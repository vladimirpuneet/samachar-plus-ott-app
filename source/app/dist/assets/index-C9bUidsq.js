function H0(s,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in s)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function sh(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function jT(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var Ic={exports:{}},Xi={},Rc={exports:{}},Ce={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ap;function GT(){if(Ap)return Ce;Ap=1;var s=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.iterator;function m(C){return C===null||typeof C!="object"?null:(C=g&&C[g]||C["@@iterator"],typeof C=="function"?C:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,T={};function S(C,N,te){this.props=C,this.context=N,this.refs=T,this.updater=te||y}S.prototype.isReactComponent={},S.prototype.setState=function(C,N){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,N,"setState")},S.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function w(){}w.prototype=S.prototype;function b(C,N,te){this.props=C,this.context=N,this.refs=T,this.updater=te||y}var A=b.prototype=new w;A.constructor=b,v(A,S.prototype),A.isPureReactComponent=!0;var L=Array.isArray,k=Object.prototype.hasOwnProperty,O={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function $(C,N,te){var ce,de={},fe=null,Le=null;if(N!=null)for(ce in N.ref!==void 0&&(Le=N.ref),N.key!==void 0&&(fe=""+N.key),N)k.call(N,ce)&&!P.hasOwnProperty(ce)&&(de[ce]=N[ce]);var Ae=arguments.length-2;if(Ae===1)de.children=te;else if(1<Ae){for(var De=Array(Ae),ze=0;ze<Ae;ze++)De[ze]=arguments[ze+2];de.children=De}if(C&&C.defaultProps)for(ce in Ae=C.defaultProps,Ae)de[ce]===void 0&&(de[ce]=Ae[ce]);return{$$typeof:s,type:C,key:fe,ref:Le,props:de,_owner:O.current}}function B(C,N){return{$$typeof:s,type:C.type,key:N,ref:C.ref,props:C.props,_owner:C._owner}}function U(C){return typeof C=="object"&&C!==null&&C.$$typeof===s}function q(C){var N={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(te){return N[te]})}var re=/\/+/g;function ae(C,N){return typeof C=="object"&&C!==null&&C.key!=null?q(""+C.key):N.toString(36)}function le(C,N,te,ce,de){var fe=typeof C;(fe==="undefined"||fe==="boolean")&&(C=null);var Le=!1;if(C===null)Le=!0;else switch(fe){case"string":case"number":Le=!0;break;case"object":switch(C.$$typeof){case s:case e:Le=!0}}if(Le)return Le=C,de=de(Le),C=ce===""?"."+ae(Le,0):ce,L(de)?(te="",C!=null&&(te=C.replace(re,"$&/")+"/"),le(de,N,te,"",function(ze){return ze})):de!=null&&(U(de)&&(de=B(de,te+(!de.key||Le&&Le.key===de.key?"":(""+de.key).replace(re,"$&/")+"/")+C)),N.push(de)),1;if(Le=0,ce=ce===""?".":ce+":",L(C))for(var Ae=0;Ae<C.length;Ae++){fe=C[Ae];var De=ce+ae(fe,Ae);Le+=le(fe,N,te,De,de)}else if(De=m(C),typeof De=="function")for(C=De.call(C),Ae=0;!(fe=C.next()).done;)fe=fe.value,De=ce+ae(fe,Ae++),Le+=le(fe,N,te,De,de);else if(fe==="object")throw N=String(C),Error("Objects are not valid as a React child (found: "+(N==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":N)+"). If you meant to render a collection of children, use an array instead.");return Le}function oe(C,N,te){if(C==null)return C;var ce=[],de=0;return le(C,ce,"","",function(fe){return N.call(te,fe,de++)}),ce}function J(C){if(C._status===-1){var N=C._result;N=N(),N.then(function(te){(C._status===0||C._status===-1)&&(C._status=1,C._result=te)},function(te){(C._status===0||C._status===-1)&&(C._status=2,C._result=te)}),C._status===-1&&(C._status=0,C._result=N)}if(C._status===1)return C._result.default;throw C._result}var se={current:null},F={transition:null},Y={ReactCurrentDispatcher:se,ReactCurrentBatchConfig:F,ReactCurrentOwner:O};function Q(){throw Error("act(...) is not supported in production builds of React.")}return Ce.Children={map:oe,forEach:function(C,N,te){oe(C,function(){N.apply(this,arguments)},te)},count:function(C){var N=0;return oe(C,function(){N++}),N},toArray:function(C){return oe(C,function(N){return N})||[]},only:function(C){if(!U(C))throw Error("React.Children.only expected to receive a single React element child.");return C}},Ce.Component=S,Ce.Fragment=t,Ce.Profiler=n,Ce.PureComponent=b,Ce.StrictMode=r,Ce.Suspense=c,Ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y,Ce.act=Q,Ce.cloneElement=function(C,N,te){if(C==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+C+".");var ce=v({},C.props),de=C.key,fe=C.ref,Le=C._owner;if(N!=null){if(N.ref!==void 0&&(fe=N.ref,Le=O.current),N.key!==void 0&&(de=""+N.key),C.type&&C.type.defaultProps)var Ae=C.type.defaultProps;for(De in N)k.call(N,De)&&!P.hasOwnProperty(De)&&(ce[De]=N[De]===void 0&&Ae!==void 0?Ae[De]:N[De])}var De=arguments.length-2;if(De===1)ce.children=te;else if(1<De){Ae=Array(De);for(var ze=0;ze<De;ze++)Ae[ze]=arguments[ze+2];ce.children=Ae}return{$$typeof:s,type:C.type,key:de,ref:fe,props:ce,_owner:Le}},Ce.createContext=function(C){return C={$$typeof:o,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},C.Provider={$$typeof:i,_context:C},C.Consumer=C},Ce.createElement=$,Ce.createFactory=function(C){var N=$.bind(null,C);return N.type=C,N},Ce.createRef=function(){return{current:null}},Ce.forwardRef=function(C){return{$$typeof:u,render:C}},Ce.isValidElement=U,Ce.lazy=function(C){return{$$typeof:f,_payload:{_status:-1,_result:C},_init:J}},Ce.memo=function(C,N){return{$$typeof:d,type:C,compare:N===void 0?null:N}},Ce.startTransition=function(C){var N=F.transition;F.transition={};try{C()}finally{F.transition=N}},Ce.unstable_act=Q,Ce.useCallback=function(C,N){return se.current.useCallback(C,N)},Ce.useContext=function(C){return se.current.useContext(C)},Ce.useDebugValue=function(){},Ce.useDeferredValue=function(C){return se.current.useDeferredValue(C)},Ce.useEffect=function(C,N){return se.current.useEffect(C,N)},Ce.useId=function(){return se.current.useId()},Ce.useImperativeHandle=function(C,N,te){return se.current.useImperativeHandle(C,N,te)},Ce.useInsertionEffect=function(C,N){return se.current.useInsertionEffect(C,N)},Ce.useLayoutEffect=function(C,N){return se.current.useLayoutEffect(C,N)},Ce.useMemo=function(C,N){return se.current.useMemo(C,N)},Ce.useReducer=function(C,N,te){return se.current.useReducer(C,N,te)},Ce.useRef=function(C){return se.current.useRef(C)},Ce.useState=function(C){return se.current.useState(C)},Ce.useSyncExternalStore=function(C,N,te){return se.current.useSyncExternalStore(C,N,te)},Ce.useTransition=function(){return se.current.useTransition()},Ce.version="18.3.1",Ce}var bp;function ih(){return bp||(bp=1,Rc.exports=GT()),Rc.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ip;function VT(){if(Ip)return Xi;Ip=1;var s=ih(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(u,c,d){var f,g={},m=null,y=null;d!==void 0&&(m=""+d),c.key!==void 0&&(m=""+c.key),c.ref!==void 0&&(y=c.ref);for(f in c)r.call(c,f)&&!i.hasOwnProperty(f)&&(g[f]=c[f]);if(u&&u.defaultProps)for(f in c=u.defaultProps,c)g[f]===void 0&&(g[f]=c[f]);return{$$typeof:e,type:u,key:m,ref:y,props:g,_owner:n.current}}return Xi.Fragment=t,Xi.jsx=o,Xi.jsxs=o,Xi}var Rp;function KT(){return Rp||(Rp=1,Ic.exports=VT()),Ic.exports}var R=KT(),W=ih();const W0=sh(W),HT=H0({__proto__:null,default:W0},[W]);var ko={},Lc={exports:{}},Bt={},kc={exports:{}},Cc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lp;function WT(){return Lp||(Lp=1,(function(s){function e(F,Y){var Q=F.length;F.push(Y);e:for(;0<Q;){var C=Q-1>>>1,N=F[C];if(0<n(N,Y))F[C]=Y,F[Q]=N,Q=C;else break e}}function t(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var Y=F[0],Q=F.pop();if(Q!==Y){F[0]=Q;e:for(var C=0,N=F.length,te=N>>>1;C<te;){var ce=2*(C+1)-1,de=F[ce],fe=ce+1,Le=F[fe];if(0>n(de,Q))fe<N&&0>n(Le,de)?(F[C]=Le,F[fe]=Q,C=fe):(F[C]=de,F[ce]=Q,C=ce);else if(fe<N&&0>n(Le,Q))F[C]=Le,F[fe]=Q,C=fe;else break e}}return Y}function n(F,Y){var Q=F.sortIndex-Y.sortIndex;return Q!==0?Q:F.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var o=Date,u=o.now();s.unstable_now=function(){return o.now()-u}}var c=[],d=[],f=1,g=null,m=3,y=!1,v=!1,T=!1,S=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(F){for(var Y=t(d);Y!==null;){if(Y.callback===null)r(d);else if(Y.startTime<=F)r(d),Y.sortIndex=Y.expirationTime,e(c,Y);else break;Y=t(d)}}function L(F){if(T=!1,A(F),!v)if(t(c)!==null)v=!0,J(k);else{var Y=t(d);Y!==null&&se(L,Y.startTime-F)}}function k(F,Y){v=!1,T&&(T=!1,w($),$=-1),y=!0;var Q=m;try{for(A(Y),g=t(c);g!==null&&(!(g.expirationTime>Y)||F&&!q());){var C=g.callback;if(typeof C=="function"){g.callback=null,m=g.priorityLevel;var N=C(g.expirationTime<=Y);Y=s.unstable_now(),typeof N=="function"?g.callback=N:g===t(c)&&r(c),A(Y)}else r(c);g=t(c)}if(g!==null)var te=!0;else{var ce=t(d);ce!==null&&se(L,ce.startTime-Y),te=!1}return te}finally{g=null,m=Q,y=!1}}var O=!1,P=null,$=-1,B=5,U=-1;function q(){return!(s.unstable_now()-U<B)}function re(){if(P!==null){var F=s.unstable_now();U=F;var Y=!0;try{Y=P(!0,F)}finally{Y?ae():(O=!1,P=null)}}else O=!1}var ae;if(typeof b=="function")ae=function(){b(re)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,oe=le.port2;le.port1.onmessage=re,ae=function(){oe.postMessage(null)}}else ae=function(){S(re,0)};function J(F){P=F,O||(O=!0,ae())}function se(F,Y){$=S(function(){F(s.unstable_now())},Y)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(F){F.callback=null},s.unstable_continueExecution=function(){v||y||(v=!0,J(k))},s.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<F?Math.floor(1e3/F):5},s.unstable_getCurrentPriorityLevel=function(){return m},s.unstable_getFirstCallbackNode=function(){return t(c)},s.unstable_next=function(F){switch(m){case 1:case 2:case 3:var Y=3;break;default:Y=m}var Q=m;m=Y;try{return F()}finally{m=Q}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(F,Y){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Q=m;m=F;try{return Y()}finally{m=Q}},s.unstable_scheduleCallback=function(F,Y,Q){var C=s.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?C+Q:C):Q=C,F){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=Q+N,F={id:f++,callback:Y,priorityLevel:F,startTime:Q,expirationTime:N,sortIndex:-1},Q>C?(F.sortIndex=Q,e(d,F),t(c)===null&&F===t(d)&&(T?(w($),$=-1):T=!0,se(L,Q-C))):(F.sortIndex=N,e(c,F),v||y||(v=!0,J(k))),F},s.unstable_shouldYield=q,s.unstable_wrapCallback=function(F){var Y=m;return function(){var Q=m;m=Y;try{return F.apply(this,arguments)}finally{m=Q}}}})(Cc)),Cc}var kp;function zT(){return kp||(kp=1,kc.exports=WT()),kc.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cp;function qT(){if(Cp)return Bt;Cp=1;var s=ih(),e=zT();function t(a){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+a,h=1;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,n={};function i(a,l){o(a,l),o(a+"Capture",l)}function o(a,l){for(n[a]=l,a=0;a<l.length;a++)r.add(l[a])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},g={};function m(a){return c.call(g,a)?!0:c.call(f,a)?!1:d.test(a)?g[a]=!0:(f[a]=!0,!1)}function y(a,l,h,p){if(h!==null&&h.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return p?!1:h!==null?!h.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function v(a,l,h,p){if(l===null||typeof l>"u"||y(a,l,h,p))return!0;if(p)return!1;if(h!==null)switch(h.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function T(a,l,h,p,E,x,I){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=p,this.attributeNamespace=E,this.mustUseProperty=h,this.propertyName=a,this.type=l,this.sanitizeURL=x,this.removeEmptyString=I}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){S[a]=new T(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var l=a[0];S[l]=new T(l,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){S[a]=new T(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){S[a]=new T(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){S[a]=new T(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){S[a]=new T(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){S[a]=new T(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){S[a]=new T(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){S[a]=new T(a,5,!1,a.toLowerCase(),null,!1,!1)});var w=/[\-:]([a-z])/g;function b(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var l=a.replace(w,b);S[l]=new T(l,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var l=a.replace(w,b);S[l]=new T(l,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var l=a.replace(w,b);S[l]=new T(l,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){S[a]=new T(a,1,!1,a.toLowerCase(),null,!1,!1)}),S.xlinkHref=new T("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){S[a]=new T(a,1,!1,a.toLowerCase(),null,!0,!0)});function A(a,l,h,p){var E=S.hasOwnProperty(l)?S[l]:null;(E!==null?E.type!==0:p||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(v(l,h,E,p)&&(h=null),p||E===null?m(l)&&(h===null?a.removeAttribute(l):a.setAttribute(l,""+h)):E.mustUseProperty?a[E.propertyName]=h===null?E.type===3?!1:"":h:(l=E.attributeName,p=E.attributeNamespace,h===null?a.removeAttribute(l):(E=E.type,h=E===3||E===4&&h===!0?"":""+h,p?a.setAttributeNS(p,l,h):a.setAttribute(l,h))))}var L=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),O=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),U=Symbol.for("react.provider"),q=Symbol.for("react.context"),re=Symbol.for("react.forward_ref"),ae=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),se=Symbol.for("react.offscreen"),F=Symbol.iterator;function Y(a){return a===null||typeof a!="object"?null:(a=F&&a[F]||a["@@iterator"],typeof a=="function"?a:null)}var Q=Object.assign,C;function N(a){if(C===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);C=l&&l[1]||""}return`
`+C+a}var te=!1;function ce(a,l){if(!a||te)return"";te=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(z){var p=z}Reflect.construct(a,[],l)}else{try{l.call()}catch(z){p=z}a.call(l.prototype)}else{try{throw Error()}catch(z){p=z}a()}}catch(z){if(z&&p&&typeof z.stack=="string"){for(var E=z.stack.split(`
`),x=p.stack.split(`
`),I=E.length-1,D=x.length-1;1<=I&&0<=D&&E[I]!==x[D];)D--;for(;1<=I&&0<=D;I--,D--)if(E[I]!==x[D]){if(I!==1||D!==1)do if(I--,D--,0>D||E[I]!==x[D]){var M=`
`+E[I].replace(" at new "," at ");return a.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",a.displayName)),M}while(1<=I&&0<=D);break}}}finally{te=!1,Error.prepareStackTrace=h}return(a=a?a.displayName||a.name:"")?N(a):""}function de(a){switch(a.tag){case 5:return N(a.type);case 16:return N("Lazy");case 13:return N("Suspense");case 19:return N("SuspenseList");case 0:case 2:case 15:return a=ce(a.type,!1),a;case 11:return a=ce(a.type.render,!1),a;case 1:return a=ce(a.type,!0),a;default:return""}}function fe(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case P:return"Fragment";case O:return"Portal";case B:return"Profiler";case $:return"StrictMode";case ae:return"Suspense";case le:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case q:return(a.displayName||"Context")+".Consumer";case U:return(a._context.displayName||"Context")+".Provider";case re:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case oe:return l=a.displayName||null,l!==null?l:fe(a.type)||"Memo";case J:l=a._payload,a=a._init;try{return fe(a(l))}catch{}}return null}function Le(a){var l=a.type;switch(a.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=l.render,a=a.displayName||a.name||"",l.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(l);case 8:return l===$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Ae(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function De(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function ze(a){var l=De(a)?"checked":"value",h=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),p=""+a[l];if(!a.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var E=h.get,x=h.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return E.call(this)},set:function(I){p=""+I,x.call(this,I)}}),Object.defineProperty(a,l,{enumerable:h.enumerable}),{getValue:function(){return p},setValue:function(I){p=""+I},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function tr(a){a._valueTracker||(a._valueTracker=ze(a))}function Ta(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var h=l.getValue(),p="";return a&&(p=De(a)?a.checked?"true":"false":a.value),a=p,a!==h?(l.setValue(a),!0):!1}function tn(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Mn(a,l){var h=l.checked;return Q({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??a._wrapperState.initialChecked})}function Ul(a,l){var h=l.defaultValue==null?"":l.defaultValue,p=l.checked!=null?l.checked:l.defaultChecked;h=Ae(l.value!=null?l.value:h),a._wrapperState={initialChecked:p,initialValue:h,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function Oe(a,l){l=l.checked,l!=null&&A(a,"checked",l,!1)}function it(a,l){Oe(a,l);var h=Ae(l.value),p=l.type;if(h!=null)p==="number"?(h===0&&a.value===""||a.value!=h)&&(a.value=""+h):a.value!==""+h&&(a.value=""+h);else if(p==="submit"||p==="reset"){a.removeAttribute("value");return}l.hasOwnProperty("value")?dr(a,l.type,h):l.hasOwnProperty("defaultValue")&&dr(a,l.type,Ae(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(a.defaultChecked=!!l.defaultChecked)}function Lt(a,l,h){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var p=l.type;if(!(p!=="submit"&&p!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+a._wrapperState.initialValue,h||l===a.value||(a.value=l),a.defaultValue=l}h=a.name,h!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,h!==""&&(a.name=h)}function dr(a,l,h){(l!=="number"||tn(a.ownerDocument)!==a)&&(h==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+h&&(a.defaultValue=""+h))}var vt=Array.isArray;function Gt(a,l,h,p){if(a=a.options,l){l={};for(var E=0;E<h.length;E++)l["$"+h[E]]=!0;for(h=0;h<a.length;h++)E=l.hasOwnProperty("$"+a[h].value),a[h].selected!==E&&(a[h].selected=E),E&&p&&(a[h].defaultSelected=!0)}else{for(h=""+Ae(h),l=null,E=0;E<a.length;E++){if(a[E].value===h){a[E].selected=!0,p&&(a[E].defaultSelected=!0);return}l!==null||a[E].disabled||(l=a[E])}l!==null&&(l.selected=!0)}}function hr(a,l){if(l.dangerouslySetInnerHTML!=null)throw Error(t(91));return Q({},l,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function hi(a,l){var h=l.value;if(h==null){if(h=l.children,l=l.defaultValue,h!=null){if(l!=null)throw Error(t(92));if(vt(h)){if(1<h.length)throw Error(t(93));h=h[0]}l=h}l==null&&(l=""),h=l}a._wrapperState={initialValue:Ae(h)}}function Fn(a,l){var h=Ae(l.value),p=Ae(l.defaultValue);h!=null&&(h=""+h,h!==a.value&&(a.value=h),l.defaultValue==null&&a.defaultValue!==h&&(a.defaultValue=h)),p!=null&&(a.defaultValue=""+p)}function fi(a){var l=a.textContent;l===a._wrapperState.initialValue&&l!==""&&l!==null&&(a.value=l)}function rn(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function hs(a,l){return a==null||a==="http://www.w3.org/1999/xhtml"?rn(l):a==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var fs,gi=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,h,p,E){MSApp.execUnsafeLocalFunction(function(){return a(l,h,p,E)})}:a})(function(a,l){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=l;else{for(fs=fs||document.createElement("div"),fs.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=fs.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}});function nn(a,l){if(l){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=l;return}}a.textContent=l}var fr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},HE=["Webkit","ms","Moz","O"];Object.keys(fr).forEach(function(a){HE.forEach(function(l){l=l+a.charAt(0).toUpperCase()+a.substring(1),fr[l]=fr[a]})});function Bh(a,l,h){return l==null||typeof l=="boolean"||l===""?"":h||typeof l!="number"||l===0||fr.hasOwnProperty(a)&&fr[a]?(""+l).trim():l+"px"}function $h(a,l){a=a.style;for(var h in l)if(l.hasOwnProperty(h)){var p=h.indexOf("--")===0,E=Bh(h,l[h],p);h==="float"&&(h="cssFloat"),p?a.setProperty(h,E):a[h]=E}}var WE=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Bl(a,l){if(l){if(WE[a]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(t(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(t(61))}if(l.style!=null&&typeof l.style!="object")throw Error(t(62))}}function $l(a,l){if(a.indexOf("-")===-1)return typeof l.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jl=null;function Gl(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Vl=null,gs=null,ps=null;function jh(a){if(a=Mi(a)){if(typeof Vl!="function")throw Error(t(280));var l=a.stateNode;l&&(l=Ka(l),Vl(a.stateNode,a.type,l))}}function Gh(a){gs?ps?ps.push(a):ps=[a]:gs=a}function Vh(){if(gs){var a=gs,l=ps;if(ps=gs=null,jh(a),l)for(a=0;a<l.length;a++)jh(l[a])}}function Kh(a,l){return a(l)}function Hh(){}var Kl=!1;function Wh(a,l,h){if(Kl)return a(l,h);Kl=!0;try{return Kh(a,l,h)}finally{Kl=!1,(gs!==null||ps!==null)&&(Hh(),Vh())}}function pi(a,l){var h=a.stateNode;if(h===null)return null;var p=Ka(h);if(p===null)return null;h=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(t(231,l,typeof h));return h}var Hl=!1;if(u)try{var mi={};Object.defineProperty(mi,"passive",{get:function(){Hl=!0}}),window.addEventListener("test",mi,mi),window.removeEventListener("test",mi,mi)}catch{Hl=!1}function zE(a,l,h,p,E,x,I,D,M){var z=Array.prototype.slice.call(arguments,3);try{l.apply(h,z)}catch(ee){this.onError(ee)}}var yi=!1,xa=null,_a=!1,Wl=null,qE={onError:function(a){yi=!0,xa=a}};function YE(a,l,h,p,E,x,I,D,M){yi=!1,xa=null,zE.apply(qE,arguments)}function QE(a,l,h,p,E,x,I,D,M){if(YE.apply(this,arguments),yi){if(yi){var z=xa;yi=!1,xa=null}else throw Error(t(198));_a||(_a=!0,Wl=z)}}function Un(a){var l=a,h=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(h=l.return),a=l.return;while(a)}return l.tag===3?h:null}function zh(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function qh(a){if(Un(a)!==a)throw Error(t(188))}function XE(a){var l=a.alternate;if(!l){if(l=Un(a),l===null)throw Error(t(188));return l!==a?null:a}for(var h=a,p=l;;){var E=h.return;if(E===null)break;var x=E.alternate;if(x===null){if(p=E.return,p!==null){h=p;continue}break}if(E.child===x.child){for(x=E.child;x;){if(x===h)return qh(E),a;if(x===p)return qh(E),l;x=x.sibling}throw Error(t(188))}if(h.return!==p.return)h=E,p=x;else{for(var I=!1,D=E.child;D;){if(D===h){I=!0,h=E,p=x;break}if(D===p){I=!0,p=E,h=x;break}D=D.sibling}if(!I){for(D=x.child;D;){if(D===h){I=!0,h=x,p=E;break}if(D===p){I=!0,p=x,h=E;break}D=D.sibling}if(!I)throw Error(t(189))}}if(h.alternate!==p)throw Error(t(190))}if(h.tag!==3)throw Error(t(188));return h.stateNode.current===h?a:l}function Yh(a){return a=XE(a),a!==null?Qh(a):null}function Qh(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var l=Qh(a);if(l!==null)return l;a=a.sibling}return null}var Xh=e.unstable_scheduleCallback,Jh=e.unstable_cancelCallback,JE=e.unstable_shouldYield,ZE=e.unstable_requestPaint,nt=e.unstable_now,eS=e.unstable_getCurrentPriorityLevel,zl=e.unstable_ImmediatePriority,Zh=e.unstable_UserBlockingPriority,wa=e.unstable_NormalPriority,tS=e.unstable_LowPriority,ef=e.unstable_IdlePriority,Aa=null,br=null;function rS(a){if(br&&typeof br.onCommitFiberRoot=="function")try{br.onCommitFiberRoot(Aa,a,void 0,(a.current.flags&128)===128)}catch{}}var gr=Math.clz32?Math.clz32:iS,nS=Math.log,sS=Math.LN2;function iS(a){return a>>>=0,a===0?32:31-(nS(a)/sS|0)|0}var ba=64,Ia=4194304;function vi(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Ra(a,l){var h=a.pendingLanes;if(h===0)return 0;var p=0,E=a.suspendedLanes,x=a.pingedLanes,I=h&268435455;if(I!==0){var D=I&~E;D!==0?p=vi(D):(x&=I,x!==0&&(p=vi(x)))}else I=h&~E,I!==0?p=vi(I):x!==0&&(p=vi(x));if(p===0)return 0;if(l!==0&&l!==p&&(l&E)===0&&(E=p&-p,x=l&-l,E>=x||E===16&&(x&4194240)!==0))return l;if((p&4)!==0&&(p|=h&16),l=a.entangledLanes,l!==0)for(a=a.entanglements,l&=p;0<l;)h=31-gr(l),E=1<<h,p|=a[h],l&=~E;return p}function aS(a,l){switch(a){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oS(a,l){for(var h=a.suspendedLanes,p=a.pingedLanes,E=a.expirationTimes,x=a.pendingLanes;0<x;){var I=31-gr(x),D=1<<I,M=E[I];M===-1?((D&h)===0||(D&p)!==0)&&(E[I]=aS(D,l)):M<=l&&(a.expiredLanes|=D),x&=~D}}function ql(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function tf(){var a=ba;return ba<<=1,(ba&4194240)===0&&(ba=64),a}function Yl(a){for(var l=[],h=0;31>h;h++)l.push(a);return l}function Ei(a,l,h){a.pendingLanes|=l,l!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,l=31-gr(l),a[l]=h}function lS(a,l){var h=a.pendingLanes&~l;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=l,a.mutableReadLanes&=l,a.entangledLanes&=l,l=a.entanglements;var p=a.eventTimes;for(a=a.expirationTimes;0<h;){var E=31-gr(h),x=1<<E;l[E]=0,p[E]=-1,a[E]=-1,h&=~x}}function Ql(a,l){var h=a.entangledLanes|=l;for(a=a.entanglements;h;){var p=31-gr(h),E=1<<p;E&l|a[p]&l&&(a[p]|=l),h&=~E}}var Fe=0;function rf(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var nf,Xl,sf,af,of,Jl=!1,La=[],sn=null,an=null,on=null,Si=new Map,Ti=new Map,ln=[],uS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lf(a,l){switch(a){case"focusin":case"focusout":sn=null;break;case"dragenter":case"dragleave":an=null;break;case"mouseover":case"mouseout":on=null;break;case"pointerover":case"pointerout":Si.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ti.delete(l.pointerId)}}function xi(a,l,h,p,E,x){return a===null||a.nativeEvent!==x?(a={blockedOn:l,domEventName:h,eventSystemFlags:p,nativeEvent:x,targetContainers:[E]},l!==null&&(l=Mi(l),l!==null&&Xl(l)),a):(a.eventSystemFlags|=p,l=a.targetContainers,E!==null&&l.indexOf(E)===-1&&l.push(E),a)}function cS(a,l,h,p,E){switch(l){case"focusin":return sn=xi(sn,a,l,h,p,E),!0;case"dragenter":return an=xi(an,a,l,h,p,E),!0;case"mouseover":return on=xi(on,a,l,h,p,E),!0;case"pointerover":var x=E.pointerId;return Si.set(x,xi(Si.get(x)||null,a,l,h,p,E)),!0;case"gotpointercapture":return x=E.pointerId,Ti.set(x,xi(Ti.get(x)||null,a,l,h,p,E)),!0}return!1}function uf(a){var l=Bn(a.target);if(l!==null){var h=Un(l);if(h!==null){if(l=h.tag,l===13){if(l=zh(h),l!==null){a.blockedOn=l,of(a.priority,function(){sf(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ka(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var h=eu(a.domEventName,a.eventSystemFlags,l[0],a.nativeEvent);if(h===null){h=a.nativeEvent;var p=new h.constructor(h.type,h);jl=p,h.target.dispatchEvent(p),jl=null}else return l=Mi(h),l!==null&&Xl(l),a.blockedOn=h,!1;l.shift()}return!0}function cf(a,l,h){ka(a)&&h.delete(l)}function dS(){Jl=!1,sn!==null&&ka(sn)&&(sn=null),an!==null&&ka(an)&&(an=null),on!==null&&ka(on)&&(on=null),Si.forEach(cf),Ti.forEach(cf)}function _i(a,l){a.blockedOn===l&&(a.blockedOn=null,Jl||(Jl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,dS)))}function wi(a){function l(E){return _i(E,a)}if(0<La.length){_i(La[0],a);for(var h=1;h<La.length;h++){var p=La[h];p.blockedOn===a&&(p.blockedOn=null)}}for(sn!==null&&_i(sn,a),an!==null&&_i(an,a),on!==null&&_i(on,a),Si.forEach(l),Ti.forEach(l),h=0;h<ln.length;h++)p=ln[h],p.blockedOn===a&&(p.blockedOn=null);for(;0<ln.length&&(h=ln[0],h.blockedOn===null);)uf(h),h.blockedOn===null&&ln.shift()}var ms=L.ReactCurrentBatchConfig,Ca=!0;function hS(a,l,h,p){var E=Fe,x=ms.transition;ms.transition=null;try{Fe=1,Zl(a,l,h,p)}finally{Fe=E,ms.transition=x}}function fS(a,l,h,p){var E=Fe,x=ms.transition;ms.transition=null;try{Fe=4,Zl(a,l,h,p)}finally{Fe=E,ms.transition=x}}function Zl(a,l,h,p){if(Ca){var E=eu(a,l,h,p);if(E===null)yu(a,l,p,Pa,h),lf(a,p);else if(cS(E,a,l,h,p))p.stopPropagation();else if(lf(a,p),l&4&&-1<uS.indexOf(a)){for(;E!==null;){var x=Mi(E);if(x!==null&&nf(x),x=eu(a,l,h,p),x===null&&yu(a,l,p,Pa,h),x===E)break;E=x}E!==null&&p.stopPropagation()}else yu(a,l,p,null,h)}}var Pa=null;function eu(a,l,h,p){if(Pa=null,a=Gl(p),a=Bn(a),a!==null)if(l=Un(a),l===null)a=null;else if(h=l.tag,h===13){if(a=zh(l),a!==null)return a;a=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null);return Pa=a,null}function df(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(eS()){case zl:return 1;case Zh:return 4;case wa:case tS:return 16;case ef:return 536870912;default:return 16}default:return 16}}var un=null,tu=null,Da=null;function hf(){if(Da)return Da;var a,l=tu,h=l.length,p,E="value"in un?un.value:un.textContent,x=E.length;for(a=0;a<h&&l[a]===E[a];a++);var I=h-a;for(p=1;p<=I&&l[h-p]===E[x-p];p++);return Da=E.slice(a,1<p?1-p:void 0)}function Oa(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function Na(){return!0}function ff(){return!1}function Vt(a){function l(h,p,E,x,I){this._reactName=h,this._targetInst=E,this.type=p,this.nativeEvent=x,this.target=I,this.currentTarget=null;for(var D in a)a.hasOwnProperty(D)&&(h=a[D],this[D]=h?h(x):x[D]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Na:ff,this.isPropagationStopped=ff,this}return Q(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Na)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Na)},persist:function(){},isPersistent:Na}),l}var ys={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ru=Vt(ys),Ai=Q({},ys,{view:0,detail:0}),gS=Vt(Ai),nu,su,bi,Ma=Q({},Ai,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:au,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==bi&&(bi&&a.type==="mousemove"?(nu=a.screenX-bi.screenX,su=a.screenY-bi.screenY):su=nu=0,bi=a),nu)},movementY:function(a){return"movementY"in a?a.movementY:su}}),gf=Vt(Ma),pS=Q({},Ma,{dataTransfer:0}),mS=Vt(pS),yS=Q({},Ai,{relatedTarget:0}),iu=Vt(yS),vS=Q({},ys,{animationName:0,elapsedTime:0,pseudoElement:0}),ES=Vt(vS),SS=Q({},ys,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),TS=Vt(SS),xS=Q({},ys,{data:0}),pf=Vt(xS),_S={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bS(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=AS[a])?!!l[a]:!1}function au(){return bS}var IS=Q({},Ai,{key:function(a){if(a.key){var l=_S[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=Oa(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?wS[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:au,charCode:function(a){return a.type==="keypress"?Oa(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Oa(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),RS=Vt(IS),LS=Q({},Ma,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mf=Vt(LS),kS=Q({},Ai,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:au}),CS=Vt(kS),PS=Q({},ys,{propertyName:0,elapsedTime:0,pseudoElement:0}),DS=Vt(PS),OS=Q({},Ma,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),NS=Vt(OS),MS=[9,13,27,32],ou=u&&"CompositionEvent"in window,Ii=null;u&&"documentMode"in document&&(Ii=document.documentMode);var FS=u&&"TextEvent"in window&&!Ii,yf=u&&(!ou||Ii&&8<Ii&&11>=Ii),vf=" ",Ef=!1;function Sf(a,l){switch(a){case"keyup":return MS.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tf(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var vs=!1;function US(a,l){switch(a){case"compositionend":return Tf(l);case"keypress":return l.which!==32?null:(Ef=!0,vf);case"textInput":return a=l.data,a===vf&&Ef?null:a;default:return null}}function BS(a,l){if(vs)return a==="compositionend"||!ou&&Sf(a,l)?(a=hf(),Da=tu=un=null,vs=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return yf&&l.locale!=="ko"?null:l.data;default:return null}}var $S={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xf(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!$S[a.type]:l==="textarea"}function _f(a,l,h,p){Gh(p),l=ja(l,"onChange"),0<l.length&&(h=new ru("onChange","change",null,h,p),a.push({event:h,listeners:l}))}var Ri=null,Li=null;function jS(a){jf(a,0)}function Fa(a){var l=_s(a);if(Ta(l))return a}function GS(a,l){if(a==="change")return l}var wf=!1;if(u){var lu;if(u){var uu="oninput"in document;if(!uu){var Af=document.createElement("div");Af.setAttribute("oninput","return;"),uu=typeof Af.oninput=="function"}lu=uu}else lu=!1;wf=lu&&(!document.documentMode||9<document.documentMode)}function bf(){Ri&&(Ri.detachEvent("onpropertychange",If),Li=Ri=null)}function If(a){if(a.propertyName==="value"&&Fa(Li)){var l=[];_f(l,Li,a,Gl(a)),Wh(jS,l)}}function VS(a,l,h){a==="focusin"?(bf(),Ri=l,Li=h,Ri.attachEvent("onpropertychange",If)):a==="focusout"&&bf()}function KS(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Fa(Li)}function HS(a,l){if(a==="click")return Fa(l)}function WS(a,l){if(a==="input"||a==="change")return Fa(l)}function zS(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var pr=typeof Object.is=="function"?Object.is:zS;function ki(a,l){if(pr(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var h=Object.keys(a),p=Object.keys(l);if(h.length!==p.length)return!1;for(p=0;p<h.length;p++){var E=h[p];if(!c.call(l,E)||!pr(a[E],l[E]))return!1}return!0}function Rf(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Lf(a,l){var h=Rf(a);a=0;for(var p;h;){if(h.nodeType===3){if(p=a+h.textContent.length,a<=l&&p>=l)return{node:h,offset:l-a};a=p}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Rf(h)}}function kf(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?kf(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function Cf(){for(var a=window,l=tn();l instanceof a.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)a=l.contentWindow;else break;l=tn(a.document)}return l}function cu(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}function qS(a){var l=Cf(),h=a.focusedElem,p=a.selectionRange;if(l!==h&&h&&h.ownerDocument&&kf(h.ownerDocument.documentElement,h)){if(p!==null&&cu(h)){if(l=p.start,a=p.end,a===void 0&&(a=l),"selectionStart"in h)h.selectionStart=l,h.selectionEnd=Math.min(a,h.value.length);else if(a=(l=h.ownerDocument||document)&&l.defaultView||window,a.getSelection){a=a.getSelection();var E=h.textContent.length,x=Math.min(p.start,E);p=p.end===void 0?x:Math.min(p.end,E),!a.extend&&x>p&&(E=p,p=x,x=E),E=Lf(h,x);var I=Lf(h,p);E&&I&&(a.rangeCount!==1||a.anchorNode!==E.node||a.anchorOffset!==E.offset||a.focusNode!==I.node||a.focusOffset!==I.offset)&&(l=l.createRange(),l.setStart(E.node,E.offset),a.removeAllRanges(),x>p?(a.addRange(l),a.extend(I.node,I.offset)):(l.setEnd(I.node,I.offset),a.addRange(l)))}}for(l=[],a=h;a=a.parentNode;)a.nodeType===1&&l.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<l.length;h++)a=l[h],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var YS=u&&"documentMode"in document&&11>=document.documentMode,Es=null,du=null,Ci=null,hu=!1;function Pf(a,l,h){var p=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;hu||Es==null||Es!==tn(p)||(p=Es,"selectionStart"in p&&cu(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Ci&&ki(Ci,p)||(Ci=p,p=ja(du,"onSelect"),0<p.length&&(l=new ru("onSelect","select",null,l,h),a.push({event:l,listeners:p}),l.target=Es)))}function Ua(a,l){var h={};return h[a.toLowerCase()]=l.toLowerCase(),h["Webkit"+a]="webkit"+l,h["Moz"+a]="moz"+l,h}var Ss={animationend:Ua("Animation","AnimationEnd"),animationiteration:Ua("Animation","AnimationIteration"),animationstart:Ua("Animation","AnimationStart"),transitionend:Ua("Transition","TransitionEnd")},fu={},Df={};u&&(Df=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function Ba(a){if(fu[a])return fu[a];if(!Ss[a])return a;var l=Ss[a],h;for(h in l)if(l.hasOwnProperty(h)&&h in Df)return fu[a]=l[h];return a}var Of=Ba("animationend"),Nf=Ba("animationiteration"),Mf=Ba("animationstart"),Ff=Ba("transitionend"),Uf=new Map,Bf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cn(a,l){Uf.set(a,l),i(l,[a])}for(var gu=0;gu<Bf.length;gu++){var pu=Bf[gu],QS=pu.toLowerCase(),XS=pu[0].toUpperCase()+pu.slice(1);cn(QS,"on"+XS)}cn(Of,"onAnimationEnd"),cn(Nf,"onAnimationIteration"),cn(Mf,"onAnimationStart"),cn("dblclick","onDoubleClick"),cn("focusin","onFocus"),cn("focusout","onBlur"),cn(Ff,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pi));function $f(a,l,h){var p=a.type||"unknown-event";a.currentTarget=h,QE(p,l,void 0,a),a.currentTarget=null}function jf(a,l){l=(l&4)!==0;for(var h=0;h<a.length;h++){var p=a[h],E=p.event;p=p.listeners;e:{var x=void 0;if(l)for(var I=p.length-1;0<=I;I--){var D=p[I],M=D.instance,z=D.currentTarget;if(D=D.listener,M!==x&&E.isPropagationStopped())break e;$f(E,D,z),x=M}else for(I=0;I<p.length;I++){if(D=p[I],M=D.instance,z=D.currentTarget,D=D.listener,M!==x&&E.isPropagationStopped())break e;$f(E,D,z),x=M}}}if(_a)throw a=Wl,_a=!1,Wl=null,a}function He(a,l){var h=l[_u];h===void 0&&(h=l[_u]=new Set);var p=a+"__bubble";h.has(p)||(Gf(l,a,2,!1),h.add(p))}function mu(a,l,h){var p=0;l&&(p|=4),Gf(h,a,p,l)}var $a="_reactListening"+Math.random().toString(36).slice(2);function Di(a){if(!a[$a]){a[$a]=!0,r.forEach(function(h){h!=="selectionchange"&&(JS.has(h)||mu(h,!1,a),mu(h,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[$a]||(l[$a]=!0,mu("selectionchange",!1,l))}}function Gf(a,l,h,p){switch(df(l)){case 1:var E=hS;break;case 4:E=fS;break;default:E=Zl}h=E.bind(null,l,h,a),E=void 0,!Hl||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(E=!0),p?E!==void 0?a.addEventListener(l,h,{capture:!0,passive:E}):a.addEventListener(l,h,!0):E!==void 0?a.addEventListener(l,h,{passive:E}):a.addEventListener(l,h,!1)}function yu(a,l,h,p,E){var x=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var I=p.tag;if(I===3||I===4){var D=p.stateNode.containerInfo;if(D===E||D.nodeType===8&&D.parentNode===E)break;if(I===4)for(I=p.return;I!==null;){var M=I.tag;if((M===3||M===4)&&(M=I.stateNode.containerInfo,M===E||M.nodeType===8&&M.parentNode===E))return;I=I.return}for(;D!==null;){if(I=Bn(D),I===null)return;if(M=I.tag,M===5||M===6){p=x=I;continue e}D=D.parentNode}}p=p.return}Wh(function(){var z=x,ee=Gl(h),ne=[];e:{var Z=Uf.get(a);if(Z!==void 0){var he=ru,me=a;switch(a){case"keypress":if(Oa(h)===0)break e;case"keydown":case"keyup":he=RS;break;case"focusin":me="focus",he=iu;break;case"focusout":me="blur",he=iu;break;case"beforeblur":case"afterblur":he=iu;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=gf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=mS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=CS;break;case Of:case Nf:case Mf:he=ES;break;case Ff:he=DS;break;case"scroll":he=gS;break;case"wheel":he=NS;break;case"copy":case"cut":case"paste":he=TS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=mf}var ye=(l&4)!==0,st=!ye&&a==="scroll",K=ye?Z!==null?Z+"Capture":null:Z;ye=[];for(var j=z,H;j!==null;){H=j;var ie=H.stateNode;if(H.tag===5&&ie!==null&&(H=ie,K!==null&&(ie=pi(j,K),ie!=null&&ye.push(Oi(j,ie,H)))),st)break;j=j.return}0<ye.length&&(Z=new he(Z,me,null,h,ee),ne.push({event:Z,listeners:ye}))}}if((l&7)===0){e:{if(Z=a==="mouseover"||a==="pointerover",he=a==="mouseout"||a==="pointerout",Z&&h!==jl&&(me=h.relatedTarget||h.fromElement)&&(Bn(me)||me[jr]))break e;if((he||Z)&&(Z=ee.window===ee?ee:(Z=ee.ownerDocument)?Z.defaultView||Z.parentWindow:window,he?(me=h.relatedTarget||h.toElement,he=z,me=me?Bn(me):null,me!==null&&(st=Un(me),me!==st||me.tag!==5&&me.tag!==6)&&(me=null)):(he=null,me=z),he!==me)){if(ye=gf,ie="onMouseLeave",K="onMouseEnter",j="mouse",(a==="pointerout"||a==="pointerover")&&(ye=mf,ie="onPointerLeave",K="onPointerEnter",j="pointer"),st=he==null?Z:_s(he),H=me==null?Z:_s(me),Z=new ye(ie,j+"leave",he,h,ee),Z.target=st,Z.relatedTarget=H,ie=null,Bn(ee)===z&&(ye=new ye(K,j+"enter",me,h,ee),ye.target=H,ye.relatedTarget=st,ie=ye),st=ie,he&&me)t:{for(ye=he,K=me,j=0,H=ye;H;H=Ts(H))j++;for(H=0,ie=K;ie;ie=Ts(ie))H++;for(;0<j-H;)ye=Ts(ye),j--;for(;0<H-j;)K=Ts(K),H--;for(;j--;){if(ye===K||K!==null&&ye===K.alternate)break t;ye=Ts(ye),K=Ts(K)}ye=null}else ye=null;he!==null&&Vf(ne,Z,he,ye,!1),me!==null&&st!==null&&Vf(ne,st,me,ye,!0)}}e:{if(Z=z?_s(z):window,he=Z.nodeName&&Z.nodeName.toLowerCase(),he==="select"||he==="input"&&Z.type==="file")var Ee=GS;else if(xf(Z))if(wf)Ee=WS;else{Ee=KS;var xe=VS}else(he=Z.nodeName)&&he.toLowerCase()==="input"&&(Z.type==="checkbox"||Z.type==="radio")&&(Ee=HS);if(Ee&&(Ee=Ee(a,z))){_f(ne,Ee,h,ee);break e}xe&&xe(a,Z,z),a==="focusout"&&(xe=Z._wrapperState)&&xe.controlled&&Z.type==="number"&&dr(Z,"number",Z.value)}switch(xe=z?_s(z):window,a){case"focusin":(xf(xe)||xe.contentEditable==="true")&&(Es=xe,du=z,Ci=null);break;case"focusout":Ci=du=Es=null;break;case"mousedown":hu=!0;break;case"contextmenu":case"mouseup":case"dragend":hu=!1,Pf(ne,h,ee);break;case"selectionchange":if(YS)break;case"keydown":case"keyup":Pf(ne,h,ee)}var _e;if(ou)e:{switch(a){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else vs?Sf(a,h)&&(be="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(be="onCompositionStart");be&&(yf&&h.locale!=="ko"&&(vs||be!=="onCompositionStart"?be==="onCompositionEnd"&&vs&&(_e=hf()):(un=ee,tu="value"in un?un.value:un.textContent,vs=!0)),xe=ja(z,be),0<xe.length&&(be=new pf(be,a,null,h,ee),ne.push({event:be,listeners:xe}),_e?be.data=_e:(_e=Tf(h),_e!==null&&(be.data=_e)))),(_e=FS?US(a,h):BS(a,h))&&(z=ja(z,"onBeforeInput"),0<z.length&&(ee=new pf("onBeforeInput","beforeinput",null,h,ee),ne.push({event:ee,listeners:z}),ee.data=_e))}jf(ne,l)})}function Oi(a,l,h){return{instance:a,listener:l,currentTarget:h}}function ja(a,l){for(var h=l+"Capture",p=[];a!==null;){var E=a,x=E.stateNode;E.tag===5&&x!==null&&(E=x,x=pi(a,h),x!=null&&p.unshift(Oi(a,x,E)),x=pi(a,l),x!=null&&p.push(Oi(a,x,E))),a=a.return}return p}function Ts(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Vf(a,l,h,p,E){for(var x=l._reactName,I=[];h!==null&&h!==p;){var D=h,M=D.alternate,z=D.stateNode;if(M!==null&&M===p)break;D.tag===5&&z!==null&&(D=z,E?(M=pi(h,x),M!=null&&I.unshift(Oi(h,M,D))):E||(M=pi(h,x),M!=null&&I.push(Oi(h,M,D)))),h=h.return}I.length!==0&&a.push({event:l,listeners:I})}var ZS=/\r\n?/g,eT=/\u0000|\uFFFD/g;function Kf(a){return(typeof a=="string"?a:""+a).replace(ZS,`
`).replace(eT,"")}function Ga(a,l,h){if(l=Kf(l),Kf(a)!==l&&h)throw Error(t(425))}function Va(){}var vu=null,Eu=null;function Su(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Tu=typeof setTimeout=="function"?setTimeout:void 0,tT=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,rT=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(a){return Hf.resolve(null).then(a).catch(nT)}:Tu;function nT(a){setTimeout(function(){throw a})}function xu(a,l){var h=l,p=0;do{var E=h.nextSibling;if(a.removeChild(h),E&&E.nodeType===8)if(h=E.data,h==="/$"){if(p===0){a.removeChild(E),wi(l);return}p--}else h!=="$"&&h!=="$?"&&h!=="$!"||p++;h=E}while(h);wi(l)}function dn(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return a}function Wf(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return a;l--}else h==="/$"&&l++}a=a.previousSibling}return null}var xs=Math.random().toString(36).slice(2),Ir="__reactFiber$"+xs,Ni="__reactProps$"+xs,jr="__reactContainer$"+xs,_u="__reactEvents$"+xs,sT="__reactListeners$"+xs,iT="__reactHandles$"+xs;function Bn(a){var l=a[Ir];if(l)return l;for(var h=a.parentNode;h;){if(l=h[jr]||h[Ir]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(a=Wf(a);a!==null;){if(h=a[Ir])return h;a=Wf(a)}return l}a=h,h=a.parentNode}return null}function Mi(a){return a=a[Ir]||a[jr],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function _s(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function Ka(a){return a[Ni]||null}var wu=[],ws=-1;function hn(a){return{current:a}}function We(a){0>ws||(a.current=wu[ws],wu[ws]=null,ws--)}function Ve(a,l){ws++,wu[ws]=a.current,a.current=l}var fn={},wt=hn(fn),Ot=hn(!1),$n=fn;function As(a,l){var h=a.type.contextTypes;if(!h)return fn;var p=a.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===l)return p.__reactInternalMemoizedMaskedChildContext;var E={},x;for(x in h)E[x]=l[x];return p&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=l,a.__reactInternalMemoizedMaskedChildContext=E),E}function Nt(a){return a=a.childContextTypes,a!=null}function Ha(){We(Ot),We(wt)}function zf(a,l,h){if(wt.current!==fn)throw Error(t(168));Ve(wt,l),Ve(Ot,h)}function qf(a,l,h){var p=a.stateNode;if(l=l.childContextTypes,typeof p.getChildContext!="function")return h;p=p.getChildContext();for(var E in p)if(!(E in l))throw Error(t(108,Le(a)||"Unknown",E));return Q({},h,p)}function Wa(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||fn,$n=wt.current,Ve(wt,a),Ve(Ot,Ot.current),!0}function Yf(a,l,h){var p=a.stateNode;if(!p)throw Error(t(169));h?(a=qf(a,l,$n),p.__reactInternalMemoizedMergedChildContext=a,We(Ot),We(wt),Ve(wt,a)):We(Ot),Ve(Ot,h)}var Gr=null,za=!1,Au=!1;function Qf(a){Gr===null?Gr=[a]:Gr.push(a)}function aT(a){za=!0,Qf(a)}function gn(){if(!Au&&Gr!==null){Au=!0;var a=0,l=Fe;try{var h=Gr;for(Fe=1;a<h.length;a++){var p=h[a];do p=p(!0);while(p!==null)}Gr=null,za=!1}catch(E){throw Gr!==null&&(Gr=Gr.slice(a+1)),Xh(zl,gn),E}finally{Fe=l,Au=!1}}return null}var bs=[],Is=0,qa=null,Ya=0,rr=[],nr=0,jn=null,Vr=1,Kr="";function Gn(a,l){bs[Is++]=Ya,bs[Is++]=qa,qa=a,Ya=l}function Xf(a,l,h){rr[nr++]=Vr,rr[nr++]=Kr,rr[nr++]=jn,jn=a;var p=Vr;a=Kr;var E=32-gr(p)-1;p&=~(1<<E),h+=1;var x=32-gr(l)+E;if(30<x){var I=E-E%5;x=(p&(1<<I)-1).toString(32),p>>=I,E-=I,Vr=1<<32-gr(l)+E|h<<E|p,Kr=x+a}else Vr=1<<x|h<<E|p,Kr=a}function bu(a){a.return!==null&&(Gn(a,1),Xf(a,1,0))}function Iu(a){for(;a===qa;)qa=bs[--Is],bs[Is]=null,Ya=bs[--Is],bs[Is]=null;for(;a===jn;)jn=rr[--nr],rr[nr]=null,Kr=rr[--nr],rr[nr]=null,Vr=rr[--nr],rr[nr]=null}var Kt=null,Ht=null,qe=!1,mr=null;function Jf(a,l){var h=or(5,null,null,0);h.elementType="DELETED",h.stateNode=l,h.return=a,l=a.deletions,l===null?(a.deletions=[h],a.flags|=16):l.push(h)}function Zf(a,l){switch(a.tag){case 5:var h=a.type;return l=l.nodeType!==1||h.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(a.stateNode=l,Kt=a,Ht=dn(l.firstChild),!0):!1;case 6:return l=a.pendingProps===""||l.nodeType!==3?null:l,l!==null?(a.stateNode=l,Kt=a,Ht=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(h=jn!==null?{id:Vr,overflow:Kr}:null,a.memoizedState={dehydrated:l,treeContext:h,retryLane:1073741824},h=or(18,null,null,0),h.stateNode=l,h.return=a,a.child=h,Kt=a,Ht=null,!0):!1;default:return!1}}function Ru(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Lu(a){if(qe){var l=Ht;if(l){var h=l;if(!Zf(a,l)){if(Ru(a))throw Error(t(418));l=dn(h.nextSibling);var p=Kt;l&&Zf(a,l)?Jf(p,h):(a.flags=a.flags&-4097|2,qe=!1,Kt=a)}}else{if(Ru(a))throw Error(t(418));a.flags=a.flags&-4097|2,qe=!1,Kt=a}}}function eg(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Kt=a}function Qa(a){if(a!==Kt)return!1;if(!qe)return eg(a),qe=!0,!1;var l;if((l=a.tag!==3)&&!(l=a.tag!==5)&&(l=a.type,l=l!=="head"&&l!=="body"&&!Su(a.type,a.memoizedProps)),l&&(l=Ht)){if(Ru(a))throw tg(),Error(t(418));for(;l;)Jf(a,l),l=dn(l.nextSibling)}if(eg(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"){if(l===0){Ht=dn(a.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++}a=a.nextSibling}Ht=null}}else Ht=Kt?dn(a.stateNode.nextSibling):null;return!0}function tg(){for(var a=Ht;a;)a=dn(a.nextSibling)}function Rs(){Ht=Kt=null,qe=!1}function ku(a){mr===null?mr=[a]:mr.push(a)}var oT=L.ReactCurrentBatchConfig;function Fi(a,l,h){if(a=h.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(t(309));var p=h.stateNode}if(!p)throw Error(t(147,a));var E=p,x=""+a;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===x?l.ref:(l=function(I){var D=E.refs;I===null?delete D[x]:D[x]=I},l._stringRef=x,l)}if(typeof a!="string")throw Error(t(284));if(!h._owner)throw Error(t(290,a))}return a}function Xa(a,l){throw a=Object.prototype.toString.call(l),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a))}function rg(a){var l=a._init;return l(a._payload)}function ng(a){function l(K,j){if(a){var H=K.deletions;H===null?(K.deletions=[j],K.flags|=16):H.push(j)}}function h(K,j){if(!a)return null;for(;j!==null;)l(K,j),j=j.sibling;return null}function p(K,j){for(K=new Map;j!==null;)j.key!==null?K.set(j.key,j):K.set(j.index,j),j=j.sibling;return K}function E(K,j){return K=xn(K,j),K.index=0,K.sibling=null,K}function x(K,j,H){return K.index=H,a?(H=K.alternate,H!==null?(H=H.index,H<j?(K.flags|=2,j):H):(K.flags|=2,j)):(K.flags|=1048576,j)}function I(K){return a&&K.alternate===null&&(K.flags|=2),K}function D(K,j,H,ie){return j===null||j.tag!==6?(j=Tc(H,K.mode,ie),j.return=K,j):(j=E(j,H),j.return=K,j)}function M(K,j,H,ie){var Ee=H.type;return Ee===P?ee(K,j,H.props.children,ie,H.key):j!==null&&(j.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===J&&rg(Ee)===j.type)?(ie=E(j,H.props),ie.ref=Fi(K,j,H),ie.return=K,ie):(ie=xo(H.type,H.key,H.props,null,K.mode,ie),ie.ref=Fi(K,j,H),ie.return=K,ie)}function z(K,j,H,ie){return j===null||j.tag!==4||j.stateNode.containerInfo!==H.containerInfo||j.stateNode.implementation!==H.implementation?(j=xc(H,K.mode,ie),j.return=K,j):(j=E(j,H.children||[]),j.return=K,j)}function ee(K,j,H,ie,Ee){return j===null||j.tag!==7?(j=Qn(H,K.mode,ie,Ee),j.return=K,j):(j=E(j,H),j.return=K,j)}function ne(K,j,H){if(typeof j=="string"&&j!==""||typeof j=="number")return j=Tc(""+j,K.mode,H),j.return=K,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case k:return H=xo(j.type,j.key,j.props,null,K.mode,H),H.ref=Fi(K,null,j),H.return=K,H;case O:return j=xc(j,K.mode,H),j.return=K,j;case J:var ie=j._init;return ne(K,ie(j._payload),H)}if(vt(j)||Y(j))return j=Qn(j,K.mode,H,null),j.return=K,j;Xa(K,j)}return null}function Z(K,j,H,ie){var Ee=j!==null?j.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return Ee!==null?null:D(K,j,""+H,ie);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case k:return H.key===Ee?M(K,j,H,ie):null;case O:return H.key===Ee?z(K,j,H,ie):null;case J:return Ee=H._init,Z(K,j,Ee(H._payload),ie)}if(vt(H)||Y(H))return Ee!==null?null:ee(K,j,H,ie,null);Xa(K,H)}return null}function he(K,j,H,ie,Ee){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return K=K.get(H)||null,D(j,K,""+ie,Ee);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case k:return K=K.get(ie.key===null?H:ie.key)||null,M(j,K,ie,Ee);case O:return K=K.get(ie.key===null?H:ie.key)||null,z(j,K,ie,Ee);case J:var xe=ie._init;return he(K,j,H,xe(ie._payload),Ee)}if(vt(ie)||Y(ie))return K=K.get(H)||null,ee(j,K,ie,Ee,null);Xa(j,ie)}return null}function me(K,j,H,ie){for(var Ee=null,xe=null,_e=j,be=j=0,mt=null;_e!==null&&be<H.length;be++){_e.index>be?(mt=_e,_e=null):mt=_e.sibling;var Me=Z(K,_e,H[be],ie);if(Me===null){_e===null&&(_e=mt);break}a&&_e&&Me.alternate===null&&l(K,_e),j=x(Me,j,be),xe===null?Ee=Me:xe.sibling=Me,xe=Me,_e=mt}if(be===H.length)return h(K,_e),qe&&Gn(K,be),Ee;if(_e===null){for(;be<H.length;be++)_e=ne(K,H[be],ie),_e!==null&&(j=x(_e,j,be),xe===null?Ee=_e:xe.sibling=_e,xe=_e);return qe&&Gn(K,be),Ee}for(_e=p(K,_e);be<H.length;be++)mt=he(_e,K,be,H[be],ie),mt!==null&&(a&&mt.alternate!==null&&_e.delete(mt.key===null?be:mt.key),j=x(mt,j,be),xe===null?Ee=mt:xe.sibling=mt,xe=mt);return a&&_e.forEach(function(_n){return l(K,_n)}),qe&&Gn(K,be),Ee}function ye(K,j,H,ie){var Ee=Y(H);if(typeof Ee!="function")throw Error(t(150));if(H=Ee.call(H),H==null)throw Error(t(151));for(var xe=Ee=null,_e=j,be=j=0,mt=null,Me=H.next();_e!==null&&!Me.done;be++,Me=H.next()){_e.index>be?(mt=_e,_e=null):mt=_e.sibling;var _n=Z(K,_e,Me.value,ie);if(_n===null){_e===null&&(_e=mt);break}a&&_e&&_n.alternate===null&&l(K,_e),j=x(_n,j,be),xe===null?Ee=_n:xe.sibling=_n,xe=_n,_e=mt}if(Me.done)return h(K,_e),qe&&Gn(K,be),Ee;if(_e===null){for(;!Me.done;be++,Me=H.next())Me=ne(K,Me.value,ie),Me!==null&&(j=x(Me,j,be),xe===null?Ee=Me:xe.sibling=Me,xe=Me);return qe&&Gn(K,be),Ee}for(_e=p(K,_e);!Me.done;be++,Me=H.next())Me=he(_e,K,be,Me.value,ie),Me!==null&&(a&&Me.alternate!==null&&_e.delete(Me.key===null?be:Me.key),j=x(Me,j,be),xe===null?Ee=Me:xe.sibling=Me,xe=Me);return a&&_e.forEach(function($T){return l(K,$T)}),qe&&Gn(K,be),Ee}function st(K,j,H,ie){if(typeof H=="object"&&H!==null&&H.type===P&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case k:e:{for(var Ee=H.key,xe=j;xe!==null;){if(xe.key===Ee){if(Ee=H.type,Ee===P){if(xe.tag===7){h(K,xe.sibling),j=E(xe,H.props.children),j.return=K,K=j;break e}}else if(xe.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===J&&rg(Ee)===xe.type){h(K,xe.sibling),j=E(xe,H.props),j.ref=Fi(K,xe,H),j.return=K,K=j;break e}h(K,xe);break}else l(K,xe);xe=xe.sibling}H.type===P?(j=Qn(H.props.children,K.mode,ie,H.key),j.return=K,K=j):(ie=xo(H.type,H.key,H.props,null,K.mode,ie),ie.ref=Fi(K,j,H),ie.return=K,K=ie)}return I(K);case O:e:{for(xe=H.key;j!==null;){if(j.key===xe)if(j.tag===4&&j.stateNode.containerInfo===H.containerInfo&&j.stateNode.implementation===H.implementation){h(K,j.sibling),j=E(j,H.children||[]),j.return=K,K=j;break e}else{h(K,j);break}else l(K,j);j=j.sibling}j=xc(H,K.mode,ie),j.return=K,K=j}return I(K);case J:return xe=H._init,st(K,j,xe(H._payload),ie)}if(vt(H))return me(K,j,H,ie);if(Y(H))return ye(K,j,H,ie);Xa(K,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,j!==null&&j.tag===6?(h(K,j.sibling),j=E(j,H),j.return=K,K=j):(h(K,j),j=Tc(H,K.mode,ie),j.return=K,K=j),I(K)):h(K,j)}return st}var Ls=ng(!0),sg=ng(!1),Ja=hn(null),Za=null,ks=null,Cu=null;function Pu(){Cu=ks=Za=null}function Du(a){var l=Ja.current;We(Ja),a._currentValue=l}function Ou(a,l,h){for(;a!==null;){var p=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),a===h)break;a=a.return}}function Cs(a,l){Za=a,Cu=ks=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&l)!==0&&(Mt=!0),a.firstContext=null)}function sr(a){var l=a._currentValue;if(Cu!==a)if(a={context:a,memoizedValue:l,next:null},ks===null){if(Za===null)throw Error(t(308));ks=a,Za.dependencies={lanes:0,firstContext:a}}else ks=ks.next=a;return l}var Vn=null;function Nu(a){Vn===null?Vn=[a]:Vn.push(a)}function ig(a,l,h,p){var E=l.interleaved;return E===null?(h.next=h,Nu(l)):(h.next=E.next,E.next=h),l.interleaved=h,Hr(a,p)}function Hr(a,l){a.lanes|=l;var h=a.alternate;for(h!==null&&(h.lanes|=l),h=a,a=a.return;a!==null;)a.childLanes|=l,h=a.alternate,h!==null&&(h.childLanes|=l),h=a,a=a.return;return h.tag===3?h.stateNode:null}var pn=!1;function Mu(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ag(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Wr(a,l){return{eventTime:a,lane:l,tag:0,payload:null,callback:null,next:null}}function mn(a,l,h){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(Ne&2)!==0){var E=p.pending;return E===null?l.next=l:(l.next=E.next,E.next=l),p.pending=l,Hr(a,h)}return E=p.interleaved,E===null?(l.next=l,Nu(p)):(l.next=E.next,E.next=l),p.interleaved=l,Hr(a,h)}function eo(a,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194240)!==0)){var p=l.lanes;p&=a.pendingLanes,h|=p,l.lanes=h,Ql(a,h)}}function og(a,l){var h=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,h===p)){var E=null,x=null;if(h=h.firstBaseUpdate,h!==null){do{var I={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};x===null?E=x=I:x=x.next=I,h=h.next}while(h!==null);x===null?E=x=l:x=x.next=l}else E=x=l;h={baseState:p.baseState,firstBaseUpdate:E,lastBaseUpdate:x,shared:p.shared,effects:p.effects},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=l:a.next=l,h.lastBaseUpdate=l}function to(a,l,h,p){var E=a.updateQueue;pn=!1;var x=E.firstBaseUpdate,I=E.lastBaseUpdate,D=E.shared.pending;if(D!==null){E.shared.pending=null;var M=D,z=M.next;M.next=null,I===null?x=z:I.next=z,I=M;var ee=a.alternate;ee!==null&&(ee=ee.updateQueue,D=ee.lastBaseUpdate,D!==I&&(D===null?ee.firstBaseUpdate=z:D.next=z,ee.lastBaseUpdate=M))}if(x!==null){var ne=E.baseState;I=0,ee=z=M=null,D=x;do{var Z=D.lane,he=D.eventTime;if((p&Z)===Z){ee!==null&&(ee=ee.next={eventTime:he,lane:0,tag:D.tag,payload:D.payload,callback:D.callback,next:null});e:{var me=a,ye=D;switch(Z=l,he=h,ye.tag){case 1:if(me=ye.payload,typeof me=="function"){ne=me.call(he,ne,Z);break e}ne=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=ye.payload,Z=typeof me=="function"?me.call(he,ne,Z):me,Z==null)break e;ne=Q({},ne,Z);break e;case 2:pn=!0}}D.callback!==null&&D.lane!==0&&(a.flags|=64,Z=E.effects,Z===null?E.effects=[D]:Z.push(D))}else he={eventTime:he,lane:Z,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ee===null?(z=ee=he,M=ne):ee=ee.next=he,I|=Z;if(D=D.next,D===null){if(D=E.shared.pending,D===null)break;Z=D,D=Z.next,Z.next=null,E.lastBaseUpdate=Z,E.shared.pending=null}}while(!0);if(ee===null&&(M=ne),E.baseState=M,E.firstBaseUpdate=z,E.lastBaseUpdate=ee,l=E.shared.interleaved,l!==null){E=l;do I|=E.lane,E=E.next;while(E!==l)}else x===null&&(E.shared.lanes=0);Wn|=I,a.lanes=I,a.memoizedState=ne}}function lg(a,l,h){if(a=l.effects,l.effects=null,a!==null)for(l=0;l<a.length;l++){var p=a[l],E=p.callback;if(E!==null){if(p.callback=null,p=h,typeof E!="function")throw Error(t(191,E));E.call(p)}}}var Ui={},Rr=hn(Ui),Bi=hn(Ui),$i=hn(Ui);function Kn(a){if(a===Ui)throw Error(t(174));return a}function Fu(a,l){switch(Ve($i,l),Ve(Bi,a),Ve(Rr,Ui),a=l.nodeType,a){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:hs(null,"");break;default:a=a===8?l.parentNode:l,l=a.namespaceURI||null,a=a.tagName,l=hs(l,a)}We(Rr),Ve(Rr,l)}function Ps(){We(Rr),We(Bi),We($i)}function ug(a){Kn($i.current);var l=Kn(Rr.current),h=hs(l,a.type);l!==h&&(Ve(Bi,a),Ve(Rr,h))}function Uu(a){Bi.current===a&&(We(Rr),We(Bi))}var Ye=hn(0);function ro(a){for(var l=a;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Bu=[];function $u(){for(var a=0;a<Bu.length;a++)Bu[a]._workInProgressVersionPrimary=null;Bu.length=0}var no=L.ReactCurrentDispatcher,ju=L.ReactCurrentBatchConfig,Hn=0,Qe=null,ut=null,gt=null,so=!1,ji=!1,Gi=0,lT=0;function At(){throw Error(t(321))}function Gu(a,l){if(l===null)return!1;for(var h=0;h<l.length&&h<a.length;h++)if(!pr(a[h],l[h]))return!1;return!0}function Vu(a,l,h,p,E,x){if(Hn=x,Qe=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,no.current=a===null||a.memoizedState===null?hT:fT,a=h(p,E),ji){x=0;do{if(ji=!1,Gi=0,25<=x)throw Error(t(301));x+=1,gt=ut=null,l.updateQueue=null,no.current=gT,a=h(p,E)}while(ji)}if(no.current=oo,l=ut!==null&&ut.next!==null,Hn=0,gt=ut=Qe=null,so=!1,l)throw Error(t(300));return a}function Ku(){var a=Gi!==0;return Gi=0,a}function Lr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?Qe.memoizedState=gt=a:gt=gt.next=a,gt}function ir(){if(ut===null){var a=Qe.alternate;a=a!==null?a.memoizedState:null}else a=ut.next;var l=gt===null?Qe.memoizedState:gt.next;if(l!==null)gt=l,ut=a;else{if(a===null)throw Error(t(310));ut=a,a={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},gt===null?Qe.memoizedState=gt=a:gt=gt.next=a}return gt}function Vi(a,l){return typeof l=="function"?l(a):l}function Hu(a){var l=ir(),h=l.queue;if(h===null)throw Error(t(311));h.lastRenderedReducer=a;var p=ut,E=p.baseQueue,x=h.pending;if(x!==null){if(E!==null){var I=E.next;E.next=x.next,x.next=I}p.baseQueue=E=x,h.pending=null}if(E!==null){x=E.next,p=p.baseState;var D=I=null,M=null,z=x;do{var ee=z.lane;if((Hn&ee)===ee)M!==null&&(M=M.next={lane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),p=z.hasEagerState?z.eagerState:a(p,z.action);else{var ne={lane:ee,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null};M===null?(D=M=ne,I=p):M=M.next=ne,Qe.lanes|=ee,Wn|=ee}z=z.next}while(z!==null&&z!==x);M===null?I=p:M.next=D,pr(p,l.memoizedState)||(Mt=!0),l.memoizedState=p,l.baseState=I,l.baseQueue=M,h.lastRenderedState=p}if(a=h.interleaved,a!==null){E=a;do x=E.lane,Qe.lanes|=x,Wn|=x,E=E.next;while(E!==a)}else E===null&&(h.lanes=0);return[l.memoizedState,h.dispatch]}function Wu(a){var l=ir(),h=l.queue;if(h===null)throw Error(t(311));h.lastRenderedReducer=a;var p=h.dispatch,E=h.pending,x=l.memoizedState;if(E!==null){h.pending=null;var I=E=E.next;do x=a(x,I.action),I=I.next;while(I!==E);pr(x,l.memoizedState)||(Mt=!0),l.memoizedState=x,l.baseQueue===null&&(l.baseState=x),h.lastRenderedState=x}return[x,p]}function cg(){}function dg(a,l){var h=Qe,p=ir(),E=l(),x=!pr(p.memoizedState,E);if(x&&(p.memoizedState=E,Mt=!0),p=p.queue,zu(gg.bind(null,h,p,a),[a]),p.getSnapshot!==l||x||gt!==null&&gt.memoizedState.tag&1){if(h.flags|=2048,Ki(9,fg.bind(null,h,p,E,l),void 0,null),pt===null)throw Error(t(349));(Hn&30)!==0||hg(h,l,E)}return E}function hg(a,l,h){a.flags|=16384,a={getSnapshot:l,value:h},l=Qe.updateQueue,l===null?(l={lastEffect:null,stores:null},Qe.updateQueue=l,l.stores=[a]):(h=l.stores,h===null?l.stores=[a]:h.push(a))}function fg(a,l,h,p){l.value=h,l.getSnapshot=p,pg(l)&&mg(a)}function gg(a,l,h){return h(function(){pg(l)&&mg(a)})}function pg(a){var l=a.getSnapshot;a=a.value;try{var h=l();return!pr(a,h)}catch{return!0}}function mg(a){var l=Hr(a,1);l!==null&&Sr(l,a,1,-1)}function yg(a){var l=Lr();return typeof a=="function"&&(a=a()),l.memoizedState=l.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:a},l.queue=a,a=a.dispatch=dT.bind(null,Qe,a),[l.memoizedState,a]}function Ki(a,l,h,p){return a={tag:a,create:l,destroy:h,deps:p,next:null},l=Qe.updateQueue,l===null?(l={lastEffect:null,stores:null},Qe.updateQueue=l,l.lastEffect=a.next=a):(h=l.lastEffect,h===null?l.lastEffect=a.next=a:(p=h.next,h.next=a,a.next=p,l.lastEffect=a)),a}function vg(){return ir().memoizedState}function io(a,l,h,p){var E=Lr();Qe.flags|=a,E.memoizedState=Ki(1|l,h,void 0,p===void 0?null:p)}function ao(a,l,h,p){var E=ir();p=p===void 0?null:p;var x=void 0;if(ut!==null){var I=ut.memoizedState;if(x=I.destroy,p!==null&&Gu(p,I.deps)){E.memoizedState=Ki(l,h,x,p);return}}Qe.flags|=a,E.memoizedState=Ki(1|l,h,x,p)}function Eg(a,l){return io(8390656,8,a,l)}function zu(a,l){return ao(2048,8,a,l)}function Sg(a,l){return ao(4,2,a,l)}function Tg(a,l){return ao(4,4,a,l)}function xg(a,l){if(typeof l=="function")return a=a(),l(a),function(){l(null)};if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function _g(a,l,h){return h=h!=null?h.concat([a]):null,ao(4,4,xg.bind(null,l,a),h)}function qu(){}function wg(a,l){var h=ir();l=l===void 0?null:l;var p=h.memoizedState;return p!==null&&l!==null&&Gu(l,p[1])?p[0]:(h.memoizedState=[a,l],a)}function Ag(a,l){var h=ir();l=l===void 0?null:l;var p=h.memoizedState;return p!==null&&l!==null&&Gu(l,p[1])?p[0]:(a=a(),h.memoizedState=[a,l],a)}function bg(a,l,h){return(Hn&21)===0?(a.baseState&&(a.baseState=!1,Mt=!0),a.memoizedState=h):(pr(h,l)||(h=tf(),Qe.lanes|=h,Wn|=h,a.baseState=!0),l)}function uT(a,l){var h=Fe;Fe=h!==0&&4>h?h:4,a(!0);var p=ju.transition;ju.transition={};try{a(!1),l()}finally{Fe=h,ju.transition=p}}function Ig(){return ir().memoizedState}function cT(a,l,h){var p=Sn(a);if(h={lane:p,action:h,hasEagerState:!1,eagerState:null,next:null},Rg(a))Lg(l,h);else if(h=ig(a,l,h,p),h!==null){var E=Ct();Sr(h,a,p,E),kg(h,l,p)}}function dT(a,l,h){var p=Sn(a),E={lane:p,action:h,hasEagerState:!1,eagerState:null,next:null};if(Rg(a))Lg(l,E);else{var x=a.alternate;if(a.lanes===0&&(x===null||x.lanes===0)&&(x=l.lastRenderedReducer,x!==null))try{var I=l.lastRenderedState,D=x(I,h);if(E.hasEagerState=!0,E.eagerState=D,pr(D,I)){var M=l.interleaved;M===null?(E.next=E,Nu(l)):(E.next=M.next,M.next=E),l.interleaved=E;return}}catch{}finally{}h=ig(a,l,E,p),h!==null&&(E=Ct(),Sr(h,a,p,E),kg(h,l,p))}}function Rg(a){var l=a.alternate;return a===Qe||l!==null&&l===Qe}function Lg(a,l){ji=so=!0;var h=a.pending;h===null?l.next=l:(l.next=h.next,h.next=l),a.pending=l}function kg(a,l,h){if((h&4194240)!==0){var p=l.lanes;p&=a.pendingLanes,h|=p,l.lanes=h,Ql(a,h)}}var oo={readContext:sr,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useInsertionEffect:At,useLayoutEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useMutableSource:At,useSyncExternalStore:At,useId:At,unstable_isNewReconciler:!1},hT={readContext:sr,useCallback:function(a,l){return Lr().memoizedState=[a,l===void 0?null:l],a},useContext:sr,useEffect:Eg,useImperativeHandle:function(a,l,h){return h=h!=null?h.concat([a]):null,io(4194308,4,xg.bind(null,l,a),h)},useLayoutEffect:function(a,l){return io(4194308,4,a,l)},useInsertionEffect:function(a,l){return io(4,2,a,l)},useMemo:function(a,l){var h=Lr();return l=l===void 0?null:l,a=a(),h.memoizedState=[a,l],a},useReducer:function(a,l,h){var p=Lr();return l=h!==void 0?h(l):l,p.memoizedState=p.baseState=l,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:l},p.queue=a,a=a.dispatch=cT.bind(null,Qe,a),[p.memoizedState,a]},useRef:function(a){var l=Lr();return a={current:a},l.memoizedState=a},useState:yg,useDebugValue:qu,useDeferredValue:function(a){return Lr().memoizedState=a},useTransition:function(){var a=yg(!1),l=a[0];return a=uT.bind(null,a[1]),Lr().memoizedState=a,[l,a]},useMutableSource:function(){},useSyncExternalStore:function(a,l,h){var p=Qe,E=Lr();if(qe){if(h===void 0)throw Error(t(407));h=h()}else{if(h=l(),pt===null)throw Error(t(349));(Hn&30)!==0||hg(p,l,h)}E.memoizedState=h;var x={value:h,getSnapshot:l};return E.queue=x,Eg(gg.bind(null,p,x,a),[a]),p.flags|=2048,Ki(9,fg.bind(null,p,x,h,l),void 0,null),h},useId:function(){var a=Lr(),l=pt.identifierPrefix;if(qe){var h=Kr,p=Vr;h=(p&~(1<<32-gr(p)-1)).toString(32)+h,l=":"+l+"R"+h,h=Gi++,0<h&&(l+="H"+h.toString(32)),l+=":"}else h=lT++,l=":"+l+"r"+h.toString(32)+":";return a.memoizedState=l},unstable_isNewReconciler:!1},fT={readContext:sr,useCallback:wg,useContext:sr,useEffect:zu,useImperativeHandle:_g,useInsertionEffect:Sg,useLayoutEffect:Tg,useMemo:Ag,useReducer:Hu,useRef:vg,useState:function(){return Hu(Vi)},useDebugValue:qu,useDeferredValue:function(a){var l=ir();return bg(l,ut.memoizedState,a)},useTransition:function(){var a=Hu(Vi)[0],l=ir().memoizedState;return[a,l]},useMutableSource:cg,useSyncExternalStore:dg,useId:Ig,unstable_isNewReconciler:!1},gT={readContext:sr,useCallback:wg,useContext:sr,useEffect:zu,useImperativeHandle:_g,useInsertionEffect:Sg,useLayoutEffect:Tg,useMemo:Ag,useReducer:Wu,useRef:vg,useState:function(){return Wu(Vi)},useDebugValue:qu,useDeferredValue:function(a){var l=ir();return ut===null?l.memoizedState=a:bg(l,ut.memoizedState,a)},useTransition:function(){var a=Wu(Vi)[0],l=ir().memoizedState;return[a,l]},useMutableSource:cg,useSyncExternalStore:dg,useId:Ig,unstable_isNewReconciler:!1};function yr(a,l){if(a&&a.defaultProps){l=Q({},l),a=a.defaultProps;for(var h in a)l[h]===void 0&&(l[h]=a[h]);return l}return l}function Yu(a,l,h,p){l=a.memoizedState,h=h(p,l),h=h==null?l:Q({},l,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var lo={isMounted:function(a){return(a=a._reactInternals)?Un(a)===a:!1},enqueueSetState:function(a,l,h){a=a._reactInternals;var p=Ct(),E=Sn(a),x=Wr(p,E);x.payload=l,h!=null&&(x.callback=h),l=mn(a,x,E),l!==null&&(Sr(l,a,E,p),eo(l,a,E))},enqueueReplaceState:function(a,l,h){a=a._reactInternals;var p=Ct(),E=Sn(a),x=Wr(p,E);x.tag=1,x.payload=l,h!=null&&(x.callback=h),l=mn(a,x,E),l!==null&&(Sr(l,a,E,p),eo(l,a,E))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var h=Ct(),p=Sn(a),E=Wr(h,p);E.tag=2,l!=null&&(E.callback=l),l=mn(a,E,p),l!==null&&(Sr(l,a,p,h),eo(l,a,p))}};function Cg(a,l,h,p,E,x,I){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,x,I):l.prototype&&l.prototype.isPureReactComponent?!ki(h,p)||!ki(E,x):!0}function Pg(a,l,h){var p=!1,E=fn,x=l.contextType;return typeof x=="object"&&x!==null?x=sr(x):(E=Nt(l)?$n:wt.current,p=l.contextTypes,x=(p=p!=null)?As(a,E):fn),l=new l(h,x),a.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=lo,a.stateNode=l,l._reactInternals=a,p&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=E,a.__reactInternalMemoizedMaskedChildContext=x),l}function Dg(a,l,h,p){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,p),l.state!==a&&lo.enqueueReplaceState(l,l.state,null)}function Qu(a,l,h,p){var E=a.stateNode;E.props=h,E.state=a.memoizedState,E.refs={},Mu(a);var x=l.contextType;typeof x=="object"&&x!==null?E.context=sr(x):(x=Nt(l)?$n:wt.current,E.context=As(a,x)),E.state=a.memoizedState,x=l.getDerivedStateFromProps,typeof x=="function"&&(Yu(a,l,x,h),E.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(l=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),l!==E.state&&lo.enqueueReplaceState(E,E.state,null),to(a,h,E,p),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308)}function Ds(a,l){try{var h="",p=l;do h+=de(p),p=p.return;while(p);var E=h}catch(x){E=`
Error generating stack: `+x.message+`
`+x.stack}return{value:a,source:l,stack:E,digest:null}}function Xu(a,l,h){return{value:a,source:null,stack:h??null,digest:l??null}}function Ju(a,l){try{console.error(l.value)}catch(h){setTimeout(function(){throw h})}}var pT=typeof WeakMap=="function"?WeakMap:Map;function Og(a,l,h){h=Wr(-1,h),h.tag=3,h.payload={element:null};var p=l.value;return h.callback=function(){mo||(mo=!0,fc=p),Ju(a,l)},h}function Ng(a,l,h){h=Wr(-1,h),h.tag=3;var p=a.type.getDerivedStateFromError;if(typeof p=="function"){var E=l.value;h.payload=function(){return p(E)},h.callback=function(){Ju(a,l)}}var x=a.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(h.callback=function(){Ju(a,l),typeof p!="function"&&(vn===null?vn=new Set([this]):vn.add(this));var I=l.stack;this.componentDidCatch(l.value,{componentStack:I!==null?I:""})}),h}function Mg(a,l,h){var p=a.pingCache;if(p===null){p=a.pingCache=new pT;var E=new Set;p.set(l,E)}else E=p.get(l),E===void 0&&(E=new Set,p.set(l,E));E.has(h)||(E.add(h),a=LT.bind(null,a,l,h),l.then(a,a))}function Fg(a){do{var l;if((l=a.tag===13)&&(l=a.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return a;a=a.return}while(a!==null);return null}function Ug(a,l,h,p,E){return(a.mode&1)===0?(a===l?a.flags|=65536:(a.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(l=Wr(-1,1),l.tag=2,mn(h,l,1))),h.lanes|=1),a):(a.flags|=65536,a.lanes=E,a)}var mT=L.ReactCurrentOwner,Mt=!1;function kt(a,l,h,p){l.child=a===null?sg(l,null,h,p):Ls(l,a.child,h,p)}function Bg(a,l,h,p,E){h=h.render;var x=l.ref;return Cs(l,E),p=Vu(a,l,h,p,x,E),h=Ku(),a!==null&&!Mt?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~E,zr(a,l,E)):(qe&&h&&bu(l),l.flags|=1,kt(a,l,p,E),l.child)}function $g(a,l,h,p,E){if(a===null){var x=h.type;return typeof x=="function"&&!Sc(x)&&x.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(l.tag=15,l.type=x,jg(a,l,x,p,E)):(a=xo(h.type,null,p,l,l.mode,E),a.ref=l.ref,a.return=l,l.child=a)}if(x=a.child,(a.lanes&E)===0){var I=x.memoizedProps;if(h=h.compare,h=h!==null?h:ki,h(I,p)&&a.ref===l.ref)return zr(a,l,E)}return l.flags|=1,a=xn(x,p),a.ref=l.ref,a.return=l,l.child=a}function jg(a,l,h,p,E){if(a!==null){var x=a.memoizedProps;if(ki(x,p)&&a.ref===l.ref)if(Mt=!1,l.pendingProps=p=x,(a.lanes&E)!==0)(a.flags&131072)!==0&&(Mt=!0);else return l.lanes=a.lanes,zr(a,l,E)}return Zu(a,l,h,p,E)}function Gg(a,l,h){var p=l.pendingProps,E=p.children,x=a!==null?a.memoizedState:null;if(p.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ve(Ns,Wt),Wt|=h;else{if((h&1073741824)===0)return a=x!==null?x.baseLanes|h:h,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:a,cachePool:null,transitions:null},l.updateQueue=null,Ve(Ns,Wt),Wt|=a,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=x!==null?x.baseLanes:h,Ve(Ns,Wt),Wt|=p}else x!==null?(p=x.baseLanes|h,l.memoizedState=null):p=h,Ve(Ns,Wt),Wt|=p;return kt(a,l,E,h),l.child}function Vg(a,l){var h=l.ref;(a===null&&h!==null||a!==null&&a.ref!==h)&&(l.flags|=512,l.flags|=2097152)}function Zu(a,l,h,p,E){var x=Nt(h)?$n:wt.current;return x=As(l,x),Cs(l,E),h=Vu(a,l,h,p,x,E),p=Ku(),a!==null&&!Mt?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~E,zr(a,l,E)):(qe&&p&&bu(l),l.flags|=1,kt(a,l,h,E),l.child)}function Kg(a,l,h,p,E){if(Nt(h)){var x=!0;Wa(l)}else x=!1;if(Cs(l,E),l.stateNode===null)co(a,l),Pg(l,h,p),Qu(l,h,p,E),p=!0;else if(a===null){var I=l.stateNode,D=l.memoizedProps;I.props=D;var M=I.context,z=h.contextType;typeof z=="object"&&z!==null?z=sr(z):(z=Nt(h)?$n:wt.current,z=As(l,z));var ee=h.getDerivedStateFromProps,ne=typeof ee=="function"||typeof I.getSnapshotBeforeUpdate=="function";ne||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(D!==p||M!==z)&&Dg(l,I,p,z),pn=!1;var Z=l.memoizedState;I.state=Z,to(l,p,I,E),M=l.memoizedState,D!==p||Z!==M||Ot.current||pn?(typeof ee=="function"&&(Yu(l,h,ee,p),M=l.memoizedState),(D=pn||Cg(l,h,D,p,Z,M,z))?(ne||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(l.flags|=4194308)):(typeof I.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=M),I.props=p,I.state=M,I.context=z,p=D):(typeof I.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{I=l.stateNode,ag(a,l),D=l.memoizedProps,z=l.type===l.elementType?D:yr(l.type,D),I.props=z,ne=l.pendingProps,Z=I.context,M=h.contextType,typeof M=="object"&&M!==null?M=sr(M):(M=Nt(h)?$n:wt.current,M=As(l,M));var he=h.getDerivedStateFromProps;(ee=typeof he=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(D!==ne||Z!==M)&&Dg(l,I,p,M),pn=!1,Z=l.memoizedState,I.state=Z,to(l,p,I,E);var me=l.memoizedState;D!==ne||Z!==me||Ot.current||pn?(typeof he=="function"&&(Yu(l,h,he,p),me=l.memoizedState),(z=pn||Cg(l,h,z,p,Z,me,M)||!1)?(ee||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(p,me,M),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(p,me,M)),typeof I.componentDidUpdate=="function"&&(l.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof I.componentDidUpdate!="function"||D===a.memoizedProps&&Z===a.memoizedState||(l.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||D===a.memoizedProps&&Z===a.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=me),I.props=p,I.state=me,I.context=M,p=z):(typeof I.componentDidUpdate!="function"||D===a.memoizedProps&&Z===a.memoizedState||(l.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||D===a.memoizedProps&&Z===a.memoizedState||(l.flags|=1024),p=!1)}return ec(a,l,h,p,x,E)}function ec(a,l,h,p,E,x){Vg(a,l);var I=(l.flags&128)!==0;if(!p&&!I)return E&&Yf(l,h,!1),zr(a,l,x);p=l.stateNode,mT.current=l;var D=I&&typeof h.getDerivedStateFromError!="function"?null:p.render();return l.flags|=1,a!==null&&I?(l.child=Ls(l,a.child,null,x),l.child=Ls(l,null,D,x)):kt(a,l,D,x),l.memoizedState=p.state,E&&Yf(l,h,!0),l.child}function Hg(a){var l=a.stateNode;l.pendingContext?zf(a,l.pendingContext,l.pendingContext!==l.context):l.context&&zf(a,l.context,!1),Fu(a,l.containerInfo)}function Wg(a,l,h,p,E){return Rs(),ku(E),l.flags|=256,kt(a,l,h,p),l.child}var tc={dehydrated:null,treeContext:null,retryLane:0};function rc(a){return{baseLanes:a,cachePool:null,transitions:null}}function zg(a,l,h){var p=l.pendingProps,E=Ye.current,x=!1,I=(l.flags&128)!==0,D;if((D=I)||(D=a!==null&&a.memoizedState===null?!1:(E&2)!==0),D?(x=!0,l.flags&=-129):(a===null||a.memoizedState!==null)&&(E|=1),Ve(Ye,E&1),a===null)return Lu(l),a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((l.mode&1)===0?l.lanes=1:a.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(I=p.children,a=p.fallback,x?(p=l.mode,x=l.child,I={mode:"hidden",children:I},(p&1)===0&&x!==null?(x.childLanes=0,x.pendingProps=I):x=_o(I,p,0,null),a=Qn(a,p,h,null),x.return=l,a.return=l,x.sibling=a,l.child=x,l.child.memoizedState=rc(h),l.memoizedState=tc,a):nc(l,I));if(E=a.memoizedState,E!==null&&(D=E.dehydrated,D!==null))return yT(a,l,I,p,D,E,h);if(x){x=p.fallback,I=l.mode,E=a.child,D=E.sibling;var M={mode:"hidden",children:p.children};return(I&1)===0&&l.child!==E?(p=l.child,p.childLanes=0,p.pendingProps=M,l.deletions=null):(p=xn(E,M),p.subtreeFlags=E.subtreeFlags&14680064),D!==null?x=xn(D,x):(x=Qn(x,I,h,null),x.flags|=2),x.return=l,p.return=l,p.sibling=x,l.child=p,p=x,x=l.child,I=a.child.memoizedState,I=I===null?rc(h):{baseLanes:I.baseLanes|h,cachePool:null,transitions:I.transitions},x.memoizedState=I,x.childLanes=a.childLanes&~h,l.memoizedState=tc,p}return x=a.child,a=x.sibling,p=xn(x,{mode:"visible",children:p.children}),(l.mode&1)===0&&(p.lanes=h),p.return=l,p.sibling=null,a!==null&&(h=l.deletions,h===null?(l.deletions=[a],l.flags|=16):h.push(a)),l.child=p,l.memoizedState=null,p}function nc(a,l){return l=_o({mode:"visible",children:l},a.mode,0,null),l.return=a,a.child=l}function uo(a,l,h,p){return p!==null&&ku(p),Ls(l,a.child,null,h),a=nc(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function yT(a,l,h,p,E,x,I){if(h)return l.flags&256?(l.flags&=-257,p=Xu(Error(t(422))),uo(a,l,I,p)):l.memoizedState!==null?(l.child=a.child,l.flags|=128,null):(x=p.fallback,E=l.mode,p=_o({mode:"visible",children:p.children},E,0,null),x=Qn(x,E,I,null),x.flags|=2,p.return=l,x.return=l,p.sibling=x,l.child=p,(l.mode&1)!==0&&Ls(l,a.child,null,I),l.child.memoizedState=rc(I),l.memoizedState=tc,x);if((l.mode&1)===0)return uo(a,l,I,null);if(E.data==="$!"){if(p=E.nextSibling&&E.nextSibling.dataset,p)var D=p.dgst;return p=D,x=Error(t(419)),p=Xu(x,p,void 0),uo(a,l,I,p)}if(D=(I&a.childLanes)!==0,Mt||D){if(p=pt,p!==null){switch(I&-I){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=(E&(p.suspendedLanes|I))!==0?0:E,E!==0&&E!==x.retryLane&&(x.retryLane=E,Hr(a,E),Sr(p,a,E,-1))}return Ec(),p=Xu(Error(t(421))),uo(a,l,I,p)}return E.data==="$?"?(l.flags|=128,l.child=a.child,l=kT.bind(null,a),E._reactRetry=l,null):(a=x.treeContext,Ht=dn(E.nextSibling),Kt=l,qe=!0,mr=null,a!==null&&(rr[nr++]=Vr,rr[nr++]=Kr,rr[nr++]=jn,Vr=a.id,Kr=a.overflow,jn=l),l=nc(l,p.children),l.flags|=4096,l)}function qg(a,l,h){a.lanes|=l;var p=a.alternate;p!==null&&(p.lanes|=l),Ou(a.return,l,h)}function sc(a,l,h,p,E){var x=a.memoizedState;x===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:h,tailMode:E}:(x.isBackwards=l,x.rendering=null,x.renderingStartTime=0,x.last=p,x.tail=h,x.tailMode=E)}function Yg(a,l,h){var p=l.pendingProps,E=p.revealOrder,x=p.tail;if(kt(a,l,p.children,h),p=Ye.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&qg(a,h,l);else if(a.tag===19)qg(a,h,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}if(Ve(Ye,p),(l.mode&1)===0)l.memoizedState=null;else switch(E){case"forwards":for(h=l.child,E=null;h!==null;)a=h.alternate,a!==null&&ro(a)===null&&(E=h),h=h.sibling;h=E,h===null?(E=l.child,l.child=null):(E=h.sibling,h.sibling=null),sc(l,!1,E,h,x);break;case"backwards":for(h=null,E=l.child,l.child=null;E!==null;){if(a=E.alternate,a!==null&&ro(a)===null){l.child=E;break}a=E.sibling,E.sibling=h,h=E,E=a}sc(l,!0,h,null,x);break;case"together":sc(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function co(a,l){(l.mode&1)===0&&a!==null&&(a.alternate=null,l.alternate=null,l.flags|=2)}function zr(a,l,h){if(a!==null&&(l.dependencies=a.dependencies),Wn|=l.lanes,(h&l.childLanes)===0)return null;if(a!==null&&l.child!==a.child)throw Error(t(153));if(l.child!==null){for(a=l.child,h=xn(a,a.pendingProps),l.child=h,h.return=l;a.sibling!==null;)a=a.sibling,h=h.sibling=xn(a,a.pendingProps),h.return=l;h.sibling=null}return l.child}function vT(a,l,h){switch(l.tag){case 3:Hg(l),Rs();break;case 5:ug(l);break;case 1:Nt(l.type)&&Wa(l);break;case 4:Fu(l,l.stateNode.containerInfo);break;case 10:var p=l.type._context,E=l.memoizedProps.value;Ve(Ja,p._currentValue),p._currentValue=E;break;case 13:if(p=l.memoizedState,p!==null)return p.dehydrated!==null?(Ve(Ye,Ye.current&1),l.flags|=128,null):(h&l.child.childLanes)!==0?zg(a,l,h):(Ve(Ye,Ye.current&1),a=zr(a,l,h),a!==null?a.sibling:null);Ve(Ye,Ye.current&1);break;case 19:if(p=(h&l.childLanes)!==0,(a.flags&128)!==0){if(p)return Yg(a,l,h);l.flags|=128}if(E=l.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Ve(Ye,Ye.current),p)break;return null;case 22:case 23:return l.lanes=0,Gg(a,l,h)}return zr(a,l,h)}var Qg,ic,Xg,Jg;Qg=function(a,l){for(var h=l.child;h!==null;){if(h.tag===5||h.tag===6)a.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return;h=h.return}h.sibling.return=h.return,h=h.sibling}},ic=function(){},Xg=function(a,l,h,p){var E=a.memoizedProps;if(E!==p){a=l.stateNode,Kn(Rr.current);var x=null;switch(h){case"input":E=Mn(a,E),p=Mn(a,p),x=[];break;case"select":E=Q({},E,{value:void 0}),p=Q({},p,{value:void 0}),x=[];break;case"textarea":E=hr(a,E),p=hr(a,p),x=[];break;default:typeof E.onClick!="function"&&typeof p.onClick=="function"&&(a.onclick=Va)}Bl(h,p);var I;h=null;for(z in E)if(!p.hasOwnProperty(z)&&E.hasOwnProperty(z)&&E[z]!=null)if(z==="style"){var D=E[z];for(I in D)D.hasOwnProperty(I)&&(h||(h={}),h[I]="")}else z!=="dangerouslySetInnerHTML"&&z!=="children"&&z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(n.hasOwnProperty(z)?x||(x=[]):(x=x||[]).push(z,null));for(z in p){var M=p[z];if(D=E!=null?E[z]:void 0,p.hasOwnProperty(z)&&M!==D&&(M!=null||D!=null))if(z==="style")if(D){for(I in D)!D.hasOwnProperty(I)||M&&M.hasOwnProperty(I)||(h||(h={}),h[I]="");for(I in M)M.hasOwnProperty(I)&&D[I]!==M[I]&&(h||(h={}),h[I]=M[I])}else h||(x||(x=[]),x.push(z,h)),h=M;else z==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,D=D?D.__html:void 0,M!=null&&D!==M&&(x=x||[]).push(z,M)):z==="children"?typeof M!="string"&&typeof M!="number"||(x=x||[]).push(z,""+M):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&(n.hasOwnProperty(z)?(M!=null&&z==="onScroll"&&He("scroll",a),x||D===M||(x=[])):(x=x||[]).push(z,M))}h&&(x=x||[]).push("style",h);var z=x;(l.updateQueue=z)&&(l.flags|=4)}},Jg=function(a,l,h,p){h!==p&&(l.flags|=4)};function Hi(a,l){if(!qe)switch(a.tailMode){case"hidden":l=a.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var p=null;h!==null;)h.alternate!==null&&(p=h),h=h.sibling;p===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function bt(a){var l=a.alternate!==null&&a.alternate.child===a.child,h=0,p=0;if(l)for(var E=a.child;E!==null;)h|=E.lanes|E.childLanes,p|=E.subtreeFlags&14680064,p|=E.flags&14680064,E.return=a,E=E.sibling;else for(E=a.child;E!==null;)h|=E.lanes|E.childLanes,p|=E.subtreeFlags,p|=E.flags,E.return=a,E=E.sibling;return a.subtreeFlags|=p,a.childLanes=h,l}function ET(a,l,h){var p=l.pendingProps;switch(Iu(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bt(l),null;case 1:return Nt(l.type)&&Ha(),bt(l),null;case 3:return p=l.stateNode,Ps(),We(Ot),We(wt),$u(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(a===null||a.child===null)&&(Qa(l)?l.flags|=4:a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,mr!==null&&(mc(mr),mr=null))),ic(a,l),bt(l),null;case 5:Uu(l);var E=Kn($i.current);if(h=l.type,a!==null&&l.stateNode!=null)Xg(a,l,h,p,E),a.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!p){if(l.stateNode===null)throw Error(t(166));return bt(l),null}if(a=Kn(Rr.current),Qa(l)){p=l.stateNode,h=l.type;var x=l.memoizedProps;switch(p[Ir]=l,p[Ni]=x,a=(l.mode&1)!==0,h){case"dialog":He("cancel",p),He("close",p);break;case"iframe":case"object":case"embed":He("load",p);break;case"video":case"audio":for(E=0;E<Pi.length;E++)He(Pi[E],p);break;case"source":He("error",p);break;case"img":case"image":case"link":He("error",p),He("load",p);break;case"details":He("toggle",p);break;case"input":Ul(p,x),He("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!x.multiple},He("invalid",p);break;case"textarea":hi(p,x),He("invalid",p)}Bl(h,x),E=null;for(var I in x)if(x.hasOwnProperty(I)){var D=x[I];I==="children"?typeof D=="string"?p.textContent!==D&&(x.suppressHydrationWarning!==!0&&Ga(p.textContent,D,a),E=["children",D]):typeof D=="number"&&p.textContent!==""+D&&(x.suppressHydrationWarning!==!0&&Ga(p.textContent,D,a),E=["children",""+D]):n.hasOwnProperty(I)&&D!=null&&I==="onScroll"&&He("scroll",p)}switch(h){case"input":tr(p),Lt(p,x,!0);break;case"textarea":tr(p),fi(p);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(p.onclick=Va)}p=E,l.updateQueue=p,p!==null&&(l.flags|=4)}else{I=E.nodeType===9?E:E.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=rn(h)),a==="http://www.w3.org/1999/xhtml"?h==="script"?(a=I.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof p.is=="string"?a=I.createElement(h,{is:p.is}):(a=I.createElement(h),h==="select"&&(I=a,p.multiple?I.multiple=!0:p.size&&(I.size=p.size))):a=I.createElementNS(a,h),a[Ir]=l,a[Ni]=p,Qg(a,l,!1,!1),l.stateNode=a;e:{switch(I=$l(h,p),h){case"dialog":He("cancel",a),He("close",a),E=p;break;case"iframe":case"object":case"embed":He("load",a),E=p;break;case"video":case"audio":for(E=0;E<Pi.length;E++)He(Pi[E],a);E=p;break;case"source":He("error",a),E=p;break;case"img":case"image":case"link":He("error",a),He("load",a),E=p;break;case"details":He("toggle",a),E=p;break;case"input":Ul(a,p),E=Mn(a,p),He("invalid",a);break;case"option":E=p;break;case"select":a._wrapperState={wasMultiple:!!p.multiple},E=Q({},p,{value:void 0}),He("invalid",a);break;case"textarea":hi(a,p),E=hr(a,p),He("invalid",a);break;default:E=p}Bl(h,E),D=E;for(x in D)if(D.hasOwnProperty(x)){var M=D[x];x==="style"?$h(a,M):x==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,M!=null&&gi(a,M)):x==="children"?typeof M=="string"?(h!=="textarea"||M!=="")&&nn(a,M):typeof M=="number"&&nn(a,""+M):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(n.hasOwnProperty(x)?M!=null&&x==="onScroll"&&He("scroll",a):M!=null&&A(a,x,M,I))}switch(h){case"input":tr(a),Lt(a,p,!1);break;case"textarea":tr(a),fi(a);break;case"option":p.value!=null&&a.setAttribute("value",""+Ae(p.value));break;case"select":a.multiple=!!p.multiple,x=p.value,x!=null?Gt(a,!!p.multiple,x,!1):p.defaultValue!=null&&Gt(a,!!p.multiple,p.defaultValue,!0);break;default:typeof E.onClick=="function"&&(a.onclick=Va)}switch(h){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return bt(l),null;case 6:if(a&&l.stateNode!=null)Jg(a,l,a.memoizedProps,p);else{if(typeof p!="string"&&l.stateNode===null)throw Error(t(166));if(h=Kn($i.current),Kn(Rr.current),Qa(l)){if(p=l.stateNode,h=l.memoizedProps,p[Ir]=l,(x=p.nodeValue!==h)&&(a=Kt,a!==null))switch(a.tag){case 3:Ga(p.nodeValue,h,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Ga(p.nodeValue,h,(a.mode&1)!==0)}x&&(l.flags|=4)}else p=(h.nodeType===9?h:h.ownerDocument).createTextNode(p),p[Ir]=l,l.stateNode=p}return bt(l),null;case 13:if(We(Ye),p=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(qe&&Ht!==null&&(l.mode&1)!==0&&(l.flags&128)===0)tg(),Rs(),l.flags|=98560,x=!1;else if(x=Qa(l),p!==null&&p.dehydrated!==null){if(a===null){if(!x)throw Error(t(318));if(x=l.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(t(317));x[Ir]=l}else Rs(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;bt(l),x=!1}else mr!==null&&(mc(mr),mr=null),x=!0;if(!x)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=h,l):(p=p!==null,p!==(a!==null&&a.memoizedState!==null)&&p&&(l.child.flags|=8192,(l.mode&1)!==0&&(a===null||(Ye.current&1)!==0?ct===0&&(ct=3):Ec())),l.updateQueue!==null&&(l.flags|=4),bt(l),null);case 4:return Ps(),ic(a,l),a===null&&Di(l.stateNode.containerInfo),bt(l),null;case 10:return Du(l.type._context),bt(l),null;case 17:return Nt(l.type)&&Ha(),bt(l),null;case 19:if(We(Ye),x=l.memoizedState,x===null)return bt(l),null;if(p=(l.flags&128)!==0,I=x.rendering,I===null)if(p)Hi(x,!1);else{if(ct!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(I=ro(a),I!==null){for(l.flags|=128,Hi(x,!1),p=I.updateQueue,p!==null&&(l.updateQueue=p,l.flags|=4),l.subtreeFlags=0,p=h,h=l.child;h!==null;)x=h,a=p,x.flags&=14680066,I=x.alternate,I===null?(x.childLanes=0,x.lanes=a,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=I.childLanes,x.lanes=I.lanes,x.child=I.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=I.memoizedProps,x.memoizedState=I.memoizedState,x.updateQueue=I.updateQueue,x.type=I.type,a=I.dependencies,x.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),h=h.sibling;return Ve(Ye,Ye.current&1|2),l.child}a=a.sibling}x.tail!==null&&nt()>Ms&&(l.flags|=128,p=!0,Hi(x,!1),l.lanes=4194304)}else{if(!p)if(a=ro(I),a!==null){if(l.flags|=128,p=!0,h=a.updateQueue,h!==null&&(l.updateQueue=h,l.flags|=4),Hi(x,!0),x.tail===null&&x.tailMode==="hidden"&&!I.alternate&&!qe)return bt(l),null}else 2*nt()-x.renderingStartTime>Ms&&h!==1073741824&&(l.flags|=128,p=!0,Hi(x,!1),l.lanes=4194304);x.isBackwards?(I.sibling=l.child,l.child=I):(h=x.last,h!==null?h.sibling=I:l.child=I,x.last=I)}return x.tail!==null?(l=x.tail,x.rendering=l,x.tail=l.sibling,x.renderingStartTime=nt(),l.sibling=null,h=Ye.current,Ve(Ye,p?h&1|2:h&1),l):(bt(l),null);case 22:case 23:return vc(),p=l.memoizedState!==null,a!==null&&a.memoizedState!==null!==p&&(l.flags|=8192),p&&(l.mode&1)!==0?(Wt&1073741824)!==0&&(bt(l),l.subtreeFlags&6&&(l.flags|=8192)):bt(l),null;case 24:return null;case 25:return null}throw Error(t(156,l.tag))}function ST(a,l){switch(Iu(l),l.tag){case 1:return Nt(l.type)&&Ha(),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Ps(),We(Ot),We(wt),$u(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 5:return Uu(l),null;case 13:if(We(Ye),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(t(340));Rs()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return We(Ye),null;case 4:return Ps(),null;case 10:return Du(l.type._context),null;case 22:case 23:return vc(),null;case 24:return null;default:return null}}var ho=!1,It=!1,TT=typeof WeakSet=="function"?WeakSet:Set,pe=null;function Os(a,l){var h=a.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(p){et(a,l,p)}else h.current=null}function ac(a,l,h){try{h()}catch(p){et(a,l,p)}}var Zg=!1;function xT(a,l){if(vu=Ca,a=Cf(),cu(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var p=h.getSelection&&h.getSelection();if(p&&p.rangeCount!==0){h=p.anchorNode;var E=p.anchorOffset,x=p.focusNode;p=p.focusOffset;try{h.nodeType,x.nodeType}catch{h=null;break e}var I=0,D=-1,M=-1,z=0,ee=0,ne=a,Z=null;t:for(;;){for(var he;ne!==h||E!==0&&ne.nodeType!==3||(D=I+E),ne!==x||p!==0&&ne.nodeType!==3||(M=I+p),ne.nodeType===3&&(I+=ne.nodeValue.length),(he=ne.firstChild)!==null;)Z=ne,ne=he;for(;;){if(ne===a)break t;if(Z===h&&++z===E&&(D=I),Z===x&&++ee===p&&(M=I),(he=ne.nextSibling)!==null)break;ne=Z,Z=ne.parentNode}ne=he}h=D===-1||M===-1?null:{start:D,end:M}}else h=null}h=h||{start:0,end:0}}else h=null;for(Eu={focusedElem:a,selectionRange:h},Ca=!1,pe=l;pe!==null;)if(l=pe,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,pe=a;else for(;pe!==null;){l=pe;try{var me=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(me!==null){var ye=me.memoizedProps,st=me.memoizedState,K=l.stateNode,j=K.getSnapshotBeforeUpdate(l.elementType===l.type?ye:yr(l.type,ye),st);K.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var H=l.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ie){et(l,l.return,ie)}if(a=l.sibling,a!==null){a.return=l.return,pe=a;break}pe=l.return}return me=Zg,Zg=!1,me}function Wi(a,l,h){var p=l.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var E=p=p.next;do{if((E.tag&a)===a){var x=E.destroy;E.destroy=void 0,x!==void 0&&ac(l,h,x)}E=E.next}while(E!==p)}}function fo(a,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var h=l=l.next;do{if((h.tag&a)===a){var p=h.create;h.destroy=p()}h=h.next}while(h!==l)}}function oc(a){var l=a.ref;if(l!==null){var h=a.stateNode;switch(a.tag){case 5:a=h;break;default:a=h}typeof l=="function"?l(a):l.current=a}}function ep(a){var l=a.alternate;l!==null&&(a.alternate=null,ep(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&(delete l[Ir],delete l[Ni],delete l[_u],delete l[sT],delete l[iT])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function tp(a){return a.tag===5||a.tag===3||a.tag===4}function rp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||tp(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function lc(a,l,h){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?h.nodeType===8?h.parentNode.insertBefore(a,l):h.insertBefore(a,l):(h.nodeType===8?(l=h.parentNode,l.insertBefore(a,h)):(l=h,l.appendChild(a)),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=Va));else if(p!==4&&(a=a.child,a!==null))for(lc(a,l,h),a=a.sibling;a!==null;)lc(a,l,h),a=a.sibling}function uc(a,l,h){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?h.insertBefore(a,l):h.appendChild(a);else if(p!==4&&(a=a.child,a!==null))for(uc(a,l,h),a=a.sibling;a!==null;)uc(a,l,h),a=a.sibling}var Et=null,vr=!1;function yn(a,l,h){for(h=h.child;h!==null;)np(a,l,h),h=h.sibling}function np(a,l,h){if(br&&typeof br.onCommitFiberUnmount=="function")try{br.onCommitFiberUnmount(Aa,h)}catch{}switch(h.tag){case 5:It||Os(h,l);case 6:var p=Et,E=vr;Et=null,yn(a,l,h),Et=p,vr=E,Et!==null&&(vr?(a=Et,h=h.stateNode,a.nodeType===8?a.parentNode.removeChild(h):a.removeChild(h)):Et.removeChild(h.stateNode));break;case 18:Et!==null&&(vr?(a=Et,h=h.stateNode,a.nodeType===8?xu(a.parentNode,h):a.nodeType===1&&xu(a,h),wi(a)):xu(Et,h.stateNode));break;case 4:p=Et,E=vr,Et=h.stateNode.containerInfo,vr=!0,yn(a,l,h),Et=p,vr=E;break;case 0:case 11:case 14:case 15:if(!It&&(p=h.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){E=p=p.next;do{var x=E,I=x.destroy;x=x.tag,I!==void 0&&((x&2)!==0||(x&4)!==0)&&ac(h,l,I),E=E.next}while(E!==p)}yn(a,l,h);break;case 1:if(!It&&(Os(h,l),p=h.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=h.memoizedProps,p.state=h.memoizedState,p.componentWillUnmount()}catch(D){et(h,l,D)}yn(a,l,h);break;case 21:yn(a,l,h);break;case 22:h.mode&1?(It=(p=It)||h.memoizedState!==null,yn(a,l,h),It=p):yn(a,l,h);break;default:yn(a,l,h)}}function sp(a){var l=a.updateQueue;if(l!==null){a.updateQueue=null;var h=a.stateNode;h===null&&(h=a.stateNode=new TT),l.forEach(function(p){var E=CT.bind(null,a,p);h.has(p)||(h.add(p),p.then(E,E))})}}function Er(a,l){var h=l.deletions;if(h!==null)for(var p=0;p<h.length;p++){var E=h[p];try{var x=a,I=l,D=I;e:for(;D!==null;){switch(D.tag){case 5:Et=D.stateNode,vr=!1;break e;case 3:Et=D.stateNode.containerInfo,vr=!0;break e;case 4:Et=D.stateNode.containerInfo,vr=!0;break e}D=D.return}if(Et===null)throw Error(t(160));np(x,I,E),Et=null,vr=!1;var M=E.alternate;M!==null&&(M.return=null),E.return=null}catch(z){et(E,l,z)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)ip(l,a),l=l.sibling}function ip(a,l){var h=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Er(l,a),kr(a),p&4){try{Wi(3,a,a.return),fo(3,a)}catch(ye){et(a,a.return,ye)}try{Wi(5,a,a.return)}catch(ye){et(a,a.return,ye)}}break;case 1:Er(l,a),kr(a),p&512&&h!==null&&Os(h,h.return);break;case 5:if(Er(l,a),kr(a),p&512&&h!==null&&Os(h,h.return),a.flags&32){var E=a.stateNode;try{nn(E,"")}catch(ye){et(a,a.return,ye)}}if(p&4&&(E=a.stateNode,E!=null)){var x=a.memoizedProps,I=h!==null?h.memoizedProps:x,D=a.type,M=a.updateQueue;if(a.updateQueue=null,M!==null)try{D==="input"&&x.type==="radio"&&x.name!=null&&Oe(E,x),$l(D,I);var z=$l(D,x);for(I=0;I<M.length;I+=2){var ee=M[I],ne=M[I+1];ee==="style"?$h(E,ne):ee==="dangerouslySetInnerHTML"?gi(E,ne):ee==="children"?nn(E,ne):A(E,ee,ne,z)}switch(D){case"input":it(E,x);break;case"textarea":Fn(E,x);break;case"select":var Z=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!x.multiple;var he=x.value;he!=null?Gt(E,!!x.multiple,he,!1):Z!==!!x.multiple&&(x.defaultValue!=null?Gt(E,!!x.multiple,x.defaultValue,!0):Gt(E,!!x.multiple,x.multiple?[]:"",!1))}E[Ni]=x}catch(ye){et(a,a.return,ye)}}break;case 6:if(Er(l,a),kr(a),p&4){if(a.stateNode===null)throw Error(t(162));E=a.stateNode,x=a.memoizedProps;try{E.nodeValue=x}catch(ye){et(a,a.return,ye)}}break;case 3:if(Er(l,a),kr(a),p&4&&h!==null&&h.memoizedState.isDehydrated)try{wi(l.containerInfo)}catch(ye){et(a,a.return,ye)}break;case 4:Er(l,a),kr(a);break;case 13:Er(l,a),kr(a),E=a.child,E.flags&8192&&(x=E.memoizedState!==null,E.stateNode.isHidden=x,!x||E.alternate!==null&&E.alternate.memoizedState!==null||(hc=nt())),p&4&&sp(a);break;case 22:if(ee=h!==null&&h.memoizedState!==null,a.mode&1?(It=(z=It)||ee,Er(l,a),It=z):Er(l,a),kr(a),p&8192){if(z=a.memoizedState!==null,(a.stateNode.isHidden=z)&&!ee&&(a.mode&1)!==0)for(pe=a,ee=a.child;ee!==null;){for(ne=pe=ee;pe!==null;){switch(Z=pe,he=Z.child,Z.tag){case 0:case 11:case 14:case 15:Wi(4,Z,Z.return);break;case 1:Os(Z,Z.return);var me=Z.stateNode;if(typeof me.componentWillUnmount=="function"){p=Z,h=Z.return;try{l=p,me.props=l.memoizedProps,me.state=l.memoizedState,me.componentWillUnmount()}catch(ye){et(p,h,ye)}}break;case 5:Os(Z,Z.return);break;case 22:if(Z.memoizedState!==null){lp(ne);continue}}he!==null?(he.return=Z,pe=he):lp(ne)}ee=ee.sibling}e:for(ee=null,ne=a;;){if(ne.tag===5){if(ee===null){ee=ne;try{E=ne.stateNode,z?(x=E.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(D=ne.stateNode,M=ne.memoizedProps.style,I=M!=null&&M.hasOwnProperty("display")?M.display:null,D.style.display=Bh("display",I))}catch(ye){et(a,a.return,ye)}}}else if(ne.tag===6){if(ee===null)try{ne.stateNode.nodeValue=z?"":ne.memoizedProps}catch(ye){et(a,a.return,ye)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===a)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===a)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===a)break e;ee===ne&&(ee=null),ne=ne.return}ee===ne&&(ee=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:Er(l,a),kr(a),p&4&&sp(a);break;case 21:break;default:Er(l,a),kr(a)}}function kr(a){var l=a.flags;if(l&2){try{e:{for(var h=a.return;h!==null;){if(tp(h)){var p=h;break e}h=h.return}throw Error(t(160))}switch(p.tag){case 5:var E=p.stateNode;p.flags&32&&(nn(E,""),p.flags&=-33);var x=rp(a);uc(a,x,E);break;case 3:case 4:var I=p.stateNode.containerInfo,D=rp(a);lc(a,D,I);break;default:throw Error(t(161))}}catch(M){et(a,a.return,M)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function _T(a,l,h){pe=a,ap(a)}function ap(a,l,h){for(var p=(a.mode&1)!==0;pe!==null;){var E=pe,x=E.child;if(E.tag===22&&p){var I=E.memoizedState!==null||ho;if(!I){var D=E.alternate,M=D!==null&&D.memoizedState!==null||It;D=ho;var z=It;if(ho=I,(It=M)&&!z)for(pe=E;pe!==null;)I=pe,M=I.child,I.tag===22&&I.memoizedState!==null?up(E):M!==null?(M.return=I,pe=M):up(E);for(;x!==null;)pe=x,ap(x),x=x.sibling;pe=E,ho=D,It=z}op(a)}else(E.subtreeFlags&8772)!==0&&x!==null?(x.return=E,pe=x):op(a)}}function op(a){for(;pe!==null;){var l=pe;if((l.flags&8772)!==0){var h=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:It||fo(5,l);break;case 1:var p=l.stateNode;if(l.flags&4&&!It)if(h===null)p.componentDidMount();else{var E=l.elementType===l.type?h.memoizedProps:yr(l.type,h.memoizedProps);p.componentDidUpdate(E,h.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var x=l.updateQueue;x!==null&&lg(l,x,p);break;case 3:var I=l.updateQueue;if(I!==null){if(h=null,l.child!==null)switch(l.child.tag){case 5:h=l.child.stateNode;break;case 1:h=l.child.stateNode}lg(l,I,h)}break;case 5:var D=l.stateNode;if(h===null&&l.flags&4){h=D;var M=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":M.autoFocus&&h.focus();break;case"img":M.src&&(h.src=M.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var z=l.alternate;if(z!==null){var ee=z.memoizedState;if(ee!==null){var ne=ee.dehydrated;ne!==null&&wi(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}It||l.flags&512&&oc(l)}catch(Z){et(l,l.return,Z)}}if(l===a){pe=null;break}if(h=l.sibling,h!==null){h.return=l.return,pe=h;break}pe=l.return}}function lp(a){for(;pe!==null;){var l=pe;if(l===a){pe=null;break}var h=l.sibling;if(h!==null){h.return=l.return,pe=h;break}pe=l.return}}function up(a){for(;pe!==null;){var l=pe;try{switch(l.tag){case 0:case 11:case 15:var h=l.return;try{fo(4,l)}catch(M){et(l,h,M)}break;case 1:var p=l.stateNode;if(typeof p.componentDidMount=="function"){var E=l.return;try{p.componentDidMount()}catch(M){et(l,E,M)}}var x=l.return;try{oc(l)}catch(M){et(l,x,M)}break;case 5:var I=l.return;try{oc(l)}catch(M){et(l,I,M)}}}catch(M){et(l,l.return,M)}if(l===a){pe=null;break}var D=l.sibling;if(D!==null){D.return=l.return,pe=D;break}pe=l.return}}var wT=Math.ceil,go=L.ReactCurrentDispatcher,cc=L.ReactCurrentOwner,ar=L.ReactCurrentBatchConfig,Ne=0,pt=null,at=null,St=0,Wt=0,Ns=hn(0),ct=0,zi=null,Wn=0,po=0,dc=0,qi=null,Ft=null,hc=0,Ms=1/0,qr=null,mo=!1,fc=null,vn=null,yo=!1,En=null,vo=0,Yi=0,gc=null,Eo=-1,So=0;function Ct(){return(Ne&6)!==0?nt():Eo!==-1?Eo:Eo=nt()}function Sn(a){return(a.mode&1)===0?1:(Ne&2)!==0&&St!==0?St&-St:oT.transition!==null?(So===0&&(So=tf()),So):(a=Fe,a!==0||(a=window.event,a=a===void 0?16:df(a.type)),a)}function Sr(a,l,h,p){if(50<Yi)throw Yi=0,gc=null,Error(t(185));Ei(a,h,p),((Ne&2)===0||a!==pt)&&(a===pt&&((Ne&2)===0&&(po|=h),ct===4&&Tn(a,St)),Ut(a,p),h===1&&Ne===0&&(l.mode&1)===0&&(Ms=nt()+500,za&&gn()))}function Ut(a,l){var h=a.callbackNode;oS(a,l);var p=Ra(a,a===pt?St:0);if(p===0)h!==null&&Jh(h),a.callbackNode=null,a.callbackPriority=0;else if(l=p&-p,a.callbackPriority!==l){if(h!=null&&Jh(h),l===1)a.tag===0?aT(dp.bind(null,a)):Qf(dp.bind(null,a)),rT(function(){(Ne&6)===0&&gn()}),h=null;else{switch(rf(p)){case 1:h=zl;break;case 4:h=Zh;break;case 16:h=wa;break;case 536870912:h=ef;break;default:h=wa}h=Ep(h,cp.bind(null,a))}a.callbackPriority=l,a.callbackNode=h}}function cp(a,l){if(Eo=-1,So=0,(Ne&6)!==0)throw Error(t(327));var h=a.callbackNode;if(Fs()&&a.callbackNode!==h)return null;var p=Ra(a,a===pt?St:0);if(p===0)return null;if((p&30)!==0||(p&a.expiredLanes)!==0||l)l=To(a,p);else{l=p;var E=Ne;Ne|=2;var x=fp();(pt!==a||St!==l)&&(qr=null,Ms=nt()+500,qn(a,l));do try{IT();break}catch(D){hp(a,D)}while(!0);Pu(),go.current=x,Ne=E,at!==null?l=0:(pt=null,St=0,l=ct)}if(l!==0){if(l===2&&(E=ql(a),E!==0&&(p=E,l=pc(a,E))),l===1)throw h=zi,qn(a,0),Tn(a,p),Ut(a,nt()),h;if(l===6)Tn(a,p);else{if(E=a.current.alternate,(p&30)===0&&!AT(E)&&(l=To(a,p),l===2&&(x=ql(a),x!==0&&(p=x,l=pc(a,x))),l===1))throw h=zi,qn(a,0),Tn(a,p),Ut(a,nt()),h;switch(a.finishedWork=E,a.finishedLanes=p,l){case 0:case 1:throw Error(t(345));case 2:Yn(a,Ft,qr);break;case 3:if(Tn(a,p),(p&130023424)===p&&(l=hc+500-nt(),10<l)){if(Ra(a,0)!==0)break;if(E=a.suspendedLanes,(E&p)!==p){Ct(),a.pingedLanes|=a.suspendedLanes&E;break}a.timeoutHandle=Tu(Yn.bind(null,a,Ft,qr),l);break}Yn(a,Ft,qr);break;case 4:if(Tn(a,p),(p&4194240)===p)break;for(l=a.eventTimes,E=-1;0<p;){var I=31-gr(p);x=1<<I,I=l[I],I>E&&(E=I),p&=~x}if(p=E,p=nt()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*wT(p/1960))-p,10<p){a.timeoutHandle=Tu(Yn.bind(null,a,Ft,qr),p);break}Yn(a,Ft,qr);break;case 5:Yn(a,Ft,qr);break;default:throw Error(t(329))}}}return Ut(a,nt()),a.callbackNode===h?cp.bind(null,a):null}function pc(a,l){var h=qi;return a.current.memoizedState.isDehydrated&&(qn(a,l).flags|=256),a=To(a,l),a!==2&&(l=Ft,Ft=h,l!==null&&mc(l)),a}function mc(a){Ft===null?Ft=a:Ft.push.apply(Ft,a)}function AT(a){for(var l=a;;){if(l.flags&16384){var h=l.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var p=0;p<h.length;p++){var E=h[p],x=E.getSnapshot;E=E.value;try{if(!pr(x(),E))return!1}catch{return!1}}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Tn(a,l){for(l&=~dc,l&=~po,a.suspendedLanes|=l,a.pingedLanes&=~l,a=a.expirationTimes;0<l;){var h=31-gr(l),p=1<<h;a[h]=-1,l&=~p}}function dp(a){if((Ne&6)!==0)throw Error(t(327));Fs();var l=Ra(a,0);if((l&1)===0)return Ut(a,nt()),null;var h=To(a,l);if(a.tag!==0&&h===2){var p=ql(a);p!==0&&(l=p,h=pc(a,p))}if(h===1)throw h=zi,qn(a,0),Tn(a,l),Ut(a,nt()),h;if(h===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=l,Yn(a,Ft,qr),Ut(a,nt()),null}function yc(a,l){var h=Ne;Ne|=1;try{return a(l)}finally{Ne=h,Ne===0&&(Ms=nt()+500,za&&gn())}}function zn(a){En!==null&&En.tag===0&&(Ne&6)===0&&Fs();var l=Ne;Ne|=1;var h=ar.transition,p=Fe;try{if(ar.transition=null,Fe=1,a)return a()}finally{Fe=p,ar.transition=h,Ne=l,(Ne&6)===0&&gn()}}function vc(){Wt=Ns.current,We(Ns)}function qn(a,l){a.finishedWork=null,a.finishedLanes=0;var h=a.timeoutHandle;if(h!==-1&&(a.timeoutHandle=-1,tT(h)),at!==null)for(h=at.return;h!==null;){var p=h;switch(Iu(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&Ha();break;case 3:Ps(),We(Ot),We(wt),$u();break;case 5:Uu(p);break;case 4:Ps();break;case 13:We(Ye);break;case 19:We(Ye);break;case 10:Du(p.type._context);break;case 22:case 23:vc()}h=h.return}if(pt=a,at=a=xn(a.current,null),St=Wt=l,ct=0,zi=null,dc=po=Wn=0,Ft=qi=null,Vn!==null){for(l=0;l<Vn.length;l++)if(h=Vn[l],p=h.interleaved,p!==null){h.interleaved=null;var E=p.next,x=h.pending;if(x!==null){var I=x.next;x.next=E,p.next=I}h.pending=p}Vn=null}return a}function hp(a,l){do{var h=at;try{if(Pu(),no.current=oo,so){for(var p=Qe.memoizedState;p!==null;){var E=p.queue;E!==null&&(E.pending=null),p=p.next}so=!1}if(Hn=0,gt=ut=Qe=null,ji=!1,Gi=0,cc.current=null,h===null||h.return===null){ct=1,zi=l,at=null;break}e:{var x=a,I=h.return,D=h,M=l;if(l=St,D.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){var z=M,ee=D,ne=ee.tag;if((ee.mode&1)===0&&(ne===0||ne===11||ne===15)){var Z=ee.alternate;Z?(ee.updateQueue=Z.updateQueue,ee.memoizedState=Z.memoizedState,ee.lanes=Z.lanes):(ee.updateQueue=null,ee.memoizedState=null)}var he=Fg(I);if(he!==null){he.flags&=-257,Ug(he,I,D,x,l),he.mode&1&&Mg(x,z,l),l=he,M=z;var me=l.updateQueue;if(me===null){var ye=new Set;ye.add(M),l.updateQueue=ye}else me.add(M);break e}else{if((l&1)===0){Mg(x,z,l),Ec();break e}M=Error(t(426))}}else if(qe&&D.mode&1){var st=Fg(I);if(st!==null){(st.flags&65536)===0&&(st.flags|=256),Ug(st,I,D,x,l),ku(Ds(M,D));break e}}x=M=Ds(M,D),ct!==4&&(ct=2),qi===null?qi=[x]:qi.push(x),x=I;do{switch(x.tag){case 3:x.flags|=65536,l&=-l,x.lanes|=l;var K=Og(x,M,l);og(x,K);break e;case 1:D=M;var j=x.type,H=x.stateNode;if((x.flags&128)===0&&(typeof j.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(vn===null||!vn.has(H)))){x.flags|=65536,l&=-l,x.lanes|=l;var ie=Ng(x,D,l);og(x,ie);break e}}x=x.return}while(x!==null)}pp(h)}catch(Ee){l=Ee,at===h&&h!==null&&(at=h=h.return);continue}break}while(!0)}function fp(){var a=go.current;return go.current=oo,a===null?oo:a}function Ec(){(ct===0||ct===3||ct===2)&&(ct=4),pt===null||(Wn&268435455)===0&&(po&268435455)===0||Tn(pt,St)}function To(a,l){var h=Ne;Ne|=2;var p=fp();(pt!==a||St!==l)&&(qr=null,qn(a,l));do try{bT();break}catch(E){hp(a,E)}while(!0);if(Pu(),Ne=h,go.current=p,at!==null)throw Error(t(261));return pt=null,St=0,ct}function bT(){for(;at!==null;)gp(at)}function IT(){for(;at!==null&&!JE();)gp(at)}function gp(a){var l=vp(a.alternate,a,Wt);a.memoizedProps=a.pendingProps,l===null?pp(a):at=l,cc.current=null}function pp(a){var l=a;do{var h=l.alternate;if(a=l.return,(l.flags&32768)===0){if(h=ET(h,l,Wt),h!==null){at=h;return}}else{if(h=ST(h,l),h!==null){h.flags&=32767,at=h;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{ct=6,at=null;return}}if(l=l.sibling,l!==null){at=l;return}at=l=a}while(l!==null);ct===0&&(ct=5)}function Yn(a,l,h){var p=Fe,E=ar.transition;try{ar.transition=null,Fe=1,RT(a,l,h,p)}finally{ar.transition=E,Fe=p}return null}function RT(a,l,h,p){do Fs();while(En!==null);if((Ne&6)!==0)throw Error(t(327));h=a.finishedWork;var E=a.finishedLanes;if(h===null)return null;if(a.finishedWork=null,a.finishedLanes=0,h===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var x=h.lanes|h.childLanes;if(lS(a,x),a===pt&&(at=pt=null,St=0),(h.subtreeFlags&2064)===0&&(h.flags&2064)===0||yo||(yo=!0,Ep(wa,function(){return Fs(),null})),x=(h.flags&15990)!==0,(h.subtreeFlags&15990)!==0||x){x=ar.transition,ar.transition=null;var I=Fe;Fe=1;var D=Ne;Ne|=4,cc.current=null,xT(a,h),ip(h,a),qS(Eu),Ca=!!vu,Eu=vu=null,a.current=h,_T(h),ZE(),Ne=D,Fe=I,ar.transition=x}else a.current=h;if(yo&&(yo=!1,En=a,vo=E),x=a.pendingLanes,x===0&&(vn=null),rS(h.stateNode),Ut(a,nt()),l!==null)for(p=a.onRecoverableError,h=0;h<l.length;h++)E=l[h],p(E.value,{componentStack:E.stack,digest:E.digest});if(mo)throw mo=!1,a=fc,fc=null,a;return(vo&1)!==0&&a.tag!==0&&Fs(),x=a.pendingLanes,(x&1)!==0?a===gc?Yi++:(Yi=0,gc=a):Yi=0,gn(),null}function Fs(){if(En!==null){var a=rf(vo),l=ar.transition,h=Fe;try{if(ar.transition=null,Fe=16>a?16:a,En===null)var p=!1;else{if(a=En,En=null,vo=0,(Ne&6)!==0)throw Error(t(331));var E=Ne;for(Ne|=4,pe=a.current;pe!==null;){var x=pe,I=x.child;if((pe.flags&16)!==0){var D=x.deletions;if(D!==null){for(var M=0;M<D.length;M++){var z=D[M];for(pe=z;pe!==null;){var ee=pe;switch(ee.tag){case 0:case 11:case 15:Wi(8,ee,x)}var ne=ee.child;if(ne!==null)ne.return=ee,pe=ne;else for(;pe!==null;){ee=pe;var Z=ee.sibling,he=ee.return;if(ep(ee),ee===z){pe=null;break}if(Z!==null){Z.return=he,pe=Z;break}pe=he}}}var me=x.alternate;if(me!==null){var ye=me.child;if(ye!==null){me.child=null;do{var st=ye.sibling;ye.sibling=null,ye=st}while(ye!==null)}}pe=x}}if((x.subtreeFlags&2064)!==0&&I!==null)I.return=x,pe=I;else e:for(;pe!==null;){if(x=pe,(x.flags&2048)!==0)switch(x.tag){case 0:case 11:case 15:Wi(9,x,x.return)}var K=x.sibling;if(K!==null){K.return=x.return,pe=K;break e}pe=x.return}}var j=a.current;for(pe=j;pe!==null;){I=pe;var H=I.child;if((I.subtreeFlags&2064)!==0&&H!==null)H.return=I,pe=H;else e:for(I=j;pe!==null;){if(D=pe,(D.flags&2048)!==0)try{switch(D.tag){case 0:case 11:case 15:fo(9,D)}}catch(Ee){et(D,D.return,Ee)}if(D===I){pe=null;break e}var ie=D.sibling;if(ie!==null){ie.return=D.return,pe=ie;break e}pe=D.return}}if(Ne=E,gn(),br&&typeof br.onPostCommitFiberRoot=="function")try{br.onPostCommitFiberRoot(Aa,a)}catch{}p=!0}return p}finally{Fe=h,ar.transition=l}}return!1}function mp(a,l,h){l=Ds(h,l),l=Og(a,l,1),a=mn(a,l,1),l=Ct(),a!==null&&(Ei(a,1,l),Ut(a,l))}function et(a,l,h){if(a.tag===3)mp(a,a,h);else for(;l!==null;){if(l.tag===3){mp(l,a,h);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(vn===null||!vn.has(p))){a=Ds(h,a),a=Ng(l,a,1),l=mn(l,a,1),a=Ct(),l!==null&&(Ei(l,1,a),Ut(l,a));break}}l=l.return}}function LT(a,l,h){var p=a.pingCache;p!==null&&p.delete(l),l=Ct(),a.pingedLanes|=a.suspendedLanes&h,pt===a&&(St&h)===h&&(ct===4||ct===3&&(St&130023424)===St&&500>nt()-hc?qn(a,0):dc|=h),Ut(a,l)}function yp(a,l){l===0&&((a.mode&1)===0?l=1:(l=Ia,Ia<<=1,(Ia&130023424)===0&&(Ia=4194304)));var h=Ct();a=Hr(a,l),a!==null&&(Ei(a,l,h),Ut(a,h))}function kT(a){var l=a.memoizedState,h=0;l!==null&&(h=l.retryLane),yp(a,h)}function CT(a,l){var h=0;switch(a.tag){case 13:var p=a.stateNode,E=a.memoizedState;E!==null&&(h=E.retryLane);break;case 19:p=a.stateNode;break;default:throw Error(t(314))}p!==null&&p.delete(l),yp(a,h)}var vp;vp=function(a,l,h){if(a!==null)if(a.memoizedProps!==l.pendingProps||Ot.current)Mt=!0;else{if((a.lanes&h)===0&&(l.flags&128)===0)return Mt=!1,vT(a,l,h);Mt=(a.flags&131072)!==0}else Mt=!1,qe&&(l.flags&1048576)!==0&&Xf(l,Ya,l.index);switch(l.lanes=0,l.tag){case 2:var p=l.type;co(a,l),a=l.pendingProps;var E=As(l,wt.current);Cs(l,h),E=Vu(null,l,p,a,E,h);var x=Ku();return l.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,Nt(p)?(x=!0,Wa(l)):x=!1,l.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,Mu(l),E.updater=lo,l.stateNode=E,E._reactInternals=l,Qu(l,p,a,h),l=ec(null,l,p,!0,x,h)):(l.tag=0,qe&&x&&bu(l),kt(null,l,E,h),l=l.child),l;case 16:p=l.elementType;e:{switch(co(a,l),a=l.pendingProps,E=p._init,p=E(p._payload),l.type=p,E=l.tag=DT(p),a=yr(p,a),E){case 0:l=Zu(null,l,p,a,h);break e;case 1:l=Kg(null,l,p,a,h);break e;case 11:l=Bg(null,l,p,a,h);break e;case 14:l=$g(null,l,p,yr(p.type,a),h);break e}throw Error(t(306,p,""))}return l;case 0:return p=l.type,E=l.pendingProps,E=l.elementType===p?E:yr(p,E),Zu(a,l,p,E,h);case 1:return p=l.type,E=l.pendingProps,E=l.elementType===p?E:yr(p,E),Kg(a,l,p,E,h);case 3:e:{if(Hg(l),a===null)throw Error(t(387));p=l.pendingProps,x=l.memoizedState,E=x.element,ag(a,l),to(l,p,null,h);var I=l.memoizedState;if(p=I.element,x.isDehydrated)if(x={element:p,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},l.updateQueue.baseState=x,l.memoizedState=x,l.flags&256){E=Ds(Error(t(423)),l),l=Wg(a,l,p,h,E);break e}else if(p!==E){E=Ds(Error(t(424)),l),l=Wg(a,l,p,h,E);break e}else for(Ht=dn(l.stateNode.containerInfo.firstChild),Kt=l,qe=!0,mr=null,h=sg(l,null,p,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Rs(),p===E){l=zr(a,l,h);break e}kt(a,l,p,h)}l=l.child}return l;case 5:return ug(l),a===null&&Lu(l),p=l.type,E=l.pendingProps,x=a!==null?a.memoizedProps:null,I=E.children,Su(p,E)?I=null:x!==null&&Su(p,x)&&(l.flags|=32),Vg(a,l),kt(a,l,I,h),l.child;case 6:return a===null&&Lu(l),null;case 13:return zg(a,l,h);case 4:return Fu(l,l.stateNode.containerInfo),p=l.pendingProps,a===null?l.child=Ls(l,null,p,h):kt(a,l,p,h),l.child;case 11:return p=l.type,E=l.pendingProps,E=l.elementType===p?E:yr(p,E),Bg(a,l,p,E,h);case 7:return kt(a,l,l.pendingProps,h),l.child;case 8:return kt(a,l,l.pendingProps.children,h),l.child;case 12:return kt(a,l,l.pendingProps.children,h),l.child;case 10:e:{if(p=l.type._context,E=l.pendingProps,x=l.memoizedProps,I=E.value,Ve(Ja,p._currentValue),p._currentValue=I,x!==null)if(pr(x.value,I)){if(x.children===E.children&&!Ot.current){l=zr(a,l,h);break e}}else for(x=l.child,x!==null&&(x.return=l);x!==null;){var D=x.dependencies;if(D!==null){I=x.child;for(var M=D.firstContext;M!==null;){if(M.context===p){if(x.tag===1){M=Wr(-1,h&-h),M.tag=2;var z=x.updateQueue;if(z!==null){z=z.shared;var ee=z.pending;ee===null?M.next=M:(M.next=ee.next,ee.next=M),z.pending=M}}x.lanes|=h,M=x.alternate,M!==null&&(M.lanes|=h),Ou(x.return,h,l),D.lanes|=h;break}M=M.next}}else if(x.tag===10)I=x.type===l.type?null:x.child;else if(x.tag===18){if(I=x.return,I===null)throw Error(t(341));I.lanes|=h,D=I.alternate,D!==null&&(D.lanes|=h),Ou(I,h,l),I=x.sibling}else I=x.child;if(I!==null)I.return=x;else for(I=x;I!==null;){if(I===l){I=null;break}if(x=I.sibling,x!==null){x.return=I.return,I=x;break}I=I.return}x=I}kt(a,l,E.children,h),l=l.child}return l;case 9:return E=l.type,p=l.pendingProps.children,Cs(l,h),E=sr(E),p=p(E),l.flags|=1,kt(a,l,p,h),l.child;case 14:return p=l.type,E=yr(p,l.pendingProps),E=yr(p.type,E),$g(a,l,p,E,h);case 15:return jg(a,l,l.type,l.pendingProps,h);case 17:return p=l.type,E=l.pendingProps,E=l.elementType===p?E:yr(p,E),co(a,l),l.tag=1,Nt(p)?(a=!0,Wa(l)):a=!1,Cs(l,h),Pg(l,p,E),Qu(l,p,E,h),ec(null,l,p,!0,a,h);case 19:return Yg(a,l,h);case 22:return Gg(a,l,h)}throw Error(t(156,l.tag))};function Ep(a,l){return Xh(a,l)}function PT(a,l,h,p){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function or(a,l,h,p){return new PT(a,l,h,p)}function Sc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function DT(a){if(typeof a=="function")return Sc(a)?1:0;if(a!=null){if(a=a.$$typeof,a===re)return 11;if(a===oe)return 14}return 2}function xn(a,l){var h=a.alternate;return h===null?(h=or(a.tag,l,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=l,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&14680064,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,l=a.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h}function xo(a,l,h,p,E,x){var I=2;if(p=a,typeof a=="function")Sc(a)&&(I=1);else if(typeof a=="string")I=5;else e:switch(a){case P:return Qn(h.children,E,x,l);case $:I=8,E|=8;break;case B:return a=or(12,h,l,E|2),a.elementType=B,a.lanes=x,a;case ae:return a=or(13,h,l,E),a.elementType=ae,a.lanes=x,a;case le:return a=or(19,h,l,E),a.elementType=le,a.lanes=x,a;case se:return _o(h,E,x,l);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case U:I=10;break e;case q:I=9;break e;case re:I=11;break e;case oe:I=14;break e;case J:I=16,p=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return l=or(I,h,l,E),l.elementType=a,l.type=p,l.lanes=x,l}function Qn(a,l,h,p){return a=or(7,a,p,l),a.lanes=h,a}function _o(a,l,h,p){return a=or(22,a,p,l),a.elementType=se,a.lanes=h,a.stateNode={isHidden:!1},a}function Tc(a,l,h){return a=or(6,a,null,l),a.lanes=h,a}function xc(a,l,h){return l=or(4,a.children!==null?a.children:[],a.key,l),l.lanes=h,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}function OT(a,l,h,p,E){this.tag=l,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yl(0),this.expirationTimes=Yl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yl(0),this.identifierPrefix=p,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function _c(a,l,h,p,E,x,I,D,M){return a=new OT(a,l,h,D,M),l===1?(l=1,x===!0&&(l|=8)):l=0,x=or(3,null,null,l),a.current=x,x.stateNode=a,x.memoizedState={element:p,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mu(x),a}function NT(a,l,h){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O,key:p==null?null:""+p,children:a,containerInfo:l,implementation:h}}function Sp(a){if(!a)return fn;a=a._reactInternals;e:{if(Un(a)!==a||a.tag!==1)throw Error(t(170));var l=a;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(Nt(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(t(171))}if(a.tag===1){var h=a.type;if(Nt(h))return qf(a,h,l)}return l}function Tp(a,l,h,p,E,x,I,D,M){return a=_c(h,p,!0,a,E,x,I,D,M),a.context=Sp(null),h=a.current,p=Ct(),E=Sn(h),x=Wr(p,E),x.callback=l??null,mn(h,x,E),a.current.lanes=E,Ei(a,E,p),Ut(a,p),a}function wo(a,l,h,p){var E=l.current,x=Ct(),I=Sn(E);return h=Sp(h),l.context===null?l.context=h:l.pendingContext=h,l=Wr(x,I),l.payload={element:a},p=p===void 0?null:p,p!==null&&(l.callback=p),a=mn(E,l,I),a!==null&&(Sr(a,E,I,x),eo(a,E,I)),I}function Ao(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function xp(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<l?h:l}}function wc(a,l){xp(a,l),(a=a.alternate)&&xp(a,l)}function MT(){return null}var _p=typeof reportError=="function"?reportError:function(a){console.error(a)};function Ac(a){this._internalRoot=a}bo.prototype.render=Ac.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(t(409));wo(a,l,null,null)},bo.prototype.unmount=Ac.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;zn(function(){wo(null,a,null,null)}),l[jr]=null}};function bo(a){this._internalRoot=a}bo.prototype.unstable_scheduleHydration=function(a){if(a){var l=af();a={blockedOn:null,target:a,priority:l};for(var h=0;h<ln.length&&l!==0&&l<ln[h].priority;h++);ln.splice(h,0,a),h===0&&uf(a)}};function bc(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Io(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function wp(){}function FT(a,l,h,p,E){if(E){if(typeof p=="function"){var x=p;p=function(){var z=Ao(I);x.call(z)}}var I=Tp(l,p,a,0,null,!1,!1,"",wp);return a._reactRootContainer=I,a[jr]=I.current,Di(a.nodeType===8?a.parentNode:a),zn(),I}for(;E=a.lastChild;)a.removeChild(E);if(typeof p=="function"){var D=p;p=function(){var z=Ao(M);D.call(z)}}var M=_c(a,0,!1,null,null,!1,!1,"",wp);return a._reactRootContainer=M,a[jr]=M.current,Di(a.nodeType===8?a.parentNode:a),zn(function(){wo(l,M,h,p)}),M}function Ro(a,l,h,p,E){var x=h._reactRootContainer;if(x){var I=x;if(typeof E=="function"){var D=E;E=function(){var M=Ao(I);D.call(M)}}wo(l,I,a,E)}else I=FT(h,l,a,E,p);return Ao(I)}nf=function(a){switch(a.tag){case 3:var l=a.stateNode;if(l.current.memoizedState.isDehydrated){var h=vi(l.pendingLanes);h!==0&&(Ql(l,h|1),Ut(l,nt()),(Ne&6)===0&&(Ms=nt()+500,gn()))}break;case 13:zn(function(){var p=Hr(a,1);if(p!==null){var E=Ct();Sr(p,a,1,E)}}),wc(a,1)}},Xl=function(a){if(a.tag===13){var l=Hr(a,134217728);if(l!==null){var h=Ct();Sr(l,a,134217728,h)}wc(a,134217728)}},sf=function(a){if(a.tag===13){var l=Sn(a),h=Hr(a,l);if(h!==null){var p=Ct();Sr(h,a,l,p)}wc(a,l)}},af=function(){return Fe},of=function(a,l){var h=Fe;try{return Fe=a,l()}finally{Fe=h}},Vl=function(a,l,h){switch(l){case"input":if(it(a,h),l=h.name,h.type==="radio"&&l!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<h.length;l++){var p=h[l];if(p!==a&&p.form===a.form){var E=Ka(p);if(!E)throw Error(t(90));Ta(p),it(p,E)}}}break;case"textarea":Fn(a,h);break;case"select":l=h.value,l!=null&&Gt(a,!!h.multiple,l,!1)}},Kh=yc,Hh=zn;var UT={usingClientEntryPoint:!1,Events:[Mi,_s,Ka,Gh,Vh,yc]},Qi={findFiberByHostInstance:Bn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},BT={bundleType:Qi.bundleType,version:Qi.version,rendererPackageName:Qi.rendererPackageName,rendererConfig:Qi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:L.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Yh(a),a===null?null:a.stateNode},findFiberByHostInstance:Qi.findFiberByHostInstance||MT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lo.isDisabled&&Lo.supportsFiber)try{Aa=Lo.inject(BT),br=Lo}catch{}}return Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UT,Bt.createPortal=function(a,l){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bc(l))throw Error(t(200));return NT(a,l,null,h)},Bt.createRoot=function(a,l){if(!bc(a))throw Error(t(299));var h=!1,p="",E=_p;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=_c(a,1,!1,null,null,h,!1,p,E),a[jr]=l.current,Di(a.nodeType===8?a.parentNode:a),new Ac(l)},Bt.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=Yh(l),a=a===null?null:a.stateNode,a},Bt.flushSync=function(a){return zn(a)},Bt.hydrate=function(a,l,h){if(!Io(l))throw Error(t(200));return Ro(null,a,l,!0,h)},Bt.hydrateRoot=function(a,l,h){if(!bc(a))throw Error(t(405));var p=h!=null&&h.hydratedSources||null,E=!1,x="",I=_p;if(h!=null&&(h.unstable_strictMode===!0&&(E=!0),h.identifierPrefix!==void 0&&(x=h.identifierPrefix),h.onRecoverableError!==void 0&&(I=h.onRecoverableError)),l=Tp(l,null,a,1,h??null,E,!1,x,I),a[jr]=l.current,Di(a),p)for(a=0;a<p.length;a++)h=p[a],E=h._getVersion,E=E(h._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[h,E]:l.mutableSourceEagerHydrationData.push(h,E);return new bo(l)},Bt.render=function(a,l,h){if(!Io(l))throw Error(t(200));return Ro(null,a,l,!1,h)},Bt.unmountComponentAtNode=function(a){if(!Io(a))throw Error(t(40));return a._reactRootContainer?(zn(function(){Ro(null,null,a,!1,function(){a._reactRootContainer=null,a[jr]=null})}),!0):!1},Bt.unstable_batchedUpdates=yc,Bt.unstable_renderSubtreeIntoContainer=function(a,l,h,p){if(!Io(h))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return Ro(a,l,h,!1,p)},Bt.version="18.3.1-next-f1338f8080-20240426",Bt}var Pp;function z0(){if(Pp)return Lc.exports;Pp=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Lc.exports=qT(),Lc.exports}var Dp;function YT(){if(Dp)return ko;Dp=1;var s=z0();return ko.createRoot=s.createRoot,ko.hydrateRoot=s.hydrateRoot,ko}var QT=YT();const XT=sh(QT);z0();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function oa(){return oa=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},oa.apply(this,arguments)}var kn;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(kn||(kn={}));const Op="popstate";function JT(s){s===void 0&&(s={});function e(r,n){let{pathname:i,search:o,hash:u}=r.location;return md("",{pathname:i,search:o,hash:u},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(r,n){return typeof n=="string"?n:cl(n)}return ex(e,t,null,s)}function rt(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function q0(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ZT(){return Math.random().toString(36).substr(2,8)}function Np(s,e){return{usr:s.state,key:s.key,idx:e}}function md(s,e,t,r){return t===void 0&&(t=null),oa({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?li(e):e,{state:t,key:e&&e.key||r||ZT()})}function cl(s){let{pathname:e="/",search:t="",hash:r=""}=s;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function li(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substr(t),s=s.substr(0,t));let r=s.indexOf("?");r>=0&&(e.search=s.substr(r),s=s.substr(0,r)),s&&(e.pathname=s)}return e}function ex(s,e,t,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:i=!1}=r,o=n.history,u=kn.Pop,c=null,d=f();d==null&&(d=0,o.replaceState(oa({},o.state,{idx:d}),""));function f(){return(o.state||{idx:null}).idx}function g(){u=kn.Pop;let S=f(),w=S==null?null:S-d;d=S,c&&c({action:u,location:T.location,delta:w})}function m(S,w){u=kn.Push;let b=md(T.location,S,w);d=f()+1;let A=Np(b,d),L=T.createHref(b);try{o.pushState(A,"",L)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;n.location.assign(L)}i&&c&&c({action:u,location:T.location,delta:1})}function y(S,w){u=kn.Replace;let b=md(T.location,S,w);d=f();let A=Np(b,d),L=T.createHref(b);o.replaceState(A,"",L),i&&c&&c({action:u,location:T.location,delta:0})}function v(S){let w=n.location.origin!=="null"?n.location.origin:n.location.href,b=typeof S=="string"?S:cl(S);return b=b.replace(/ $/,"%20"),rt(w,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,w)}let T={get action(){return u},get location(){return s(n,o)},listen(S){if(c)throw new Error("A history only accepts one active listener");return n.addEventListener(Op,g),c=S,()=>{n.removeEventListener(Op,g),c=null}},createHref(S){return e(n,S)},createURL:v,encodeLocation(S){let w=v(S);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:m,replace:y,go(S){return o.go(S)}};return T}var Mp;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(Mp||(Mp={}));function tx(s,e,t){return t===void 0&&(t="/"),rx(s,e,t)}function rx(s,e,t,r){let n=typeof e=="string"?li(e):e,i=si(n.pathname||"/",t);if(i==null)return null;let o=Y0(s);nx(o);let u=null;for(let c=0;u==null&&c<o.length;++c){let d=gx(i);u=hx(o[c],d)}return u}function Y0(s,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let n=(i,o,u)=>{let c={relativePath:u===void 0?i.path||"":u,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(rt(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=Cn([r,c.relativePath]),f=t.concat(c);i.children&&i.children.length>0&&(rt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Y0(i.children,e,f,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:cx(d,i.index),routesMeta:f})};return s.forEach((i,o)=>{var u;if(i.path===""||!((u=i.path)!=null&&u.includes("?")))n(i,o);else for(let c of Q0(i.path))n(i,o,c)}),e}function Q0(s){let e=s.split("/");if(e.length===0)return[];let[t,...r]=e,n=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return n?[i,""]:[i];let o=Q0(r.join("/")),u=[];return u.push(...o.map(c=>c===""?i:[i,c].join("/"))),n&&u.push(...o),u.map(c=>s.startsWith("/")&&c===""?"/":c)}function nx(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:dx(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const sx=/^:[\w-]+$/,ix=3,ax=2,ox=1,lx=10,ux=-2,Fp=s=>s==="*";function cx(s,e){let t=s.split("/"),r=t.length;return t.some(Fp)&&(r+=ux),e&&(r+=ax),t.filter(n=>!Fp(n)).reduce((n,i)=>n+(sx.test(i)?ix:i===""?ox:lx),r)}function dx(s,e){return s.length===e.length&&s.slice(0,-1).every((r,n)=>r===e[n])?s[s.length-1]-e[e.length-1]:0}function hx(s,e,t){let{routesMeta:r}=s,n={},i="/",o=[];for(let u=0;u<r.length;++u){let c=r[u],d=u===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",g=yd({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),m=c.route;if(!g)return null;Object.assign(n,g.params),o.push({params:n,pathname:Cn([i,g.pathname]),pathnameBase:vx(Cn([i,g.pathnameBase])),route:m}),g.pathnameBase!=="/"&&(i=Cn([i,g.pathnameBase]))}return o}function yd(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,r]=fx(s.path,s.caseSensitive,s.end),n=e.match(t);if(!n)return null;let i=n[0],o=i.replace(/(.)\/+$/,"$1"),u=n.slice(1);return{params:r.reduce((d,f,g)=>{let{paramName:m,isOptional:y}=f;if(m==="*"){let T=u[g]||"";o=i.slice(0,i.length-T.length).replace(/(.)\/+$/,"$1")}const v=u[g];return y&&!v?d[m]=void 0:d[m]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:s}}function fx(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),q0(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let r=[],n="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,c)=>(r.push({paramName:u,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(r.push({paramName:"*"}),n+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":s!==""&&s!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),r]}function gx(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return q0(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),s}}function si(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=s.charAt(t);return r&&r!=="/"?null:s.slice(t)||"/"}function px(s,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:n=""}=typeof s=="string"?li(s):s;return{pathname:t?t.startsWith("/")?t:mx(t,e):e,search:Ex(r),hash:Sx(n)}}function mx(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function Pc(s,e,t,r){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function yx(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function X0(s,e){let t=yx(s);return e?t.map((r,n)=>n===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function J0(s,e,t,r){r===void 0&&(r=!1);let n;typeof s=="string"?n=li(s):(n=oa({},s),rt(!n.pathname||!n.pathname.includes("?"),Pc("?","pathname","search",n)),rt(!n.pathname||!n.pathname.includes("#"),Pc("#","pathname","hash",n)),rt(!n.search||!n.search.includes("#"),Pc("#","search","hash",n)));let i=s===""||n.pathname==="",o=i?"/":n.pathname,u;if(o==null)u=t;else{let g=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),g-=1;n.pathname=m.join("/")}u=g>=0?e[g]:"/"}let c=px(n,u),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}const Cn=s=>s.join("/").replace(/\/\/+/g,"/"),vx=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Ex=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Sx=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function Tx(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const Z0=["post","put","patch","delete"];new Set(Z0);const xx=["get",...Z0];new Set(xx);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function la(){return la=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},la.apply(this,arguments)}const Rl=W.createContext(null),ey=W.createContext(null),On=W.createContext(null),Ll=W.createContext(null),ds=W.createContext({outlet:null,matches:[],isDataRoute:!1}),ty=W.createContext(null);function _x(s,e){let{relative:t}=e===void 0?{}:e;Ea()||rt(!1);let{basename:r,navigator:n}=W.useContext(On),{hash:i,pathname:o,search:u}=Cl(s,{relative:t}),c=o;return r!=="/"&&(c=o==="/"?r:Cn([r,o])),n.createHref({pathname:c,search:u,hash:i})}function Ea(){return W.useContext(Ll)!=null}function $r(){return Ea()||rt(!1),W.useContext(Ll).location}function ry(s){W.useContext(On).static||W.useLayoutEffect(s)}function kl(){let{isDataRoute:s}=W.useContext(ds);return s?Mx():wx()}function wx(){Ea()||rt(!1);let s=W.useContext(Rl),{basename:e,future:t,navigator:r}=W.useContext(On),{matches:n}=W.useContext(ds),{pathname:i}=$r(),o=JSON.stringify(X0(n,t.v7_relativeSplatPath)),u=W.useRef(!1);return ry(()=>{u.current=!0}),W.useCallback(function(d,f){if(f===void 0&&(f={}),!u.current)return;if(typeof d=="number"){r.go(d);return}let g=J0(d,JSON.parse(o),i,f.relative==="path");s==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:Cn([e,g.pathname])),(f.replace?r.replace:r.push)(g,f.state,f)},[e,r,o,i,s])}function Cl(s,e){let{relative:t}=e===void 0?{}:e,{future:r}=W.useContext(On),{matches:n}=W.useContext(ds),{pathname:i}=$r(),o=JSON.stringify(X0(n,r.v7_relativeSplatPath));return W.useMemo(()=>J0(s,JSON.parse(o),i,t==="path"),[s,o,i,t])}function Ax(s,e){return bx(s,e)}function bx(s,e,t,r){Ea()||rt(!1);let{navigator:n}=W.useContext(On),{matches:i}=W.useContext(ds),o=i[i.length-1],u=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=$r(),f;if(e){var g;let S=typeof e=="string"?li(e):e;c==="/"||(g=S.pathname)!=null&&g.startsWith(c)||rt(!1),f=S}else f=d;let m=f.pathname||"/",y=m;if(c!=="/"){let S=c.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(S.length).join("/")}let v=tx(s,{pathname:y}),T=Cx(v&&v.map(S=>Object.assign({},S,{params:Object.assign({},u,S.params),pathname:Cn([c,n.encodeLocation?n.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?c:Cn([c,n.encodeLocation?n.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),i,t,r);return e&&T?W.createElement(Ll.Provider,{value:{location:la({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:kn.Pop}},T):T}function Ix(){let s=Nx(),e=Tx(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},e),t?W.createElement("pre",{style:n},t):null,null)}const Rx=W.createElement(Ix,null);class Lx extends W.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?W.createElement(ds.Provider,{value:this.props.routeContext},W.createElement(ty.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function kx(s){let{routeContext:e,match:t,children:r}=s,n=W.useContext(Rl);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),W.createElement(ds.Provider,{value:e},r)}function Cx(s,e,t,r){var n;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),s==null){var i;if(!t)return null;if(t.errors)s=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let o=s,u=(n=t)==null?void 0:n.errors;if(u!=null){let f=o.findIndex(g=>g.route.id&&(u==null?void 0:u[g.route.id])!==void 0);f>=0||rt(!1),o=o.slice(0,Math.min(o.length,f+1))}let c=!1,d=-1;if(t&&r&&r.v7_partialHydration)for(let f=0;f<o.length;f++){let g=o[f];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=f),g.route.id){let{loaderData:m,errors:y}=t,v=g.route.loader&&m[g.route.id]===void 0&&(!y||y[g.route.id]===void 0);if(g.route.lazy||v){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((f,g,m)=>{let y,v=!1,T=null,S=null;t&&(y=u&&g.route.id?u[g.route.id]:void 0,T=g.route.errorElement||Rx,c&&(d<0&&m===0?(Fx("route-fallback"),v=!0,S=null):d===m&&(v=!0,S=g.route.hydrateFallbackElement||null)));let w=e.concat(o.slice(0,m+1)),b=()=>{let A;return y?A=T:v?A=S:g.route.Component?A=W.createElement(g.route.Component,null):g.route.element?A=g.route.element:A=f,W.createElement(kx,{match:g,routeContext:{outlet:f,matches:w,isDataRoute:t!=null},children:A})};return t&&(g.route.ErrorBoundary||g.route.errorElement||m===0)?W.createElement(Lx,{location:t.location,revalidation:t.revalidation,component:T,error:y,children:b(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):b()},null)}var ny=(function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s})(ny||{}),sy=(function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s})(sy||{});function Px(s){let e=W.useContext(Rl);return e||rt(!1),e}function Dx(s){let e=W.useContext(ey);return e||rt(!1),e}function Ox(s){let e=W.useContext(ds);return e||rt(!1),e}function iy(s){let e=Ox(),t=e.matches[e.matches.length-1];return t.route.id||rt(!1),t.route.id}function Nx(){var s;let e=W.useContext(ty),t=Dx(),r=iy();return e!==void 0?e:(s=t.errors)==null?void 0:s[r]}function Mx(){let{router:s}=Px(ny.UseNavigateStable),e=iy(sy.UseNavigateStable),t=W.useRef(!1);return ry(()=>{t.current=!0}),W.useCallback(function(n,i){i===void 0&&(i={}),t.current&&(typeof n=="number"?s.navigate(n):s.navigate(n,la({fromRouteId:e},i)))},[s,e])}const Up={};function Fx(s,e,t){Up[s]||(Up[s]=!0)}function Ux(s,e){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function Xr(s){rt(!1)}function Bx(s){let{basename:e="/",children:t=null,location:r,navigationType:n=kn.Pop,navigator:i,static:o=!1,future:u}=s;Ea()&&rt(!1);let c=e.replace(/^\/*/,"/"),d=W.useMemo(()=>({basename:c,navigator:i,static:o,future:la({v7_relativeSplatPath:!1},u)}),[c,u,i,o]);typeof r=="string"&&(r=li(r));let{pathname:f="/",search:g="",hash:m="",state:y=null,key:v="default"}=r,T=W.useMemo(()=>{let S=si(f,c);return S==null?null:{location:{pathname:S,search:g,hash:m,state:y,key:v},navigationType:n}},[c,f,g,m,y,v,n]);return T==null?null:W.createElement(On.Provider,{value:d},W.createElement(Ll.Provider,{children:t,value:T}))}function $x(s){let{children:e,location:t}=s;return Ax(vd(e),t)}new Promise(()=>{});function vd(s,e){e===void 0&&(e=[]);let t=[];return W.Children.forEach(s,(r,n)=>{if(!W.isValidElement(r))return;let i=[...e,n];if(r.type===W.Fragment){t.push.apply(t,vd(r.props.children,i));return}r.type!==Xr&&rt(!1),!r.props.index||!r.props.children||rt(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=vd(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function dl(){return dl=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},dl.apply(this,arguments)}function ay(s,e){if(s==null)return{};var t={},r=Object.keys(s),n,i;for(i=0;i<r.length;i++)n=r[i],!(e.indexOf(n)>=0)&&(t[n]=s[n]);return t}function jx(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function Gx(s,e){return s.button===0&&(!e||e==="_self")&&!jx(s)}const Vx=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Kx=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Hx="6";try{window.__reactRouterVersion=Hx}catch{}const Wx=W.createContext({isTransitioning:!1}),zx="startTransition",Bp=HT[zx];function qx(s){let{basename:e,children:t,future:r,window:n}=s,i=W.useRef();i.current==null&&(i.current=JT({window:n,v5Compat:!0}));let o=i.current,[u,c]=W.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},f=W.useCallback(g=>{d&&Bp?Bp(()=>c(g)):c(g)},[c,d]);return W.useLayoutEffect(()=>o.listen(f),[o,f]),W.useEffect(()=>Ux(r),[r]),W.createElement(Bx,{basename:e,children:t,location:u.location,navigationType:u.action,navigator:o,future:r})}const Yx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Qx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oy=W.forwardRef(function(e,t){let{onClick:r,relative:n,reloadDocument:i,replace:o,state:u,target:c,to:d,preventScrollReset:f,viewTransition:g}=e,m=ay(e,Vx),{basename:y}=W.useContext(On),v,T=!1;if(typeof d=="string"&&Qx.test(d)&&(v=d,Yx))try{let A=new URL(window.location.href),L=d.startsWith("//")?new URL(A.protocol+d):new URL(d),k=si(L.pathname,y);L.origin===A.origin&&k!=null?d=k+L.search+L.hash:T=!0}catch{}let S=_x(d,{relative:n}),w=Jx(d,{replace:o,state:u,target:c,preventScrollReset:f,relative:n,viewTransition:g});function b(A){r&&r(A),A.defaultPrevented||w(A)}return W.createElement("a",dl({},m,{href:v||S,onClick:T||i?r:b,ref:t,target:c}))}),Zi=W.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:n=!1,className:i="",end:o=!1,style:u,to:c,viewTransition:d,children:f}=e,g=ay(e,Kx),m=Cl(c,{relative:g.relative}),y=$r(),v=W.useContext(ey),{navigator:T,basename:S}=W.useContext(On),w=v!=null&&Zx(m)&&d===!0,b=T.encodeLocation?T.encodeLocation(m).pathname:m.pathname,A=y.pathname,L=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;n||(A=A.toLowerCase(),L=L?L.toLowerCase():null,b=b.toLowerCase()),L&&S&&(L=si(L,S)||L);const k=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let O=A===b||!o&&A.startsWith(b)&&A.charAt(k)==="/",P=L!=null&&(L===b||!o&&L.startsWith(b)&&L.charAt(b.length)==="/"),$={isActive:O,isPending:P,isTransitioning:w},B=O?r:void 0,U;typeof i=="function"?U=i($):U=[i,O?"active":null,P?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let q=typeof u=="function"?u($):u;return W.createElement(oy,dl({},g,{"aria-current":B,className:U,ref:t,style:q,to:c,viewTransition:d}),typeof f=="function"?f($):f)});var Ed;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(Ed||(Ed={}));var $p;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})($p||($p={}));function Xx(s){let e=W.useContext(Rl);return e||rt(!1),e}function Jx(s,e){let{target:t,replace:r,state:n,preventScrollReset:i,relative:o,viewTransition:u}=e===void 0?{}:e,c=kl(),d=$r(),f=Cl(s,{relative:o});return W.useCallback(g=>{if(Gx(g,t)){g.preventDefault();let m=r!==void 0?r:cl(d)===cl(f);c(s,{replace:m,state:n,preventScrollReset:i,relative:o,viewTransition:u})}},[d,c,f,r,n,t,s,i,o,u])}function Zx(s,e){e===void 0&&(e={});let t=W.useContext(Wx);t==null&&rt(!1);let{basename:r}=Xx(Ed.useViewTransitionState),n=Cl(s,{relative:e.relative});if(!t.isTransitioning)return!1;let i=si(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=si(t.nextLocation.pathname,r)||t.nextLocation.pathname;return yd(n.pathname,o)!=null||yd(n.pathname,i)!=null}var Sd=function(s,e){return Sd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},Sd(s,e)};function ly(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sd(s,e);function t(){this.constructor=s}s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var hl=function(){return hl=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},hl.apply(this,arguments)};function ui(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t}function uy(s,e,t,r){var n=arguments.length,i=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(s,e,t,r);else for(var u=s.length-1;u>=0;u--)(o=s[u])&&(i=(n<3?o(i):n>3?o(e,t,i):o(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i}function cy(s,e){return function(t,r){e(t,r,s)}}function dy(s,e,t,r,n,i){function o(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var u=r.kind,c=u==="getter"?"get":u==="setter"?"set":"value",d=!e&&s?r.static?s:s.prototype:null,f=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),g,m=!1,y=t.length-1;y>=0;y--){var v={};for(var T in r)v[T]=T==="access"?{}:r[T];for(var T in r.access)v.access[T]=r.access[T];v.addInitializer=function(w){if(m)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(w||null))};var S=(0,t[y])(u==="accessor"?{get:f.get,set:f.set}:f[c],v);if(u==="accessor"){if(S===void 0)continue;if(S===null||typeof S!="object")throw new TypeError("Object expected");(g=o(S.get))&&(f.get=g),(g=o(S.set))&&(f.set=g),(g=o(S.init))&&n.unshift(g)}else(g=o(S))&&(u==="field"?n.unshift(g):f[c]=g)}d&&Object.defineProperty(d,r.name,f),m=!0}function hy(s,e,t){for(var r=arguments.length>2,n=0;n<e.length;n++)t=r?e[n].call(s,t):e[n].call(s);return r?t:void 0}function fy(s){return typeof s=="symbol"?s:"".concat(s)}function gy(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function py(s,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,e)}function Se(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function u(f){try{d(r.next(f))}catch(g){o(g)}}function c(f){try{d(r.throw(f))}catch(g){o(g)}}function d(f){f.done?i(f.value):n(f.value).then(u,c)}d((r=r.apply(s,e||[])).next())})}function my(s,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,n,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(d){return function(f){return c([d,f])}}function c(d){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(t=0)),t;)try{if(r=1,n&&(i=d[0]&2?n.return:d[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,d[1])).done)return i;switch(n=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,n=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){t.label=d[1];break}if(d[0]===6&&t.label<i[1]){t.label=i[1],i=d;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(d);break}i[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(s,t)}catch(f){d=[6,f],n=0}finally{r=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}var Pl=Object.create?(function(s,e,t,r){r===void 0&&(r=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(s,r,n)}):(function(s,e,t,r){r===void 0&&(r=t),s[r]=e[t]});function yy(s,e){for(var t in s)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Pl(e,s,t)}function fl(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],r=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&r>=s.length&&(s=void 0),{value:s&&s[r++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ah(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var r=t.call(s),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function vy(){for(var s=[],e=0;e<arguments.length;e++)s=s.concat(ah(arguments[e]));return s}function Ey(){for(var s=0,e=0,t=arguments.length;e<t;e++)s+=arguments[e].length;for(var r=Array(s),n=0,e=0;e<t;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,n++)r[n]=i[o];return r}function Sy(s,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,i;r<n;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return s.concat(i||Array.prototype.slice.call(e))}function ii(s){return this instanceof ii?(this.v=s,this):new ii(s)}function Ty(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(s,e||[]),n,i=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(y){return function(v){return Promise.resolve(v).then(y,g)}}function u(y,v){r[y]&&(n[y]=function(T){return new Promise(function(S,w){i.push([y,T,S,w])>1||c(y,T)})},v&&(n[y]=v(n[y])))}function c(y,v){try{d(r[y](v))}catch(T){m(i[0][3],T)}}function d(y){y.value instanceof ii?Promise.resolve(y.value.v).then(f,g):m(i[0][2],y)}function f(y){c("next",y)}function g(y){c("throw",y)}function m(y,v){y(v),i.shift(),i.length&&c(i[0][0],i[0][1])}}function xy(s){var e,t;return e={},r("next"),r("throw",function(n){throw n}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(n,i){e[n]=s[n]?function(o){return(t=!t)?{value:ii(s[n](o)),done:!1}:i?i(o):o}:i}}function _y(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof fl=="function"?fl(s):s[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=s[i]&&function(o){return new Promise(function(u,c){o=s[i](o),n(u,c,o.done,o.value)})}}function n(i,o,u,c){Promise.resolve(c).then(function(d){i({value:d,done:u})},o)}}function wy(s,e){return Object.defineProperty?Object.defineProperty(s,"raw",{value:e}):s.raw=e,s}var e_=Object.create?(function(s,e){Object.defineProperty(s,"default",{enumerable:!0,value:e})}):function(s,e){s.default=e},Td=function(s){return Td=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},Td(s)};function Ay(s){if(s&&s.__esModule)return s;var e={};if(s!=null)for(var t=Td(s),r=0;r<t.length;r++)t[r]!=="default"&&Pl(e,s,t[r]);return e_(e,s),e}function by(s){return s&&s.__esModule?s:{default:s}}function Iy(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)}function Ry(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t}function Ly(s,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof s=="function"?e===s:s.has(e)}function ky(s,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(n=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(i){return Promise.reject(i)}}),s.stack.push({value:e,dispose:r,async:t})}else t&&s.stack.push({async:!0});return e}var t_=typeof SuppressedError=="function"?SuppressedError:function(s,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=s,r.suppressed=e,r};function Cy(s){function e(i){s.error=s.hasError?new t_(i,s.error,"An error was suppressed during disposal."):i,s.hasError=!0}var t,r=0;function n(){for(;t=s.stack.pop();)try{if(!t.async&&r===1)return r=0,s.stack.push(t),Promise.resolve().then(n);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(i).then(n,function(o){return e(o),n()})}else r|=1}catch(o){e(o)}if(r===1)return s.hasError?Promise.reject(s.error):Promise.resolve();if(s.hasError)throw s.error}return n()}function Py(s,e){return typeof s=="string"&&/^\.\.?\//.test(s)?s.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,n,i,o){return r?e?".jsx":".js":n&&(!i||!o)?t:n+i+"."+o.toLowerCase()+"js"}):s}const r_={__extends:ly,__assign:hl,__rest:ui,__decorate:uy,__param:cy,__esDecorate:dy,__runInitializers:hy,__propKey:fy,__setFunctionName:gy,__metadata:py,__awaiter:Se,__generator:my,__createBinding:Pl,__exportStar:yy,__values:fl,__read:ah,__spread:vy,__spreadArrays:Ey,__spreadArray:Sy,__await:ii,__asyncGenerator:Ty,__asyncDelegator:xy,__asyncValues:_y,__makeTemplateObject:wy,__importStar:Ay,__importDefault:by,__classPrivateFieldGet:Iy,__classPrivateFieldSet:Ry,__classPrivateFieldIn:Ly,__addDisposableResource:ky,__disposeResources:Cy,__rewriteRelativeImportExtension:Py},n_=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:ky,get __assign(){return hl},__asyncDelegator:xy,__asyncGenerator:Ty,__asyncValues:_y,__await:ii,__awaiter:Se,__classPrivateFieldGet:Iy,__classPrivateFieldIn:Ly,__classPrivateFieldSet:Ry,__createBinding:Pl,__decorate:uy,__disposeResources:Cy,__esDecorate:dy,__exportStar:yy,__extends:ly,__generator:my,__importDefault:by,__importStar:Ay,__makeTemplateObject:wy,__metadata:py,__param:cy,__propKey:fy,__read:ah,__rest:ui,__rewriteRelativeImportExtension:Py,__runInitializers:hy,__setFunctionName:gy,__spread:vy,__spreadArray:Sy,__spreadArrays:Ey,__values:fl,default:r_},Symbol.toStringTag,{value:"Module"})),s_=s=>s?(...e)=>s(...e):(...e)=>fetch(...e);class oh extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class i_ extends oh{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class jp extends oh{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Gp extends oh{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var xd;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(xd||(xd={}));class a_{constructor(e,{headers:t={},customFetch:r,region:n=xd.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=s_(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Se(this,arguments,void 0,function*(t,r={}){var n;let i,o;try{const{headers:u,method:c,body:d,signal:f,timeout:g}=r;let m={},{region:y}=r;y||(y=this.region);const v=new URL(`${this.url}/${t}`);y&&y!=="any"&&(m["x-region"]=y,v.searchParams.set("forceFunctionRegion",y));let T;d&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(m["Content-Type"]="application/octet-stream",T=d):typeof d=="string"?(m["Content-Type"]="text/plain",T=d):typeof FormData<"u"&&d instanceof FormData?T=d:(m["Content-Type"]="application/json",T=JSON.stringify(d)):T=d;let S=f;g&&(o=new AbortController,i=setTimeout(()=>o.abort(),g),f?(S=o.signal,f.addEventListener("abort",()=>o.abort())):S=o.signal);const w=yield this.fetch(v.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},m),this.headers),u),body:T,signal:S}).catch(k=>{throw new i_(k)}),b=w.headers.get("x-relay-error");if(b&&b==="true")throw new jp(w);if(!w.ok)throw new Gp(w);let A=((n=w.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),L;return A==="application/json"?L=yield w.json():A==="application/octet-stream"||A==="application/pdf"?L=yield w.blob():A==="text/event-stream"?L=w:A==="multipart/form-data"?L=yield w.formData():L=yield w.text(),{data:L,error:null,response:w}}catch(u){return{data:null,error:u,response:u instanceof Gp||u instanceof jp?u.context:void 0}}finally{i&&clearTimeout(i)}})}}var Rt={};const ci=jT(n_);var Co={},Po={},Do={},Oo={},No={},Mo={},Vp;function Dy(){if(Vp)return Mo;Vp=1,Object.defineProperty(Mo,"__esModule",{value:!0});class s extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Mo.default=s,Mo}var Kp;function Oy(){if(Kp)return No;Kp=1,Object.defineProperty(No,"__esModule",{value:!0});const e=ci.__importDefault(Dy());class t{constructor(n){var i,o;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(i=n.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=n.signal,this.isMaybeSingle=(o=n.isMaybeSingle)!==null&&o!==void 0?o:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,i){return this.headers=new Headers(this.headers),this.headers.set(n,i),this}then(n,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let u=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var d,f,g,m;let y=null,v=null,T=null,S=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?v=k:v=JSON.parse(k))}const A=(f=this.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),L=(g=c.headers.get("content-range"))===null||g===void 0?void 0:g.split("/");A&&L&&L.length>1&&(T=parseInt(L[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(y={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,T=null,S=406,w="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const A=await c.text();try{y=JSON.parse(A),Array.isArray(y)&&c.status===404&&(v=[],y=null,S=200,w="OK")}catch{c.status===404&&A===""?(S=204,w="No Content"):y={message:A}}if(y&&this.isMaybeSingle&&(!((m=y==null?void 0:y.details)===null||m===void 0)&&m.includes("0 rows"))&&(y=null,S=200,w="OK"),y&&this.shouldThrowOnError)throw new e.default(y)}return{error:y,data:v,count:T,status:S,statusText:w}});return this.shouldThrowOnError||(u=u.catch(c=>{var d,f,g;return{error:{message:`${(d=c==null?void 0:c.name)!==null&&d!==void 0?d:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(f=c==null?void 0:c.stack)!==null&&f!==void 0?f:""}`,hint:"",code:`${(g=c==null?void 0:c.code)!==null&&g!==void 0?g:""}`},data:null,count:null,status:0,statusText:""}})),u.then(n,i)}returns(){return this}overrideTypes(){return this}}return No.default=t,No}var Hp;function Ny(){if(Hp)return Oo;Hp=1,Object.defineProperty(Oo,"__esModule",{value:!0});const e=ci.__importDefault(Oy());class t extends e.default{select(n){let i=!1;const o=(n??"*").split("").map(u=>/\s/.test(u)&&!i?"":(u==='"'&&(i=!i),u)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:i=!0,nullsFirst:o,foreignTable:u,referencedTable:c=u}={}){const d=c?`${c}.order`:"order",f=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${f?`${f},`:""}${n}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:o=i}={}){const u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(u,`${n}`),this}range(n,i,{foreignTable:o,referencedTable:u=o}={}){const c=typeof u>"u"?"offset":`${u}.offset`,d=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(d,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:i=!1,settings:o=!1,buffers:u=!1,wal:c=!1,format:d="text"}={}){var f;const g=[n?"analyze":null,i?"verbose":null,o?"settings":null,u?"buffers":null,c?"wal":null].filter(Boolean).join("|"),m=(f=this.headers.get("Accept"))!==null&&f!==void 0?f:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${d}; for="${m}"; options=${g};`),d==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return Oo.default=t,Oo}var Wp;function lh(){if(Wp)return Do;Wp=1,Object.defineProperty(Do,"__esModule",{value:!0});const e=ci.__importDefault(Ny()),t=new RegExp("[,()]");class r extends e.default{eq(i,o){return this.url.searchParams.append(i,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(i,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(i,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(i,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(i,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(i,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(i,`like.${o}`),this}likeAllOf(i,o){return this.url.searchParams.append(i,`like(all).{${o.join(",")}}`),this}likeAnyOf(i,o){return this.url.searchParams.append(i,`like(any).{${o.join(",")}}`),this}ilike(i,o){return this.url.searchParams.append(i,`ilike.${o}`),this}ilikeAllOf(i,o){return this.url.searchParams.append(i,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(i,o){return this.url.searchParams.append(i,`ilike(any).{${o.join(",")}}`),this}is(i,o){return this.url.searchParams.append(i,`is.${o}`),this}in(i,o){const u=Array.from(new Set(o)).map(c=>typeof c=="string"&&t.test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(i,`in.(${u})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cs.{${o.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cd.{${o.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(o)}`),this}rangeGt(i,o){return this.url.searchParams.append(i,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(i,`nxl.${o}`),this}rangeLt(i,o){return this.url.searchParams.append(i,`sl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(i,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(i,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(i,`ov.${o}`):this.url.searchParams.append(i,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:u,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const f=u===void 0?"":`(${u})`;return this.url.searchParams.append(i,`${d}fts${f}.${o}`),this}match(i){return Object.entries(i).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(i,o,u){return this.url.searchParams.append(i,`not.${o}.${u}`),this}or(i,{foreignTable:o,referencedTable:u=o}={}){const c=u?`${u}.or`:"or";return this.url.searchParams.append(c,`(${i})`),this}filter(i,o,u){return this.url.searchParams.append(i,`${o}.${u}`),this}}return Do.default=r,Do}var zp;function My(){if(zp)return Po;zp=1,Object.defineProperty(Po,"__esModule",{value:!0});const e=ci.__importDefault(lh());class t{constructor(n,{headers:i={},schema:o,fetch:u}){this.url=n,this.headers=new Headers(i),this.schema=o,this.fetch=u}select(n,i){const{head:o=!1,count:u}=i??{},c=o?"HEAD":"GET";let d=!1;const f=(n??"*").split("").map(g=>/\s/.test(g)&&!d?"":(g==='"'&&(d=!d),g)).join("");return this.url.searchParams.set("select",f),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:i,defaultToNull:o=!0}={}){var u;const c="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const d=n.reduce((f,g)=>f.concat(Object.keys(g)),[]);if(d.length>0){const f=[...new Set(d)].map(g=>`"${g}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}upsert(n,{onConflict:i,ignoreDuplicates:o=!1,count:u,defaultToNull:c=!0}={}){var d;const f="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),u&&this.headers.append("Prefer",`count=${u}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const g=n.reduce((m,y)=>m.concat(Object.keys(y)),[]);if(g.length>0){const m=[...new Set(g)].map(y=>`"${y}"`);this.url.searchParams.set("columns",m.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}update(n,{count:i}={}){var o;const u="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:n}={}){var i;const o="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return Po.default=t,Po}var qp;function o_(){if(qp)return Co;qp=1,Object.defineProperty(Co,"__esModule",{value:!0});const s=ci,e=s.__importDefault(My()),t=s.__importDefault(lh());class r{constructor(i,{headers:o={},schema:u,fetch:c}={}){this.url=i,this.headers=new Headers(o),this.schemaName=u,this.fetch=c}from(i){const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:u=!1,get:c=!1,count:d}={}){var f;let g;const m=new URL(`${this.url}/rpc/${i}`);let y;u||c?(g=u?"HEAD":"GET",Object.entries(o).filter(([T,S])=>S!==void 0).map(([T,S])=>[T,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([T,S])=>{m.searchParams.append(T,S)})):(g="POST",y=o);const v=new Headers(this.headers);return d&&v.set("Prefer",`count=${d}`),new t.default({method:g,url:m,headers:v,schema:this.schemaName,body:y,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}}return Co.default=r,Co}var Yp;function l_(){if(Yp)return Rt;Yp=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.PostgrestError=Rt.PostgrestBuilder=Rt.PostgrestTransformBuilder=Rt.PostgrestFilterBuilder=Rt.PostgrestQueryBuilder=Rt.PostgrestClient=void 0;const s=ci,e=s.__importDefault(o_());Rt.PostgrestClient=e.default;const t=s.__importDefault(My());Rt.PostgrestQueryBuilder=t.default;const r=s.__importDefault(lh());Rt.PostgrestFilterBuilder=r.default;const n=s.__importDefault(Ny());Rt.PostgrestTransformBuilder=n.default;const i=s.__importDefault(Oy());Rt.PostgrestBuilder=i.default;const o=s.__importDefault(Dy());return Rt.PostgrestError=o.default,Rt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},Rt}var Fy=l_();const Uy=sh(Fy),u_=H0({__proto__:null,default:Uy},[Fy]),{PostgrestClient:c_,PostgrestQueryBuilder:Mk,PostgrestFilterBuilder:Fk,PostgrestTransformBuilder:Uk,PostgrestBuilder:Bk,PostgrestError:$k}=Uy||u_;class d_{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const r=t.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const h_="2.81.1",f_=`realtime-js/${h_}`,By="1.0.0",g_="2.0.0",Qp=By,_d=1e4,p_=1e3,m_=100;var ns;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(ns||(ns={}));var dt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(dt||(dt={}));var lr;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(lr||(lr={}));var wd;(function(s){s.websocket="websocket"})(wd||(wd={}));var ss;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(ss||(ss={}));class y_{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:t,ref:r,event:n,topic:i,payload:o}=e,u=this.META_LENGTH+t.length+r.length+i.length+n.length,c=new ArrayBuffer(this.HEADER_LENGTH+u);let d=new DataView(c),f=0;d.setUint8(f++,this.KINDS.push),d.setUint8(f++,t.length),d.setUint8(f++,r.length),d.setUint8(f++,i.length),d.setUint8(f++,n.length),Array.from(t,m=>d.setUint8(f++,m.charCodeAt(0))),Array.from(r,m=>d.setUint8(f++,m.charCodeAt(0))),Array.from(i,m=>d.setUint8(f++,m.charCodeAt(0))),Array.from(n,m=>d.setUint8(f++,m.charCodeAt(0)));var g=new Uint8Array(c.byteLength+o.byteLength);return g.set(new Uint8Array(c),0),g.set(new Uint8Array(o),c.byteLength),g.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const{join_ref:n,ref:i,topic:o}=e,u=e.payload.event,c=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),d=this.USER_BROADCAST_PUSH_META_LENGTH+n.length+i.length+o.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let g=new DataView(f),m=0;g.setUint8(m++,this.KINDS.userBroadcastPush),g.setUint8(m++,n.length),g.setUint8(m++,i.length),g.setUint8(m++,o.length),g.setUint8(m++,u.length),g.setUint8(m++,this.BINARY_ENCODING),Array.from(n,v=>g.setUint8(m++,v.charCodeAt(0))),Array.from(i,v=>g.setUint8(m++,v.charCodeAt(0))),Array.from(o,v=>g.setUint8(m++,v.charCodeAt(0))),Array.from(u,v=>g.setUint8(m++,v.charCodeAt(0)));var y=new Uint8Array(f.byteLength+c.byteLength);return y.set(new Uint8Array(f),0),y.set(new Uint8Array(c),f.byteLength),y.buffer}_encodeJsonUserBroadcastPush(e){var t,r;const{join_ref:n,ref:i,topic:o}=e,u=e.payload.event,c=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:{},f=new TextEncoder().encode(JSON.stringify(c)).buffer,g=this.USER_BROADCAST_PUSH_META_LENGTH+n.length+i.length+o.length+u.length,m=new ArrayBuffer(this.HEADER_LENGTH+g);let y=new DataView(m),v=0;y.setUint8(v++,this.KINDS.userBroadcastPush),y.setUint8(v++,n.length),y.setUint8(v++,i.length),y.setUint8(v++,o.length),y.setUint8(v++,u.length),y.setUint8(v++,this.JSON_ENCODING),Array.from(n,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(i,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(o,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(u,S=>y.setUint8(v++,S.charCodeAt(0)));var T=new Uint8Array(m.byteLength+f.byteLength);return T.set(new Uint8Array(m),0),T.set(new Uint8Array(f),m.byteLength),T.buffer}decode(e,t){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return t(r)}if(typeof e=="string"){const r=JSON.parse(e),[n,i,o,u,c]=r;return t({join_ref:n,ref:i,topic:o,event:u,payload:c})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),n=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,t,n);case this.KINDS.reply:return this._decodeReply(e,t,n);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,n);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,n)}}_decodePush(e,t,r){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3);let u=this.HEADER_LENGTH+this.META_LENGTH-1;const c=r.decode(e.slice(u,u+n));u=u+n;const d=r.decode(e.slice(u,u+i));u=u+i;const f=r.decode(e.slice(u,u+o));u=u+o;const g=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{join_ref:c,ref:null,topic:d,event:f,payload:g}}_decodeReply(e,t,r){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),u=t.getUint8(4);let c=this.HEADER_LENGTH+this.META_LENGTH;const d=r.decode(e.slice(c,c+n));c=c+n;const f=r.decode(e.slice(c,c+i));c=c+i;const g=r.decode(e.slice(c,c+o));c=c+o;const m=r.decode(e.slice(c,c+u));c=c+u;const y=JSON.parse(r.decode(e.slice(c,e.byteLength))),v={status:m,response:y};return{join_ref:d,ref:f,topic:g,event:lr.reply,payload:v}}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const u=r.decode(e.slice(o,o+n));o=o+n;const c=r.decode(e.slice(o,o+i));o=o+i;const d=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:u,event:c,payload:d}}_decodeUserBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),u=t.getUint8(4);let c=this.HEADER_LENGTH+4;const d=r.decode(e.slice(c,c+n));c=c+n;const f=r.decode(e.slice(c,c+i));c=c+i;const g=r.decode(e.slice(c,c+o));c=c+o;const m=e.slice(c,e.byteLength),y=u===this.JSON_ENCODING?JSON.parse(r.decode(m)):m,v={type:this.BROADCAST,event:f,payload:y};return o>0&&(v.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST,payload:v}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class $y{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ke;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(Ke||(Ke={}));const Xp=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=v_(o,s,e,n),i),{}):{}},v_=(s,e,t,r)=>{const n=e.find(u=>u.name===s),i=n==null?void 0:n.type,o=t[s];return i&&!r.includes(i)?jy(i,o):Ad(o)},jy=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return x_(e,t)}switch(s){case Ke.bool:return E_(e);case Ke.float4:case Ke.float8:case Ke.int2:case Ke.int4:case Ke.int8:case Ke.numeric:case Ke.oid:return S_(e);case Ke.json:case Ke.jsonb:return T_(e);case Ke.timestamp:return __(e);case Ke.abstime:case Ke.date:case Ke.daterange:case Ke.int4range:case Ke.int8range:case Ke.money:case Ke.reltime:case Ke.text:case Ke.time:case Ke.timestamptz:case Ke.timetz:case Ke.tsrange:case Ke.tstzrange:return Ad(e);default:return Ad(e)}},Ad=s=>s,E_=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},S_=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},T_=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},x_=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(u=>jy(e,u))}return s},__=s=>typeof s=="string"?s.replace(" ","T"):s,Gy=s=>{const e=new URL(s);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Dc{constructor(e,t,r={},n=_d){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Jp;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Jp||(Jp={}));class ra{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ra.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=ra.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],u()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ra.syncDiff(this.state,n,i,o),u())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),o=this.transformState(t),u={},c={};return this.map(i,(d,f)=>{o[d]||(c[d]=f)}),this.map(o,(d,f)=>{const g=i[d];if(g){const m=f.map(S=>S.presence_ref),y=g.map(S=>S.presence_ref),v=f.filter(S=>y.indexOf(S.presence_ref)<0),T=g.filter(S=>m.indexOf(S.presence_ref)<0);v.length>0&&(u[d]=v),T.length>0&&(c[d]=T)}else u[d]=f}),this.syncDiff(i,{joins:u,leaves:c},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(u,c)=>{var d;const f=(d=e[u])!==null&&d!==void 0?d:[];if(e[u]=this.cloneDeep(c),f.length>0){const g=e[u].map(y=>y.presence_ref),m=f.filter(y=>g.indexOf(y.presence_ref)<0);e[u].unshift(...m)}r(u,f,c)}),this.map(o,(u,c)=>{let d=e[u];if(!d)return;const f=c.map(g=>g.presence_ref);d=d.filter(g=>f.indexOf(g.presence_ref)<0),e[u]=d,n(u,d,c),d.length===0&&delete e[u]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Zp;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Zp||(Zp={}));var na;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(na||(na={}));var Jr;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Jr||(Jr={}));class uh{constructor(e,t={config:{}},r){var n,i;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=dt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Dc(this,lr.join,this.params,this.timeout),this.rejoinTimer=new $y(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=dt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=dt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(lr.reply,{},(o,u)=>{this._trigger(this._replyEventName(u),o)}),this.presence=new ra(this),this.broadcastEndpointURL=Gy(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==dt.closed){const{config:{broadcast:o,presence:u,private:c}}=this.params,d=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(y=>y.filter))!==null&&n!==void 0?n:[],f=!!this.bindings[na.PRESENCE]&&this.bindings[na.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,g={},m={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:f}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(y=>e==null?void 0:e(Jr.CHANNEL_ERROR,y)),this._onClose(()=>e==null?void 0:e(Jr.CLOSED)),this.updateJoinPayload(Object.assign({config:m},g)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:y})=>{var v;if(this.socket.setAuth(),y===void 0){e==null||e(Jr.SUBSCRIBED);return}else{const T=this.bindings.postgres_changes,S=(v=T==null?void 0:T.length)!==null&&v!==void 0?v:0,w=[];for(let b=0;b<S;b++){const A=T[b],{filter:{event:L,schema:k,table:O,filter:P}}=A,$=y&&y[b];if($&&$.event===L&&$.schema===k&&$.table===O&&$.filter===P)w.push(Object.assign(Object.assign({},A),{id:$.id}));else{this.unsubscribe(),this.state=dt.errored,e==null||e(Jr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=w,e&&e(Jr.SUBSCRIBED);return}}).receive("error",y=>{this.state=dt.errored,e==null||e(Jr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(y).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Jr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===dt.joined&&e===na.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var n;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);if(u.status===202)return{success:!0};let c=u.statusText;try{const d=await u.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,u,c;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(u=(o=this.params)===null||o===void 0?void 0:o.config)===null||u===void 0?void 0:u.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=dt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(lr.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Dc(this,lr.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=dt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Dc(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>m_){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const o=e.toLocaleLowerCase(),{close:u,error:c,leave:d,join:f}=lr;if(r&&[u,c,d,f].indexOf(o)>=0&&r!==this._joinRef())return;let m=this._onMessage(o,t,r);if(t&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(y=>{var v,T,S;return((v=y.filter)===null||v===void 0?void 0:v.event)==="*"||((S=(T=y.filter)===null||T===void 0?void 0:T.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(y=>y.callback(m,r)):(i=this.bindings[o])===null||i===void 0||i.filter(y=>{var v,T,S,w,b,A;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in y){const L=y.id,k=(v=y.filter)===null||v===void 0?void 0:v.event;return L&&((T=t.ids)===null||T===void 0?void 0:T.includes(L))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((S=t.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const L=(b=(w=y==null?void 0:y.filter)===null||w===void 0?void 0:w.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return L==="*"||L===((A=t==null?void 0:t.event)===null||A===void 0?void 0:A.toLocaleLowerCase())}else return y.type.toLocaleLowerCase()===o}).map(y=>{if(typeof m=="object"&&"ids"in m){const v=m.data,{schema:T,table:S,commit_timestamp:w,type:b,errors:A}=v;m=Object.assign(Object.assign({},{schema:T,table:S,commit_timestamp:w,eventType:b,new:{},old:{},errors:A}),this._getPayloadRecords(v))}y.callback(m,r)})}_isClosed(){return this.state===dt.closed}_isJoined(){return this.state===dt.joined}_isJoining(){return this.state===dt.joining}_isLeaving(){return this.state===dt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&uh.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(lr.close,{},e)}_onError(e){this._on(lr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=dt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Xp(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Xp(e.columns,e.old_record)),t}}const Oc=()=>{},Fo={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},w_=[1e3,2e3,5e3,1e4],A_=1e4,b_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class I_{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_d,this.transport=null,this.heartbeatIntervalMs=Fo.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Oc,this.ref=0,this.reconnectTimer=null,this.vsn=Qp,this.logger=Oc,this.conn=null,this.sendBuffer=[],this.serializer=new y_,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${wd.websocket}`,this.httpEndpoint=Gy(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=d_.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ns.connecting:return ss.Connecting;case ns.open:return ss.Open;case ns.closing:return ss.Closing;default:return ss.Closed}}isConnected(){return this.connectionState()===ss.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new uh(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:n,ref:i}=e,o=()=>{this.encode(e,u=>{var c;(c=this.conn)===null||c===void 0||c.send(u)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(p_,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Fo.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:i,ref:o}=t,u=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${n} ${u}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===ns.open||this.conn.readyState===ns.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(lr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([b_],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:f_};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(lr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new $y(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Fo.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,i,o,u,c,d,f,g,m,y;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:_d,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:Fo.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(u=e==null?void 0:e.heartbeatCallback)!==null&&u!==void 0?u:Oc,this.vsn=(c=e==null?void 0:e.vsn)!==null&&c!==void 0?c:Qp,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=e==null?void 0:e.reconnectAfterMs)!==null&&d!==void 0?d:(v=>w_[v-1]||A_),this.vsn){case By:this.encode=(f=e==null?void 0:e.encode)!==null&&f!==void 0?f:((v,T)=>T(JSON.stringify(v))),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:((v,T)=>T(JSON.parse(v)));break;case g_:this.encode=(m=e==null?void 0:e.encode)!==null&&m!==void 0?m:this.serializer.encode.bind(this.serializer),this.decode=(y=e==null?void 0:e.decode)!==null&&y!==void 0?y:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class ch extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Je(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class R_ extends ch{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class bd extends ch{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const dh=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),L_=()=>Response,Id=s=>{if(Array.isArray(s))return s.map(t=>Id(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Id(r)}),e},k_=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Nc=s=>{var e;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(e=s.error)===null||e===void 0?void 0:e.message)||JSON.stringify(s)},C_=(s,e,t)=>Se(void 0,void 0,void 0,function*(){const r=yield L_();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{const i=s.status||500,o=(n==null?void 0:n.statusCode)||i+"";e(new R_(Nc(n),i,o))}).catch(n=>{e(new bd(Nc(n),n))}):e(new bd(Nc(s),s))}),P_=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||!r?n:(k_(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,e!=null&&e.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function Sa(s,e,t,r,n,i){return Se(this,void 0,void 0,function*(){return new Promise((o,u)=>{s(t,P_(e,r,n,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>C_(c,u,r))})})}function ua(s,e,t,r){return Se(this,void 0,void 0,function*(){return Sa(s,"GET",e,t,r)})}function Ar(s,e,t,r,n){return Se(this,void 0,void 0,function*(){return Sa(s,"POST",e,r,n,t)})}function Rd(s,e,t,r,n){return Se(this,void 0,void 0,function*(){return Sa(s,"PUT",e,r,n,t)})}function D_(s,e,t,r){return Se(this,void 0,void 0,function*(){return Sa(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function hh(s,e,t,r,n){return Se(this,void 0,void 0,function*(){return Sa(s,"DELETE",e,r,n,t)})}class O_{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return Se(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Je(e))return{data:null,error:e};throw e}})}}var Vy;class N_{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Vy]="BlobDownloadBuilder",this.promise=null}asStream(){return new O_(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Se(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Je(e))return{data:null,error:e};throw e}})}}Vy=Symbol.toStringTag;const M_={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},em={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class F_{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=dh(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,n){return Se(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},em),n);let u=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(c))):(i=r,u["cache-control"]=`max-age=${o.cacheControl}`,u["content-type"]=o.contentType,c&&(u["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n!=null&&n.headers&&(u=Object.assign(Object.assign({},u),n.headers));const d=this._removeEmptyFolders(t),f=this._getFinalPath(d),g=yield(e=="PUT"?Rd:Ar)(this.fetch,`${this.url}/object/${f}`,i,Object.assign({headers:u},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:g.Id,fullPath:g.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Je(i))return{data:null,error:i};throw i}})}upload(e,t,r){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return Se(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),u=new URL(this.url+`/object/upload/sign/${o}`);u.searchParams.set("token",t);try{let c;const d=Object.assign({upsert:em.upsert},n),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,f["cache-control"]=`max-age=${d.cacheControl}`,f["content-type"]=d.contentType);const g=yield Rd(this.fetch,u.toString(),c,{headers:f});return{data:{path:i,fullPath:g.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Je(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return Se(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield Ar(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+i.url),u=o.searchParams.get("token");if(!u)throw new ch("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:u},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Je(r))return{data:null,error:r};throw r}})}update(e,t,r){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Se(this,void 0,void 0,function*(){try{return{data:yield Ar(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Je(n))return{data:null,error:n};throw n}})}copy(e,t,r){return Se(this,void 0,void 0,function*(){try{return{data:{path:(yield Ar(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Je(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return Se(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield Ar(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Je(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return Se(this,void 0,void 0,function*(){try{const n=yield Ar(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Je(n))return{data:null,error:n};throw n}})}download(e,t){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"",u=this._getFinalPath(e),c=()=>ua(this.fetch,`${this.url}/${n}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new N_(c,this.shouldThrowOnError)}info(e){return Se(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield ua(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Id(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Je(r))return{data:null,error:r};throw r}})}exists(e){return Se(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield D_(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Je(r)&&r instanceof bd){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const u=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${r}${d}`)}}}remove(e){return Se(this,void 0,void 0,function*(){try{return{data:yield hh(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}list(e,t,r){return Se(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},M_),t),{prefix:e||""});return{data:yield Ar(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Je(n))return{data:null,error:n};throw n}})}listV2(e,t){return Se(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Ar(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Je(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ky="2.81.1",Hy={"X-Client-Info":`storage-js/${Ky}`};class U_{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const i=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Hy),t),this.fetch=dh(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return Se(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield ua(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}getBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield ua(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}createBucket(e){return Se(this,arguments,void 0,function*(t,r={public:!1}){try{return{data:yield Ar(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Je(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Se(this,void 0,void 0,function*(){try{return{data:yield Rd(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Je(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Ar(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield hh(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class B_{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Hy),t),this.fetch=dh(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Ar(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}listBuckets(e){return Se(this,void 0,void 0,function*(){try{const t=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&t.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&t.set("sortOrder",e.sortOrder),e!=null&&e.search&&t.set("search",e.search);const r=t.toString(),n=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield ua(this.fetch,n,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield hh(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Je(t))return{data:null,error:t};throw t}})}}const fh={"X-Client-Info":`storage-js/${Ky}`,"Content-Type":"application/json"};class Wy extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Xt(s){return typeof s=="object"&&s!==null&&"__isStorageVectorsError"in s}class Mc extends Wy{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class $_ extends Wy{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var tm;(function(s){s.InternalError="InternalError",s.S3VectorConflictException="S3VectorConflictException",s.S3VectorNotFoundException="S3VectorNotFoundException",s.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",s.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",s.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(tm||(tm={}));const gh=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),j_=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},rm=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),G_=(s,e,t)=>Se(void 0,void 0,void 0,function*(){if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!(t!=null&&t.noResolveJson)){const n=s.status||500,i=s;if(typeof i.json=="function")i.json().then(o=>{const u=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||n+"";e(new Mc(rm(o),n,u))}).catch(()=>{const o=n+"",u=i.statusText||`HTTP ${n} error`;e(new Mc(u,n,o))});else{const o=n+"",u=i.statusText||`HTTP ${n} error`;e(new Mc(u,n,o))}}else e(new $_(rm(s),s))}),V_=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return r?(j_(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,Object.assign(Object.assign({},n),t)):n};function K_(s,e,t,r,n,i){return Se(this,void 0,void 0,function*(){return new Promise((o,u)=>{s(t,V_(e,r,n,i)).then(c=>{if(!c.ok)throw c;if(r!=null&&r.noResolveJson)return c;const d=c.headers.get("content-type");return!d||!d.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>G_(c,u,r))})})}function Jt(s,e,t,r,n){return Se(this,void 0,void 0,function*(){return K_(s,"POST",e,r,n,t)})}class H_{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},fh),t),this.fetch=gh(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return Se(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}getIndex(e,t){return Se(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Xt(r))return{data:null,error:r};throw r}})}listIndexes(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return Se(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Xt(r))return{data:null,error:r};throw r}})}}class W_{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},fh),t),this.fetch=gh(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return Se(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Jt(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}getVectors(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}listVectors(e){return Se(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield Jt(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}queryVectors(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}deleteVectors(e){return Se(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Jt(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}}class z_{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},fh),t),this.fetch=gh(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}getBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}listBuckets(){return Se(this,arguments,void 0,function*(e={}){try{return{data:yield Jt(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Xt(t))return{data:null,error:t};throw t}})}}class q_ extends z_{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Y_(this.url,this.headers,e,this.fetch)}}class Y_ extends H_{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Se(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Se(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Se(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Se(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Q_(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Q_ extends W_{constructor(e,t,r,n,i){super(e,t,i),this.vectorBucketName=r,this.indexName=n}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Se(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Se(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Se(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Se(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Se(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class X_ extends U_{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new F_(this.url,this.headers,e,this.fetch)}get vectors(){return new q_(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new B_(this.url+"/iceberg",this.headers,this.fetch)}}const J_="2.81.1";let ea="";typeof Deno<"u"?ea="deno":typeof document<"u"?ea="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ea="react-native":ea="node";const Z_={"X-Client-Info":`supabase-js-${ea}/${J_}`},ew={headers:Z_},tw={schema:"public"},rw={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},nw={},sw=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),iw=()=>Headers,aw=(s,e,t)=>{const r=sw(t),n=iw();return async(i,o)=>{var u;const c=(u=await e())!==null&&u!==void 0?u:s;let d=new n(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",s),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:d}))}};function ow(s){return s.endsWith("/")?s:s+"/"}function lw(s,e){var t,r;const{db:n,auth:i,realtime:o,global:u}=s,{db:c,auth:d,realtime:f,global:g}=e,m={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},f),o),storage:{},global:Object.assign(Object.assign(Object.assign({},g),u),{headers:Object.assign(Object.assign({},(t=g==null?void 0:g.headers)!==null&&t!==void 0?t:{}),(r=u==null?void 0:u.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return s.accessToken?m.accessToken=s.accessToken:delete m.accessToken,m}function uw(s){const e=s==null?void 0:s.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ow(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const zy="2.81.1",zs=30*1e3,Ld=3,Fc=Ld*zs,cw="http://localhost:9999",dw="supabase.auth.token",hw={"X-Client-Info":`gotrue-js/${zy}`},kd="X-Supabase-Api-Version",qy={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},fw=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,gw=600*1e3;class ca extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Te(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class pw extends ca{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function mw(s){return Te(s)&&s.name==="AuthApiError"}class is extends ca{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Nn extends ca{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class xr extends Nn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function yw(s){return Te(s)&&s.name==="AuthSessionMissingError"}class Us extends Nn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Uo extends Nn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Bo extends Nn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vw(s){return Te(s)&&s.name==="AuthImplicitGrantRedirectError"}class nm extends Nn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Cd extends Nn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Uc(s){return Te(s)&&s.name==="AuthRetryableFetchError"}class sm extends Nn{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Pd extends Nn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const gl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),im=` 	
\r=`.split(""),Ew=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<im.length;e+=1)s[im[e].charCodeAt(0)]=-2;for(let e=0;e<gl.length;e+=1)s[gl[e].charCodeAt(0)]=e;return s})();function am(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(gl[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(gl[r]),e.queuedBits-=6}}function Yy(s,e,t){const r=Ew[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function om(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{xw(o,r,t)};for(let o=0;o<s.length;o+=1)Yy(s.charCodeAt(o),n,i);return e.join("")}function Sw(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Tw(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Sw(r,e)}}function xw(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if((s>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Js(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)Yy(s.charCodeAt(n),t,r);return new Uint8Array(e)}function _w(s){const e=[];return Tw(s,t=>e.push(t)),new Uint8Array(e)}function as(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>am(n,t,r)),am(null,t,r),e.join("")}function ww(s){return Math.round(Date.now()/1e3)+s}function Aw(){return Symbol("auth-callback")}const Tt=()=>typeof window<"u"&&typeof document<"u",Xn={tested:!1,writable:!1},Qy=()=>{if(!Tt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Xn.tested)return Xn.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Xn.tested=!0,Xn.writable=!0}catch{Xn.tested=!0,Xn.writable=!1}return Xn.writable};function bw(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Xy=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),Iw=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",qs=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Jn=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},wn=async(s,e)=>{await s.removeItem(e)};class Dl{constructor(){this.promise=new Dl.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Dl.promiseConstructor=Promise;function Bc(s){const e=s.split(".");if(e.length!==3)throw new Pd("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!fw.test(e[r]))throw new Pd("JWT not in base64url format");return{header:JSON.parse(om(e[0])),payload:JSON.parse(om(e[1])),signature:Js(e[2]),raw:{header:e[0],payload:e[1]}}}async function Rw(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function Lw(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function kw(s){return("0"+s.toString(16)).substr(-2)}function Cw(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,kw).join("")}async function Pw(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Dw(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await Pw(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Bs(s,e,t=!1){const r=Cw();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await qs(s,`${e}-code-verifier`,n);const i=await Dw(r);return[i,r===i?"plain":"s256"]}const Ow=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Nw(s){const e=s.headers.get(kd);if(!e||!e.match(Ow))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Mw(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function Fw(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Uw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $s(s){if(!Uw.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function $c(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Bw(s,e){return new Proxy(s,{get:(t,r,n)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,r,n)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,r,n)}})}function lm(s){return JSON.parse(JSON.stringify(s))}const ts=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),$w=[502,503,504];async function um(s){var e;if(!Iw(s))throw new Cd(ts(s),0);if($w.includes(s.status))throw new Cd(ts(s),s.status);let t;try{t=await s.json()}catch(i){throw new is(ts(i),i)}let r;const n=Nw(s);if(n&&n.getTime()>=qy["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new sm(ts(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new xr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new sm(ts(t),s.status,t.weak_password.reasons);throw new pw(ts(t),s.status||500,r)}const jw=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function we(s,e,t,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[kd]||(i[kd]=qy["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const u=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Gw(s,e,t+u,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Gw(s,e,t,r,n,i){const o=jw(e,r,n,i);let u;try{u=await s(t,Object.assign({},o))}catch(c){throw console.error(c),new Cd(ts(c),0)}if(u.ok||await um(u),r!=null&&r.noResolveJson)return u;try{return await u.json()}catch(c){await um(c)}}function _r(s){var e;let t=null;Hw(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=ww(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function cm(s){const e=_r(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Ln(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Vw(s){return{data:s,error:null}}function Kw(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,o=ui(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:u,user:c},error:null}}function dm(s){return s}function Hw(s){return s.access_token&&s.refresh_token&&s.expires_in}const jc=["global","local","others"];class Ww{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Xy(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=jc[0]){if(jc.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${jc.join(", ")}`);try{return await we(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Te(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await we(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ln})}catch(r){if(Te(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=ui(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await we(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Kw,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Te(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await we(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ln})}catch(t){if(Te(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,o,u,c;try{const d={nextPage:null,lastPage:0,total:0},f=await we(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:dm});if(f.error)throw f.error;const g=await f.json(),m=(o=f.headers.get("x-total-count"))!==null&&o!==void 0?o:0,y=(c=(u=f.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&c!==void 0?c:[];return y.length>0&&(y.forEach(v=>{const T=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(v.split(";")[1].split("=")[1]);d[`${S}Page`]=T}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},g),d),error:null}}catch(d){if(Te(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){$s(e);try{return await we(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ln})}catch(t){if(Te(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){$s(e);try{return await we(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ln})}catch(r){if(Te(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){$s(e);try{return await we(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ln})}catch(r){if(Te(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){$s(e.userId);try{const{data:t,error:r}=await we(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _deleteFactor(e){$s(e.userId),$s(e.id);try{return{data:await we(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,r,n,i,o,u,c;try{const d={nextPage:null,lastPage:0,total:0},f=await we(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:dm});if(f.error)throw f.error;const g=await f.json(),m=(o=f.headers.get("x-total-count"))!==null&&o!==void 0?o:0,y=(c=(u=f.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&c!==void 0?c:[];return y.length>0&&(y.forEach(v=>{const T=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(v.split(";")[1].split("=")[1]);d[`${S}Page`]=T}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},g),d),error:null}}catch(d){if(Te(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await we(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await we(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await we(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Te(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await we(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await we(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Te(t))return{data:null,error:t};throw t}}}function hm(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}const js={debug:!!(globalThis&&Qy()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Jy extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class zw extends Jy{}async function qw(s,e,t){js.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),js.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){js.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{js.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw js.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new zw(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(js.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function Yw(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Zy(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function Qw(s){return parseInt(s,16)}function Xw(s){const e=new TextEncoder().encode(s);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function Jw(s){var e;const{chainId:t,domain:r,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:u,requestId:c,resources:d,scheme:f,uri:g,version:m}=s;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(m!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${m}`);if(!((e=s.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const y=Zy(s.address),v=f?`${f}://${r}`:r,T=s.statement?`${s.statement}
`:"",S=`${v} wants you to sign in with your Ethereum account:
${y}

${T}`;let w=`URI: ${g}
Version: ${m}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(w+=`
Expiration Time: ${n.toISOString()}`),u&&(w+=`
Not Before: ${u.toISOString()}`),c&&(w+=`
Request ID: ${c}`),d){let b=`
Resources:`;for(const A of d){if(!A||typeof A!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${A}`);b+=`
- ${A}`}w+=b}return`${S}
${w}`}class ot extends Error{constructor({message:e,code:t,cause:r,name:n}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=n??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class pl extends ot{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Zw({error:s,options:e}){var t,r,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ot({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new ot({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new ot({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new ot({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new ot({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new ot({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return i.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new ot({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new ot({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(ev(o)){if(i.rp.id!==o)return new ot({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new ot({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ot({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new ot({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new ot({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function eA({error:s,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ot({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new ot({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const r=window.location.hostname;if(ev(r)){if(t.rpId!==r)return new ot({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new ot({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new ot({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new ot({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class tA{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const rA=new tA;function nA(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:e,user:t,excludeCredentials:r}=s,n=ui(s,["challenge","user","excludeCredentials"]),i=Js(e).buffer,o=Object.assign(Object.assign({},t),{id:Js(t.id).buffer}),u=Object.assign(Object.assign({},n),{challenge:i,user:o});if(r&&r.length>0){u.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const d=r[c];u.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Js(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return u}function sA(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:e,allowCredentials:t}=s,r=ui(s,["challenge","allowCredentials"]),n=Js(e).buffer,i=Object.assign(Object.assign({},r),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const u=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},u),{id:Js(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return i}function iA(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const t=s;return{id:s.id,rawId:s.id,response:{attestationObject:as(new Uint8Array(s.response.attestationObject)),clientDataJSON:as(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function aA(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const t=s,r=s.getClientExtensionResults(),n=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:as(new Uint8Array(n.authenticatorData)),clientDataJSON:as(new Uint8Array(n.clientDataJSON)),signature:as(new Uint8Array(n.signature)),userHandle:n.userHandle?as(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ev(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function fm(){var s,e;return!!(Tt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator==null?void 0:navigator.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function oA(s){try{const e=await navigator.credentials.create(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new pl("Browser returned unexpected credential type",e)}:{data:null,error:new pl("Empty credential response",e)}}catch(e){return{data:null,error:Zw({error:e,options:s})}}}async function lA(s){try{const e=await navigator.credentials.get(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new pl("Browser returned unexpected credential type",e)}:{data:null,error:new pl("Empty credential response",e)}}catch(e){return{data:null,error:eA({error:e,options:s})}}}const uA={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},cA={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ml(...s){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),r={};for(const n of s)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(t(o))r[i]=o;else if(e(o)){const u=r[i];e(u)?r[i]=ml(u,o):r[i]=ml(o)}else r[i]=o}return r}function dA(s,e){return ml(uA,s,e||{})}function hA(s,e){return ml(cA,s,e||{})}class fA{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:n},i){try{const{data:o,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:u};const c=n??rA.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${r}`),d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=dA(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:f,error:g}=await oA({publicKey:d,signal:c});return f?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}case"request":{const d=hA(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:f,error:g}=await lA(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:c}));return f?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}}}catch(o){return Te(o)?{data:null,error:o}:{data:null,error:new is("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new ca("rpId is required for WebAuthn authentication")};try{if(!fm())return{data:null,error:new is("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:n},{request:i});if(!o)return{data:null,error:u};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:r,credential_response:c.credential_response}})}catch(o){return Te(o)?{data:null,error:o}:{data:null,error:new is("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new ca("rpId is required for WebAuthn registration")};try{if(!fm())return{data:null,error:new is("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(f=>{var g;return(g=f.data)===null||g===void 0?void 0:g.all.find(m=>m.factor_type==="webauthn"&&m.friendly_name===e&&m.status!=="unverified")}).then(f=>f?this.client.mfa.unenroll({factorId:f==null?void 0:f.id}):void 0),{data:null,error:u};const{data:c,error:d}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:n},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(o){return Te(o)?{data:null,error:o}:{data:null,error:new is("Unexpected error in register",o)}}}}Yw();const gA={url:cw,storageKey:dw,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:hw,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function gm(s,e,t){return await t()}const Gs={};class da{get jwks(){var e,t;return(t=(e=Gs[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Gs[this.storageKey]=Object.assign(Object.assign({},Gs[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Gs[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Gs[this.storageKey]=Object.assign(Object.assign({},Gs[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},gA),e);if(this.storageKey=i.storageKey,this.instanceID=(t=da.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,da.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Tt()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Ww({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Xy(i.fetch),this.lock=i.lock||gm,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:Tt()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=qw:this.lock=gm,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new fA(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Qy()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=hm(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=hm(this.memoryStorage)),Tt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${zy}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},r="none";if(Tt()&&(t=bw(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),Tt()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),vw(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:u}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",u),await this._saveSession(o),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Te(t)?this._returnResult({error:t}):this._returnResult({error:new is("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:_r}),{data:o,error:u}=i;if(u||!o)return this._returnResult({data:{user:null,session:null},error:u});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(Te(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:f,password:g,options:m}=e;let y=null,v=null;this.flowType==="pkce"&&([y,v]=await Bs(this.storage,this.storageKey)),i=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:f,password:g,data:(t=m==null?void 0:m.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:y,code_challenge_method:v},xform:_r})}else if("phone"in e){const{phone:f,password:g,options:m}=e;i=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:f,password:g,data:(r=m==null?void 0:m.data)!==null&&r!==void 0?r:{},channel:(n=m==null?void 0:m.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:_r})}else throw new Uo("You must provide either an email or phone number and a password");const{data:o,error:u}=i;if(u||!o)return this._returnResult({data:{user:null,session:null},error:u});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(Te(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:u}=e;t=await we(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:cm})}else if("phone"in e){const{phone:i,password:o,options:u}=e;t=await we(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:cm})}else throw new Uo("You must provide either an email or phone number and a password");const{data:r,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!r||!r.session||!r.user){const i=new Us;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(Te(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,n,i,o,u,c,d,f,g,m;let y,v;if("message"in e)y=e.message,v=e.signature;else{const{chain:T,wallet:S,statement:w,options:b}=e;let A;if(Tt())if(typeof S=="object")A=S;else{const B=window;if("ethereum"in B&&typeof B.ethereum=="object"&&"request"in B.ethereum&&typeof B.ethereum.request=="function")A=B.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");A=S}const L=new URL((t=b==null?void 0:b.url)!==null&&t!==void 0?t:window.location.href),k=await A.request({method:"eth_requestAccounts"}).then(B=>B).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const O=Zy(k[0]);let P=(r=b==null?void 0:b.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!P){const B=await A.request({method:"eth_chainId"});P=Qw(B)}const $={domain:L.host,address:O,statement:w,uri:L.href,version:"1",chainId:P,nonce:(n=b==null?void 0:b.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=b==null?void 0:b.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(u=b==null?void 0:b.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(c=b==null?void 0:b.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=b==null?void 0:b.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(f=b==null?void 0:b.signInWithEthereum)===null||f===void 0?void 0:f.resources};y=Jw($),v=await A.request({method:"personal_sign",params:[Xw(y),O]})}try{const{data:T,error:S}=await we(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:y,signature:v},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:_r});if(S)throw S;if(!T||!T.session||!T.user){const w=new Us;return this._returnResult({data:{user:null,session:null},error:w})}return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),this._returnResult({data:Object.assign({},T),error:S})}catch(T){if(Te(T))return this._returnResult({data:{user:null,session:null},error:T});throw T}}async signInWithSolana(e){var t,r,n,i,o,u,c,d,f,g,m,y;let v,T;if("message"in e)v=e.message,T=e.signature;else{const{chain:S,wallet:w,statement:b,options:A}=e;let L;if(Tt())if(typeof w=="object")L=w;else{const O=window;if("solana"in O&&typeof O.solana=="object"&&("signIn"in O.solana&&typeof O.solana.signIn=="function"||"signMessage"in O.solana&&typeof O.solana.signMessage=="function"))L=O.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(A!=null&&A.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=w}const k=new URL((t=A==null?void 0:A.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in L&&L.signIn){const O=await L.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},A==null?void 0:A.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),b?{statement:b}:null));let P;if(Array.isArray(O)&&O[0]&&typeof O[0]=="object")P=O[0];else if(O&&typeof O=="object"&&"signedMessage"in O&&"signature"in O)P=O;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)v=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),T=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in L)||typeof L.signMessage!="function"||!("publicKey"in L)||typeof L!="object"||!L.publicKey||!("toBase58"in L.publicKey)||typeof L.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${k.host} wants you to sign in with your Solana account:`,L.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(n=(r=A==null?void 0:A.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=A==null?void 0:A.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${A.signInWithSolana.notBefore}`]:[],...!((o=A==null?void 0:A.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${A.signInWithSolana.expirationTime}`]:[],...!((u=A==null?void 0:A.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${A.signInWithSolana.chainId}`]:[],...!((c=A==null?void 0:A.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${A.signInWithSolana.nonce}`]:[],...!((d=A==null?void 0:A.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${A.signInWithSolana.requestId}`]:[],...!((g=(f=A==null?void 0:A.signInWithSolana)===null||f===void 0?void 0:f.resources)===null||g===void 0)&&g.length?["Resources",...A.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const O=await L.signMessage(new TextEncoder().encode(v),"utf8");if(!O||!(O instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");T=O}}try{const{data:S,error:w}=await we(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:as(T)},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(y=e.options)===null||y===void 0?void 0:y.captchaToken}}:null),xform:_r});if(w)throw w;if(!S||!S.session||!S.user){const b=new Us;return this._returnResult({data:{user:null,session:null},error:b})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:w})}catch(S){if(Te(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(e){const t=await Jn(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:o}=await we(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:_r});if(await wn(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const u=new Us;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(Te(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:o}=e,u=await we(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:_r}),{data:c,error:d}=u;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const f=new Us;return this._returnResult({data:{user:null,session:null},error:f})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(t){if(Te(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,r,n,i,o;try{if("email"in e){const{email:u,options:c}=e;let d=null,f=null;this.flowType==="pkce"&&([d,f]=await Bs(this.storage,this.storageKey));const{error:g}=await we(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:f},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:u,options:c}=e,{data:d,error:f}=await we(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:f})}throw new Uo("You must provide either an email or phone number.")}catch(u){if(Te(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:u}=await we(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:_r});if(u)throw u;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(n){if(Te(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var t,r,n,i,o;try{let u=null,c=null;this.flowType==="pkce"&&([u,c]=await Bs(this.storage,this.storageKey));const d=await we(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:c}),headers:this.headers,xform:Vw});return!((i=d.data)===null||i===void 0)&&i.url&&Tt()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(u){if(Te(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new xr;const{error:n}=await we(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(Te(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:o}=await we(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:o,error:u}=await we(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:u})}throw new Uo("You must provide either an email or phone number and a type")}catch(t){if(Te(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Jn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Fc:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await Jn(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=$c()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=Bw(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await we(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ln}):await this._useSession(async t=>{var r,n,i;const{data:o,error:u}=t;if(u)throw u;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new xr}:await we(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Ln})})}catch(t){if(Te(t))return yw(t)&&(await this._removeSession(),await wn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new xr;const o=n.session;let u=null,c=null;this.flowType==="pkce"&&e.email!=null&&([u,c]=await Bs(this.storage,this.storageKey));const{data:d,error:f}=await we(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:c}),jwt:o.access_token,xform:Ln});if(f)throw f;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(Te(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new xr;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:o}=Bc(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{data:u,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!u)return{data:{user:null,session:null},error:null};i=u}else{const{data:u,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(Te(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:u}=t;if(u)throw u;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new xr;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Te(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!Tt())throw new Bo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Bo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new nm("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Bo("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new nm("No code detected.");const{data:b,error:A}=await this._exchangeCodeForSession(e.code);if(A)throw A;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:u,expires_at:c,token_type:d}=e;if(!i||!u||!o||!d)throw new Bo("No session defined in URL");const f=Math.round(Date.now()/1e3),g=parseInt(u);let m=f+g;c&&(m=parseInt(c));const y=m-f;y*1e3<=zs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${y}s, should have been closer to ${g}s`);const v=m-g;f-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,m,f):f-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,m,f);const{data:T,error:S}=await this._getUser(i);if(S)throw S;const w={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:g,expires_at:m,refresh_token:o,token_type:d,user:T.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:w,redirectType:e.type},error:null})}catch(r){if(Te(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Jn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return this._returnResult({error:i});const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:u}=await this.admin.signOut(o,e);if(u&&!(mw(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return e!=="others"&&(await this._removeSession(),await wn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Aw(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await Bs(this.storage,this.storageKey,!0));try{return await we(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(Te(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var o,u,c,d,f;const{data:g,error:m}=i;if(m)throw m;const y=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await we(this.fetch,"GET",y,{headers:this.headers,jwt:(f=(d=g.session)===null||d===void 0?void 0:d.access_token)!==null&&f!==void 0?f:void 0})});if(n)throw n;return Tt()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Te(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:n,data:{session:i}}=t;if(n)throw n;const{options:o,provider:u,token:c,access_token:d,nonce:f}=e,g=await we(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:u,id_token:c,access_token:d,nonce:f,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:_r}),{data:m,error:y}=g;return y?this._returnResult({data:{user:null,session:null},error:y}):!m||!m.session||!m.user?this._returnResult({data:{user:null,session:null},error:new Us}):(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("USER_UPDATED",m.session)),this._returnResult({data:m,error:y}))}catch(n){if(Te(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)throw o;return await we(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Lw(async n=>(n>0&&await Rw(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await we(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_r})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Uc(i)&&Date.now()+o-r<zs})}catch(r){if(this._debug(t,"error",r),Te(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Tt()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await Jn(this.storage,this.storageKey);if(n&&this.userStorage){let o=await Jn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await qs(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:$c()}else if(n&&!n.user&&!n.user){const o=await Jn(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,await wn(this.storage,this.storageKey+"-user"),await qs(this.storage,this.storageKey,n)):n.user=$c()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Fc;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Fc}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Uc(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:u}=await this._getUser(n.access_token);!u&&(o!=null&&o.user)?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new xr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Dl;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new xr;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const u={data:i.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(i){if(this._debug(n,"error",i),Te(i)){const o={data:null,error:i};return Uc(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let u=0;u<i.length;u+=1)console.error(i[u]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await qs(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=lm(n);await qs(this.storage,this.storageKey,i)}else{const n=lm(t);await qs(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await wn(this.storage,this.storageKey),await wn(this.storage,this.storageKey+"-code-verifier"),await wn(this.storage,this.storageKey+"-user"),this.userStorage&&await wn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Tt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),zs);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/zs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${zs}ms, refresh threshold is ${Ld} ticks`),n<=Ld&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Jy)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Tt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await Bs(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(u.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?this._returnResult({data:null,error:i}):await we(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await we(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(e.factorType==="totp"&&c.type==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?iA(e.webauthn.credential_response):aA(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:c}=await we(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:c}))})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await we(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:u}=o;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:nA(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:sA(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Bc(r.access_token);let o=null;i.aal&&(o=i.aal);let u=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(f=>f.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(u="aal2");const d=i.amr||[];return{data:{currentLevel:o,nextLevel:u,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await we(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new xr})})}catch(t){if(Te(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new xr});const o=await we(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&Tt()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Te(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new xr});const o=await we(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&Tt()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Te(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(u=>u.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(u=>u.kid===e),r&&this.jwks_cached_at+gw>n)return r;const{data:i,error:o}=await we(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,r=i.keys.find(u=>u.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:y,error:v}=await this.getSession();if(v||!y.session)return this._returnResult({data:null,error:v});r=y.session.access_token}const{header:n,payload:i,signature:o,raw:{header:u,payload:c}}=Bc(r);t!=null&&t.allowExpired||Mw(i.exp);const d=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!d){const{error:y}=await this.getUser(r);if(y)throw y;return{data:{claims:i,header:n,signature:o},error:null}}const f=Fw(n.alg),g=await crypto.subtle.importKey("jwk",d,f,!0,["verify"]);if(!await crypto.subtle.verify(f,g,o,_w(`${u}.${c}`)))throw new Pd("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(r){if(Te(r))return this._returnResult({data:null,error:r});throw r}}}da.nextInstanceID={};const pA=da;class mA extends pA{constructor(e){super(e)}}class yA{constructor(e,t,r){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;const u=uw(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const c=`sb-${u.hostname.split(".")[0]}-auth-token`,d={db:tw,realtime:nw,auth:Object.assign(Object.assign({},rw),{storageKey:c}),global:ew},f=lw(r??{},d);this.storageKey=(n=f.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=f.global.headers)!==null&&i!==void 0?i:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(g,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=f.auth)!==null&&o!==void 0?o:{},this.headers,f.global.fetch),this.fetch=aw(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&this.accessToken().then(g=>this.realtime.setAuth(g)).catch(g=>console.warn("Failed to set initial Realtime auth token:",g)),this.rest=new c_(new URL("rest/v1",u).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new X_(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new a_(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:i,storageKey:o,flowType:u,lock:c,debug:d,throwOnError:f},g,m){const y={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new mA({url:this.authUrl.href,headers:Object.assign(Object.assign({},y),g),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:i,flowType:u,lock:c,debug:d,throwOnError:f,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new I_(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const vA=(s,e,t)=>new yA(s,e,t);function EA(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const e=s.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}EA()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const SA="https://yrmfnwouyzxteswiocmg.supabase.co",TA="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4",Zt=vA(SA,TA,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}}),xA=async s=>{const{error:e}=await Zt.from("reported_links").insert({channel_id:s.id,channel_name:s.name,reported_at:new Date().toISOString()});if(e)throw e},_A=async s=>{const{data:e,error:t}=await Zt.from("profiles").select("*").eq("id",s).single();if(t&&t.code!=="PGRST116")throw t;return e},tv=async(s,e)=>{const t={...e,updated_at:new Date().toISOString()},{error:r}=await Zt.from("profiles").upsert({id:s,...t});if(r)throw r},pm=(s,e)=>{const t=Zt.channel("profiles_changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:`id=eq.${s}`},r=>{e(r.new)}).subscribe();return()=>{Zt.removeChannel(t)}},wA=s=>({id:s.id,...s}),rv=(s,e)=>{const t=Zt.channel("notifications_changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications"},r=>{const n=wA(r.new);e([n])}).subscribe();return()=>{Zt.removeChannel(t)}},AA=async s=>{const{error:e}=await Zt.from("user_notifications").update({is_read:!0}).eq("user_id",s).eq("is_read",!1);if(e)throw e},Dd=(s,e)=>e.some(t=>s instanceof t);let mm,ym;function bA(){return mm||(mm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function IA(){return ym||(ym=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Od=new WeakMap,Gc=new WeakMap,Ol=new WeakMap;function RA(s){const e=new Promise((t,r)=>{const n=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{t(os(s.result)),n()},o=()=>{r(s.error),n()};s.addEventListener("success",i),s.addEventListener("error",o)});return Ol.set(e,s),e}function LA(s){if(Od.has(s))return;const e=new Promise((t,r)=>{const n=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{t(),n()},o=()=>{r(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});Od.set(s,e)}let Nd={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Od.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return os(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function nv(s){Nd=s(Nd)}function kA(s){return IA().includes(s)?function(...e){return s.apply(Md(this),e),os(this.request)}:function(...e){return os(s.apply(Md(this),e))}}function CA(s){return typeof s=="function"?kA(s):(s instanceof IDBTransaction&&LA(s),Dd(s,bA())?new Proxy(s,Nd):s)}function os(s){if(s instanceof IDBRequest)return RA(s);if(Gc.has(s))return Gc.get(s);const e=CA(s);return e!==s&&(Gc.set(s,e),Ol.set(e,s)),e}const Md=s=>Ol.get(s);function PA(s,e,{blocked:t,upgrade:r,blocking:n,terminated:i}={}){const o=indexedDB.open(s,e),u=os(o);return r&&o.addEventListener("upgradeneeded",c=>{r(os(o.result),c.oldVersion,c.newVersion,os(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),u.then(c=>{i&&c.addEventListener("close",()=>i()),n&&c.addEventListener("versionchange",d=>n(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const DA=["get","getKey","getAll","getAllKeys","count"],OA=["put","add","delete","clear"],Vc=new Map;function vm(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Vc.get(e))return Vc.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,n=OA.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(n||DA.includes(t)))return;const i=async function(o,...u){const c=this.transaction(o,n?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),n&&c.done]))[0]};return Vc.set(e,i),i}nv(s=>({...s,get:(e,t,r)=>vm(e,t)||s.get(e,t,r),has:(e,t)=>!!vm(e,t)||s.has(e,t)}));const NA=["continue","continuePrimaryKey","advance"],Em={},Fd=new WeakMap,sv=new WeakMap,MA={get(s,e){if(!NA.includes(e))return s[e];let t=Em[e];return t||(t=Em[e]=function(...r){Fd.set(this,sv.get(this)[e](...r))}),t}};async function*FA(...s){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...s)),!e)return;e=e;const t=new Proxy(e,MA);for(sv.set(t,e),Ol.set(t,Md(e));e;)yield t,e=await(Fd.get(t)||e.continue()),Fd.delete(t)}function Sm(s,e){return e===Symbol.asyncIterator&&Dd(s,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Dd(s,[IDBIndex,IDBObjectStore])}nv(s=>({...s,get(e,t,r){return Sm(e,t)?FA:s.get(e,t,r)},has(e,t){return Sm(e,t)||s.has(e,t)}}));let Kc=null;const iv=(s,e)=>(Kc||(Kc=PA(s,3,{upgrade(t){t.objectStoreNames.contains(e)&&t.deleteObjectStore(e),t.createObjectStore(e)}})),Kc),av="user-session-db",Zs="user-session",ov="activeUser",Tm=async s=>{if(s)try{const t=(await iv(av,Zs)).transaction(Zs,"readwrite");await t.objectStore(Zs).put({uid:s},ov),await t.done,console.log("User session started in IndexedDB:",s)}catch(e){console.error("Error setting active user in IndexedDB:",e)}},xm=async()=>{try{const e=(await iv(av,Zs)).transaction(Zs,"readwrite");await e.objectStore(Zs).delete(ov),await e.done,console.log("User session cleared from IndexedDB.")}catch(s){console.error("Error clearing active user from IndexedDB:",s)}},UA=({onLogoClick:s})=>R.jsx("header",{className:"bg-red-600 shadow-lg sticky top-0 z-20",children:R.jsx("div",{className:"container mx-auto px-4 lg:px-6 py-3 flex justify-between items-center h-[68px]",children:R.jsx("button",{onClick:s,"aria-label":"Go to Home",className:"flex-shrink-0 z-10",children:R.jsx("img",{src:"https://s12.gifyu.com/images/b38qq.gif",alt:"Samachar Plus OTT Logo",className:"h-14"})})})}),BA=()=>R.jsx("svg",{className:"w-7 h-7 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:1.5,children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),$A=({className:s})=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:s||"w-6 h-6",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"})}),jA=({className:s="w-6 h-6"})=>R.jsxs("svg",{className:s,viewBox:"0 0 80 40",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",children:[R.jsx("rect",{x:"2",y:"2",width:"76",height:"36",rx:"8",stroke:"currentColor",strokeWidth:"3",fill:"none"}),R.jsx("text",{x:"50%",y:"50%",dy:".3em",textAnchor:"middle",fill:"currentColor",fontSize:"18",fontWeight:"bold",children:"LIVE"})]}),GA=({className:s="w-6 h-6"})=>R.jsxs("svg",{className:s,viewBox:"0 0 80 40",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",children:[R.jsx("rect",{x:"2",y:"2",width:"76",height:"36",rx:"8",stroke:"currentColor",strokeWidth:"3",fill:"none"}),R.jsx("text",{x:"50%",y:"50%",dy:".3em",textAnchor:"middle",fill:"currentColor",fontSize:"18",fontWeight:"bold",children:"NEWS"})]}),Hc="contentPreference",VA=()=>{const s=$r(),[e,t]=W.useState(localStorage.getItem(Hc)||"national"),r=s.pathname.includes("live"),n=s.pathname==="/"||s.pathname==="/regional-live",i=s.pathname==="/national"||s.pathname==="/live";W.useEffect(()=>{n?(t("regional"),localStorage.setItem(Hc,"regional")):i&&(t("national"),localStorage.setItem(Hc,"national"))},[s.pathname,n,i]);const o=e==="regional"?"/regional-live":"/live",u=e==="regional"?"/":"/national",c=e==="regional",d=f=>`flex flex-col items-center justify-center text-xs transition-colors p-2 ${f?"text-red-600":"text-gray-500 hover:text-red-600"}`;return R.jsxs("div",{className:"flex items-center justify-center w-3/5 bg-white",children:[R.jsx(Zi,{to:o,className:({isActive:f})=>d(f),children:R.jsx(jA,{className:"w-16 h-16"})}),R.jsxs("div",{className:"relative flex flex-col bg-gray-200 rounded-md text-xs shadow-inner w-16",children:[R.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 bg-red-600 rounded-md transition-transform duration-300 ease-in-out",style:{transform:c?"translateY(100%)":"translateY(0)"}}),R.jsx(Zi,{to:r?"/live":"/national",className:`relative z-10 py-1 text-center font-semibold transition-colors duration-300 ${c?"text-gray-600":"text-white"}`,children:"National"}),R.jsx(Zi,{to:r?"/regional-live":"/",end:!0,className:`relative z-10 py-1 text-center font-semibold transition-colors duration-300 ${c?"text-white":"text-gray-600"}`,children:"Regional"})]}),R.jsx(Zi,{to:u,className:({isActive:f})=>d(f),children:R.jsx(GA,{className:"w-16 h-16"})})]})},KA=({onProfileClick:s,unreadCount:e=0})=>{const t=$r(),r=`
    fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-40
  `,n=`
    flex items-center h-full max-w-4xl mx-auto
  `,i="flex items-center justify-center transition-colors p-2 w-1/5",o=({isActive:d})=>`${i} ${d?"text-red-600":"text-gray-500 hover:text-red-600"}`,u=t.pathname==="/profile",c=`${i} ${u?"text-red-600":"text-gray-500 hover:text-red-600"}`;return R.jsx("footer",{className:r,children:R.jsxs("nav",{className:n,children:[R.jsx("button",{onClick:s,className:c,children:R.jsx(BA,{className:"w-8 h-8"})}),R.jsx(VA,{}),R.jsx(Zi,{to:"/notifications",className:o,children:R.jsxs("div",{className:"relative",children:[R.jsx($A,{className:"w-8 h-8"}),e>0&&R.jsx("span",{className:"absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 bg-red-600 text-white text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center",children:e})]})})]})})},di=()=>R.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[R.jsx("div",{className:"w-4 h-4 rounded-full bg-white/80 animate-bounce [animation-delay:-0.3s]"}),R.jsx("div",{className:"w-4 h-4 rounded-full bg-white/80 animate-bounce [animation-delay:-0.15s]"}),R.jsx("div",{className:"w-4 h-4 rounded-full bg-white/80 animate-bounce"})]}),HA=()=>({INDIAN_STATES:["MAHARASHTRA","KARNATAKA","TAMIL NADU","GUJARAT","RAJASTHAN","UTTAR PRADESH","MADHYA PRADESH","ANDHRA PRADESH","TELANGANA","WEST BENGAL","BIHAR","HARYANA","PUNJAB","KERALA","ODISHA","JHARKHAND","ASSAM","GOA","MEGHALAYA","MANIPUR","MIZORAM","NAGALAND","SIKKIM","TRIPURA","ARUNACHAL PRADESH"],INDIAN_STATES_AND_DISTRICTS:{MAHARASHTRA:["Mumbai","Pune","Nagpur","Nashik","Aurangabad","Thane","Solapur"],KARNATAKA:["Bangalore Urban","Mysore","Belgaum","Hubli-Dharwad","Mangalore","Gulbarga"],"TAMIL NADU":["Chennai","Coimbatore","Madurai","Tiruchirappalli","Salem","Erode"],GUJARAT:["Ahmedabad","Surat","Vadodara","Rajkot","Bhavnagar","Jamnagar"],RAJASTHAN:["Jaipur","Jodhpur","Kota","Bikaner","Ajmer","Udaipur"]}}),lv=async()=>{try{return console.log("Using fallback location data due to RLS policy issues"),HA()}catch(s){return console.error("Error in fetchEnabledLocations:",s),{INDIAN_STATES:[],INDIAN_STATES_AND_DISTRICTS:{}}}},uv=[{id:"live-1",name:"Aaj Tak",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ0FgBSdI4TYVJyvq_QgXyb75TEeiszKJm6LQ&s",streamUrl:"https://aajtaklive-amd.akamaized.net/hls/live/2014416/aajtak/aajtaklive/live_720p/chunks.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-2",name:"ABP News",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTF2Y0RVCUCiSZTkvIn_O8KIVQKzIGxn8pV4Q&s",streamUrl:"https://d2l4ar6y3mrs4k.cloudfront.net/live-streaming/abpnews-livetv/master_720.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-3",name:"DD News",logoUrl:"https://th-i.thgim.com/public/latest-news/wtrkwx/article68081322.ece/alternates/FREE_1200/DDNews.jpg",streamUrl:"https://playhls.media.nic.in/hls/live/ddnews/ddnews.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-4",name:"News18 India",logoUrl:"https://upload.wikimedia.org/wikipedia/commons/2/24/News_18_India.png",streamUrl:"https://nw18live.cdn.jio.com/bpk-tv/News18_India_NW18_MOB/output01/News18_India_NW18_MOB-audio_98835_eng=98800-video=3724000.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-5",name:"NDTV India",logoUrl:"https://images.seeklogo.com/logo-png/46/2/ndtv-india-logo-png_seeklogo-466899.png",streamUrl:"https://ndtvindiaelemarchana.akamaized.net/hls/live/2003679-b/ndtvindia/masterb_720p@3.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-6",name:"Zee News",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQNJxr9YJ_5R0AxpVM_xfGzpfobuyshYKPHAg&s",streamUrl:"https://dknttpxmr0dwf.cloudfront.net/index_57.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-7",name:"Zee Bharat",logoUrl:"https://yt3.googleusercontent.com/QCKjEhgbRnhNTcPeTe5-uAYnLyf0OdDpYPZSgLufVeOi1LTygW2XIli33YXGohWphxWlAQRVCQ=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://d1hp2yai3k4ork.cloudfront.net/index_4.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-8",name:"Republic Bharat",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTE5yq5kFO48XWr25bAp1Y4xF-UGmg5OXJ6qQ&s",streamUrl:"https://vg-republictvlive.akamaized.net/v1/master/611d79b11b77e2f571934fd80ca1413453772ac7/vglive-sk-275673/main.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-9",name:"India TV",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRupx5hp2GkJ1hoFX1rc4omoTuLJeKp7_b2EO9qfJspAha-FH2-s8AKsr1wyIkPauvz8Rs&usqp=CAU",streamUrl:"https://pl-indiatvnews.akamaized.net/out/v1/db79179b608641ceaa5a4d0dd0dca8da/index_3.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-10",name:"News 24",logoUrl:"https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/66/92/9d/66929dd4-5268-ad97-9b65-f7f1bfee8417/AppIcon-0-0-1x_U007epad-0-85-220.png/1200x630wa.png",streamUrl:"https://vidcdn.vidgyor.com/news24-origin/liveabr/news24-origin/live_720p/chunks.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-11",name:"TV9 Bharatvarsh",logoUrl:"https://upload.wikimedia.org/wikipedia/en/thumb/a/a6/TV9_Bharatvarsh.svg/250px-TV9_Bharatvarsh.svg.png",streamUrl:"https://dyjmyiv3bp2ez.cloudfront.net/pub-iotv9hinjzgtpe/liveabr/pub-iotv9hinjzgtpe/live_720p/chunks.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-46",name:"Times Now Navbharat",logoUrl:"https://i.ibb.co/jZPg3HXW/tn-navbharat.jpg",streamUrl:"https://amg01448-samsungin-tinnavbharat-samsungin-ad-m8.amagi.tv/playlist/amg01448-samsungin-tinnavbharat-samsungin/playlist.m3u8",category:"NATIONAL",subCategory:"HINDI"},{id:"live-12",name:"WION",logoUrl:"https://images.seeklogo.com/logo-png/60/2/wion-logo-png_seeklogo-605806.png",streamUrl:"https://d7x8z4yuq42qn.cloudfront.net/index_7.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-13",name:"India Today",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSDY3XZpruzPEg5YPKa2o6_fFAoNhtJWq8JJw&s",streamUrl:"https://feeds.intoday.in/hltapps/api/master.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-14",name:"CNN News18",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKV89B5gUlXtUNUJ9J_1m_Ahxod9kO71XyYw&s",streamUrl:"https://nw18live.cdn.jio.com/bpk-tv/CNN_News18_NW18_MOB/output01/CNN_News18_NW18_MOB-audio_98835_hin=98800-video=2293600.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-15",name:"NDTV 24x7",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQwjUVJCJlJaaUtIBnHE3njLdKcdWlcALk_tQ&s",streamUrl:"https://ndtv24x7elemarchana.akamaized.net/hls/live/2003678-b/ndtv24x7/masterb_720p@3.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-16",name:"Times Now",logoUrl:"https://content.jdmagicbox.com/comp/kolkata/84/033p520084/catalogue/times-now-circus-avenue-kolkata-news-satellite-channels-9xcseqhba6.jpg",streamUrl:"https://dztlhgid9me95.cloudfront.net/live-tv/Vidgyor/timesnow/live_720p/chunks.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-17",name:"Republic TV",logoUrl:"https://jiotv.catchup.cdn.jio.com/dare_images/images/Republic_TV.png",streamUrl:"https://d3qs3d2rkhfqrt.cloudfront.net/out/v1/2e31d831f08640ff92f65003bdc89991/index.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-18",name:"Sansad TV",logoUrl:"https://webcast.gov.in/assets/images/RajyaSabha.png",streamUrl:"https://playhls.media.nic.in/live/rstv-360p/index.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-19",name:"DD India",logoUrl:"https://i.ibb.co/PZ9RmJmd/dd-india.jpg",streamUrl:"https://test-yupptv.cachefly.net/120723/smil:ddindiahd.smil/chunklist_b896000.m3u8",category:"NATIONAL",subCategory:"ENGLISH"},{id:"live-20",name:"NDTV Profit",logoUrl:"https://media.assettype.com/bloombergquint/2023-12/d55e2378-26a1-42ee-8d02-7ab53846081d/ndtv_profit.png?w=1200&h=675&auto=format%2Ccompress&fit=max&enlarge=true",streamUrl:"https://ndtvprofit.akamaized.net/hls/live/2107404/ndtvprofit/chunklist_4.m3u8",category:"NATIONAL",subCategory:"BUSINESS"},{id:"live-21",name:"Zee Business",logoUrl:"https://yt3.googleusercontent.com/sxHEe-On1euLaHO6gssZiJXWQpRgjy7duGBWC9qPmDEul_AfSvthGaGOc3uRZEhTUchMBEOJlp0=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://dwby15d04agvq.cloudfront.net/index_5.m3u8",category:"NATIONAL",subCategory:"BUSINESS"},{id:"live-22",name:"CNBC AWAAZ",logoUrl:"https://jiotvimages.cdn.jio.com/dare_images/images/CNBC_Awaaz.png",streamUrl:"https://nw18live.cdn.jio.com/bpk-tv/CNBC_Awaaz_NW18_MOB/output01/CNBC_Awaaz_NW18_MOB-audio_98834_hin=98800-video=3724000.m3u8",category:"NATIONAL",subCategory:"BUSINESS"},{id:"live-31",name:"NDTV Madhya Pradesh Chhattisgarh",logoUrl:"https://yt3.googleusercontent.com/5S4SubzzRn25zCq2FNyrGjVgZhjHI536Ld41nAwMGQKvgrndOpDp8yhqKe1ZLg-y67YMYqAB=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://ndtvregional.akamaized.net/hls/live/2102726-b/ndtvmpcg/chunklist_3.m3u8",category:"REGIONAL",subCategory:["Madhya Pradesh","Chhattisgarh"]},{id:"live-32",name:"NDTV Rajasthan",logoUrl:"https://yt3.googleusercontent.com/H_G4mPfQH5xJWZgrqfOYg-fOSABfRpyErqhnV4WpV7NI3VnhJPY1mRuDZLcxwvHzLKTOXgsqYw=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://ndtvregional.akamaized.net/hls/live/2102726-b/ndtvraj/master_1.m3u8",category:"REGIONAL",subCategory:["Rajasthan"]},{id:"live-33",name:"News18 Bihar-Jharkhand",logoUrl:"https://upload.wikimedia.org/wikipedia/commons/3/3a/News18_Bihar_Jharkhand.png",streamUrl:"",category:"REGIONAL",subCategory:["Bihar","Jharkhand"]},{id:"live-34",name:"News18 Madhya Pradesh Chhattisgarh",logoUrl:"https://yt3.googleusercontent.com/Y8aFJxC0NMZbPDFfGfRLr1ymVHgujMpnbdzUrMEv8M3KWFt7EmgCgA17T4f5AsKCKzVdK1tBhQ=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://nw18live.cdn.jio.com/bpk-tv/News18_MP_Chhattisgarh_NW18_MOB/output01/News18_MP_Chhattisgarh_NW18_MOB-audio_98835_hin=98800-video=3724000.m3u8",category:"REGIONAL",subCategory:["Madhya Pradesh","Chhattisgarh"]},{id:"live-35",name:"News18 Rajasthan",logoUrl:"https://yt3.googleusercontent.com/xIJSgMJGzG1RMformQj_mdyl0Xf9wihKmpPpTmXsVDjH2S_pp80OcITIL8HVL8ZuxsnbqtJVxzg=s160-c-k-c0x00ffffff-no-rj",streamUrl:"https://nw18live.cdn.jio.com/bpk-tv/News18_Rajasthan_NW18_MOB/output01/News18_Rajasthan_NW18_MOB-audio_98835_hin=98800-video=3724000.m3u8",category:"REGIONAL",subCategory:["Rajasthan"]},{id:"live-36",name:"News18 Uttar Pradesh Uttarakhand",logoUrl:"https://yt3.googleusercontent.com/qf5BdXxgdMXutHsPx7Y9QH-EFfhA-8hkHNPPbYtMfj9SQWyQxEjlq4EYUtdmn52zQ5mUwG29dg=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://nw18live.cdn.jio.com/bpk-tv/News18_UP_Uttarakhand_NW18_MOB/output01/News18_UP_Uttarakhand_NW18_MOB-audio_98835_eng=98800-video=3724000.m3u8",category:"REGIONAL",subCategory:["Uttar Pradesh","Uttarakhand"]},{id:"live-37",name:"Z Bihar Jharkhand",logoUrl:"https://yt3.googleusercontent.com/Tc7Ad0aVG60qoHUKbCu8bK9t6gRBZvSPauIDEIYhadkUHnT9r9hp-Q38aRYkkjYRgWJaHP-EbA=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://d3vmwjy7v49lo5.cloudfront.net/index_4.m3u8",category:"REGIONAL",subCategory:["Bihar","Jharkhand"]},{id:"live-39",name:"Z Madhya Pradesh Chhattisgarh",logoUrl:"https://yt3.googleusercontent.com/yTIy-oADsKUGbdR92P3exxP-2HpRNbxvQtz6En_2bJ1pyIgfw400ibfNErg0SXBsVGKAU1FCRA=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://d1ek9hdbw9xxcw.cloudfront.net/index_4.m3u8",category:"REGIONAL",subCategory:["Madhya Pradesh","Chhattisgarh"]},{id:"live-40",name:"Z Rajasthan",logoUrl:"https://yt3.googleusercontent.com/CqBwhwPCfGMMlZK1L0Sluelx6cA-RqN5nEZb2Uihy8JZupeU-12Gfyvw93o53SgOHpnBBW4xXkg=s900-c-k-c0x00ffffff-no-rj",streamUrl:"https://vg-zeefta.akamaized.net/ptnr-yupptv/title-zeerajashthannews/v1/master/611d79b11b77e2f571934fd80ca1413453772ac7/8e864b9a-1681-41a0-99a6-387490bc5b24/main.m3u8",category:"REGIONAL",subCategory:["Rajasthan"]},{id:"live-41",name:"Z Uttar Pradesh Uttarakhand",logoUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDqiaSpRM5Jl8ejnLl1H3VoNUWvWvjdo3XUw&s",streamUrl:"https://duw35ict5q7th.cloudfront.net/index_3.m3u8",category:"REGIONAL",subCategory:["Uttar Pradesh","Uttarakhand"]}],cv=["National","Technology","Sports","Entertainment","Business"],WA=({onClose:s,initialStep:e=1})=>{const[t,r]=W.useState(e),[n,i]=W.useState(""),[o,u]=W.useState(""),[c,d]=W.useState(""),[f,g]=W.useState(!1),[m,y]=W.useState(""),[v,T]=W.useState(!1),[S,w]=W.useState(""),[b,A]=W.useState("other"),[L,k]=W.useState({categories:[],state:"",district:""}),[O,P]=W.useState({INDIAN_STATES:[],INDIAN_STATES_AND_DISTRICTS:{}}),[$,B]=W.useState([]);W.useEffect(()=>{lv().then(P)},[]),W.useEffect(()=>{L.state&&O.INDIAN_STATES_AND_DISTRICTS&&B(O.INDIAN_STATES_AND_DISTRICTS[L.state]||[])},[L.state,O]);const U=async()=>{if(y(""),!n){y("Please enter your phone number.");return}if(n.length!==10){y("Please enter a valid 10-digit phone number.");return}T(!0);try{const Y=await(await fetch("https://yrmfnwouyzxteswiocmg.supabase.co/functions/v1/sms-auth",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4"},body:JSON.stringify({action:"sendOTP",phoneNumber:n,purpose:"signup"})})).json();if(!Y.success)throw new Error(Y.error||"Failed to send OTP");d(Y.verificationId),g(!0),y("")}catch(F){console.error("Send OTP error:",F),F.name==="TypeError"&&F.message.includes("fetch")?y("Unable to connect to authentication service. Please check your internet connection and try again."):F.message.includes("CORS")||F.message.includes("blocked")?y("Authentication service is temporarily unavailable. Please try again later."):y(F.message||"Failed to send OTP. Please check your phone number and try again.")}finally{T(!1)}},q=async()=>{if(y(""),!o||o.length!==6){y("Please enter the complete 6-digit OTP.");return}T(!0);try{const Y=await(await fetch("https://yrmfnwouyzxteswiocmg.supabase.co/functions/v1/sms-auth",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4"},body:JSON.stringify({action:"verifyOTP",verificationId:c,otp:o})})).json();if(!Y.verified)throw new Error("Invalid or expired OTP");if(Y.needsRegistration)r(2);else{const{data:{user:Q}}=await Zt.auth.getUser();if(Q){const C=await _A(Q.id);C!=null&&C.name?s():r(2)}}}catch(F){y(F.message||"OTP verification failed"),console.error(F)}finally{T(!1)}},re=async()=>{if(c){T(!0),y("");try{const Y=await(await fetch("https://yrmfnwouyzxteswiocmg.supabase.co/functions/v1/sms-auth",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZud291eXp4dGVzd2lvY21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMDIxNjAsImV4cCI6MjA3ODY3ODE2MH0.YhhDPAD8NB_TIOYCSR6oBA438G_6ySR51xz9J6spwq4"},body:JSON.stringify({action:"resendOTP",verificationId:c})})).json();if(!Y.success)throw new Error(Y.error||"Failed to resend OTP");y("")}catch(F){y(F.message||"Failed to resend OTP"),console.error(F)}finally{T(!1)}}},ae=()=>{g(!1),u(""),d(""),y("")},le=async()=>{if(y(""),!S.trim()){y("Name is required.");return}if(!L.state||!L.district){y("Location is required.");return}T(!0);try{if(!c)throw new Error("No verification found. Please complete OTP verification first.");let F=null;const Y=`temp_${n}_${Date.now()}`,{data:Q,error:C}=await Zt.auth.signUp({phone:`+91${n}`,password:Y,options:{data:{name:S,phone:`+91${n}`}}});if(C)throw C;if(F=Q.user,!F)throw new Error("No authenticated user found.");await tv(F.id,{uid:F.id,name:S,gender:b,phone:`+91${n}`,email:F.email||"",preferences:L,notificationPreferences:{allNews:!0,breakingNews:!0,favorites:!0,localNews:!0}}),s()}catch(F){console.error("Profile submission error:",F),y(F.message||"Failed to save profile.")}finally{T(!1)}},oe=F=>k(Y=>({...Y,categories:Y.categories.includes(F)?Y.categories.filter(Q=>Q!==F):[...Y.categories,F]})),J=F=>k(Y=>({...Y,state:F.target.value,district:""})),se=F=>F.charAt(0).toUpperCase()+F.slice(1);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:R.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full m-4 relative",children:[R.jsx("button",{onClick:s,className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",children:""}),m&&R.jsx("p",{className:"text-red-500 text-sm text-center mb-4 bg-red-100 p-2 rounded",children:m}),t===1&&R.jsxs("div",{className:"space-y-4",children:[R.jsx("h2",{className:"text-2xl font-bold text-center",children:"Phone Authentication"}),f?R.jsxs("div",{children:[R.jsxs("div",{className:"mb-4 text-center",children:[R.jsxs("p",{className:"text-sm text-gray-600",children:["OTP sent to ",n.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")]}),R.jsx("button",{type:"button",onClick:ae,className:"text-red-600 hover:text-red-800 text-sm underline",children:"Change number"})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"Enter OTP"}),R.jsx("input",{type:"text",value:o,onChange:F=>u(F.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full mt-1 p-2 border rounded text-center text-lg tracking-widest",placeholder:"Enter 6-digit OTP",maxLength:6,pattern:"[0-9]{6}"})]}),R.jsx("button",{onClick:q,disabled:v||o.length!==6,className:"w-full bg-green-600 text-white p-2 rounded hover:bg-green-700 disabled:bg-gray-400",children:v?"Verifying...":"Verify OTP"}),R.jsx("div",{className:"text-center",children:R.jsx("button",{type:"button",onClick:re,disabled:v,className:"text-red-600 hover:text-red-800 text-sm underline disabled:opacity-50",children:"Resend OTP"})})]})]}):R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"Phone Number"}),R.jsx("input",{type:"tel",value:n,onChange:F=>i(F.target.value.replace(/\D/g,"").slice(0,10)),className:"w-full mt-1 p-2 border rounded",placeholder:"Enter 10-digit phone number",maxLength:10,pattern:"[0-9]{10}"}),R.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"We'll send you a 6-digit OTP"})]}),R.jsx("button",{onClick:U,disabled:v||!n||n.length!==10,className:"w-full bg-red-600 text-white p-2 rounded hover:bg-red-700 disabled:bg-gray-400",children:v?"Sending OTP...":"Send OTP"})]})]}),t===2&&R.jsxs("div",{className:"space-y-4",children:[R.jsx("h2",{className:"text-2xl font-bold text-center",children:"Complete Your Profile"}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"Full Name"}),R.jsx("input",{type:"text",value:S,onChange:F=>w(F.target.value),className:"w-full mt-1 p-2 border rounded"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"Gender"}),R.jsx("div",{className:"flex justify-start space-x-4 p-2 rounded-lg",children:["male","female","other"].map(F=>R.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[R.jsx("input",{type:"radio",name:"gender",value:F,checked:b===F,onChange:Y=>A(Y.target.value),className:"form-radio h-4 w-4"}),R.jsx("span",{children:se(F)})]},F))})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"State"}),R.jsxs("select",{value:L.state,onChange:J,className:"w-full p-2 border rounded",children:[R.jsx("option",{value:"",children:"Select"}),O.INDIAN_STATES.map(F=>R.jsx("option",{value:F,children:F},F))]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"District"}),R.jsxs("select",{value:L.district,onChange:F=>k(Y=>({...Y,district:F.target.value})),className:"w-full p-2 border rounded",disabled:!$.length,children:[R.jsx("option",{value:"",children:"Select"}),$.map(F=>R.jsx("option",{value:F,children:F},F))]})]}),R.jsxs("div",{children:[R.jsx("h4",{className:"font-medium",children:"Favorite Categories"}),R.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:cv.map(F=>R.jsx("button",{onClick:()=>oe(F),className:`px-3 py-1 text-sm rounded-full ${L.categories.includes(F)?"bg-red-600 text-white":"bg-gray-200"}`,children:F},F))})]}),R.jsx("button",{onClick:le,disabled:v,className:"w-full bg-green-600 text-white p-2 rounded hover:bg-green-700 disabled:bg-gray-400",children:v?"Saving...":"Save Profile"})]})]})})},ue=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},zA=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=qA},qA=Number.MAX_SAFE_INTEGER||9007199254740991;let ve=(function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s})({}),V=(function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s})({}),_=(function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s})({});var Pe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ge={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Vs{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class YA{constructor(e,t,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Vs(e),this.fast_=new Vs(t),this.defaultTTFB_=n,this.ttfb_=new Vs(e)}update(e,t){const{slow_:r,fast_:n,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Vs(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Vs(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Vs(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,n=e/1e3,i=r/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function QA(s,e,t){return(e=JA(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function $e(){return $e=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},$e.apply(null,arguments)}function _m(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function Ue(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_m(Object(t),!0).forEach(function(r){QA(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):_m(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function XA(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function JA(s){var e=XA(s,"string");return typeof e=="symbol"?e:e+""}class cr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=In,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const In=function(){},ZA={trace:In,debug:In,log:In,warn:In,info:In,error:In};function Ud(){return $e({},ZA)}function eb(s,e){const t=self.console[s];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${s}] >`):In}function wm(s,e,t){return e[s]?e[s].bind(e):eb(s,t)}const Bd=Ud();function tb(s,e,t){const r=Ud();if(typeof console=="object"&&s===!0||typeof s=="object"){const n=["debug","log","info","warn","error"];n.forEach(i=>{r[i]=wm(i,s,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.14`)}catch{return Ud()}n.forEach(i=>{Bd[i]=wm(i,s)})}else $e(Bd,r);return r}const Be=Bd;function Pn(s=!0){return typeof self>"u"?void 0:(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rb(s){return typeof self<"u"&&s===self.ManagedMediaSource}function dv(s,e){const t=Object.keys(s),r=Object.keys(e),n=t.length,i=r.length;return!n||!i||n===i&&!t.some(o=>r.indexOf(o)===-1)}function er(s,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(s);if(e){const f=d.indexOf("\0");return f!==-1?d.substring(0,f):d}return d.replace(/\0/g,"")}const t=s.length;let r,n,i,o="",u=0;for(;u<t;){if(r=s[u++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:n=s[u++],o+=String.fromCharCode((r&31)<<6|n&63);break;case 14:n=s[u++],i=s[u++],o+=String.fromCharCode((r&15)<<12|(n&63)<<6|(i&63)<<0);break}}return o}function Pt(s){let e="";for(let t=0;t<s.length;t++){let r=s[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function hv(s){return Uint8Array.from(s.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function nb(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Wc={exports:{}},Am;function sb(){return Am||(Am=1,(function(s,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(c,d,f){if(f=f||{},c=c.trim(),d=d.trim(),!d){if(!f.alwaysNormalize)return c;var g=u.parseURL(c);if(!g)throw new Error("Error trying to parse base URL.");return g.path=u.normalizePath(g.path),u.buildURLFromParts(g)}var m=u.parseURL(d);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=u.normalizePath(m.path),u.buildURLFromParts(m)):d;var y=u.parseURL(c);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=n.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var T={scheme:y.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(T.netLoc=y.netLoc,m.path[0]!=="/"))if(!m.path)T.path=y.path,m.params||(T.params=y.params,m.query||(T.query=y.query));else{var S=y.path,w=S.substring(0,S.lastIndexOf("/")+1)+m.path;T.path=u.normalizePath(w)}return T.path===null&&(T.path=f.alwaysNormalize?u.normalizePath(m.path):m.path),u.buildURLFromParts(T)},parseURL:function(c){var d=r.exec(c);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(i,"");c.length!==(c=c.replace(o,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};s.exports=u})()})(Wc)),Wc.exports}var ph=sb();class mh{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var je={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class fv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,ab(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let n;r.length===1?n=(t==null?void 0:t.byteRangeEndOffset)||0:n=parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[je.AUDIO]:null,[je.VIDEO]:null,[je.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new mh),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ph.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[je.AUDIO]=null,e[je.VIDEO]=null,e[je.AUDIOVIDEO]=null}}function lt(s){return s.sn!=="initSegment"}class zc extends fv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ue(e)&&ue(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const n=this._decryptdata=t[r[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ue(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),n=r.length;if(n>1||n===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ue(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return lt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const n=t[e];n&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,n,i,o=!1){const{elementaryStreams:u}=this,c=u[e];if(!c){u[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:o};return}c.startPTS=Math.min(c.startPTS,t),c.endPTS=Math.max(c.endPTS,r),c.startDTS=Math.min(c.startDTS,n),c.endDTS=Math.max(c.endDTS,i)}}class ib extends fv{constructor(e,t,r,n,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function gv(s,e){const t=Object.getPrototypeOf(s);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||gv(t,e)}}function ab(s,e){const t=gv(s,e);t&&(t.enumerable=!0,Object.defineProperty(s,e,t))}const bm=Math.pow(2,32)-1,ob=[].push,pv={video:1,audio:2,id3:3,text:4};function ht(s){return String.fromCharCode.apply(null,s)}function mv(s,e){const t=s[e]<<8|s[e+1];return t<0?65536+t:t}function Ie(s,e){const t=yv(s,e);return t<0?4294967296+t:t}function Im(s,e){let t=Ie(s,e);return t*=Math.pow(2,32),t+=Ie(s,e+4),t}function yv(s,e){return s[e]<<24|s[e+1]<<16|s[e+2]<<8|s[e+3]}function lb(s){const e=s.byteLength;for(let t=0;t<e;){const r=Ie(s,t);if(r>8&&s[t+4]===109&&s[t+5]===111&&s[t+6]===111&&s[t+7]===102)return!0;t=r>1?t+r:e}return!1}function ke(s,e){const t=[];if(!e.length)return t;const r=s.byteLength;for(let n=0;n<r;){const i=Ie(s,n),o=ht(s.subarray(n+4,n+8)),u=i>1?n+i:r;if(o===e[0])if(e.length===1)t.push(s.subarray(n+8,u));else{const c=ke(s.subarray(n+8,u),e.slice(1));c.length&&ob.apply(t,c)}n=u}return t}function ub(s){const e=[],t=s[0];let r=8;const n=Ie(s,r);r+=4;let i=0,o=0;t===0?(i=Ie(s,r),o=Ie(s,r+4),r+=8):(i=Im(s,r),o=Im(s,r+8),r+=16),r+=2;let u=s.length+o;const c=mv(s,r);r+=2;for(let d=0;d<c;d++){let f=r;const g=Ie(s,f);f+=4;const m=g&2147483647;if((g&2147483648)>>>31===1)return Be.warn("SIDX has hierarchical references (not supported)"),null;const v=Ie(s,f);f+=4,e.push({referenceSize:m,subsegmentDuration:v,info:{duration:v/n,start:u,end:u+m-1}}),u+=m,f+=4,r=f}return{earliestPresentationTime:i,timescale:n,version:t,referencesCount:c,references:e}}function vv(s){const e=[],t=ke(s,["moov","trak"]);for(let n=0;n<t.length;n++){const i=t[n],o=ke(i,["tkhd"])[0];if(o){let u=o[0];const c=Ie(o,u===0?12:20),d=ke(i,["mdia","mdhd"])[0];if(d){u=d[0];const f=Ie(d,u===0?12:20),g=ke(i,["mdia","hdlr"])[0];if(g){const m=ht(g.subarray(8,12)),y={soun:je.AUDIO,vide:je.VIDEO}[m],v=ke(i,["mdia","minf","stbl","stsd"])[0],T=cb(v);y?(e[c]={timescale:f,type:y,stsd:T},e[y]=Ue({timescale:f,id:c},T)):e[c]={timescale:f,type:m,stsd:T}}}}}return ke(s,["moov","mvex","trex"]).forEach(n=>{const i=Ie(n,4),o=e[i];o&&(o.default={duration:Ie(n,12),flags:Ie(n,20)})}),e}function cb(s){const e=s.subarray(8),t=e.subarray(86),r=ht(e.subarray(4,8));let n=r,i;const o=r==="enca"||r==="encv";if(o){const d=ke(e,[r])[0].subarray(r==="enca"?28:78);ke(d,["sinf"]).forEach(g=>{const m=ke(g,["schm"])[0];if(m){const y=ht(m.subarray(4,8));if(y==="cbcs"||y==="cenc"){const v=ke(g,["frma"])[0];v&&(n=ht(v))}}})}const u=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const c=ke(t,["avcC"])[0];c&&c.length>3&&(n+="."+jo(c[1])+jo(c[2])+jo(c[3]),i=$o(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const c=ke(e,[r])[0],d=ke(c.subarray(28),["esds"])[0];if(d&&d.length>7){let f=4;if(d[f++]!==3)break;f=qc(d,f),f+=2;const g=d[f++];if(g&128&&(f+=2),g&64&&(f+=d[f++]),d[f++]!==4)break;f=qc(d,f);const m=d[f++];if(m===64)n+="."+jo(m);else break;if(f+=12,d[f++]!==5)break;f=qc(d,f);const y=d[f++];let v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((d[f]&224)>>5)),n+="."+v}break}case"hvc1":case"hev1":{const c=ke(t,["hvcC"])[0];if(c&&c.length>12){const d=c[1],f=["","A","B","C"][d>>6],g=d&31,m=Ie(c,2),y=(d&32)>>5?"H":"L",v=c[12],T=c.subarray(6,12);n+="."+f+g,n+="."+db(m).toString(16).toUpperCase(),n+="."+y+v;let S="";for(let w=T.length;w--;){const b=T[w];(b||S)&&(S="."+b.toString(16).toUpperCase()+S)}n+=S}i=$o(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=$o(n,t)||n;break}case"vp09":{const c=ke(t,["vpcC"])[0];if(c&&c.length>6){const d=c[4],f=c[5],g=c[6]>>4&15;n+="."+Dr(d)+"."+Dr(f)+"."+Dr(g)}break}case"av01":{const c=ke(t,["av1C"])[0];if(c&&c.length>2){const d=c[1]>>>5,f=c[1]&31,g=c[2]>>>7?"H":"M",m=(c[2]&64)>>6,y=(c[2]&32)>>5,v=d===2&&m?y?12:10:m?10:8,T=(c[2]&16)>>4,S=(c[2]&8)>>3,w=(c[2]&4)>>2,b=c[2]&3;n+="."+d+"."+Dr(f)+g+"."+Dr(v)+"."+T+"."+S+w+b+"."+Dr(1)+"."+Dr(1)+"."+Dr(1)+"."+0,i=$o("dav1",t)}break}}return{codec:n,encrypted:o,supplemental:i}}function $o(s,e){const t=ke(e,["dvvC"]),r=t.length?t[0]:ke(e,["dvcC"])[0];if(r){const n=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return s+"."+Dr(n)+"."+Dr(i)}}function db(s){let e=0;for(let t=0;t<32;t++)e|=(s>>t&1)<<31-t;return e>>>0}function qc(s,e){const t=e+5;for(;s[e++]&128&&e<t;);return e}function jo(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Dr(s){return(s<10?"0":"")+s}function hb(s,e){if(!s||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Ev(s,(r,n)=>{const i=r.subarray(8,24);i.some(o=>o!==0)||(Be.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${Pt(i)} -> ${Pt(t)}`),r.set(t,8))})}function fb(s){const e=[];return Ev(s,t=>e.push(t.subarray(8,24))),e}function Ev(s,e){ke(s,["moov","trak"]).forEach(r=>{const n=ke(r,["mdia","minf","stbl","stsd"])[0];if(!n)return;const i=n.subarray(8);let o=ke(i,["enca"]);const u=o.length>0;u||(o=ke(i,["encv"])),o.forEach(c=>{const d=u?c.subarray(28):c.subarray(78);ke(d,["sinf"]).forEach(g=>{const m=Sv(g);m&&e(m,u)})})})}function Sv(s){const e=ke(s,["schm"])[0];if(e){const t=ht(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=ke(s,["schi","tenc"])[0];if(r)return r}}}function gb(s,e,t){const r={},n=ke(s,["moof","traf"]);for(let i=0;i<n.length;i++){const o=n[i],u=ke(o,["tfhd"])[0],c=Ie(u,4),d=e[c];if(!d)continue;r[c]||(r[c]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const f=r[c],g=ke(o,["tfdt"])[0];if(g){const A=g[0];let L=Ie(g,4);A===1&&(L===bm?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(L*=bm+1,L+=Ie(g,8))),ue(L)&&(!ue(f.start)||L<f.start)&&(f.start=L)}const m=d.default,y=Ie(u,0)|(m==null?void 0:m.flags);let v=(m==null?void 0:m.duration)||0;y&8&&(y&2?v=Ie(u,12):v=Ie(u,8));const T=ke(o,["trun"]);let S=f.start||0,w=0,b=v;for(let A=0;A<T.length;A++){const L=T[A],k=Ie(L,4),O=f.sampleCount;f.sampleCount+=k;const P=L[3]&1,$=L[3]&4,B=L[2]&1,U=L[2]&2,q=L[2]&4,re=L[2]&8;let ae=8,le=k;for(P&&(ae+=4),$&&k&&(!(L[ae+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=O),ae+=4,B?(b=Ie(L,ae),ae+=4):b=v,U&&(ae+=4),re&&(ae+=4),S+=b,w+=b,le--);le--;)B?(b=Ie(L,ae),ae+=4):b=v,U&&(ae+=4),q&&(L[ae+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(le+1),f.keyFrameStart=S),ae+=4),re&&(ae+=4),S+=b,w+=b;!w&&v&&(w+=v*k)}f.duration+=w}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,o=0;const u=ke(s,["sidx"]);for(let c=0;c<u.length;c++){const d=ub(u[c]);if(d!=null&&d.references){i=Math.min(i,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((g,m)=>g+m.info.duration||0,0);o=Math.max(o,f+d.earliestPresentationTime/d.timescale)}}o&&ue(o)&&Object.keys(r).forEach(c=>{r[c].duration||(r[c].duration=o*r[c].timescale-r[c].start)})}return r}function pb(s){const e={valid:null,remainder:null},t=ke(s,["moof"]);if(t.length<2)return e.remainder=s,e;const r=t[t.length-1];return e.valid=s.slice(0,r.byteOffset-8),e.remainder=s.slice(r.byteOffset-8),e}function ur(s,e){const t=new Uint8Array(s.length+e.length);return t.set(s),t.set(e,s.length),t}function Rm(s,e){const t=[],r=e.samples,n=e.timescale,i=e.id;let o=!1;return ke(r,["moof"]).map(c=>{const d=c.byteOffset-8;ke(c,["traf"]).map(g=>{const m=ke(g,["tfdt"]).map(y=>{const v=y[0];let T=Ie(y,4);return v===1&&(T*=Math.pow(2,32),T+=Ie(y,8)),T/n})[0];return m!==void 0&&(s=m),ke(g,["tfhd"]).map(y=>{const v=Ie(y,4),T=Ie(y,0)&16777215,S=(T&1)!==0,w=(T&2)!==0,b=(T&8)!==0;let A=0;const L=(T&16)!==0;let k=0;const O=(T&32)!==0;let P=8;v===i&&(S&&(P+=8),w&&(P+=4),b&&(A=Ie(y,P),P+=4),L&&(k=Ie(y,P),P+=4),O&&(P+=4),e.type==="video"&&(o=Nl(e.codec)),ke(g,["trun"]).map($=>{const B=$[0],U=Ie($,0)&16777215,q=(U&1)!==0;let re=0;const ae=(U&4)!==0,le=(U&256)!==0;let oe=0;const J=(U&512)!==0;let se=0;const F=(U&1024)!==0,Y=(U&2048)!==0;let Q=0;const C=Ie($,4);let N=8;q&&(re=Ie($,N),N+=4),ae&&(N+=4);let te=re+d;for(let ce=0;ce<C;ce++){if(le?(oe=Ie($,N),N+=4):oe=A,J?(se=Ie($,N),N+=4):se=k,F&&(N+=4),Y&&(B===0?Q=Ie($,N):Q=yv($,N),N+=4),e.type===je.VIDEO){let de=0;for(;de<se;){const fe=Ie(r,te);if(te+=4,mb(o,r[te])){const Le=r.subarray(te,te+fe);yh(Le,o?2:1,s+Q/n,t)}te+=fe,de+=fe+4}}s+=oe/n}}))})})}),t}function Nl(s){if(!s)return!1;const e=s.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function mb(s,e){if(s){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function yh(s,e,t,r){const n=Tv(s);let i=0;i+=e;let o=0,u=0,c=0;for(;i<n.length;){o=0;do{if(i>=n.length)break;c=n[i++],o+=c}while(c===255);u=0;do{if(i>=n.length)break;c=n[i++],u+=c}while(c===255);const d=n.length-i;let f=i;if(u<d)i+=u;else if(u>d){Be.error(`Malformed SEI payload. ${u} is too small, only ${d} bytes left to parse.`);break}if(o===4){if(n[f++]===181){const m=mv(n,f);if(f+=2,m===49){const y=Ie(n,f);if(f+=4,y===1195456820){const v=n[f++];if(v===3){const T=n[f++],S=31&T,w=64&T,b=w?2+S*3:0,A=new Uint8Array(b);if(w){A[0]=T;for(let L=1;L<b;L++)A[L]=n[f++]}r.push({type:v,payloadType:o,pts:t,bytes:A})}}}}}else if(o===5&&u>16){const g=[];for(let v=0;v<16;v++){const T=n[f++].toString(16);g.push(T.length==1?"0"+T:T),(v===3||v===5||v===7||v===9)&&g.push("-")}const m=u-16,y=new Uint8Array(m);for(let v=0;v<m;v++)y[v]=n[f++];r.push({payloadType:o,pts:t,uuid:g.join(""),userData:er(y),userDataBytes:y})}}}function Tv(s){const e=s.byteLength,t=[];let r=1;for(;r<e-2;)s[r]===0&&s[r+1]===0&&s[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return s;const n=e-t.length,i=new Uint8Array(n);let o=0;for(r=0;r<n;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=s[o];return i}function yb(s){const e=s[0];let t="",r="",n=0,i=0,o=0,u=0,c=0,d=0;if(e===0){for(;ht(s.subarray(d,d+1))!=="\0";)t+=ht(s.subarray(d,d+1)),d+=1;for(t+=ht(s.subarray(d,d+1)),d+=1;ht(s.subarray(d,d+1))!=="\0";)r+=ht(s.subarray(d,d+1)),d+=1;r+=ht(s.subarray(d,d+1)),d+=1,n=Ie(s,12),i=Ie(s,16),u=Ie(s,20),c=Ie(s,24),d=28}else if(e===1){d+=4,n=Ie(s,d),d+=4;const g=Ie(s,d);d+=4;const m=Ie(s,d);for(d+=4,o=2**32*g+m,zA(o)||(o=Number.MAX_SAFE_INTEGER,Be.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Ie(s,d),d+=4,c=Ie(s,d),d+=4;ht(s.subarray(d,d+1))!=="\0";)t+=ht(s.subarray(d,d+1)),d+=1;for(t+=ht(s.subarray(d,d+1)),d+=1;ht(s.subarray(d,d+1))!=="\0";)r+=ht(s.subarray(d,d+1)),d+=1;r+=ht(s.subarray(d,d+1)),d+=1}const f=s.subarray(d,s.byteLength);return{schemeIdUri:t,value:r,timeScale:n,presentationTime:o,presentationTimeDelta:i,eventDuration:u,id:c,payload:f}}function vb(s,...e){const t=e.length;let r=8,n=t;for(;n--;)r+=e[n].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(s,4),n=0,r=8;n<t;n++)i.set(e[n],r),r+=e[n].byteLength;return i}function Eb(s,e,t){if(s.byteLength!==16)throw new RangeError("Invalid system id");let r,n;r=0,n=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),vb([112,115,115,104],new Uint8Array([r,0,0,0]),s,i,n,o,t)}function Sb(s){const e=[];if(s instanceof ArrayBuffer){const t=s.byteLength;let r=0;for(;r+32<t;){const n=new DataView(s,r),i=Tb(n);e.push(i),r+=i.size}}return e}function Tb(s){const e=s.getUint32(0),t=s.byteOffset,r=s.byteLength;if(r<e)return{offset:t,size:r};if(s.getUint32(4)!==1886614376)return{offset:t,size:e};const i=s.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=s.buffer,u=Pt(new Uint8Array(o,t+12,16));let c=null,d=null,f=0;if(i===0)f=28;else{const m=s.getUint32(28);if(!m||r<32+m*16)return{offset:t,size:e};c=[];for(let y=0;y<m;y++)c.push(new Uint8Array(o,t+32+y*16,16));f=32+m*16}if(!f)return{offset:t,size:e};const g=s.getUint32(f);return e-32<g?{offset:t,size:e}:(d=new Uint8Array(o,t+f+4,g),{version:i,systemId:u,kids:c,data:d,offset:t,size:e})}const xv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ai={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function vh(s,e){const t=ai[e];return!!t&&!!t[s.slice(0,4)]}function ha(s,e,t=!0){return!s.split(",").some(r=>!Eh(r,e,t))}function Eh(s,e,t=!0){var r;const n=Pn(t);return(r=n==null?void 0:n.isTypeSupported(fa(s,e)))!=null?r:!1}function fa(s,e){return`${e}/mp4;codecs=${s}`}function Lm(s){if(s){const e=s.substring(0,4);return ai.video[e]}return 2}function yl(s){const e=xv();return s.split(",").reduce((t,r)=>{const i=e&&Nl(r)?9:ai.video[r];return i?(i*2+t)/(t?3:2):(ai.audio[r]+t)/(t?2:1)},0)}const Yc={};function xb(s,e=!0){if(Yc[s])return Yc[s];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[s];for(let n=0;n<t.length;n++){var r;if(Eh(t[n],"audio",e))return Yc[s]=t[n],t[n];if(t[n]==="mp3"&&(r=Pn(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return s}const _b=/flac|opus|mp4a\.40\.34/i;function vl(s,e=!0){return s.replace(_b,t=>xb(t.toLowerCase(),e))}function wb(s,e){const t=[];if(s){const r=s.split(",");for(let n=0;n<r.length;n++)vh(r[n],"video")||t.push(r[n])}return e&&t.push(e),t.join(",")}function rl(s,e){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1)&&(km(s,"audio")||km(s,"video")))return s;if(e){const t=e.split(",");if(t.length>1){if(s){for(let r=t.length;r--;)if(t[r].substring(0,4)===s.substring(0,4))return t[r]}return t[0]}}return e||s}function km(s,e){return vh(s,e)&&Eh(s,e)}function Ab(s){const e=s.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function bb(s){if(s.startsWith("av01.")){const e=s.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return s}function Cm(s){const e=Pn(s)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function $d(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Ib={supported:!0,powerEfficient:!0,smooth:!0},Rb={supported:!1,smooth:!1,powerEfficient:!1},_v={supported:!0,configurations:[],decodingInfoResults:[Ib]};function wv(s,e){return{supported:!1,configurations:e,decodingInfoResults:[Rb],error:s}}function Lb(s,e,t,r,n,i){const o=s.videoCodec,u=s.audioCodec?s.audioGroups:null,c=i==null?void 0:i.audioCodec,d=i==null?void 0:i.channels,f=d?parseInt(d):c?1/0:2;let g=null;if(u!=null&&u.length)try{u.length===1&&u[0]?g=e.groups[u[0]].channels:g=u.reduce((m,y)=>{if(y){const v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(T=>{m[T]=(m[T]||0)+v.channels[T]})}return m},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(m=>Nl(m))||s.width>1920&&s.height>1088||s.height>1920&&s.width>1088||s.frameRate>Math.max(r,30)||s.videoRange!=="SDR"&&s.videoRange!==t||s.bitrate>Math.max(n,8e6))||!!g&&ue(f)&&Object.keys(g).some(m=>parseInt(m)>f)}function Av(s,e,t,r={}){const n=s.videoCodec;if(!n&&!s.audioCodec||!t)return Promise.resolve(_v);const i=[],o=kb(s),u=o.length,c=Cb(s,e,u>0),d=c.length;for(let f=u||1*d||1;f--;){const g={type:"media-source"};if(u&&(g.video=o[f%u]),d){g.audio=c[f%d];const m=g.audio.bitrate;g.video&&m&&(g.video.bitrate-=m)}i.push(g)}if(n){const f=navigator.userAgent;if(n.split(",").some(g=>Nl(g))&&xv())return Promise.resolve(wv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),i))}return Promise.all(i.map(f=>{const g=Db(f);return r[g]||(r[g]=t.decodingInfo(f))})).then(f=>({supported:!f.some(g=>!g.supported),configurations:i,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:i,decodingInfoResults:[],error:f}))}function kb(s){var e;const t=(e=s.videoCodec)==null?void 0:e.split(","),r=bv(s),n=s.width||640,i=s.height||480,o=s.frameRate||30,u=s.videoRange.toLowerCase();return t?t.map(c=>{const d={contentType:fa(bb(c),"video"),width:n,height:i,bitrate:r,framerate:o};return u!=="sdr"&&(d.transferFunction=u),d}):[]}function Cb(s,e,t){var r;const n=(r=s.audioCodec)==null?void 0:r.split(","),i=bv(s);return n&&s.audioGroups?s.audioGroups.reduce((o,u)=>{var c;const d=u?(c=e.groups[u])==null?void 0:c.tracks:null;return d?d.reduce((f,g)=>{if(g.groupId===u){const m=parseFloat(g.channels||"");n.forEach(y=>{const v={contentType:fa(y,"audio"),bitrate:t?Pb(y,i):i};m&&(v.channels=""+m),f.push(v)})}return f},o):o},[]):[]}function Pb(s,e){if(e<=1)return 1;let t=128e3;return s==="ec-3"?t=768e3:s==="ac-3"&&(t=64e4),Math.min(e/2,t)}function bv(s){return Math.ceil(Math.max(s.bitrate*.9,s.averageBitrate)/1e3)*1e3||1}function Db(s){let e="";const{audio:t,video:r}=s;if(r){const n=$d(r.contentType);e+=`${n}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const n=$d(t.contentType);e+=`${r?"_":""}${n}_c${t.channels}`}return e}const jd=["NONE","TYPE-0","TYPE-1",null];function Ob(s){return jd.indexOf(s)>-1}const El=["SDR","PQ","HLG"];function Nb(s){return!!s&&El.indexOf(s)>-1}var nl={No:"",Yes:"YES",v2:"v2"};function Pm(s){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=s,n=r<e/2;return e&&n?t?nl.v2:nl.Yes:nl.No}class Dm{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class ga{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Om(this._audioGroups,e)}hasSubtitleGroup(e){return Om(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Om(s,e){return!e||!s?!1:s.indexOf(e)!==-1}function Mb(){if(typeof matchMedia=="function"){const s=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(s.media!==e.media)return s.matches===!0}return!1}function Fb(s,e){let t=!1,r=[];if(s&&(t=s!=="SDR",r=[s]),e){r=e.allowedVideoRanges||El.slice(0);const n=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&Mb(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const Ub=s=>{const e=new WeakSet;return(t,r)=>{if(s&&(r=s(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Ge=(s,e)=>JSON.stringify(s,Ub(e));function Bb(s,e,t,r,n){const i=Object.keys(s),o=r==null?void 0:r.channels,u=r==null?void 0:r.audioCodec,c=n==null?void 0:n.videoCodec,d=o&&parseInt(o)===2;let f=!1,g=!1,m=1/0,y=1/0,v=1/0,T=1/0,S=0,w=[];const{preferHDR:b,allowedVideoRanges:A}=Fb(e,n);for(let $=i.length;$--;){const B=s[i[$]];f||(f=B.channels[2]>0),m=Math.min(m,B.minHeight),y=Math.min(y,B.minFramerate),v=Math.min(v,B.minBitrate),A.filter(q=>B.videoRanges[q]>0).length>0&&(g=!0)}m=ue(m)?m:0,y=ue(y)?y:0;const L=Math.max(1080,m),k=Math.max(30,y);v=ue(v)?v:t,t=Math.max(v,t),g||(e=void 0);const O=i.length>1;return{codecSet:i.reduce(($,B)=>{const U=s[B];if(B===$)return $;if(w=g?A.filter(q=>U.videoRanges[q]>0):[],O){if(U.minBitrate>t)return Cr(B,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),$;if(!U.hasDefaultAudio)return Cr(B,"no renditions with default or auto-select sound found"),$;if(u&&B.indexOf(u.substring(0,4))%5!==0)return Cr(B,`audio codec preference "${u}" not found`),$;if(o&&!d){if(!U.channels[o])return Cr(B,`no renditions with ${o} channel sound found (channels options: ${Object.keys(U.channels)})`),$}else if((!u||d)&&f&&U.channels[2]===0)return Cr(B,"no renditions with stereo sound found"),$;if(U.minHeight>L)return Cr(B,`min resolution of ${U.minHeight} > maximum of ${L}`),$;if(U.minFramerate>k)return Cr(B,`min framerate of ${U.minFramerate} > maximum of ${k}`),$;if(!w.some(q=>U.videoRanges[q]>0))return Cr(B,`no variants with VIDEO-RANGE of ${Ge(w)} found`),$;if(c&&B.indexOf(c.substring(0,4))%5!==0)return Cr(B,`video codec preference "${c}" not found`),$;if(U.maxScore<S)return Cr(B,`max score of ${U.maxScore} < selected max of ${S}`),$}return $&&(yl(B)>=yl($)||U.fragmentError>s[$].fragmentError)?$:(T=U.minIndex,S=U.maxScore,B)},void 0),videoRanges:w,preferHDR:b,minFramerate:y,minBitrate:v,minIndex:T}}function Cr(s,e){Be.log(`[abr] start candidates with "${s}" ignored because ${e}`)}function Iv(s){return s.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const n=t.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function $b(s,e,t,r){return s.slice(t,r+1).reduce((n,i,o)=>{if(!i.codecSet)return n;const u=i.audioGroups;let c=n[i.codecSet];c||(n[i.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,i.bitrate);const d=Math.min(i.height,i.width);return c.minHeight=Math.min(c.minHeight,d),c.minFramerate=Math.min(c.minFramerate,i.frameRate),c.minIndex=Math.min(c.minIndex,o),c.maxScore=Math.max(c.maxScore,i.score),c.fragmentError+=i.fragmentError,c.videoRanges[i.videoRange]=(c.videoRanges[i.videoRange]||0)+1,u&&u.forEach(f=>{if(!f)return;const g=e.groups[f];g&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(m=>{c.channels[m]=(c.channels[m]||0)+g.channels[m]}))}),n},{})}function Nm(s){if(!s)return s;const{lang:e,assocLang:t,characteristics:r,channels:n,audioCodec:i}=s;return{lang:e,assocLang:t,characteristics:r,channels:n,audioCodec:i}}function Mr(s,e,t){if("attrs"in s){const r=e.indexOf(s);if(r!==-1)return r}for(let r=0;r<e.length;r++){const n=e[r];if(ls(s,n,t))return r}return-1}function ls(s,e,t){const{groupId:r,name:n,lang:i,assocLang:o,default:u}=s,c=s.forced;return(r===void 0||e.groupId===r)&&(n===void 0||e.name===n)&&(i===void 0||jb(i,e.lang))&&(i===void 0||e.assocLang===o)&&(u===void 0||e.default===u)&&(c===void 0||e.forced===c)&&(!("characteristics"in s)||Gb(s.characteristics||"",e.characteristics))&&(t===void 0||t(s,e))}function jb(s,e="--"){return s.length===e.length?s===e:s.startsWith(e)||e.startsWith(s)}function Gb(s,e=""){const t=s.split(","),r=e.split(",");return t.length===r.length&&!t.some(n=>r.indexOf(n)===-1)}function rs(s,e){const{audioCodec:t,channels:r}=s;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function Vb(s,e,t,r,n){const i=e[r],u=e.reduce((m,y,v)=>{const T=y.uri;return(m[T]||(m[T]=[])).push(v),m},{})[i.uri];u.length>1&&(r=Math.max.apply(Math,u));const c=i.videoRange,d=i.frameRate,f=i.codecSet.substring(0,4),g=Mm(e,r,m=>{if(m.videoRange!==c||m.frameRate!==d||m.codecSet.substring(0,4)!==f)return!1;const y=m.audioGroups,v=t.filter(T=>!y||y.indexOf(T.groupId)!==-1);return Mr(s,v,n)>-1});return g>-1?g:Mm(e,r,m=>{const y=m.audioGroups,v=t.filter(T=>!y||y.indexOf(T.groupId)!==-1);return Mr(s,v,n)>-1})}function Mm(s,e,t){for(let r=e;r>-1;r--)if(t(s[r]))return r;for(let r=e+1;r<s.length;r++)if(t(s[r]))return r;return-1}function Sl(s,e){var t;return!!s&&s!==((t=e.loadLevelObj)==null?void 0:t.uri)}class Kb extends cr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:n,partCurrent:i,hls:o}=this,{autoLevelEnabled:u,media:c}=o;if(!n||!c)return;const d=performance.now(),f=i?i.stats:n.stats,g=i?i.duration:n.duration,m=d-f.loading.start,y=o.minAutoLevel,v=n.level,T=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=T>-1&&T!==v,w=!!t||S;if(!w&&(c.paused||!c.playbackRate||!c.readyState))return;const b=o.mainForwardBufferInfo;if(!w&&b===null)return;const A=this.bwEstimator.getEstimateTTFB(),L=Math.abs(c.playbackRate);if(m<=Math.max(A,1e3*(g/(L*2))))return;const k=b?b.len/L:0,O=f.loading.first?f.loading.first-f.loading.start:-1,P=f.loaded&&O>-1,$=this.getBwEstimate(),B=o.levels,U=B[v],q=Math.max(f.loaded,Math.round(g*(n.bitrate||U.averageBitrate)/8));let re=P?m-O:m;re<1&&P&&(re=Math.min(m,f.loaded*8/$));const ae=P?f.loaded*1e3/re:0,le=A/1e3,oe=ae?(q-f.loaded)/ae:q*8/$+le;if(oe<=k)return;const J=ae?ae*8:$,se=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,F=this.hls.config.abrBandWidthUpFactor;let Y=Number.POSITIVE_INFINITY,Q;for(Q=v-1;Q>y;Q--){const ce=B[Q].maxBitrate,de=!B[Q].details||se;if(Y=this.getTimeToLoadFrag(le,J,g*ce,de),Y<Math.min(k,g+le))break}if(Y>=oe||Y>g*10)return;P?this.bwEstimator.sample(m-Math.min(A,O),f.loaded):this.bwEstimator.sampleTTFB(m);const C=B[Q].maxBitrate;this.getBwEstimate()*F>C&&this.resetEstimator(C);const N=this.findBestLevel(C,y,Q,0,k,1,1);N>-1&&(Q=N),this.warn(`Fragment ${n.sn}${i?" part "+i.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${oe.toFixed(3)} s
      Estimated load time for down switch fragment: ${Y.toFixed(3)} s
      TTFB estimate: ${O|0} ms
      Current BW estimate: ${ue($)?$|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Q} @ ${C|0} bps`),o.nextLoadLevel=o.nextAutoLevel=Q,this.clearTimer();const te=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===Q&&Q>0){const ce=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Q>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${ce.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,Q>y){let de=this.findBestLevel(this.hls.levels[y].bitrate,y,Q,0,ce,1,1);de===-1&&(de=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=de,this.resetEstimator(this.hls.levels[de].bitrate)}}};S||oe>Y*2?te():this.timer=self.setInterval(te,Y*1e3),o.trigger(_.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:i,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new YA(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(_.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var n;this.fragCurrent=r,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case V.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:n,partCurrent:i}=this;if(r&&n&&r.sn===n.sn&&r.level===n.level){const o=performance.now(),u=i?i.stats:r.stats,c=o-u.loading.start,d=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&d>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(c-Math.min(g,d),u.loaded)}else this.bwEstimator.sampleTTFB(c)}break}}}getTimeToLoadFrag(e,t,r,n){const i=e+r/t,o=n?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:n}=t.stats,i=n.end-n.first;ue(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const n=r?r.stats:t.stats;if(t.type===ge.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+n.loaded,c=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:u,duration:c},o.realBitrate=Math.round(8*u/c)}if(t.bitrateTest){const i={stats:n,frag:t,part:r,id:t.type};this.onFragBuffered(_.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:n}=t,i=n!=null&&n.stats.loaded?n.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ge.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,n,1,1);if(i>-1)return i;const o=this.hls.firstLevel,u=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:n,config:i,minAutoLevel:o}=r,u=t?t.duration:e?e.duration:0,c=this.getBwEstimate(),d=this.getStarvationDelay();let f=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(d){const S=this.findBestLevel(c,o,n,d,0,f,g);if(S>=0)return this.rebufferNotice=-1,S}let m=u?Math.min(u,i.maxStarvationDelay):i.maxStarvationDelay;if(!d){const S=this.bitrateTestDelay;S&&(m=(u?Math.min(u,i.maxLoadingDelay):i.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=g=1)}const y=this.findBestLevel(c,o,n,d,m,f,g);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const v=r.levels[o],T=r.loadLevelObj;return T&&(v==null?void 0:v.bitrate)<T.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,n,i,o,u){var c;const d=n+i,f=this.lastLoadedFragLevel,g=f===-1?this.hls.firstLevel:f,{fragCurrent:m,partCurrent:y}=this,{levels:v,allAudioTracks:T,loadLevel:S,config:w}=this.hls;if(v.length===1)return 0;const b=v[g],A=!!((c=this.hls.latestLevelDetails)!=null&&c.live),L=S===-1||f===-1;let k,O="SDR",P=(b==null?void 0:b.frameRate)||0;const{audioPreference:$,videoPreference:B}=w,U=this.audioTracksByGroup||(this.audioTracksByGroup=Iv(T));let q=-1;if(L){if(this.firstSelection!==-1)return this.firstSelection;const J=this.codecTiers||(this.codecTiers=$b(v,U,t,r)),se=Bb(J,O,e,$,B),{codecSet:F,videoRanges:Y,minFramerate:Q,minBitrate:C,minIndex:N,preferHDR:te}=se;q=N,k=F,O=te?Y[Y.length-1]:Y[0],P=Q,e=Math.max(e,C),this.log(`picked start tier ${Ge(se)}`)}else k=b==null?void 0:b.codecSet,O=b==null?void 0:b.videoRange;const re=y?y.duration:m?m.duration:0,ae=this.bwEstimator.getEstimateTTFB()/1e3,le=[];for(let J=r;J>=t;J--){var oe;const se=v[J],F=J>g;if(!se)continue;if(w.useMediaCapabilities&&!se.supportedResult&&!se.supportedPromise){const de=navigator.mediaCapabilities;typeof(de==null?void 0:de.decodingInfo)=="function"&&Lb(se,U,O,P,e,$)?(se.supportedPromise=Av(se,U,de,this.supportedCache),se.supportedPromise.then(fe=>{if(!this.hls)return;se.supportedResult=fe;const Le=this.hls.levels,Ae=Le.indexOf(se);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${Ae} ${Ge(fe)}`):fe.supported?fe.decodingInfoResults.some(De=>De.smooth===!1||De.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ae} not smooth or powerEfficient: ${Ge(fe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${Ge(fe)}`),Ae>-1&&Le.length>1&&(this.log(`Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(fe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${fe}`)})):se.supportedResult=_v}if((k&&se.codecSet!==k||O&&se.videoRange!==O||F&&P>se.frameRate||!F&&P>0&&P<se.frameRate||(oe=se.supportedResult)!=null&&(oe=oe.decodingInfoResults)!=null&&oe.some(de=>de.smooth===!1))&&(!L||J!==q)){le.push(J);continue}const Y=se.details,Q=(y?Y==null?void 0:Y.partTarget:Y==null?void 0:Y.averagetargetduration)||re;let C;F?C=u*e:C=o*e;const N=re&&n>=re*2&&i===0?se.averageBitrate:se.maxBitrate,te=this.getTimeToLoadFrag(ae,C,N*Q,Y===void 0);if(C>=N&&(J===f||se.loadError===0&&se.fragmentError===0)&&(te<=ae||!ue(te)||A&&!this.bitrateTestDelay||te<d)){const de=this.forcedAutoLevel;return J!==S&&(de===-1||de!==S)&&(le.length&&this.trace(`Skipped level(s) ${le.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${v[le[0]].codecs}" ${v[le[0]].videoRange}; not compatible with "${k}" ${O}`),this.info(`switch candidate:${g}->${J} adjustedbw(${Math.round(C)})-bitrate=${Math.round(C-N)} ttfb:${ae.toFixed(1)} avgDuration:${Q.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${te.toFixed(1)} firstSelection:${L} codecSet:${se.codecSet} videoRange:${se.videoRange} hls.loadLevel:${S}`)),L&&(this.firstSelection=J),J}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const Rv={search:function(s,e){let t=0,r=s.length-1,n=null,i=null;for(;t<=r;){n=(t+r)/2|0,i=s[n];const o=e(i);if(o>0)t=n+1;else if(o<0)r=n-1;else return i}return null}};function Hb(s,e,t){if(e===null||!Array.isArray(s)||!s.length||!ue(e))return null;const r=s[0].programDateTime;if(e<(r||0))return null;const n=s[s.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let i=0;i<s.length;++i){const o=s[i];if(zb(e,t,o))return o}return null}function cs(s,e,t=0,r=0,n=.005){let i=null;if(s){i=e[1+s.sn-e[0].sn]||null;const u=s.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),i&&s.level!==i.level&&i.end<=s.end&&(i=e[2+s.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!s||s.level===i.level)&&Fm(t,r,i)===0||Wb(i,s,Math.min(n,r))))return i;const o=Rv.search(e,Fm.bind(null,t,r));return o&&(o!==s||!i)?o:i}function Wb(s,e,t){if(e&&e.start===0&&e.level<s.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((n,i)=>(i[0]==="INF"&&(n+=parseFloat(i[1])),n),t);return s.start<=r}return!1}function Fm(s=0,e=0,t){if(t.start<=s&&t.start+t.duration>s)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=s?1:t.start-r>s&&t.start?-1:0}function zb(s,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>s}function Lv(s,e,t){if(s&&s.startCC<=e&&s.endCC>=e){let r=s.fragments;const{fragmentHint:n}=s;n&&(r=r.concat(n));let i;return Rv.search(r,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function Tl(s){switch(s.details){case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_TIMEOUT:case V.LEVEL_LOAD_TIMEOUT:case V.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function kv(s){return s.details.startsWith("key")}function Cv(s){return kv(s)&&!!s.frag&&!s.frag.decryptdata}function Um(s,e){const t=Tl(e);return s.default[`${t?"timeout":"error"}Retry`]}function Sh(s,e){const t=s.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*s.retryDelayMs,s.maxRetryDelayMs)}function Bm(s){return Ue(Ue({},s),{errorRetry:null,timeoutRetry:null})}function xl(s,e,t,r){if(!s)return!1;const n=r==null?void 0:r.code,i=e<s.maxNumRetry&&(qb(n)||!!t);return s.shouldRetry?s.shouldRetry(s,e,t,r,i):i}function qb(s){return Gd(s)||!!s&&(s<400||s>499)}function Gd(s){return s===0&&navigator.onLine===!1}var xt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},qt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class Yb extends cr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(_.ERROR,this.onError,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(_.ERROR,this.onError,this),e.off(_.ERROR,this.onErrorOut,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ge.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(o=>n.indexOf(o.groupId)>=0).some(o=>{var u;return(u=o.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const n=this.hls,i=t.context;switch(t.details){case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case V.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=ei();return}case V.FRAG_GAP:case V.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=xt.SendAlternateToPenaltyBox;return}case V.LEVEL_EMPTY_ERROR:case V.LEVEL_PARSING_ERROR:{var o;const c=t.parent===ge.MAIN?t.level:n.loadLevel;t.details===V.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case V.LEVEL_LOAD_ERROR:case V.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case V.AUDIO_TRACK_LOAD_ERROR:case V.AUDIO_TRACK_LOAD_TIMEOUT:case V.SUBTITLE_LOAD_ERROR:case V.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const c=n.loadLevelObj;if(c&&(i.type===Pe.AUDIO_TRACK&&c.hasAudioGroup(i.groupId)||i.type===Pe.SUBTITLE_TRACK&&c.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=xt.SendAlternateToPenaltyBox,t.errorAction.flags=qt.MoveAllAlternatesMatchingHost;return}}return;case V.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:xt.SendAlternateToPenaltyBox,flags:qt.MoveAllAlternatesMatchingHDCP};return;case V.KEY_SYSTEM_SESSION_UPDATE_FAILED:case V.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case V.KEY_SYSTEM_NO_SESSION:t.errorAction={action:xt.SendAlternateToPenaltyBox,flags:qt.MoveAllAlternatesMatchingKey};return;case V.BUFFER_ADD_CODEC_ERROR:case V.REMUX_ALLOC_ERROR:case V.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:n.loadLevel)}return;case V.INTERNAL_EXCEPTION:case V.BUFFER_APPENDING_ERROR:case V.BUFFER_FULL_ERROR:case V.LEVEL_SWITCH_ERROR:case V.BUFFER_STALLED_ERROR:case V.BUFFER_SEEK_OVER_HOLE:case V.BUFFER_NUDGE_ON_STALL:t.errorAction=ei();return}t.type===ve.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ei())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,n=Um(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(xl(n,i,Tl(e),e.response))return{action:xt.RetryRequest,flags:qt.None,retryConfig:n,retryCount:i};const u=this.getLevelSwitchAction(e,t);return n&&(u.retryConfig=n,u.retryCount=i),u}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,u=Um(kv(e)?o:i,e),c=t.levels.reduce((f,g)=>f+g.fragmentError,0);if(n&&(e.details!==V.FRAG_GAP&&n.fragmentError++,!Cv(e)&&xl(u,c,Tl(e),e.response)))return{action:xt.RetryRequest,flags:qt.None,retryConfig:u,retryCount:c};const d=this.getLevelSwitchAction(e,r);return u&&(d.retryConfig=u,d.retryCount=c),d}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const n=this.hls.levels[t];if(n){var i,o;const d=e.details;n.loadError++,d===V.BUFFER_APPEND_ERROR&&n.fragmentError++;let f=-1;const{levels:g,loadLevel:m,minAutoLevel:y,maxAutoLevel:v}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const T=(i=e.frag)==null?void 0:i.type,w=(T===ge.AUDIO&&d===V.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===V.BUFFER_ADD_CODEC_ERROR||d===V.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:O})=>n.audioCodec!==O),A=e.sourceBufferName==="video"&&(d===V.BUFFER_ADD_CODEC_ERROR||d===V.BUFFER_APPEND_ERROR)&&g.some(({codecSet:O,audioCodec:P})=>n.codecSet!==O&&n.audioCodec===P),{type:L,groupId:k}=(o=e.context)!=null?o:{};for(let O=g.length;O--;){const P=(O+m)%g.length;if(P!==m&&P>=y&&P<=v&&g[P].loadError===0){var u,c;const $=g[P];if(d===V.FRAG_GAP&&T===ge.MAIN&&e.frag){const B=g[P].details;if(B){const U=cs(e.frag,B.fragments,e.frag.start);if(U!=null&&U.gap)continue}}else{if(L===Pe.AUDIO_TRACK&&$.hasAudioGroup(k)||L===Pe.SUBTITLE_TRACK&&$.hasSubtitleGroup(k))continue;if(T===ge.AUDIO&&(u=n.audioGroups)!=null&&u.some(B=>$.hasAudioGroup(B))||T===ge.SUBTITLE&&(c=n.subtitleGroups)!=null&&c.some(B=>$.hasSubtitleGroup(B))||w&&n.audioCodec===$.audioCodec||A&&n.codecSet===$.codecSet||!w&&n.codecSet!==$.codecSet)continue}f=P;break}}if(f>-1&&r.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:xt.SendAlternateToPenaltyBox,flags:qt.None,nextAutoLevel:f}}return{action:xt.SendAlternateToPenaltyBox,flags:qt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case xt.DoNothing:break;case xt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==V.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:n}=r,i=r.nextAutoLevel;switch(n){case qt.None:this.switchLevel(e,i);break;case qt.MoveAllAlternatesMatchingHDCP:{const c=this.getVariantLevelIndex(e.frag),d=t.levels[c],f=d==null?void 0:d.attrs["HDCP-LEVEL"];if(r.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=jd[jd.indexOf(f)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case qt.MoveAllAlternatesMatchingKey:{const c=e.decryptdata;if(c){const d=this.hls.levels,f=d.length;for(let m=f;m--;)if(this.variantHasKey(d[m],c)){var o,u;this.log(`Banned key found in level ${m} (${d[m].bitrate}bps) or audio group "${(o=d[m].audioGroups)==null?void 0:o.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${Pt(c.keyId||[])}`),d[m].fragmentError++,d[m].loadError++,this.log(`Removing level ${m} with key error (${e.error})`),this.hls.removeLevel(m)}const g=e.frag;if(this.hls.levels.length<f)r.resolved=!0;else if(g&&g.type!==ge.MAIN){const m=g.decryptdata;m&&!c.matches(m)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===V.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=$d(e.mimeType),n=this.hls.levels;for(let i=n.length;i--;)n[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function ei(s){const e={action:xt.DoNothing,flags:qt.None};return s&&(e.resolved=!0),e}var ft={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Qb{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let n=r.length;n--;){const i=r[n];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:n}=this,i=Object.keys(n);for(let o=i.length;o--;){const u=n[i[o]];if((u==null?void 0:u.body.type)===t&&(!r||u.buffered)){const c=u.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,r,n,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const c=this.fragments[u];if(!c||o>=c.body.sn)return;if(!c.buffered&&(!c.loaded||i)){c.body.type===r&&this.removeFragment(c.body);return}const d=c.range[e];if(d){if(d.time.length===0){this.removeFragment(c.body);return}d.time.some(f=>{const g=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return g&&this.removeFragment(c.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,n=Ks(r),i=this.fragments[n];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(u=>{const c=r.elementaryStreams[u];if(!c)return;const d=t[u],f=o||c.partial===!0;i.range[u]=this.getBufferedTimes(r,e.part,f,d)}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,(i.body.endList=r.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),Go(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=$m(r,n=>n.fragment.sn>=e))}fragBuffered(e,t){const r=Ks(e);let n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,r,n){const i={time:[],partial:r},o=e.start,u=e.end,c=e.minEndPTS||u,d=e.maxStartPTS||o;for(let f=0;f<n.length;f++){const g=n.start(f)-this.bufferPadding,m=n.end(f)+this.bufferPadding;if(d>=g&&c<=m){i.time.push({startPTS:Math.max(o,n.start(f)),endPTS:Math.min(u,n.end(f))});break}else if(o<m&&u>g){const y=Math.max(o,n.start(f)),v=Math.min(u,n.end(f));v>y&&(i.partial=!0,i.time.push({startPTS:y,endPTS:v}))}else if(u<=g)break}return i}getPartialFragment(e){let t=null,r,n,i,o=0;const{bufferPadding:u,fragments:c}=this;return Object.keys(c).forEach(d=>{const f=c[d];f&&Go(f)&&(n=f.body.start-u,i=f.body.end+u,e>=n&&e<=i&&(r=Math.min(e-n,i-e),o<=r&&(t=f.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Go(t))}getState(e){const t=Ks(e),r=this.fragments[t];return r?r.buffered?Go(r)?ft.PARTIAL:ft.OK:ft.APPENDING:ft.NOT_LOADED}isTimeBuffered(e,t,r){let n,i;for(let o=0;o<r.length;o++){if(n=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,n=t.part?null:t,i=Ks(r);this.fragments[i]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:n,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const u=r.type;if(n){let d=this.activePartLists[u];d||(this.activePartLists[u]=d=[]),d.push(n)}this.timeRanges=i;const c=i[o];this.detectEvictedFragments(o,c,u,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ks(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let n=r.length;n--;){const i=t[r[n]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const c=u.body;c.type!==r||n&&!c.gap||c.start<t&&c.end>e&&(u.buffered||i)&&this.removeFragment(c)})}removeFragment(e){const t=Ks(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const n=e.sn;this.activePartLists[e.type]=$m(r,i=>i.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function Go(s){var e,t,r;return s.buffered&&!!(s.body.gap||(e=s.range.video)!=null&&e.partial||(t=s.range.audio)!=null&&t.partial||(r=s.range.audiovideo)!=null&&r.partial)}function Ks(s){return`${s.type}_${s.level}_${s.sn}`}function $m(s,e){return s.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Dn={cbc:0,ctr:1};class Xb{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Dn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Dn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Jb(s){const e=s.byteLength,t=e&&new DataView(s.buffer).getUint8(e-1);return t?s.slice(0,e-t):s}class Zb{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let n=0;n<4;n++)r[n]=t.getUint32(n*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],o=r[2],u=r[3],c=this.invSubMix,d=c[0],f=c[1],g=c[2],m=c[3],y=new Uint32Array(256);let v=0,T=0,S=0;for(S=0;S<256;S++)S<128?y[S]=S<<1:y[S]=S<<1^283;for(S=0;S<256;S++){let w=T^T<<1^T<<2^T<<3^T<<4;w=w>>>8^w&255^99,e[v]=w,t[w]=v;const b=y[v],A=y[b],L=y[A];let k=y[w]*257^w*16843008;n[v]=k<<24|k>>>8,i[v]=k<<16|k>>>16,o[v]=k<<8|k>>>24,u[v]=k,k=L*16843009^A*65537^b*257^v*16843008,d[w]=k<<24|k>>>8,f[w]=k<<16|k>>>16,g[w]=k<<8|k>>>24,m[w]=k,v?(v=b^y[y[y[L^b]]],T^=y[y[T]]):v=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<t.length&&r;)r=t[n]===this.key[n],n++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let u,c;const d=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),g=this.sBox,m=this.rcon,y=this.invSubMix,v=y[0],T=y[1],S=y[2],w=y[3];let b,A;for(u=0;u<o;u++){if(u<i){b=d[u]=t[u];continue}A=b,u%i===0?(A=A<<8|A>>>24,A=g[A>>>24]<<24|g[A>>>16&255]<<16|g[A>>>8&255]<<8|g[A&255],A^=m[u/i|0]<<24):i>6&&u%i===4&&(A=g[A>>>24]<<24|g[A>>>16&255]<<16|g[A>>>8&255]<<8|g[A&255]),d[u]=b=(d[u-i]^A)>>>0}for(c=0;c<o;c++)u=o-c,c&3?A=d[u]:A=d[u-4],c<4||u<=4?f[c]=A:f[c]=v[g[A>>>24]]^T[g[A>>>16&255]]^S[g[A>>>8&255]]^w[g[A&255]],f[c]=f[c]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const n=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,c=u[0],d=u[1],f=u[2],g=u[3],m=this.uint8ArrayToUint32Array_(r);let y=m[0],v=m[1],T=m[2],S=m[3];const w=new Int32Array(e),b=new Int32Array(w.length);let A,L,k,O,P,$,B,U,q,re,ae,le,oe,J;const se=this.networkToHostOrderSwap;for(;t<w.length;){for(q=se(w[t]),re=se(w[t+1]),ae=se(w[t+2]),le=se(w[t+3]),P=q^i[0],$=le^i[1],B=ae^i[2],U=re^i[3],oe=4,J=1;J<n;J++)A=c[P>>>24]^d[$>>16&255]^f[B>>8&255]^g[U&255]^i[oe],L=c[$>>>24]^d[B>>16&255]^f[U>>8&255]^g[P&255]^i[oe+1],k=c[B>>>24]^d[U>>16&255]^f[P>>8&255]^g[$&255]^i[oe+2],O=c[U>>>24]^d[P>>16&255]^f[$>>8&255]^g[B&255]^i[oe+3],P=A,$=L,B=k,U=O,oe=oe+4;A=o[P>>>24]<<24^o[$>>16&255]<<16^o[B>>8&255]<<8^o[U&255]^i[oe],L=o[$>>>24]<<24^o[B>>16&255]<<16^o[U>>8&255]<<8^o[P&255]^i[oe+1],k=o[B>>>24]<<24^o[U>>16&255]<<16^o[P>>8&255]<<8^o[$&255]^i[oe+2],O=o[U>>>24]<<24^o[P>>16&255]<<16^o[$>>8&255]<<8^o[B&255]^i[oe+3],b[t]=se(A^y),b[t+1]=se(O^v),b[t+2]=se(k^T),b[t+3]=se(L^S),y=q,v=re,T=ae,S=le,t=t+4}return b.buffer}}class eI{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=tI(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function tI(s){switch(s){case Dn.cbc:return"AES-CBC";case Dn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${s}`)}}const rI=16;class Th{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Jb(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,n){return this.useSoftware?new Promise((i,o)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,r,n);const c=this.flush();c?i(c.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,n)}softwareDecrypt(e,t,r,n){const{currentIV:i,currentResult:o,remainderData:u}=this;if(n!==Dn.cbc||t.byteLength!==16)return Be.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=ur(u,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;i&&(r=i);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new Zb),d.expandKey(t);const f=o;return this.currentResult=d.decrypt(c.buffer,0,r),this.currentIV=c.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,r,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,n));this.key=t,this.fastAesKey=new eI(this.subtle,t,n)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Xb(this.subtle,new Uint8Array(r),n).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Be.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,n)))}onWebCryptoError(e,t,r,n){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,n);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%rI;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Be.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const jm=Math.pow(2,17);class nI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Zr({type:ve.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,o=n.loader;return new Promise((u,c)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){c(Vm(e));return}else e.gap=!1;const d=this.loader=i?new i(n):new o(n),f=Gm(e);e.loader=d;const g=Bm(n.fragLoadPolicy.default),m={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:jm};e.stats=d.stats;const y={onSuccess:(v,T,S,w)=>{this.resetLoader(e,d);let b=v.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(b.slice(0,16)),b=b.slice(16)),u({frag:e,part:null,payload:b,networkDetails:w})},onError:(v,T,S,w)=>{this.resetLoader(e,d),c(new Zr({type:ve.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ue({url:r,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:S,stats:w}))},onAbort:(v,T,S)=>{this.resetLoader(e,d),c(new Zr({type:ve.NETWORK_ERROR,details:V.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:v}))},onTimeout:(v,T,S)=>{this.resetLoader(e,d),c(new Zr({type:ve.NETWORK_ERROR,details:V.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:S,stats:v}))}};t&&(y.onProgress=(v,T,S,w)=>t({frag:e,part:null,payload:S,networkDetails:w})),d.load(f,m,y)})}loadPart(e,t,r){this.abort();const n=this.config,i=n.fLoader,o=n.loader;return new Promise((u,c)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){c(Vm(e,t));return}const d=this.loader=i?new i(n):new o(n),f=Gm(e,t);e.loader=d;const g=Bm(n.fragLoadPolicy.default),m={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:jm};t.stats=d.stats,d.load(f,m,{onSuccess:(y,v,T,S)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const w={frag:e,part:t,payload:y.data,networkDetails:S};r(w),u(w)},onError:(y,v,T,S)=>{this.resetLoader(e,d),c(new Zr({type:ve.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ue({url:f.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:T,stats:S}))},onAbort:(y,v,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),c(new Zr({type:ve.NETWORK_ERROR,details:V.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:y}))},onTimeout:(y,v,T)=>{this.resetLoader(e,d),c(new Zr({type:ve.NETWORK_ERROR,details:V.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:T,stats:y}))}})})}updateStatsFromPart(e,t){const r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){const c=Math.round(e.duration/t.duration),d=Math.min(Math.round(r.loaded/i),c),g=(c-d)*Math.round(r.loaded/d);r.total=r.loaded+g}else r.total=Math.max(r.loaded,r.total);const o=r.loading,u=n.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Gm(s,e=null){const t=e||s,r={frag:s,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(ue(n)&&ue(i)){var o;let u=n,c=i;if(s.sn==="initSegment"&&sI((o=s.decryptdata)==null?void 0:o.method)){const d=i-n;d%16&&(c=i+(16-d%16)),n!==0&&(r.resetIV=!0,u=n-16)}r.rangeStart=u,r.rangeEnd=c}return r}function Vm(s,e){const t=new Error(`GAP ${s.gap?"tag":"attribute"} found`),r={type:ve.MEDIA_ERROR,details:V.FRAG_GAP,fatal:!1,frag:s,error:t,networkDetails:null};return e&&(r.part=e),(e||s).stats.aborted=!0,new Zr(r)}function sI(s){return s==="AES-128"||s==="AES-256"}class Zr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Pv extends cr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class xh{constructor(e,t,r,n=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Vo(),this.buffering={audio:Vo(),video:Vo(),audiovideo:Vo()},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i,this.partial=o}}function Vo(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Km={length:0,start:()=>0,end:()=>0};class Re{static isBuffered(e,t){if(e){const r=Re.getBuffered(e);for(let n=r.length;n--;)if(t>=r.start(n)&&t<=r.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=Re.getBuffered(e);return Re.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const n=Re.bufferedRanges(e);if(n.length)return Re.bufferedInfo(n,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((f,g)=>f.start-g.start||g.end-f.end);let n=-1,i=[];if(r)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(n=f);const g=i.length;if(g){const m=i[g-1].end;e[f].start-m<r?e[f].end>m&&(i[g-1].end=e[f].end):i.push(e[f])}else i.push(e[f])}else i=e;let o=0,u,c=t,d=t;for(let f=0;f<i.length;f++){const g=i[f].start,m=i[f].end;if(n===-1&&t>=g&&t<=m&&(n=f),t+r>=g&&t<m)c=g,d=m,o=d-t;else if(t+r<g){u=g;break}}return{len:o,start:c||0,end:d||0,nextStart:u,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Km}catch(t){return Be.log("failed to get media.buffered",t),Km}}}const Dv=/\{\$([a-zA-Z0-9-_]+)\}/g;function Hm(s){return Dv.test(s)}function Vd(s,e){if(s.variableList!==null||s.hasVariableRefs){const t=s.variableList;return e.replace(Dv,r=>{const n=r.substring(2,r.length-1),i=t==null?void 0:t[n];return i===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),r):i})}return e}function Wm(s,e,t){let r=s.variableList;r||(s.variableList=r={});let n,i;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(n))i=o.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(o){s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=e.NAME,i=e.VALUE;n in r?s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):r[n]=i||""}function iI(s,e,t){const r=e.IMPORT;if(t&&r in t){let n=s.variableList;n||(s.variableList=n={}),n[r]=t[r]}else s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const aI=/^(\d+)x(\d+)$/,zm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Xe{constructor(e,t){typeof e=="string"&&(e=Xe.parseAttrList(e,t)),$e(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(n*2,n*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((n,i)=>(n[i.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=aI.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const n={};for(zm.lastIndex=0;(r=zm.exec(e))!==null;){const o=r[1].trim();let u=r[2];const c=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let d=!1;if(c)u=u.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(c||d))u=Vd(t,u);else if(!d&&!c)switch(o){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Be.warn(`${e}: attribute ${o} is missing quotes`)}n[o]=u}return n}}const oI="com.apple.hls.interstitial";function lI(s){return s!=="ID"&&s!=="CLASS"&&s!=="CUE"&&s!=="START-DATE"&&s!=="DURATION"&&s!=="END-DATE"&&s!=="END-ON-NEXT"}function uI(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}class Ov{constructor(e,t,r=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(n=t==null?void 0:t.tagOrder)!=null?n:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){Be.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=$e(new Xe({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ue(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Be.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ue(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===oI}get isValid(){return!!this.id&&!this._badValueForSameId&&ue(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const cI=10;class dI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?ue(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||cI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function _l(s,e){return s.length===e.length?!s.some((t,r)=>t!==e[r]):!1}function qm(s,e){return!s&&!e?!0:!s||!e?!1:_l(s,e)}function ti(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function _h(s){switch(s){case"AES-128":case"AES-256":return Dn.cbc;case"AES-256-CTR":return Dn.ctr;default:throw new Error(`invalid full segment method ${s}`)}}function wh(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0))}function Kd(s){return Uint8Array.from(unescape(encodeURIComponent(s)),e=>e.charCodeAt(0))}function hI(s){const e=Kd(s).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Nv(s){const e=function(r,n,i){const o=r[n];r[n]=r[i],r[i]=o};e(s,0,3),e(s,1,2),e(s,4,5),e(s,6,7)}function Mv(s){const e=s.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),n=r[r.length-1].split(",");if(n.length===2){const i=n[0]==="base64",o=n[1];i?(r.splice(-1,1),t=wh(o)):t=hI(o)}}return t}const wl=typeof self<"u"?self:void 0;var Ze={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function sl(s){switch(s){case _t.FAIRPLAY:return Ze.FAIRPLAY;case _t.PLAYREADY:return Ze.PLAYREADY;case _t.WIDEVINE:return Ze.WIDEVINE;case _t.CLEARKEY:return Ze.CLEARKEY}}function Qc(s){switch(s){case Ze.FAIRPLAY:return _t.FAIRPLAY;case Ze.PLAYREADY:return _t.PLAYREADY;case Ze.WIDEVINE:return _t.WIDEVINE;case Ze.CLEARKEY:return _t.CLEARKEY}}function ta(s){const{drmSystems:e,widevineLicenseUrl:t}=s,r=e?[Ze.FAIRPLAY,Ze.WIDEVINE,Ze.PLAYREADY,Ze.CLEARKEY].filter(n=>!!e[n]):[];return!r[Ze.WIDEVINE]&&t&&r.push(Ze.WIDEVINE),r}const Fv=(function(s){return wl!=null&&(s=wl.navigator)!=null&&s.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function fI(s,e,t,r){let n;switch(s){case Ze.FAIRPLAY:n=["cenc","sinf"];break;case Ze.WIDEVINE:case Ze.PLAYREADY:n=["cenc"];break;case Ze.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${s}`)}return gI(n,e,t,r)}function gI(s,e,t,r){return[{initDataTypes:s,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function pI(s){var e;return!!s&&(s.sessionType==="persistent-license"||!!((e=s.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Uv(s){const e=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const u=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(u){const c=wh(u).subarray(0,16);return Nv(c),c}}return null}let Ko={};class us{static clearKeyUriToKeyIdMap(){Ko={}}static setKeyIdForUri(e,t){Ko[e]=t}constructor(e,t,r,n=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ti(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(hv(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&_l(e.keyFormatVersions,this.keyFormatVersions)&&qm(e.iv,this.iv)&&qm(e.keyId,this.keyId)}isSupported(){if(this.method){if(ti(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case _t.FAIRPLAY:case _t.WIDEVINE:case _t.PLAYREADY:case _t.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ti(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Be.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=yI(e)),new us(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Ko[this.uri];if(i&&!_l(this.keyId,i)&&us.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=Mv(this.uri);if(r)switch(this.keyFormat){case _t.WIDEVINE:if(this.pssh=r,!this.keyId){const i=Sb(r.buffer);if(i.length){var n;const o=i[0];this.keyId=(n=o.kids)!=null&&n.length?o.kids[0]:null}}this.keyId||(this.keyId=Ym(t));break;case _t.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Eb(i,null,r),this.keyId=Uv(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=mI(t),i||(i=Ym(t),i||(i=Ko[this.uri])),i&&(this.keyId=i,us.setKeyIdForUri(this.uri,i))}return this}}function mI(s){const e=s==null?void 0:s[_t.WIDEVINE];return e?e.keyId:null}function Ym(s){const e=s==null?void 0:s[_t.PLAYREADY];if(e){const t=Mv(e.uri);if(t)return Uv(t)}return null}function yI(s){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=s>>8*(15-t)&255;return e}const Qm=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Xm=/#EXT-X-MEDIA:(.*)/g,vI=/^#EXT(?:INF|-X-TARGETDURATION):/m,Xc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),EI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Fr{static findGroup(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===t)return n}}static resolve(e,t){return ph.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return vI.test(e)}static parseMasterPlaylist(e,t){const r=Hm(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(Qm.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let o;for(;(o=Qm.exec(e))!=null;)if(o[1]){var u;const d=new Xe(o[1],n),f=Vd(n,o[2]),g={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:Fr.resolve(f,t)},m=d.decimalResolution("RESOLUTION");m&&(g.width=m.width,g.height=m.height),e0(d.CODECS,g);const y=d["SUPPLEMENTAL-CODECS"];y&&(g.supplemental={},e0(y,g.supplemental)),(u=g.unknownCodecs)!=null&&u.length||i.push(g),n.levels.push(g)}else if(o[3]){const d=o[3],f=o[4];switch(d){case"SESSION-DATA":{const g=new Xe(f,n),m=g["DATA-ID"];m&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[m]=g);break}case"SESSION-KEY":{const g=Jm(f,t,n);g.encrypted&&g.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(g)):Be.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const g=new Xe(f,n);Wm(n,g,t)}break}case"CONTENT-STEERING":{const g=new Xe(f,n);n.contentSteering={uri:Fr.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Zm(f);break}}}const c=i.length>0&&i.length<n.levels.length;return n.levels=c?i:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,r){let n;const i={},o=r.levels,u={AUDIO:o.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:o.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let c=0;for(Xm.lastIndex=0;(n=Xm.exec(e))!==null;){const d=new Xe(n[1],r),f=d.TYPE;if(f){const g=u[f],m=i[f]||[];i[f]=m;const y=d.LANGUAGE,v=d["ASSOC-LANGUAGE"],T=d.CHANNELS,S=d.CHARACTERISTICS,w=d["INSTREAM-ID"],b={attrs:d,bitrate:0,id:c++,groupId:d["GROUP-ID"]||"",name:d.NAME||y||"",type:f,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:y,url:d.URI?Fr.resolve(d.URI,t):""};if(v&&(b.assocLang=v),T&&(b.channels=T),S&&(b.characteristics=S),w&&(b.instreamId=w),g!=null&&g.length){const A=Fr.findGroup(g,b.groupId)||g[0];t0(b,A,"audioCodec"),t0(b,A,"textCodec")}m.push(b)}}return i}static parseLevelPlaylist(e,t,r,n,i,o){var u;const c={url:t},d=new dI(t),f=d.fragments,g=[];let m=null,y=0,v=0,T=0,S=0,w=0,b=null,A=new zc(n,c),L,k,O,P=-1,$=!1,B=null,U;if(Xc.lastIndex=0,d.m3u8=e,d.hasVariableRefs=Hm(e),((u=Xc.exec(e))==null?void 0:u[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(L=Xc.exec(e))!==null;){$&&($=!1,A=new zc(n,c),A.playlistOffset=T,A.setStart(T),A.sn=y,A.cc=S,w&&(A.bitrate=w),A.level=r,m&&(A.initSegment=m,m.rawProgramDateTime&&(A.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),B&&(A.setByteRange(B),B=null)));const le=L[1];if(le){A.duration=parseFloat(le);const oe=(" "+L[2]).slice(1);A.title=oe||null,A.tagList.push(oe?["INF",le,oe]:["INF",le])}else if(L[3]){if(ue(A.duration)){A.playlistOffset=T,A.setStart(T),O&&n0(A,O,d),A.sn=y,A.level=r,A.cc=S,f.push(A);const oe=(" "+L[3]).slice(1);A.relurl=Vd(d,oe),Hd(A,b,g),b=A,T+=A.duration,y++,v=0,$=!0}}else{if(L=L[0].match(EI),!L){Be.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<L.length&&L[k]===void 0;k++);const oe=(" "+L[k]).slice(1),J=(" "+L[k+1]).slice(1),se=L[k+2]?(" "+L[k+2]).slice(1):null;switch(oe){case"BYTERANGE":b?A.setByteRange(J,b):A.setByteRange(J);break;case"PROGRAM-DATE-TIME":A.rawProgramDateTime=J,A.tagList.push(["PROGRAM-DATE-TIME",J]),P===-1&&(P=f.length);break;case"PLAYLIST-TYPE":d.type&&Yr(d,oe,L),d.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Yr(d,oe,L):f.length>0&&s0(d,oe,L),y=d.startSN=parseInt(J);break;case"SKIP":{d.skippedSegments&&Yr(d,oe,L);const F=new Xe(J,d),Y=F.decimalInteger("SKIPPED-SEGMENTS");if(ue(Y)){d.skippedSegments+=Y;for(let C=Y;C--;)f.push(null);y+=Y}const Q=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");Q&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(Q.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Yr(d,oe,L),d.targetduration=Math.max(parseInt(J),1);break;case"VERSION":d.version!==null&&Yr(d,oe,L),d.version=parseInt(J);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Yr(d,oe,L),d.live=!1;break;case"#":(J||se)&&A.tagList.push(se?[J,se]:[J]);break;case"DISCONTINUITY":S++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([oe]);break;case"BITRATE":A.tagList.push([oe,J]),w=parseInt(J)*1e3,ue(w)?A.bitrate=w:w=0;break;case"DATERANGE":{const F=new Xe(J,d),Y=new Ov(F,d.dateRanges[F.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Y.isValid||d.skippedSegments?d.dateRanges[Y.id]=Y:Be.warn(`Ignoring invalid DATERANGE tag: "${J}"`),A.tagList.push(["EXT-X-DATERANGE",J]);break}case"DEFINE":{{const F=new Xe(J,d);"IMPORT"in F?iI(d,F,o):Wm(d,F,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Yr(d,oe,L):f.length>0&&s0(d,oe,L),d.startCC=S=parseInt(J);break;case"KEY":{const F=Jm(J,t,d);if(F.isSupported()){if(F.method==="NONE"){O=void 0;break}O||(O={});const Y=O[F.keyFormat];Y!=null&&Y.matches(F)||(Y&&(O=$e({},O)),O[F.keyFormat]=F)}else Be.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${J}"`);break}case"START":d.startTimeOffset=Zm(J);break;case"MAP":{const F=new Xe(J,d);if(A.duration){const Y=new zc(n,c);r0(Y,F,r,O),m=Y,A.initSegment=m,m.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=m.rawProgramDateTime)}else{const Y=A.byteRangeEndOffset;if(Y){const Q=A.byteRangeStartOffset;B=`${Y-Q}@${Q}`}else B=null;r0(A,F,r,O),m=A,$=!0}m.cc=S;break}case"SERVER-CONTROL":{U&&Yr(d,oe,L),U=new Xe(J),d.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),d.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Yr(d,oe,L);const F=new Xe(J);d.partTarget=F.decimalFloatingPoint("PART-TARGET");break}case"PART":{let F=d.partList;F||(F=d.partList=[]);const Y=v>0?F[F.length-1]:void 0,Q=v++,C=new Xe(J,d),N=new ib(C,A,c,Q,Y);F.push(N),A.duration+=N.duration;break}case"PRELOAD-HINT":{const F=new Xe(J,d);d.preloadHint=F;break}case"RENDITION-REPORT":{const F=new Xe(J,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(F);break}default:Be.warn(`line parsed but not handled: ${L}`);break}}}b&&!b.relurl?(f.pop(),T-=b.duration,d.partList&&(d.fragmentHint=b)):d.partList&&(Hd(A,b,g),A.cc=S,d.fragmentHint=A,O&&n0(A,O,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const q=f.length,re=f[0],ae=f[q-1];if(T+=d.skippedSegments*d.targetduration,T>0&&q&&ae){d.averagetargetduration=T/q;const le=ae.sn;d.endSN=le!=="initSegment"?le:0,d.live||(ae.endList=!0),P>0&&(TI(f,P),re&&g.unshift(re))}return d.fragmentHint&&(T+=d.fragmentHint.duration),d.totalduration=T,g.length&&d.dateRangeTagCount&&re&&Bv(g,d),d.endCC=S,d}}function Bv(s,e){let t=s.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];s.push(u),t++}else return;const r=s[t-1],n=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let u=i.length;u--;){const c=e.dateRanges[i[u]],d=c.startDate.getTime();c.tagAnchor=r.ref;for(let f=t;f--;){var o;if(((o=s[f])==null?void 0:o.sn)<e.startSN)break;const g=SI(e,d,s,f,n);if(g!==-1){c.tagAnchor=e.fragments[g].ref;break}}}}function SI(s,e,t,r,n){const i=t[r];if(i){const u=i.programDateTime;if(e>=u||r===0){var o;const c=(((o=t[r+1])==null?void 0:o.start)||n)-i.start;if(e<=u+c*1e3){const d=t[r].sn-s.startSN;if(d<0)return-1;const f=s.fragments;if(f.length>t.length){const m=(t[r+1]||f[f.length-1]).sn-s.startSN;for(let y=m;y>d;y--){const v=f[y].programDateTime;if(e>=v&&e<v+f[y].duration*1e3)return y}}return d}}}return-1}function Jm(s,e,t){var r,n;const i=new Xe(s,t),o=(r=i.METHOD)!=null?r:"",u=i.URI,c=i.hexadecimalInteger("IV"),d=i.KEYFORMATVERSIONS,f=(n=i.KEYFORMAT)!=null?n:"identity";u&&i.IV&&!c&&Be.error(`Invalid IV: ${i.IV}`);const g=u?Fr.resolve(u,e):"",m=(d||"1").split("/").map(Number).filter(Number.isFinite);return new us(o,g,f,m,c,i.KEYID)}function Zm(s){const t=new Xe(s).decimalFloatingPoint("TIME-OFFSET");return ue(t)?t:null}function e0(s,e){let t=(s||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const n=t.filter(i=>vh(i,r));n.length&&(e[`${r}Codec`]=n.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>n.indexOf(i)===-1))}),e.unknownCodecs=t}function t0(s,e,t){const r=e[t];r&&(s[t]=r)}function TI(s,e){let t=s[e];for(let r=e;r--;){const n=s[r];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Hd(s,e,t){s.rawProgramDateTime?t.push(s):e!=null&&e.programDateTime&&(s.programDateTime=e.endProgramDateTime)}function r0(s,e,t,r){s.relurl=e.URI,e.BYTERANGE&&s.setByteRange(e.BYTERANGE),s.level=t,s.sn="initSegment",r&&(s.levelkeys=r),s.initSegment=null}function n0(s,e,t){s.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&r.push(s)}function Yr(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function s0(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Jc(s,e){const t=e.startPTS;if(ue(t)){let r=0,n;e.sn>s.sn?(r=t-s.start,n=s):(r=s.start-t,n=e),n.duration!==r&&n.setDuration(r)}else e.sn>s.sn?s.cc===e.cc&&s.minEndPTS?e.setStart(s.start+(s.minEndPTS-s.start)):e.setStart(s.start+s.duration):e.setStart(Math.max(s.start-e.duration,0))}function $v(s,e,t,r,n,i,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,i=n+e.duration);let c=t,d=r;const f=e.startPTS,g=e.endPTS;if(ue(f)){const w=Math.abs(f-t);s&&w>s.totalduration?o.warn(`media timestamps and playlist times differ by ${w}s for level ${e.level} ${s.url}`):ue(e.deltaPTS)?e.deltaPTS=Math.max(w,e.deltaPTS):e.deltaPTS=w,c=Math.max(t,f),t=Math.min(t,f),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,d=Math.min(r,g),r=Math.max(r,g),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=c,e.startDTS=n,e.endPTS=r,e.minEndPTS=d,e.endDTS=i;const y=e.sn;if(!s||y<s.startSN||y>s.endSN)return 0;let v;const T=y-s.startSN,S=s.fragments;for(S[T]=e,v=T;v>0;v--)Jc(S[v],S[v-1]);for(v=T;v<S.length-1;v++)Jc(S[v],S[v+1]);return s.fragmentHint&&Jc(S[S.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,m}function xI(s,e,t){if(s===e)return;let r=null;const n=s.fragments;for(let f=n.length-1;f>=0;f--){const g=n[f].initSegment;if(g){r=g;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;let i;AI(s,e,(f,g,m,y)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==f.cc){const v=f.cc-g.cc;for(let T=m;T<y.length;T++)y[T].cc+=v;e.endCC=y[y.length-1].cc}ue(f.startPTS)&&ue(f.endPTS)&&(g.setStart(g.startPTS=f.startPTS),g.startDTS=f.startDTS,g.maxStartPTS=f.maxStartPTS,g.endPTS=f.endPTS,g.endDTS=f.endDTS,g.minEndPTS=f.minEndPTS,g.setDuration(f.endPTS-f.startPTS),g.duration&&(i=g),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(g.elementaryStreams=f.elementaryStreams),g.loader=f.loader,f.hasStats&&(g.stats=f.stats),f.initSegment&&(g.initSegment=f.initSegment,r=f.initSegment)});const o=e.fragments,u=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&u.forEach(f=>{var g;f&&(!f.initSegment||f.initSegment.relurl===((g=r)==null?void 0:g.relurl))&&(f.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=_I(s.dateRanges,e,t));const f=s.fragments.filter(g=>g.rawProgramDateTime);if(s.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<u.length;g++)u[g].programDateTime===null&&Hd(u[g],u[g-1],f);Bv(f,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var c;const f=Vv(s,e.startSN-1);e.startCC=(c=f==null?void 0:f.cc)!=null?c:o[0].cc}wI(s.partList,e.partList,(f,g)=>{g.elementaryStreams=f.elementaryStreams,g.stats=f.stats}),i?$v(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):jv(s,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=s.driftStartTime,e.driftStart=s.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=s.driftEndTime,e.driftEnd=s.driftEnd,e.advancedDateTime=s.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=s.requestScheduled)}function _I(s,e,t){const{dateRanges:r,recentlyRemovedDateranges:n}=e,i=$e({},s);n&&n.forEach(c=>{delete i[c]});const u=Object.keys(i).length;return u?(Object.keys(r).forEach(c=>{const d=i[c],f=new Ov(r[c].attr,d);f.isValid?(i[c]=f,d||(f.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ge(r[c].attr)}"`)}),i):r}function wI(s,e,t){if(s&&e){let r=0;for(let n=0,i=s.length;n<=i;n++){const o=s[n],u=e[n+r];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):r--}}}function AI(s,e,t){const r=e.skippedSegments,n=Math.max(s.startSN,e.startSN)-e.startSN,i=(s.fragmentHint?1:0)+(r?e.endSN:Math.min(s.endSN,e.endSN))-e.startSN,o=e.startSN-s.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;for(let d=n;d<=i;d++){const f=c[o+d];let g=u[d];if(r&&!g&&f&&(g=e.fragments[d]=f),f&&g){t(f,g,d,u);const m=f.relurl,y=g.relurl;if(m&&bI(m,y)){e.playlistParsingError=i0(`media sequence mismatch ${g.sn}:`,s,e,f,g);return}else if(f.cc!==g.cc){e.playlistParsingError=i0(`discontinuity sequence mismatch (${f.cc}!=${g.cc})`,s,e,f,g);return}}}}function i0(s,e,t,r,n){return new Error(`${s} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function jv(s,e,t=!0){const r=e.startSN+e.skippedSegments-s.startSN,n=s.fragments,i=r>=0;let o=0;if(i&&r<n.length)o=n[r].start;else if(i&&e.startSN===s.endSN+1)o=s.fragmentEnd;else if(i&&t)o=s.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=s.fragmentStart;else return;Wd(e,o)}function Wd(s,e){if(e){const t=s.fragments;for(let r=s.skippedSegments;r<t.length;r++)t[r].addStart(e);s.fragmentHint&&s.fragmentHint.addStart(e)}}function Gv(s,e=1/0){let t=1e3*s.targetduration;if(s.updated){const r=s.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function Vv(s,e,t){if(!s)return null;let r=s.fragments[e-s.startSN];return r||(r=s.fragmentHint,r&&r.sn===e)?r:e<s.startSN&&t&&t.sn===e?t:null}function a0(s,e,t){return s?Kv(s.partList,e,t):null}function Kv(s,e,t){if(s)for(let r=s.length;r--;){const n=s[r];if(n.index===t&&n.fragment.sn===e)return n}return null}function Hv(s){s.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function bI(s,e){return s!==e&&e?o0(s)!==o0(e):!1}function o0(s){return s.replace(/\?[^?]*$/,"")}function sa(s,e){for(let r=0,n=s.length;r<n;r++){var t;if(((t=s[r])==null?void 0:t.cc)===e)return s[r]}return null}function II(s,e){return!!(s&&e.startCC<s.endCC&&e.endCC>s.startCC)}function l0(s,e){const t=s.start+e;s.startPTS=t,s.setStart(t),s.endPTS=t+s.duration}function Wv(s,e){const t=e.fragments;for(let r=0,n=t.length;r<n;r++)l0(t[r],s);e.fragmentHint&&l0(e.fragmentHint,s),e.alignedSliding=!0}function RI(s,e){s&&(zv(e,s),e.alignedSliding||Al(e,s),!e.alignedSliding&&!e.skippedSegments&&jv(s,e,!1))}function zv(s,e){if(!II(e,s))return;const t=Math.min(e.endCC,s.endCC),r=sa(e.fragments,t),n=sa(s.fragments,t);if(!r||!n)return;Be.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-n.start;Wv(i,s)}function Al(s,e){if(!s.hasProgramDateTime||!e.hasProgramDateTime)return;const t=s.fragments,r=e.fragments;if(!t.length||!r.length)return;let n,i;const o=Math.min(e.endCC,s.endCC);e.startCC<o&&s.startCC<o&&(n=sa(r,o),i=sa(t,o)),(!n||!i)&&(n=r[Math.floor(r.length/2)],i=sa(t,n.cc)||t[Math.floor(t.length/2)]);const u=n.programDateTime,c=i.programDateTime;if(!u||!c)return;const d=(c-u)/1e3-(i.start-n.start);Wv(d,s)}function Dt(s,e,t){jt(s,e,t),s.addEventListener(e,t)}function jt(s,e,t){s.removeEventListener(e,t)}const LI={toString:function(s){let e="";const t=s.length;for(let r=0;r<t;r++)e+=`[${s.start(r).toFixed(3)}-${s.end(r).toFixed(3)}]`;return e}},X={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Ah extends Pv{constructor(e,t,r,n,i){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=X.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:u,media:c,mediaBuffer:d,state:f}=this,g=c?c.currentTime:0,m=Re.bufferInfo(d||c,g,o.maxBufferHole),y=!m.len;if(this.log(`Media seeking to ${ue(g)?g.toFixed(3):g}, state: ${f}, ${y?"out of":"in"} buffer`),this.state===X.ENDED)this.resetLoadingState();else if(u){const v=o.maxFragLookUpTolerance,T=u.start-v,S=u.start+u.duration+v;if(y||S<m.start||T>m.end){const w=g>S;(g<T||w)&&(w&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(c){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(g>v&&(this.lastCurrentTime=g),!this.loadingParts){const T=Math.max(m.end,g),S=this.shouldLoadParts(this.getLevelDetails(),T);S&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${T.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,y&&(this.startPosition=g)),y&&this.state===X.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new nI(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Th(e.config)}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===X.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=X.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,n=this.config.timelineOffset||0;if(r<=n)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Re.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>n&&o<t.edge||this.media.currentTime<e.start)return!1;const c=t.partList;if(c!=null&&c.length){const f=c[c.length-1];return Re.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;Dt(r,"seeking",this.onMediaSeeking),Dt(r,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===X.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),jt(n,"seeking",this.onMediaSeeking),jt(n,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=X.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const n=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,n).then(i=>{if(!i)return;const o=this.state,u=i.frag;if(this.fragContextChanged(u)){(o===X.FRAG_LOADING||!this.fragCurrent&&o===X.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=X.IDLE);return}"payload"in i&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(_.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===X.STOPPED||this.state===X.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===ft.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength),c=this.backtrackFragment;((c?e.sn-c.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===ft.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:r};this.hls.trigger(_.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const n=r==null?void 0:r.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:n}=this,{frag:i,payload:o}=r,u=i.decryptdata;if(o&&o.byteLength>0&&u!=null&&u.key&&u.iv&&ti(u.method)){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer,_h(u.method)).catch(d=>{throw n.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(d=>{const f=self.performance.now();return n.trigger(_.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:c,tdecrypt:f}}),r.payload=d,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===X.STOPPED||this.state===X.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==X.STOPPED&&(this.state=X.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,n;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(n=i.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(u.message),!o||o.mediaKeys?!1:(this.hls.trigger(_.ERROR,{type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?LI.toString(Re.getBuffered(r)):"(detached)"})`),lt(e)){var n;if(e.type!==ge.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(u=>!!o[u])){this.state=X.IDLE;return}}const i=(n=this.levels)==null?void 0:n[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=X.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:n,partsLoaded:i}=e,o=!i||i.length===0||i.some(c=>!c),u=new xh(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,n){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=X.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(_.KEY_LOADED,m),this.state===X.KEY_LOADING&&(this.state=X.IDLE),m}),this.hls.trigger(_.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const c=this.fragPrevious;if(lt(e)&&(!c||e.sn!==c.sn)){const m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${c==null?void 0:c.sn}->${e.sn}`),this.loadingParts=m)}if(r=Math.max(e.start,r||0),this.loadingParts&&lt(e)){const m=o.partList;if(m&&n){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const y=this.getNextPart(m,e,r);if(y>-1){const v=m[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${m.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=X.FRAG_LOADING;let T;return u?T=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,v,t,n)).catch(S=>this.handleFragLoadError(S)):T=this.doFragPartsLoad(e,v,t,n).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(_.FRAG_LOADING,{frag:e,part:v,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(m,r))return Promise.resolve(null)}}if(lt(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=o.partList)==null?void 0:d.filter(m=>m.loaded).map(m=>`[${m.start}-${m.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),ue(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=X.FRAG_LOADING;const f=this.config.progressive;let g;return f&&u?g=u.then(m=>!m||this.fragContextChanged(m.frag)?null:this.fragmentLoader.load(e,n)).catch(m=>this.handleFragLoadError(m)):g=Promise.all([this.fragmentLoader.load(e,f?n:void 0),u]).then(([m])=>(!f&&n&&n(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(_.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,r,n){return new Promise((i,o)=>{var u;const c=[],d=(u=r.details)==null?void 0:u.partList,f=g=>{this.fragmentLoader.loadPart(e,g,n).then(m=>{c[g.index]=m;const y=m.part;this.hls.trigger(_.FRAG_LOADED,m);const v=a0(r.details,e.sn,g.index+1)||Kv(d,e.sn,g.index+1);if(v)f(v);else return i({frag:e,part:y,partsLoaded:c})}).catch(o)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===V.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ve.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(_.ERROR,t)}else this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==X.PARSING){!this.fragCurrent&&this.state!==X.STOPPED&&this.state!==X.ERROR&&(this.state=X.IDLE);return}const{frag:r,part:n,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,n&&(n.stats.parsing.end=o);const u=this.getLevelDetails(),d=u&&r.sn>u.endSN||this.shouldLoadParts(u,r.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(r,n,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===ge.SUBTITLE)return!1;const o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:n,sn:i,part:o}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const u=t[n],c=u.details,d=o>-1?a0(c,i,o):null,f=d?d.fragment:Vv(c,i,r);return f?(r&&r!==f&&(f.stats=r.stats),{frag:f,part:d,level:u}):null}bufferFragmentData(e,t,r,n,i){if(this.state!==X.PARSING)return;const{data1:o,data2:u}=e;let c=o;if(u&&(c=ur(o,u)),!c.length)return;const d=this.initPTS[t.cc],f=d?-d.baseTime/d.timescale:void 0,g={type:e.type,frag:t,part:r,chunkMeta:n,offset:f,parent:t.type,data:c};if(this.hls.trigger(_.BUFFER_APPENDING,g),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Re.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,n=Re.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),u=Math.max(Math.min(e.start-o,n.end-o),r+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var r;const n=this.getLoadPosition();if(!ue(n))return null;const o=this.lastCurrentTime>n||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,o)}getFwdBufferInfoAtPos(e,t,r,n){const i=Re.bufferInfo(e,t,n);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const u=Math.max(Math.min(i.nextStart,o.end)-t,n);return Re.bufferInfo(e,t,u)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,n=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,n);return i>=n?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=ge.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,n=r.length;if(!n)return null;const{config:i}=this,o=r[0].start,u=i.lowLatencyMode&&!!t.partList;let c=null;if(t.live){const g=i.initialLiveManifestSize;if(n<g)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var d;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),c=this.getInitialLiveFragment(t);const m=this.hls.startPosition,y=this.hls.liveSyncPosition,v=c?(m!==-1&&m>=o?m:y)||c.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${y} frag.start: ${(d=c)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=o&&(c=r[0]);if(!c){const g=this.loadingParts?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,g,t)}let f=this.filterReplacedPrimary(c,t);if(!f&&c){const g=c.sn-t.startSN;f=this.filterReplacedPrimary(r[g+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===ft.OK||r===ft.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,n,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n,0);if(u!==null&&r.len+u.len>=i){const c=o.sn;return this.loopSn!==c&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${c}`),this.loopSn=c),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(u0(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(u0(this.config)&&e.type!==ge.SUBTITLE){const r=this.hls.interstitialsManager,n=r==null?void 0:r.bufferingItem;if(n){const o=n.event;if(o){if(o.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&(t==null?void 0:t.live)===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let o=i.length;o--;){const u=i[o].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let n=-1,i=!1,o=!0;for(let u=0,c=e.length;u<c;u++){const d=e[u];if(o=o&&!d.independent,n>-1&&r<d.start)break;const f=d.loaded;f?n=-1:(i||(d.independent||o)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${d.start}`),n=u),i=f}return n}loadedEndOfParts(e,t){let r;for(let n=e.length;n--;){if(r=e[n],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=Hb(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(n=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=Lv(e,r.cc,r.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(n=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,r){const{config:n}=this;let{fragPrevious:i}=this,{fragments:o,endSN:u}=r;const{fragmentHint:c}=r,{maxFragLookUpTolerance:d}=n,f=r.partList,g=!!(this.loadingParts&&f!=null&&f.length&&c);g&&!this.bitrateTest&&f[f.length-1].fragment.sn===c.sn&&(o=o.concat(c),u=c.sn);let m;if(e<t){var y;const T=e<this.lastCurrentTime||e>t-d||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:d;m=cs(i,o,e,T)}else m=o[o.length-1];if(m){const v=m.sn-r.startSN,T=this.fragmentTracker.getState(m);if((T===ft.OK||T===ft.PARTIAL&&m.gap)&&(i=m),i&&m.sn===i.sn&&(!g||f[0].fragment.sn>m.sn||!r.live)&&m.level===i.level){const w=o[v+1];m.sn<u&&this.fragmentTracker.getState(w)!==ft.OK?m=w:m=null}}return m}alignPlaylists(e,t,r){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,u=e.alignedSliding&&ue(i);if(o||!u&&!i){RI(r,e);const c=e.fragmentStart;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),c}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const n=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&ue(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+n}this.nextLoadPosition=r+n}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&lt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==X.FRAG_LOADING_WAITING_RETRY)&&(this.state=X.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const w=this.getCurrentContext(t.chunkMeta);w&&(t.frag=w.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var i;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===V.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(n,!0);const u=t.errorAction;if(!u){this.state=X.ERROR;return}const{action:c,flags:d,retryCount:f=0,retryConfig:g}=u,m=!!g,y=m&&c===xt.RetryRequest,v=m&&!u.resolved&&d===qt.MoveAllAlternatesMatchingHost,T=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!y&&v&&lt(n)&&!n.endList&&T&&!Cv(t))this.resetFragmentErrors(e),this.treatAsGap(n),u.resolved=!0;else if((y||v)&&f<g.maxNumRetry){var S;const w=Gd((S=t.response)==null?void 0:S.code),b=Sh(g,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+b,this.state=X.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,w){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${b}ms`)}else if(g)if(this.resetFragmentErrors(e),f<g.maxNumRetry)!o&&c!==xt.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else c===xt.SendAlternateToPenaltyBox?this.state=X.WAITING_LEVEL:this.state=X.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Gd(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=X.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===X.PARSING||this.state===X.PARSED){const t=e.frag,r=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===ge.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==X.STOPPED&&(this.state=X.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const n=Re.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===X.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==X.STOPPED&&(this.state=X.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,n){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((c,d)=>{const f=e.elementaryStreams[d];if(f){const g=f.endPTS-f.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${g})`),c||!1;const m=n?0:$v(i,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(_.LEVEL_PTS_UPDATED,{details:i,level:r,drift:m,type:d,frag:e,start:f.startPTS,end:f.endPTS}),!0}return c},!1)){var u;if(r.fragmentError===0&&this.treatAsGap(e,r),((u=this.transmuxer)==null?void 0:u.error)===null){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=X.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(_.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ge.MAIN?"level":"track"}fragInfo(e,t=!0,r){var n,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((n=t&&!r?e.startPTS:(r||e).start)!=null?n:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function u0(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}class qv{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=kI(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function kI(s,e){const t=new Uint8Array(e);let r=0;for(let n=0;n<s.length;n++){const i=s[n];t.set(i,r),r+=i.length}return t}var Zc={exports:{}},c0;function CI(){return c0||(c0=1,(function(s){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function n(c,d,f){this.fn=c,this.context=d,this.once=f||!1}function i(c,d,f,g,m){if(typeof f!="function")throw new TypeError("The listener must be a function");var y=new n(f,g||c,m),v=t?t+d:d;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],y]:c._events[v].push(y):(c._events[v]=y,c._eventsCount++),c}function o(c,d){--c._eventsCount===0?c._events=new r:delete c._events[d]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var d=[],f,g;if(this._eventsCount===0)return d;for(g in f=this._events)e.call(f,g)&&d.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},u.prototype.listeners=function(d){var f=t?t+d:d,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,y=g.length,v=new Array(y);m<y;m++)v[m]=g[m].fn;return v},u.prototype.listenerCount=function(d){var f=t?t+d:d,g=this._events[f];return g?g.fn?1:g.length:0},u.prototype.emit=function(d,f,g,m,y,v){var T=t?t+d:d;if(!this._events[T])return!1;var S=this._events[T],w=arguments.length,b,A;if(S.fn){switch(S.once&&this.removeListener(d,S.fn,void 0,!0),w){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,f),!0;case 3:return S.fn.call(S.context,f,g),!0;case 4:return S.fn.call(S.context,f,g,m),!0;case 5:return S.fn.call(S.context,f,g,m,y),!0;case 6:return S.fn.call(S.context,f,g,m,y,v),!0}for(A=1,b=new Array(w-1);A<w;A++)b[A-1]=arguments[A];S.fn.apply(S.context,b)}else{var L=S.length,k;for(A=0;A<L;A++)switch(S[A].once&&this.removeListener(d,S[A].fn,void 0,!0),w){case 1:S[A].fn.call(S[A].context);break;case 2:S[A].fn.call(S[A].context,f);break;case 3:S[A].fn.call(S[A].context,f,g);break;case 4:S[A].fn.call(S[A].context,f,g,m);break;default:if(!b)for(k=1,b=new Array(w-1);k<w;k++)b[k-1]=arguments[k];S[A].fn.apply(S[A].context,b)}}return!0},u.prototype.on=function(d,f,g){return i(this,d,f,g,!1)},u.prototype.once=function(d,f,g){return i(this,d,f,g,!0)},u.prototype.removeListener=function(d,f,g,m){var y=t?t+d:d;if(!this._events[y])return this;if(!f)return o(this,y),this;var v=this._events[y];if(v.fn)v.fn===f&&(!m||v.once)&&(!g||v.context===g)&&o(this,y);else{for(var T=0,S=[],w=v.length;T<w;T++)(v[T].fn!==f||m&&!v[T].once||g&&v[T].context!==g)&&S.push(v[T]);S.length?this._events[y]=S.length===1?S[0]:S:o(this,y)}return this},u.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&o(this,f)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,s.exports=u})(Zc)),Zc.exports}var PI=CI(),bh=nb(PI);const pa="1.6.14",oi={};function DI(){return typeof __HLS_WORKER_BUNDLE__=="function"}function OI(){const s=oi[pa];if(s)return s.clientCount++,s;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return oi[pa]=n,n}function NI(s){const e=oi[s];if(e)return e.clientCount++,e;const t=new self.URL(s,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return oi[s]=n,n}function MI(s){const e=oi[s||pa];if(e&&e.clientCount--===1){const{worker:r,objectURL:n}=e;delete oi[s||pa],n&&self.URL.revokeObjectURL(n),r.terminate()}}function Yv(s,e){return e+10<=s.length&&s[e]===51&&s[e+1]===68&&s[e+2]===73&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function Ih(s,e){return e+10<=s.length&&s[e]===73&&s[e+1]===68&&s[e+2]===51&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function Ml(s,e){let t=0;return t=(s[e]&127)<<21,t|=(s[e+1]&127)<<14,t|=(s[e+2]&127)<<7,t|=s[e+3]&127,t}function ma(s,e){const t=e;let r=0;for(;Ih(s,e);){r+=10;const n=Ml(s,e+6);r+=n,Yv(s,e+10)&&(r+=10),e+=r}if(r>0)return s.subarray(t,t+r)}function FI(s,e,t,r){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const y=new Error(`invalid ADTS sampling index:${o}`);s.emit(_.ERROR,_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const u=(i>>6&3)+1,c=e[t+3]>>6&3|(i&1)<<2,d="mp4a.40."+u,f=n[o];let g=o;(u===5||u===29)&&(g-=3);const m=[u<<3|(g&14)>>1,(g&1)<<7|c<<3];return Be.log(`manifest codec:${r}, parsed codec:${d}, channels:${c}, rate:${f} (ADTS object type:${u} sampling index:${o})`),{config:m,samplerate:f,channelCount:c,codec:d,parsedCodec:d,manifestCodec:r}}function Qv(s,e){return s[e]===255&&(s[e+1]&246)===240}function Xv(s,e){return s[e+1]&1?7:9}function Rh(s,e){return(s[e+3]&3)<<11|s[e+4]<<3|(s[e+5]&224)>>>5}function UI(s,e){return e+5<s.length}function bl(s,e){return e+1<s.length&&Qv(s,e)}function BI(s,e){return UI(s,e)&&Qv(s,e)&&Rh(s,e)<=s.length-e}function $I(s,e){if(bl(s,e)){const t=Xv(s,e);if(e+t>=s.length)return!1;const r=Rh(s,e);if(r<=t)return!1;const n=e+r;return n===s.length||bl(s,n)}return!1}function Jv(s,e,t,r,n){if(!s.samplerate){const i=FI(e,t,r,n);if(!i)return;$e(s,i)}}function Zv(s){return 1024*9e4/s}function jI(s,e){const t=Xv(s,e);if(e+t<=s.length){const r=Rh(s,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function eE(s,e,t,r,n){const i=Zv(s.samplerate),o=r+n*i,u=jI(e,t);let c;if(u){const{frameLength:g,headerLength:m}=u,y=m+g,v=Math.max(0,t+y-e.length);v?(c=new Uint8Array(y-m),c.set(e.subarray(t+m,e.length),0)):c=e.subarray(t+m,t+y);const T={unit:c,pts:o};return v||s.samples.push(T),{sample:T,length:y,missing:v}}const d=e.length-t;return c=new Uint8Array(d),c.set(e.subarray(t,e.length),0),{sample:{unit:c,pts:o},length:d,missing:-1}}function GI(s,e){return Ih(s,e)&&Ml(s,e+6)+10<=s.length-e}function VI(s){return s instanceof ArrayBuffer?s:s.byteOffset==0&&s.byteLength==s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}function ed(s,e=0,t=1/0){return KI(s,e,t,Uint8Array)}function KI(s,e,t,r){const n=HI(s);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=WI(s)?s.byteOffset:0,u=(o+s.byteLength)/i,c=(o+e)/i,d=Math.floor(Math.max(0,Math.min(c,u))),f=Math.floor(Math.min(d+Math.max(t,0),u));return new r(n,d,f-d)}function HI(s){return s instanceof ArrayBuffer?s:s.buffer}function WI(s){return s&&s.buffer instanceof ArrayBuffer&&s.byteLength!==void 0&&s.byteOffset!==void 0}function zI(s){const e={key:s.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(s.size<2)return;if(s.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=s.data.subarray(1).indexOf(0);if(r===-1)return;const n=er(ed(s.data,1,r)),i=s.data[2+r],o=s.data.subarray(3+r).indexOf(0);if(o===-1)return;const u=er(ed(s.data,3+r,o));let c;return n==="-->"?c=er(ed(s.data,4+r+o)):c=VI(s.data.subarray(4+r+o)),e.mimeType=n,e.pictureType=i,e.description=u,e.data=c,e}function qI(s){if(s.size<2)return;const e=er(s.data,!0),t=new Uint8Array(s.data.subarray(e.length+1));return{key:s.type,info:e,data:t.buffer}}function YI(s){if(s.size<2)return;if(s.type==="TXXX"){let t=1;const r=er(s.data.subarray(t),!0);t+=r.length+1;const n=er(s.data.subarray(t));return{key:s.type,info:r,data:n}}const e=er(s.data.subarray(1));return{key:s.type,info:"",data:e}}function QI(s){if(s.type==="WXXX"){if(s.size<2)return;let t=1;const r=er(s.data.subarray(t),!0);t+=r.length+1;const n=er(s.data.subarray(t));return{key:s.type,info:r,data:n}}const e=er(s.data);return{key:s.type,info:"",data:e}}function XI(s){return s.type==="PRIV"?qI(s):s.type[0]==="W"?QI(s):s.type==="APIC"?zI(s):YI(s)}function JI(s){const e=String.fromCharCode(s[0],s[1],s[2],s[3]),t=Ml(s,4),r=10;return{type:e,size:t,data:s.subarray(r,r+t)}}const Ho=10,ZI=10;function tE(s){let e=0;const t=[];for(;Ih(s,e);){const r=Ml(s,e+6);s[e+5]>>6&1&&(e+=Ho),e+=Ho;const n=e+r;for(;e+ZI<n;){const i=JI(s.subarray(e)),o=XI(i);o&&t.push(o),e+=i.size+Ho}Yv(s,e)&&(e+=Ho)}return t}function rE(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function eR(s){if(s.data.byteLength===8){const e=new Uint8Array(s.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Lh(s){const e=tE(s);for(let t=0;t<e.length;t++){const r=e[t];if(rE(r))return eR(r)}}let Qt=(function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s})({});function Or(s="",e=9e4){return{type:s,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class kh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=ur(this.cachedData,e),this.cachedData=null);let r=ma(e,0),n=r?r.length:0,i;const o=this._audioTrack,u=this._id3Track,c=r?Lh(r):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&ue(c))&&(this.basePTS=tR(c,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Qt.audioId3,duration:Number.POSITIVE_INFINITY});n<d;){if(this.canParse(e,n)){const f=this.appendFrame(o,e,n);f?(this.frameIndex++,this.lastPTS=f.sample.pts,n+=f.length,i=n):n=d}else GI(e,n)?(r=ma(e,n),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Qt.audioId3,duration:Number.POSITIVE_INFINITY}),n+=r.length,i=n):n++;if(n===d&&i!==d){const f=e.slice(i);this.cachedData?this.cachedData=ur(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:Or(),id3Track:u,textTrack:Or()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Or(),id3Track:this._id3Track,textTrack:Or()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const tR=(s,e,t)=>{if(ue(s))return s*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Wo=null;const rR=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nR=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],sR=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],iR=[0,1,1,4];function nE(s,e,t,r,n){if(t+24>e.length)return;const i=sE(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,u=r+n*o,c={unit:e.subarray(t,t+i.frameLength),pts:u,dts:u};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(c),{sample:c,length:i.frameLength,missing:0}}}function sE(s,e){const t=s[e+1]>>3&3,r=s[e+1]>>1&3,n=s[e+2]>>4&15,i=s[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&i!==3){const o=s[e+2]>>1&1,u=s[e+3]>>6,c=t===3?3-r:r===3?3:4,d=rR[c*14+n-1]*1e3,g=nR[(t===3?0:t===2?1:2)*3+i],m=u===3?1:2,y=sR[t][r],v=iR[r],T=y*8*v,S=Math.floor(y*d/g+o)*v;if(Wo===null){const A=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Wo=A?parseInt(A[1]):0}return!!Wo&&Wo<=87&&r===2&&d>=224e3&&u===0&&(s[e+3]=s[e+3]|128),{sampleRate:g,channelCount:m,frameLength:S,samplesPerFrame:T}}}function Ch(s,e){return s[e]===255&&(s[e+1]&224)===224&&(s[e+1]&6)!==0}function iE(s,e){return e+1<s.length&&Ch(s,e)}function aR(s,e){return Ch(s,e)&&4<=s.length-e}function aE(s,e){if(e+1<s.length&&Ch(s,e)){const r=sE(s,e);let n=4;r!=null&&r.frameLength&&(n=r.frameLength);const i=e+n;return i===s.length||iE(s,i)}return!1}class oR extends kh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=ma(e,0);let n=(r==null?void 0:r.length)||0;if(aE(e,n))return!1;for(let i=e.length;n<i;n++)if($I(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return BI(e,t)}appendFrame(e,t,r){Jv(e,this.observer,t,r,e.manifestCodec);const n=eE(e,t,r,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const oE=(s,e)=>{let t=0,r=5;e+=r;const n=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=s[e];const u=Math.min(r,8),c=8-u;i[0]=4278190080>>>24+c<<c,n[0]=(o[0]&i[0])>>c,t=t?t<<u|n[0]:n[0],e+=1,r-=u}return t};class lR extends kh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const n=lE(e,t,r,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=ma(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Lh(t)!==void 0&&oE(e,r)<16}}function lE(s,e,t,r,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const u=[48e3,44100,32e3][i],c=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][c*3+i]*2;if(t+f>e.length)return-1;const g=e[t+6]>>5;let m=0;g===2?m+=2:(g&1&&g!==1&&(m+=2),g&4&&(m+=2));const y=(e[t+6]<<8|e[t+7])>>12-m&1,T=[2,1,2,3,3,4,4,5][g]+y,S=e[t+5]>>3,w=e[t+5]&7,b=new Uint8Array([i<<6|S<<1|w>>2,(w&3)<<6|g<<3|y<<2|c>>4,c<<4&224]),A=1536/u*9e4,L=r+n*A,k=e.subarray(t,t+f);return s.config=b,s.channelCount=T,s.samplerate=u,s.samples.push({unit:k,pts:L}),f}class uR extends kh{resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ma(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Lh(t)!==void 0&&oE(e,r)<=16)return!1;for(let n=e.length;r<n;r++)if(aE(e,r))return Be.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return aR(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return nE(e,t,r,this.basePTS,this.frameIndex)}}const cR=/\/emsg[-/]ID3/i;class dR{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,n){const i=this.videoTrack=Or("video",1),o=this.audioTrack=Or("audio",1),u=this.txtTrack=Or("text",1);if(this.id3Track=Or("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const c=vv(e);if(c.video){const{id:d,timescale:f,codec:g,supplemental:m}=c.video;i.id=d,i.timescale=u.timescale=f,i.codec=g,i.supplemental=m}if(c.audio){const{id:d,timescale:f,codec:g}=c.audio;o.id=d,o.timescale=f,o.codec=g}u.id=pv.text,i.sampleDuration=0,i.duration=o.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return lb(e)}demux(e,t){this.timeOffset=t;let r=e;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=ur(this.remainderData,e));const u=pb(r);this.remainderData=u.remainder,n.samples=u.valid||new Uint8Array}else n.samples=r;const o=this.extractID3Track(n,t);return i.samples=Rm(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return r.samples=Rm(e,t),{videoTrack:t,audioTrack:Or(),id3Track:n,textTrack:Or()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const n=ke(e.samples,["emsg"]);n&&n.forEach(i=>{const o=yb(i);if(cR.test(o.schemeIdUri)){const u=d0(o,t);let c=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);const d=o.payload;r.samples.push({data:d,len:d.byteLength,dts:u,pts:u,type:Qt.emsg,duration:c})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=d0(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:u,pts:u,type:Qt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function d0(s,e){return ue(s.presentationTime)?s.presentationTime/s.timeScale:e+s.presentationTimeDelta/s.timeScale}class hR{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Th(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Dn.cbc)}decryptAacSample(e,t,r){const n=e[t].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(u=>{const c=new Uint8Array(u);n.set(c,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)e.set(r.subarray(n,n+16),i);return e}decryptAvcSample(e,t,r,n,i){const o=Tv(i.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(c=>{i.data=this.getAvcDecryptedUnit(o,c),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,n)}).catch(n)}decryptAvcSamples(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){n();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,n,o),!this.decrypter.isSync()))return}}}}class uE{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,n;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;n=i[i.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,n=r.length;if(n){const i=r[n-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const n=t.byteLength;let i=e.naluState||0;const o=i,u=[];let c=0,d,f,g,m=-1,y=0;for(i===-1&&(m=0,y=this.getNALuType(t,0),i=0,c=1);c<n;){if(d=t[c++],!i){i=d?0:1;continue}if(i===1){i=d?0:2;continue}if(!d)i=3;else if(d===1){if(f=c-i-1,m>=0){const v={data:t.subarray(m,f),type:y};u.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(o&&c<=4-o&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-o)),f>0&&(v.data=ur(v.data,t.subarray(0,f)),v.state=0))}c<n?(g=this.getNALuType(t,c),m=c,y=g,i=0):i=-1}else i=0}if(m>=0&&i>=0){const v={data:t.subarray(m,n),type:y,state:i};u.push(v)}if(u.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=ur(v.data,t))}return e.naluState=i,u}}class ia{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Be.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class fR extends uE{parsePES(e,t,r,n){const i=this.parseNALu(e,r.data,n);let o=this.VideoSample,u,c=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(d=>{var f,g;switch(d.type){case 1:{let T=!1;u=!0;const S=d.data;if(c&&S.length>4){const w=this.readSliceType(S);(w===2||w===4||w===7||w===9)&&(T=!0)}if(T){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=T;break}case 5:u=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{u=!0,yh(d.data,1,r.pts,t.samples);break}case 7:{var y,v;u=!0,c=!0;const T=d.data,S=this.readSPS(T);if(!e.sps||e.width!==S.width||e.height!==S.height||((y=e.pixelRatio)==null?void 0:y[0])!==S.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[T];const w=T.subarray(1,4);let b="avc1.";for(let A=0;A<3;A++){let L=w[A].toString(16);L.length<2&&(L="0"+L),b+=L}e.codec=b}break}case 8:u=!0,e.pps=[d.data];break;case 9:u=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:u=!0;break;default:u=!1;break}o&&u&&o.units.push(d)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ia(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,n=8,i;for(let o=0;o<e;o++)n!==0&&(i=t.readEG(),n=(r+i+256)%256),r=n===0?r:n}readSPS(e){const t=new ia(e);let r=0,n=0,i=0,o=0,u,c,d;const f=t.readUByte.bind(t),g=t.readBits.bind(t),m=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),T=t.skipEG.bind(t),S=t.skipUEG.bind(t),w=this.skipScalingList.bind(this);f();const b=f();if(g(5),v(3),f(),S(),b===100||b===110||b===122||b===244||b===44||b===83||b===86||b===118||b===128){const $=m();if($===3&&v(1),S(),S(),v(1),y())for(c=$!==3?8:12,d=0;d<c;d++)y()&&(d<6?w(16,t):w(64,t))}S();const A=m();if(A===0)m();else if(A===1)for(v(1),T(),T(),u=m(),d=0;d<u;d++)T();S(),v(1);const L=m(),k=m(),O=g(1);O===0&&v(1),v(1),y()&&(r=m(),n=m(),i=m(),o=m());let P=[1,1];if(y()&&y())switch(f()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((L+1)*16-r*2-n*2),height:(2-O)*(k+1)*16-(O?2:4)*(i+o),pixelRatio:P}}}class gR extends uE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,n){const i=this.parseNALu(e,r.data,n);let o=this.VideoSample,u,c=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(d=>{var f,g;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,c){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:u=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:u=!0,yh(d.data,2,r.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=$e(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(u=!0,c=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(d.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,d.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(d.data);for(const v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:u=!1;break}o&&u&&o.units.push(d)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[r]=e[n],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ia(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:n}}readSPS(e){const t=new ia(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const n=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=t.readUByte(),T=t.readUByte(),S=t.readUByte(),w=t.readUByte(),b=[],A=[];for(let Oe=0;Oe<r;Oe++)b.push(t.readBoolean()),A.push(t.readBoolean());if(r>0)for(let Oe=r;Oe<8;Oe++)t.readBits(2);for(let Oe=0;Oe<r;Oe++)b[Oe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),A[Oe]&&t.readUByte();t.readUEG();const L=t.readUEG();L==3&&t.skipBits(1);const k=t.readUEG(),O=t.readUEG(),P=t.readBoolean();let $=0,B=0,U=0,q=0;P&&($+=t.readUEG(),B+=t.readUEG(),U+=t.readUEG(),q+=t.readUEG());const re=t.readUEG(),ae=t.readUEG(),le=t.readUEG(),oe=t.readBoolean();for(let Oe=oe?0:r;Oe<=r;Oe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let it=0;it<4;it++)for(let Lt=0;Lt<(it===3?2:6);Lt++)if(!t.readBoolean())t.readUEG();else{const vt=Math.min(64,1<<4+(it<<1));it>1&&t.readEG();for(let Gt=0;Gt<vt;Gt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const F=t.readUEG();let Y=0;for(let Oe=0;Oe<F;Oe++){let it=!1;if(Oe!==0&&(it=t.readBoolean()),it){Oe===F&&t.readUEG(),t.readBoolean(),t.readUEG();let Lt=0;for(let dr=0;dr<=Y;dr++){const vt=t.readBoolean();let Gt=!1;vt||(Gt=t.readBoolean()),(vt||Gt)&&Lt++}Y=Lt}else{const Lt=t.readUEG(),dr=t.readUEG();Y=Lt+dr;for(let vt=0;vt<Lt;vt++)t.readUEG(),t.readBoolean();for(let vt=0;vt<dr;vt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Oe=t.readUEG();for(let it=0;it<Oe;it++){for(let Lt=0;Lt<le+4;Lt++)t.readBits(1);t.readBits(1)}}let C=0,N=1,te=1,ce=!0,de=1,fe=0;t.readBoolean(),t.readBoolean();let Le=!1;if(t.readBoolean()){if(t.readBoolean()){const hr=t.readUByte(),hi=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Fn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];hr>0&&hr<16?(N=hi[hr-1],te=Fn[hr-1]):hr===255&&(N=t.readBits(16),te=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Le=t.readBoolean(),Le&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(de=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Fn=t.readBoolean(),fi=t.readBoolean();let rn=!1;(Fn||fi)&&(rn=t.readBoolean(),rn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),rn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let hs=0;hs<=r;hs++){ce=t.readBoolean();const fs=ce||t.readBoolean();let gi=!1;fs?t.readEG():gi=t.readBoolean();const nn=gi?1:t.readUEG()+1;if(Fn)for(let fr=0;fr<nn;fr++)t.readUEG(),t.readUEG(),rn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(fi)for(let fr=0;fr<nn;fr++)t.readUEG(),t.readUEG(),rn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let De=k,ze=O;if(P){let Oe=1,it=1;L===1?Oe=it=2:L==2&&(Oe=2),De=k-Oe*B-Oe*$,ze=O-it*q-it*U}const tr=n?["A","B","C"][n]:"",Ta=u<<24|c<<16|d<<8|f;let tn=0;for(let Oe=0;Oe<32;Oe++)tn=(tn|(Ta>>Oe&1)<<31-Oe)>>>0;let Mn=tn.toString(16);return o===1&&Mn==="2"&&(Mn="6"),{codecString:`hvc1.${tr}${o}.${Mn}.${i?"H":"L"}${w}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:n,general_profile_compatibility_flags:[u,c,d,f],general_constraint_indicator_flags:[g,m,y,v,T,S],general_level_idc:w,bit_depth:re+8,bit_depth_luma_minus8:re,bit_depth_chroma_minus8:ae,min_spatial_segmentation_idc:C,chroma_format_idc:L,frame_rate:{fixed:ce,fps:fe/de}},width:De,height:ze,pixelRatio:[N,te]}}readPPS(e){const t=new ia(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),i=t.readBoolean();let o=1;return i&&n?o=0:i?o=3:n&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const yt=188;class Rn{constructor(e,t,r,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=n,this.videoParser=null}static probe(e,t){const r=Rn.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(yt*5,t-yt)+1,n=0;for(;n<r;){let i=!1,o=-1,u=0;for(let c=n;c<t;c+=yt)if(e[c]===71&&(t-c===yt||e[c+yt]===71)){if(u++,o===-1&&(o=c,o!==0&&(r=Math.min(o+yt*99,e.length-yt)+1)),i||(i=zd(e,c)===0),i&&u>1&&(o===0&&u>2||c+yt>r))return o}else{if(u)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:pv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Rn.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Rn.createTrack("audio",n),this._id3Track=Rn.createTrack("id3"),this._txtTrack=Rn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,n=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,u=this._audioTrack,c=this._id3Track,d=this._txtTrack;let f=o.pid,g=o.pesData,m=u.pid,y=c.pid,v=u.pesData,T=c.pesData,S=null,w=this.pmtParsed,b=this._pmtId,A=e.length;if(this.remainderData&&(e=ur(this.remainderData,e),A=e.length,this.remainderData=null),A<yt&&!n)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:c,textTrack:d};const L=Math.max(0,Rn.syncOffset(e));A-=(A-L)%yt,A<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,A,e.buffer.byteLength-A));let k=0;for(let P=L;P<A;P+=yt)if(e[P]===71){const $=!!(e[P+1]&64),B=zd(e,P),U=(e[P+3]&48)>>4;let q;if(U>1){if(q=P+5+e[P+4],q===P+yt)continue}else q=P+4;switch(B){case f:$&&(g&&(i=Hs(g,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,i,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(q,P+yt)),g.size+=P+yt-q);break;case m:if($){if(v&&(i=Hs(v,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,i);break;case"mp3":this.parseMPEGPES(u,i);break;case"ac3":this.parseAC3PES(u,i);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(q,P+yt)),v.size+=P+yt-q);break;case y:$&&(T&&(i=Hs(T,this.logger))&&this.parseID3PES(c,i),T={data:[],size:0}),T&&(T.data.push(e.subarray(q,P+yt)),T.size+=P+yt-q);break;case 0:$&&(q+=e[q]+1),b=this._pmtId=pR(e,q);break;case b:{$&&(q+=e[q]+1);const re=mR(e,q,this.typeSupported,r,this.observer,this.logger);f=re.videoPid,f>0&&(o.pid=f,o.segmentCodec=re.segmentVideoCodec),m=re.audioPid,m>0&&(u.pid=m,u.segmentCodec=re.segmentAudioCodec),y=re.id3Pid,y>0&&(c.pid=y),S!==null&&!w&&(this.logger.warn(`MPEG-TS PMT found at ${P} after unknown PID '${S}'. Backtracking to sync byte @${L} to parse all TS packets.`),S=null,P=L-188),w=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=B;break}}else k++;k>0&&qd(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=g,u.pesData=v,c.pesData=T;const O={audioTrack:u,videoTrack:o,id3Track:c,textTrack:d};return n&&this.extractRemainingSamples(O),O}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:n,textTrack:i}=e,o=r.pesData,u=t.pesData,c=n.pesData;let d;if(o&&(d=Hs(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,d,!0),r.pesData=null)):r.pesData=o,u&&(d=Hs(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;c&&(d=Hs(c,this.logger))?(this.parseID3PES(n,d),n.pesData=null):n.pesData=c}demuxSampleAes(e,t,r){const n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new hR(this.observer,this.config,t);return this.decrypt(n,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new fR:e==="hevc"&&(this.videoParser=new gR))}decrypt(e,t){return new Promise(r=>{const{audioTrack:n,videoTrack:i}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const n=this.aacOverFlow;let i=t.data;if(n){this.aacOverFlow=null;const g=n.missing,m=n.sample.unit.byteLength;if(g===-1)i=ur(n.sample.unit,i);else{const y=m-g;n.sample.unit.set(i.subarray(0,g),y),e.samples.push(n.sample),r=n.missing}}let o,u;for(o=r,u=i.length;o<u-1&&!bl(i,o);o++);if(o!==r){let g;const m=o<u-1;if(m?g=`AAC PES did not start with ADTS header,offset:${o}`:g="No ADTS header found in AAC PES",qd(this.observer,new Error(g),m,this.logger),!m)return}Jv(e,this.observer,i,o,this.audioCodec);let c;if(t.pts!==void 0)c=t.pts;else if(n){const g=Zv(e.samplerate);c=n.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,f;for(;o<u;)if(f=eE(e,i,o,c,d),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(d++;o<u-1&&!bl(i,o);o++);}parseMPEGPES(e,t){const r=t.data,n=r.length;let i=0,o=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<n;)if(iE(r,o)){const c=nE(e,r,o,u,i);if(c)o+=c.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,u=0,c;for(;u<i&&(c=lE(e,r,u,n,o++))>0;)u+=c}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=$e({},t,{type:this._videoTrack?Qt.emsg:Qt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function zd(s,e){return((s[e+1]&31)<<8)+s[e+2]}function pR(s,e){return(s[e+10]&31)<<8|s[e+11]}function mR(s,e,t,r,n,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(s[e+1]&15)<<8|s[e+2],c=e+3+u-4,d=(s[e+10]&15)<<8|s[e+11];for(e+=12+d;e<c;){const f=zd(s,e),g=(s[e+3]&15)<<8|s[e+4];switch(s[e]){case 207:if(!r){td("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!r){td("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!r){td("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&g>0){let m=e+5,y=g;for(;y>2;){switch(s[m]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const T=s[m+1]+2;m+=T,y-=T}}break;case 194:case 135:return qd(n,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=g+5}return o}function qd(s,e,t,r){r.warn(`parsing error: ${e.message}`),s.emit(_.ERROR,_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function td(s,e){e.log(`${s} with AES-128-CBC encryption found in unencrypted stream`)}function Hs(s,e){let t=0,r,n,i,o,u;const c=s.data;if(!s||s.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=ur(c[0],c[1]),c.splice(1,1);if(r=c[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(n=(r[4]<<8)+r[5],n&&n>s.size-6)return null;const f=r[7];f&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,f&64?(u=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-u>60*9e4&&(e.warn(`${Math.round((o-u)/9e4)}s delta between PTS and DTS, align them`),o=u)):u=o),i=r[8];let g=i+9;if(s.size<=g)return null;s.size-=g;const m=new Uint8Array(s.size);for(let y=0,v=c.length;y<v;y++){r=c[y];let T=r.byteLength;if(g)if(g>T){g-=T;continue}else r=r.subarray(g),T-=g,g=0;m.set(r,t),t+=T}return n&&(n-=i+3),{data:m,pts:o,dts:u,len:n}}return null}class yR{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const An=Math.pow(2,32)-1;class G{static init(){G.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in G.types)G.types.hasOwnProperty(e)&&(G.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);G.HDLR_TYPES={video:t,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);G.STTS=G.STSC=G.STCO=i,G.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),G.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),G.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),G.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);G.FTYP=G.box(G.types.ftyp,o,c,o,u),G.DINF=G.box(G.types.dinf,G.box(G.types.dref,n))}static box(e,...t){let r=8,n=t.length;const i=n;for(;n--;)r+=t[n].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),n=0,r=8;n<i;n++)o.set(t[n],r),r+=t[n].byteLength;return o}static hdlr(e){return G.box(G.types.hdlr,G.HDLR_TYPES[e])}static mdat(e){return G.box(G.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(An+1)),n=Math.floor(t%(An+1));return G.box(G.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return G.box(G.types.mdia,G.mdhd(e.timescale||0,e.duration||0),G.hdlr(e.type),G.minf(e))}static mfhd(e){return G.box(G.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?G.box(G.types.minf,G.box(G.types.smhd,G.SMHD),G.DINF,G.stbl(e)):G.box(G.types.minf,G.box(G.types.vmhd,G.VMHD),G.DINF,G.stbl(e))}static moof(e,t,r){return G.box(G.types.moof,G.mfhd(e),G.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=G.trak(e[t]);return G.box.apply(null,[G.types.moov,G.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(G.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=G.trex(e[t]);return G.box.apply(null,[G.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(An+1)),n=Math.floor(t%(An+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return G.box(G.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let n,i;for(n=0;n<t.length;n++)i=t[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return G.box(G.types.sdtp,r)}static stbl(e){return G.box(G.types.stbl,G.stsd(e),G.box(G.types.stts,G.STTS),G.box(G.types.stsc,G.STSC),G.box(G.types.stsz,G.STSZ),G.box(G.types.stco,G.STCO))}static avc1(e){let t=[],r=[],n,i,o;for(n=0;n<e.sps.length;n++)i=e.sps[n],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)i=e.pps[n],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const u=G.box(G.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),c=e.width,d=e.height,f=e.pixelRatio[0],g=e.pixelRatio[1];return G.box(G.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,G.box(G.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),G.box(G.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return G.box(G.types.mp4a,G.audioStsd(e),G.box(G.types.esds,G.esds(e)))}static mp3(e){return G.box(G.types[".mp3"],G.audioStsd(e))}static ac3(e){return G.box(G.types["ac-3"],G.audioStsd(e),G.box(G.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return G.box(G.types.stsd,G.STSD,G.mp4a(e));if(t==="ac3"&&e.config)return G.box(G.types.stsd,G.STSD,G.ac3(e));if(t==="mp3"&&e.codec==="mp3")return G.box(G.types.stsd,G.STSD,G.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return G.box(G.types.stsd,G.STSD,G.avc1(e));if(t==="hevc"&&e.vps)return G.box(G.types.stsd,G.STSD,G.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),n=e.width||0,i=e.height||0,o=Math.floor(r/(An+1)),u=Math.floor(r%(An+1));return G.box(G.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=G.sdtp(e),n=e.id,i=Math.floor(t/(An+1)),o=Math.floor(t%(An+1));return G.box(G.types.traf,G.box(G.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),G.box(G.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),G.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,G.box(G.types.trak,G.tkhd(e),G.mdia(e))}static trex(e){const t=e.id;return G.box(G.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],n=r.length,i=12+16*n,o=new Uint8Array(i);let u,c,d,f,g,m;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<n;u++)c=r[u],d=c.duration,f=c.size,g=c.flags,m=c.cts,o.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*u);return G.box(G.types.trun,o)}static initSegment(e){G.types||G.init();const t=G.moov(e);return ur(G.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],n=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let v=0;v<r.length;v+=1){o+=3;for(let T=0;T<r[v].length;T+=1)o+=2+r[v][T].length}const u=new Uint8Array(o);u.set(i,0),o=i.length;const c=r.length-1;for(let v=0;v<r.length;v+=1){u.set(new Uint8Array([32+v|(v===c?128:0),0,r[v].length]),o),o+=3;for(let T=0;T<r[v].length;T+=1)u.set(new Uint8Array([r[v][T].length>>8,r[v][T].length&255]),o),o+=2,u.set(r[v][T],o),o+=r[v][T].length}const d=G.box(G.types.hvcC,u),f=e.width,g=e.height,m=e.pixelRatio[0],y=e.pixelRatio[1];return G.box(G.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,G.box(G.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),G.box(G.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,y>>24,y>>16&255,y>>8&255,y&255])))}}G.types=void 0;G.HDLR_TYPES=void 0;G.STTS=void 0;G.STSC=void 0;G.STCO=void 0;G.STSZ=void 0;G.VMHD=void 0;G.SMHD=void 0;G.STSD=void 0;G.FTYP=void 0;G.DINF=void 0;const cE=9e4;function Ph(s,e,t=1,r=!1){const n=s*e*t;return r?Math.round(n):n}function vR(s,e,t=1,r=!1){return Ph(s,e,1/t,r)}function Ji(s,e=!1){return Ph(s,1e3,1/cE,e)}function ER(s,e=1){return Ph(s,cE,1/e)}function h0(s){const{baseTime:e,timescale:t,trackId:r}=s;return`${e/t} (${e}/${t}) trackId: ${r}`}const SR=10*1e3,TR=1024,xR=1152,_R=1536;let Ws=null,rd=null;function f0(s,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}class il extends cr{constructor(e,t,r,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Ws===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ws=o?parseInt(o[1]):0}if(rd===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);rd=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&h0(t)} > ${e&&h0(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,n=e.reduce((i,o)=>{let u=o.pts,c=u-i;return c<-4294967296&&(t=!0,u=Yt(u,r),c=u-i),c>0?i:u},r);return t&&this.debug("PTS rollover detected"),n}remux(e,t,r,n,i,o,u,c){let d,f,g,m,y,v,T=i,S=i;const w=e.pid>-1,b=t.pid>-1,A=t.samples.length,L=e.samples.length>0,k=u&&A>0||A>1;if((!w||L)&&(!b||k)||this.ISGenerated||u){if(this.ISGenerated){var P,$,B,U;const le=this.videoTrackConfig;(le&&(t.width!==le.width||t.height!==le.height||((P=t.pixelRatio)==null?void 0:P[0])!==(($=le.pixelRatio)==null?void 0:$[0])||((B=t.pixelRatio)==null?void 0:B[1])!==((U=le.pixelRatio)==null?void 0:U[1]))||!le&&k||this.nextAudioTs===null&&L)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,i,o));const q=this.isVideoContiguous;let re=-1,ae;if(k&&(re=wR(t.samples),!q&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,re>0){this.warn(`Dropped ${re} out of ${A} video samples due to a missing keyframe`);const le=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(re),t.dropped+=re,S+=(t.samples[0].pts-le)/t.inputTimeScale,ae=S}else re===-1&&(this.warn(`No keyframe found out of ${A} video samples`),v=!1);if(this.ISGenerated){if(L&&k){const le=this.getVideoStartPts(t.samples),J=(Yt(e.samples[0].pts,le)-le)/t.inputTimeScale;T+=Math.max(0,J),S+=Math.max(0,-J)}if(L){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,i,o)),f=this.remuxAudio(e,T,this.isAudioContiguous,o,b||k||c===ge.AUDIO?S:void 0),k){const le=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,i,o)),d=this.remuxVideo(t,S,q,le)}}else k&&(d=this.remuxVideo(t,S,q,0));d&&(d.firstKeyFrame=re,d.independent=re!==-1,d.firstKeyFramePTS=ae)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(y=dE(r,i,this._initPTS,this._initDTS)),n.samples.length&&(m=hE(n,i,this._initPTS))),{audio:f,video:d,initSegment:g,independent:v,text:m,id3:y}}computeInitPts(e,t,r,n){const i=Math.round(r*t);let o=Yt(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${n}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,r,n){const i=e.samples,o=t.samples,u=this.typeSupported,c={},d=this._initPTS;let f=!d||n,g="audio/mp4",m,y,v,T=-1;if(f&&(m=y=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(g="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}c.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):G.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(T=e.id,v=e.inputTimeScale,!d||v!==d.timescale?m=y=this.computeInitPts(i[0].pts,v,r,"audio"):f=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:G.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(T=t.id,v=t.inputTimeScale,!d||v!==d.timescale){const S=this.getVideoStartPts(o),w=Yt(o[0].dts,S),b=this.computeInitPts(w,v,r,"video"),A=this.computeInitPts(S,v,r,"video");y=Math.min(y,b),m=Math.min(m,A)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,f?(d&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${r} ${m/v} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${m/v} (${m}/${v}) trackId: ${T}`),this._initPTS={baseTime:m,timescale:v,trackId:T},this._initDTS={baseTime:y,timescale:v,trackId:T}):m=v=void 0,{tracks:c,initPTS:m,timescale:v,trackId:T}}remuxVideo(e,t,r,n){const i=e.inputTimeScale,o=e.samples,u=[],c=o.length,d=this._initPTS,f=d.baseTime*i/d.timescale;let g=this.nextVideoTs,m=8,y=this.videoSampleDuration,v,T,S=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,b=!1;if(!r||g===null){const C=f+t*i,N=o[0].pts-Yt(o[0].dts,o[0].pts);Ws&&g!==null&&Math.abs(C-N-(g+f))<15e3?r=!0:g=C-N-f}const A=g+f;for(let C=0;C<c;C++){const N=o[C];N.pts=Yt(N.pts,A),N.dts=Yt(N.dts,A),N.dts<o[C>0?C-1:C].dts&&(b=!0)}b&&o.sort(function(C,N){const te=C.dts-N.dts,ce=C.pts-N.pts;return te||ce}),v=o[0].dts,T=o[o.length-1].dts;const L=T-v,k=L?Math.round(L/(c-1)):y||e.inputTimeScale/30;if(r){const C=v-A,N=C>k,te=C<-1;if((N||te)&&(N?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ji(C,!0)} ms (${C}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ji(-C,!0)} ms (${C}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!te||A>=o[0].pts||Ws)){v=A;const ce=o[0].pts-C;if(N)o[0].dts=v,o[0].pts=ce;else{let de=!0;for(let fe=0;fe<o.length&&!(o[fe].dts>ce&&de);fe++){const Le=o[fe].pts;if(o[fe].dts-=C,o[fe].pts-=C,fe<o.length-1){const Ae=o[fe+1].pts,De=o[fe].pts,ze=Ae<=De,tr=Ae<=Le;de=ze==tr}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ji(ce,!0)}/${Ji(v,!0)}, delta: ${Ji(C,!0)} ms`)}}v=Math.max(0,v);let O=0,P=0,$=v;for(let C=0;C<c;C++){const N=o[C],te=N.units,ce=te.length;let de=0;for(let fe=0;fe<ce;fe++)de+=te[fe].data.length;P+=de,O+=ce,N.length=de,N.dts<$?(N.dts=$,$+=k/4|0||1):$=N.dts,S=Math.min(N.pts,S),w=Math.max(N.pts,w)}T=o[c-1].dts;const B=P+4*O+8;let U;try{U=new Uint8Array(B)}catch(C){this.observer.emit(_.ERROR,_.ERROR,{type:ve.MUX_ERROR,details:V.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:B,reason:`fail allocating video mdat ${B}`});return}const q=new DataView(U.buffer);q.setUint32(0,B),U.set(G.types.mdat,4);let re=!1,ae=Number.POSITIVE_INFINITY,le=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY;for(let C=0;C<c;C++){const N=o[C],te=N.units;let ce=0;for(let Le=0,Ae=te.length;Le<Ae;Le++){const De=te[Le],ze=De.data,tr=De.data.byteLength;q.setUint32(m,tr),m+=4,U.set(ze,m),m+=tr,ce+=4+tr}let de;if(C<c-1)y=o[C+1].dts-N.dts,de=o[C+1].pts-N.pts;else{const Le=this.config,Ae=C>0?N.dts-o[C-1].dts:k;if(de=C>0?N.pts-o[C-1].pts:k,Le.stretchShortVideoTrack&&this.nextAudioTs!==null){const De=Math.floor(Le.maxBufferHole*i),ze=(n?S+n*i:this.nextAudioTs+f)-N.pts;ze>De?(y=ze-Ae,y<0?y=Ae:re=!0,this.log(`It is approximately ${ze/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=Ae}else y=Ae}const fe=Math.round(N.pts-N.dts);ae=Math.min(ae,y),oe=Math.max(oe,y),le=Math.min(le,de),J=Math.max(J,de),u.push(f0(N.key,y,ce,fe))}if(u.length){if(Ws){if(Ws<70){const C=u[0].flags;C.dependsOn=2,C.isNonSync=0}}else if(rd&&J-le<oe-ae&&k/oe<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let C=v;for(let N=0,te=u.length;N<te;N++){const ce=C+u[N].duration,de=C+u[N].cts;if(N<te-1){const fe=ce+u[N+1].cts;u[N].duration=fe-de}else u[N].duration=N?u[N-1].duration:k;u[N].cts=0,C=ce}}}y=re||!y?k:y;const se=T+y;this.nextVideoTs=g=se-f,this.videoSampleDuration=y,this.isVideoContiguous=!0;const Q={data1:G.moof(e.sequenceNumber++,v,$e(e,{samples:u})),data2:U,startPTS:(S-f)/i,endPTS:(w+y-f)/i,startDTS:(v-f)/i,endDTS:g/i,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Q}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return xR;case"ac3":return _R;default:return TR}}remuxAudio(e,t,r,n,i){const o=e.inputTimeScale,u=e.samplerate?e.samplerate:o,c=o/u,d=this.getSamplesPerFrame(e),f=d*c,g=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=i!==void 0;let T=e.samples,S=m?0:8,w=this.nextAudioTs||-1;const b=g.baseTime*o/g.timescale,A=b+t*o;if(this.isAudioContiguous=r=r||T.length&&w>0&&(n&&Math.abs(A-(w+b))<9e3||Math.abs(Yt(T[0].pts,A)-(w+b))<20*f),T.forEach(function(J){J.pts=Yt(J.pts,A)}),!r||w<0){const J=T.length;if(T=T.filter(se=>se.pts>=0),J!==T.length&&this.warn(`Removed ${T.length-J} of ${J} samples (initPTS ${b} / ${o})`),!T.length)return;i===0?w=0:n&&!v?w=Math.max(0,A-b):w=T[0].pts-b}if(e.segmentCodec==="aac"){const J=this.config.maxAudioFramesDrift;for(let se=0,F=w+b;se<T.length;se++){const Y=T[se],Q=Y.pts,C=Q-F,N=Math.abs(1e3*C/o);if(C<=-J*f&&v)se===0&&(this.warn(`Audio frame @ ${(Q/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*C/o)} ms.`),this.nextAudioTs=w=Q-b,F=Q);else if(C>=J*f&&N<SR&&v){let te=Math.round(C/f);for(F=Q-te*f;F<0&&te&&f;)te--,F+=f;se===0&&(this.nextAudioTs=w=F-b),this.warn(`Injecting ${te} audio frames @ ${((F-b)/o).toFixed(3)}s due to ${Math.round(1e3*C/o)} ms gap.`);for(let ce=0;ce<te;ce++){let de=yR.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);de||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),de=Y.unit.subarray()),T.splice(se,0,{unit:de,pts:F}),F+=f,se++}}Y.pts=F,F+=f}}let L=null,k=null,O,P=0,$=T.length;for(;$--;)P+=T[$].unit.byteLength;for(let J=0,se=T.length;J<se;J++){const F=T[J],Y=F.unit;let Q=F.pts;if(k!==null){const N=y[J-1];N.duration=Math.round((Q-k)/c)}else if(r&&e.segmentCodec==="aac"&&(Q=w+b),L=Q,P>0){P+=S;try{O=new Uint8Array(P)}catch(N){this.observer.emit(_.ERROR,_.ERROR,{type:ve.MUX_ERROR,details:V.REMUX_ALLOC_ERROR,fatal:!1,error:N,bytes:P,reason:`fail allocating audio mdat ${P}`});return}m||(new DataView(O.buffer).setUint32(0,P),O.set(G.types.mdat,4))}else return;O.set(Y,S);const C=Y.byteLength;S+=C,y.push(f0(!0,d,C,0)),k=Q}const B=y.length;if(!B)return;const U=y[y.length-1];w=k-b,this.nextAudioTs=w+c*U.duration;const q=m?new Uint8Array(0):G.moof(e.sequenceNumber++,L/c,$e({},e,{samples:y}));e.samples=[];const re=(L-b)/o,ae=w/o,oe={data1:q,data2:O,startPTS:re,endPTS:ae,startDTS:re,endDTS:ae,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,oe}}function Yt(s,e){let t;if(e===null)return s;for(e<s?t=-8589934592:t=8589934592;Math.abs(s-e)>4294967296;)s+=t;return s}function wR(s){for(let e=0;e<s.length;e++)if(s[e].key)return e;return-1}function dE(s,e,t,r){const n=s.samples.length;if(!n)return;const i=s.inputTimeScale;for(let u=0;u<n;u++){const c=s.samples[u];c.pts=Yt(c.pts-t.baseTime*i/t.timescale,e*i)/i,c.dts=Yt(c.dts-r.baseTime*i/r.timescale,e*i)/i}const o=s.samples;return s.samples=[],{samples:o}}function hE(s,e,t){const r=s.samples.length;if(!r)return;const n=s.inputTimeScale;for(let o=0;o<r;o++){const u=s.samples[o];u.pts=Yt(u.pts-t.baseTime*n/t.timescale,e*n)/n}s.samples.sort((o,u)=>o.pts-u.pts);const i=s.samples;return s.samples=[],{samples:i}}class AR extends cr{constructor(e,t,r,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=vv(e);if(t)hb(e,t);else{const c=i||o;c!=null&&c.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${c.codec}")!`)}i&&(r=g0(i,je.AUDIO,this)),o&&(n=g0(o,je.VIDEO,this));const u={};i&&o?u.audiovideo={container:"video/mp4",codec:r+","+n,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?u.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?u.video={container:"video/mp4",codec:n,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,r,n,i,o){var u,c;let{initPTS:d,lastEndTime:f}=this;const g={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};ue(f)||(f=this.lastEndTime=i||0);const m=t.samples;if(!m.length)return g;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((u=v)!=null&&u.length||(this.generateInitSegment(m),v=this.initData),!((c=v)!=null&&c.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const T=gb(m,v,this),S=v.audio?T[v.audio.id]:null,w=v.video?T[v.video.id]:null,b=zo(w,1/0),A=zo(S,1/0),L=zo(w,0,!0),k=zo(S,0,!0);let O=i,P=0;const $=S&&(!w||!d&&A<b||d&&d.trackId===v.audio.id),B=$?S:w;if(B){const F=B.timescale,Y=B.start-i*F,Q=$?v.audio.id:v.video.id;O=B.start/F,P=$?k-A:L-b,(o||!d)&&(bR(d,O,i,P)||F!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${Y/F} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${O-i} (${Y}/${F}) trackId: ${Q}`),d=null,y.initPTS=Y,y.timescale=F,y.trackId=Q)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);d?(y.initPTS=d.baseTime,y.timescale=d.timescale,y.trackId=d.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=O,y.timescale=1,y.trackId=-1),this.initPTS=d={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const U=O-d.baseTime/d.timescale,q=U+P;P>0?this.lastEndTime=q:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const re=!!v.audio,ae=!!v.video;let le="";re&&(le+="audio"),ae&&(le+="video");const oe=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),J={data1:m,startPTS:U,startDTS:U,endPTS:q,endDTS:q,type:le,hasAudio:re,hasVideo:ae,nb:1,dropped:0,encrypted:oe};g.audio=re&&!ae?J:void 0,g.video=ae?J:void 0;const se=w==null?void 0:w.sampleCount;if(se){const F=w.keyFrameIndex,Y=F!==-1;J.nb=se,J.dropped=F===0||this.isVideoContiguous?0:Y?F:se,J.independent=Y,J.firstKeyFrame=F,Y&&w.keyFrameStart&&(J.firstKeyFramePTS=(w.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(g.independent=Y),this.isVideoContiguous||(this.isVideoContiguous=Y),J.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${F}/${se} dropped: ${J.dropped} start: ${J.firstKeyFramePTS||"NA"}`)}return g.initSegment=y,g.id3=dE(r,i,d,d),n.samples.length&&(g.text=hE(n,i,d)),g}}function zo(s,e,t=!1){return(s==null?void 0:s.start)!==void 0?(s.start+(t?s.duration:0))/s.timescale:e}function bR(s,e,t,r){if(s===null)return!0;const n=Math.max(r,1),i=e-s.baseTime/s.timescale;return Math.abs(i-t)>n}function g0(s,e,t){const r=s.codec;return r&&r.length>4?r:e===je.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?vl(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let en;try{en=self.performance.now.bind(self.performance)}catch{en=Date.now}const al=[{demux:dR,remux:AR},{demux:Rn,remux:il},{demux:oR,remux:il},{demux:uR,remux:il}];al.splice(2,0,{demux:lR,remux:il});class p0{constructor(e,t,r,n,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){const i=r.transmuxing;i.executeStart=en();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:c}=this;n&&(this.currentTransmuxState=n);const{contiguous:d,discontinuity:f,trackSwitch:g,accurateTimeOffset:m,timeOffset:y,initSegmentChange:v}=n||u,{audioCodec:T,videoCodec:S,defaultInitPts:w,duration:b,initSegmentData:A}=c,L=IR(o,t);if(L&&ti(L.method)){const $=this.getDecrypter(),B=_h(L.method);if($.isSync()){let U=$.softwareDecrypt(o,L.key.buffer,L.iv.buffer,B);if(r.part>-1){const re=$.flush();U=re&&re.buffer}if(!U)return i.executeEnd=en(),nd(r);o=new Uint8Array(U)}else return this.asyncResult=!0,this.decryptionPromise=$.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer,B).then(U=>{const q=this.push(U,null,r);return this.decryptionPromise=null,q}),this.decryptionPromise}const k=this.needsProbing(f,g);if(k){const $=this.configureTransmuxer(o);if($)return this.logger.warn(`[transmuxer] ${$.message}`),this.observer.emit(_.ERROR,_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,error:$,reason:$.message}),i.executeEnd=en(),nd(r)}(f||g||v||k)&&this.resetInitSegment(A,T,S,b,t),(f||v||k)&&this.resetInitialTimestamp(w),d||this.resetContiguity();const O=this.transmux(o,L,y,m,r);this.asyncResult=ya(O);const P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,i.executeEnd=en(),O}flush(e){const t=e.transmuxing;t.executeStart=en();const{decrypter:r,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:u}=n;if(r){const g=r.flush();g&&o.push(this.push(g.buffer,null,e))}const{demuxer:c,remuxer:d}=this;if(!c||!d){t.executeEnd=en();const g=[nd(e)];return this.asyncResult?Promise.resolve(g):g}const f=c.flush(u);return ya(f)?(this.asyncResult=!0,f.then(g=>(this.flushRemux(o,g,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:n,videoTrack:i,id3Track:o,textTrack:u}=t,{accurateTimeOffset:c,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===ge.MAIN?"level":"track"} ${r.level}`);const f=this.remuxer.remux(n,i,o,u,d,c,!0,this.id);e.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=en()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,n,i){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,r,n),u.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,n,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,n,i):o=this.transmuxUnencrypted(e,r,n,i),o}transmuxUnencrypted(e,t,r,n){const{audioTrack:i,videoTrack:o,id3Track:u,textTrack:c}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,u,c,t,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,r,n,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,n,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:n}=this;let i;for(let g=0,m=al.length;g<m;g++){var o;if((o=al[g].demux)!=null&&o.probe(e,this.logger)){i=al[g];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,c=this.remuxer,d=i.remux,f=i.demux;(!c||!(c instanceof d))&&(this.remuxer=new d(r,t,n,this.logger)),(!u||!(u instanceof f))&&(this.demuxer=new f(r,t,n,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Th(this.config)),e}}function IR(s,e){let t=null;return s.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const nd=s=>({remuxResult:{},chunkMeta:s});function ya(s){return"then"in s&&s.then instanceof Function}class RR{constructor(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i||null}}class LR{constructor(e,t,r,n,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=o}}let m0=0;class fE{constructor(e,t,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=m0++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=c=>{const d=c.data,f=this.hls;if(!(!f||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var g;const m=(g=this.workerContext)==null?void 0:g.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{f.logger[d.data.logType]&&f.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,f.trigger(d.event,d.data);break}}},this.onWorkerError=c=>{if(!this.hls)return;const d=new Error(`${c.message}  (${c.filename}:${c.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const o=(c,d)=>{d=d||{},d.frag=this.frag||void 0,c===_.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(c,d)};this.observer=new bh,this.observer.on(_.FRAG_DECRYPTED,o),this.observer.on(_.ERROR,o);const u=Cm(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const c=this.hls.logger;if(i.workerPath||DI()){try{i.workerPath?(c.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=NI(i.workerPath)):(c.log(`injecting Web Worker for "${t}"`),this.workerContext=OI());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Ge(i)})}catch(f){c.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new p0(this.observer,u,i,"",t,e.logger)}return}}this.transmuxer=new p0(this.observer,u,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=m0++;const t=this.hls.config,r=Cm(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:Ge(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),MI(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,n,i,o,u,c,d,f){var g,m;d.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:v}=this,T=o?o.start:i.start,S=i.decryptdata,w=this.frag,b=!(w&&i.cc===w.cc),A=!(w&&d.level===w.level),L=w?d.sn-w.sn:-1,k=this.part?d.part-this.part.index:-1,O=L===0&&d.id>1&&d.id===(w==null?void 0:w.stats.chunkCount),P=!A&&(L===1||L===0&&(k===1||O&&k<=0)),$=self.performance.now();(A||L||i.stats.parsing.start===0)&&(i.stats.parsing.start=$),o&&(k||!P)&&(o.stats.parsing.start=$);const B=!(w&&((g=i.initSegment)==null?void 0:g.url)===((m=w.initSegment)==null?void 0:m.url)),U=new LR(b,P,c,A,T,B);if(!P||b||B){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ge.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${b}
        trackSwitch: ${A}
        contiguous: ${P}
        accurateTimeOffset: ${c}
        timeOffset: ${T}
        initSegmentChange: ${B}`);const q=new RR(r,n,t,u,f);this.configureTransmuxer(q)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:S,chunkMeta:d,state:U},e instanceof ArrayBuffer?[e]:[]);else if(v){const q=v.push(e,S,d,U);ya(q)?q.then(re=>{this.handleTransmuxComplete(re)}).catch(re=>{this.transmuxerError(re,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(q)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const n=r.flush(e);ya(n)?n.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const y0=100;class kR extends Ah{constructor(e,t,r){super(e,t,r,"audio-stream-controller",ge.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(_.BUFFER_RESET,this.onBufferReset,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(_.BUFFER_RESET,this.onBufferReset,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i,trackId:o}){if(r===ge.MAIN){const u=t.cc,c=this.fragCurrent;if(this.initPTS[u]={baseTime:n,timescale:i,trackId:o},this.log(`InitPTS for cc: ${u} found from main: ${n/i} (${n}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===X.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==u)&&this.syncWithAnchor(t,d==null?void 0:d.frag)}else!this.hls.hasEnoughToStart&&c&&c.cc!==u?(c.abortRequests(),this.syncWithAnchor(t,c)):this.state===X.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const n=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(n==null?void 0:n.cc)===t.cc)return;const i=(n||e).cc,o=this.getLevelDetails(),u=this.getLoadPosition(),c=Lv(o,i,u);c&&(this.log(`Syncing with main frag at ${c.start} cc ${c.cc}`),this.startFragRequested=!1,this.nextLoadPosition=c.start,this.resetLoadingState(),this.state===X.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=X.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(y0),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=X.IDLE):this.state=X.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case X.IDLE:this.doTickIdle();break;case X.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],n=r==null?void 0:r.details;if(n&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(n))break;this.state=X.WAITING_INIT_PTS}break}case X.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case X.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:n,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=X.FRAG_LOADING;const u=n.flush().buffer,c={frag:t,part:r,payload:u,networkDetails:null};this._handleFragmentLoadProgress(c),i&&super._handleFragmentLoadComplete(c)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=X.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:n,trackId:i}=this,o=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const u=r[i],c=u.details;if(!c||this.waitForLive(u)||this.waitForCdnTuneIn(c)){this.state=X.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,je.AUDIO,ge.AUDIO));const f=this.getFwdBufferInfo(d,ge.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,c)){t.trigger(_.BUFFER_EOS,{type:"audio"}),this.state=X.ENDED;return}const g=f.len,m=t.maxBufferLength,y=c.fragments,v=y[0].start,T=this.getLoadPosition(),S=this.flushing?T:f.end;if(this.switchingTrack&&n){const A=T;c.PTSKnown&&A<v&&(f.end>v||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=v+.05)}if(g>=m&&!this.switchingTrack&&S<y[y.length-1].start)return;let w=this.getNextFragment(S,c);if(w&&this.isLoopLoading(w,S)&&(w=this.getNextFragmentLoopLoading(w,c,f,ge.MAIN,m)),!w){this.bufferFlushed=!0;return}let b=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&b&&lt(w)&&!w.endList&&(!c.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(b)===ft.OK&&(this.mainFragLoading=b=null),b&&lt(b))){if(w.start>b.end){const L=this.fragmentTracker.getFragAtPos(S,ge.MAIN);L&&L.end>b.end&&(b=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(w.start>b.end)return}this.loadFragment(w,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new ga(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==X.STOPPED&&(this.setInterval(y0),this.state=X.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(_.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:n}=this,{details:i,id:o,groupId:u,track:c}=t;if(!n){this.warn(`Audio tracks reset while loading track ${o} "${c.name}" of "${u}"`);return}const d=this.mainDetails;if(!d||i.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==X.STOPPED&&(this.state=X.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${c.name}" of "${u}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const f=n[o];let g=0;if(i.live||(r=f.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(f.details){var m;g=this.alignPlaylists(i,f.details,(m=this.levelLastLoaded)==null?void 0:m.details)}i.alignedSliding||(zv(i,d),i.alignedSliding||Al(i,d),g=i.fragmentStart)}f.details=i,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(d,g),this.hls.trigger(_.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===X.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=X.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:i}=e,{config:o,trackId:u,levels:c}=this;if(!c){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const d=c[u];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const f=d.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const g=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let m=this.transmuxer;m||(m=this.transmuxer=new fE(this.hls,ge.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[r.cc],v=(t=r.initSegment)==null?void 0:t.data;if(y!==void 0){const S=n?n.index:-1,w=S!==-1,b=new xh(r.level,r.sn,r.stats.chunkCount,i.byteLength,S,w);m.push(i,v,g,"",r,n,f.totalduration,!1,b,y)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${f.startSN} ,${f.endSN}],track ${u}`);const{cache:T}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new qv,complete:!1};T.push(new Uint8Array(i)),this.state!==X.STOPPED&&(this.state=X.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ge.MAIN&&lt(t.frag)&&(this.mainFragLoading=t,this.state===X.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r.type!==ge.AUDIO){!this.audioOnly&&r.type===ge.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(lt(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(_.AUDIO_TRACK_SWITCHED,Ue({},i)))}this.fragBufferedComplete(r,n),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=X.ERROR;return}switch(t.details){case V.FRAG_GAP:case V.FRAG_PARSING_ERROR:case V.FRAG_DECRYPT_ERROR:case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.AUDIO,t);break;case V.AUDIO_TRACK_LOAD_ERROR:case V.AUDIO_TRACK_LOAD_TIMEOUT:case V.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===X.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Pe.AUDIO_TRACK&&(this.state=X.IDLE);break;case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case V.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case V.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==je.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==je.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===X.ENDED&&(this.state=X.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,ge.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:n}=this,{remuxResult:i,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:c,part:d,level:f}=u,{details:g}=f,{audio:m,text:y,id3:v,initSegment:T}=i;if(this.fragContextChanged(c)||!g){this.fragmentTracker.removeFragment(c);return}if(this.state=X.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const S=c.initSegment||c;if(this.unhandledEncryptionError(T,c))return;this._bufferInitSegment(f,T.tracks,S,o),n.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:r,tracks:T.tracks})}if(m){const{startPTS:S,endPTS:w,startDTS:b,endDTS:A}=m;d&&(d.elementaryStreams[je.AUDIO]={startPTS:S,endPTS:w,startDTS:b,endDTS:A}),c.setElementaryStreamInfo(je.AUDIO,S,w,b,A),this.bufferFragmentData(m,c,d,o)}if(v!=null&&(t=v.samples)!=null&&t.length){const S=$e({id:r,frag:c,details:g},v);n.trigger(_.FRAG_PARSING_METADATA,S)}if(y){const S=$e({id:r,frag:c,details:g},y);n.trigger(_.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,r,n){if(this.state!==X.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=ge.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(_.BUFFER_CODECS,t);const u=i.initSegment;if(u!=null&&u.byteLength){const c={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:u};this.hls.trigger(_.BUFFER_APPENDING,c)}this.tickImmediate()}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===ft.NOT_LOADED||n===ft.PARTIAL){var i;if(!lt(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=X.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Al(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:n,characteristics:i,audioCodec:o,channels:u}=this.bufferedTrack;ls({name:t,lang:r,assocLang:n,characteristics:i,audioCodec:o,channels:u},e,rs)||(Sl(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(_.AUDIO_TRACK_SWITCHED,Ue({},e))}}class Dh extends cr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const n=t==null?void 0:t.renditionReports;if(n){let i=-1;for(let o=0;o<n.length;o++){const u=n[o];let c;try{c=new self.URL(u.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),c=u.URI||""}if(c===e){i=o;break}else c===e.substring(0,c.length)&&(i=o)}if(i!==-1){const o=n[i],u=parseInt(o["LAST-MSN"])||t.lastPartSn;let c=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&f>t.partTarget&&(c+=1)}const d=r&&Pm(r);return new Dm(u,c>=0?c:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:n,stats:i}=t,o=self.performance.now(),u=i.loading.first?Math.max(0,o-i.loading.first):0;n.advancedDateTime=Date.now()-u;const c=this.hls.config.timelineOffset;if(c!==n.appliedTimelineOffset){const f=Math.max(c||0,0);n.appliedTimelineOffset=f,n.fragments.forEach(g=>{g.setStart(g.playlistOffset+f)})}if(n.live||r!=null&&r.live){const f="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(r),r&&n.fragments.length>0){xI(r,n,this);const b=n.playlistParsingError;if(b){this.warn(b);const A=this.hls;if(!A.config.ignorePlaylistParsingErrors){var d;const{networkDetails:L}=t;A.trigger(_.ERROR,{type:ve.NETWORK_ERROR,details:V.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:b,reason:b.message,level:t.level||void 0,parent:(d=n.fragments[0])==null?void 0:d.type,networkDetails:L,stats:i});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=i.loading.start);const g=this.hls.mainForwardBufferInfo,m=g?g.end-g.len:0,y=(n.edge-m)*1e3,v=Gv(n,y);if(n.requestScheduled+v<o?n.requestScheduled=o:n.requestScheduled+=v,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let T,S,w;if(n.canBlockReload&&n.endSN&&n.advanced){const b=this.hls.config.lowLatencyMode,A=n.lastPartSn,L=n.endSN,k=n.lastPartIndex,O=k!==-1,P=A===L;O?P?(S=L+1,w=b?0:k):(S=A,w=b?k+1:n.maxPartIndex):S=L+1;const $=n.age,B=$+n.ageHeader;let U=Math.min(B-n.partTarget,n.targetduration*1.5);if(U>0){if(B>n.targetduration*3)this.log(`Playlist last advanced ${$.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,w=void 0;else if(r!=null&&r.tuneInGoal&&B-n.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${U} with playlist age: ${n.age}`),U=0;else{const q=Math.floor(U/n.targetduration);if(S+=q,w!==void 0){const re=Math.round(U%n.targetduration/n.partTarget);w+=re}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${$.toFixed(2)}s goal: ${U} skip sn ${q} to part ${w}`)}n.tuneInGoal=U}if(T=this.getDeliveryDirectives(n,t.deliveryDirectives,S,w),b||!P){n.requestScheduled=o,this.loadingPlaylist(f,T);return}}else(n.canBlockReload||n.canSkipUntil)&&(T=this.getDeliveryDirectives(n,t.deliveryDirectives,S,w));T&&S!==void 0&&n.canBlockReload&&(n.requestScheduled=i.loading.first+Math.max(v-u*2,v/2)),this.scheduleLoading(f,T,n)}else this.clearTimer()}scheduleLoading(e,t,r){const n=r||e.details;if(!n){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=n.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const u=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,r,n){let i=Pm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=nl.No),new Dm(r,n,i)}checkRetry(e){const t=e.details,r=Tl(e),n=e.errorAction,{action:i,retryCount:o=0,retryConfig:u}=n||{},c=!!n&&!!u&&(i===xt.RetryRequest||!n.resolved&&i===xt.SendAlternateToPenaltyBox);if(c){var d;if(o>=u.maxNumRetry)return!1;if(r&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Sh(u,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,n.resolved=!0}return c}}function gE(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!va(s[t].attrs,e[t].attrs))return!1;return!0}function va(s,e,t){const r=s["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>s[n]!==e[n])}function Yd(s,e){return e.label.toLowerCase()===s.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(s.lang||"").toLowerCase())}class CR extends Dh{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(_.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==n){this.warn(`Audio track with id:${r} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(n==null?void 0:n.length)!==(r==null?void 0:r.length)||r!=null&&r.some(u=>(n==null?void 0:n.indexOf(u))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(m=>!r||r.indexOf(m.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(m=>m.default)&&(this.selectDefaultTrack=!1),u.forEach((m,y)=>{m.id=y});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const c=this.hls.config.audioPreference;if(!i&&c){const m=Mr(c,u,rs);if(m>-1)i=u[m];else{const y=Mr(c,this.tracks);i=this.tracks[y]}}let d=this.findTrackId(i);d===-1&&i&&(d=this.findTrackId(null));const f={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(_.AUDIO_TRACKS_UPDATED,f);const g=this.trackId;if(d!==-1&&g===-1)this.setAudioTrack(d);else if(u.length&&g===-1){var o;const m=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${u.length}`);this.warn(m.message),this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===Pe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&ls(e,n,rs))return n;const i=Mr(e,this.tracksInGroup,rs);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(n){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const u=Vb(e,t.levels,r,o,rs);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const o=Mr(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e],i=n.details&&!n.details.live;if(e===this.trackId&&n===r&&i||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(_.AUDIO_TRACK_SWITCHING,Ue({},n)),i))return;const o=this.switchParams(n.url,r==null?void 0:r.details,n.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(!(this.selectDefaultTrack&&!n.default)&&(!e||ls(e,n,rs)))return r}if(e){const{name:r,lang:n,assocLang:i,characteristics:o,audioCodec:u,channels:c}=e;for(let d=0;d<t.length;d++){const f=t[d];if(ls({name:r,lang:n,assocLang:i,characteristics:o,audioCodec:u,channels:c},f,rs))return d}for(let d=0;d<t.length;d++){const f=t[d];if(va(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const f=t[d];if(va(e.attrs,f.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Sl(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(_.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:t||null,track:e})}}class PR{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(i){var r;if(n.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],n=r==null?void 0:r.buffer;return n?`SourceBuffer${n.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const v0=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,pE="HlsJsTrackRemovedError";class DR extends Error{constructor(e){super(e),this.name=pE}}class OR extends cr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:n,mediaSource:i}=this;r&&this.log("Media source opened"),!(!n||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(_.MEDIA_ATTACHED,{media:n,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:n}=this;r!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=rb(Pn(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.BUFFER_RESET,this.onBufferReset,this),e.on(_.BUFFER_APPENDING,this.onBufferAppending,this),e.on(_.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.BUFFER_EOS,this.onBufferEos,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.FRAG_PARSED,this.onFragParsed,this),e.on(_.FRAG_CHANGED,this.onFragChanged,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.BUFFER_RESET,this.onBufferReset,this),e.off(_.BUFFER_APPENDING,this.onBufferAppending,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.BUFFER_EOS,this.onBufferEos,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.FRAG_PARSED,this.onFragParsed,this),e.off(_.FRAG_CHANGED,this.onFragChanged,this),e.off(_.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?$e(r,n.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=$e({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const n=Pn(this.appendSource);if(n){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const c=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||c&&o instanceof c,E0(r),NR(r,u),r.load()}catch{r.src=u}else r.src=u}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,n=t.tracks,i=n?Object.keys(n):null,o=i?i.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ge(r,(c,d)=>c==="initSegment"?void 0:d)};
transfer tracks: ${Ge(n,(c,d)=>c==="initSegment"?void 0:d)}}`),!dv(n,r)){t.mediaSource=null,t.tracks=void 0;const c=e.currentTime,d=this.details,f=Math.max(c,(d==null?void 0:d.fragments[0].start)||0);if(f-c>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${c} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(r)}") start time: ${f} currentTime: ${c}`),this.onMediaDetaching(_.MEDIA_DETACHING,{}),this.onMediaAttaching(_.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,i.forEach(c=>{const d=c,f=n[d];if(f){const g=f.buffer;if(g){const m=this.fragmentTracker,y=f.id;if(m.hasFragments(y)||m.hasParts(y)){const S=Re.getBuffered(g);m.detectEvictedFragments(d,S,y,null,!0)}const v=sd(d),T=[d,g];this.sourceBuffers[v]=T,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,f)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=i.readyState==="open";try{const c=i.sourceBuffers;for(let d=c.length;d--;)u&&c[d].abort(),i.removeSourceBuffer(c[d]);u&&i.endOfStream()}catch(c){this.warn(`onMediaDetaching: ${c.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(n.removeAttribute("src"),this.appendSource&&E0(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(_.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[sd(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new PR(this.tracks)}onBufferCodecs(e,t){var r;const n=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),u=!o&&this.sourceBufferCount&&this.media&&i.some(c=>!n[c]);if(o||u){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${i}" SourceBuffers`);return}i.forEach(c=>{var d,f;const g=t[c],{id:m,codec:y,levelCodec:v,container:T,metadata:S,supplemental:w}=g;let b=n[c];const A=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[c],L=A!=null&&A.buffer?A:b,k=(L==null?void 0:L.pendingCodec)||(L==null?void 0:L.codec),O=L==null?void 0:L.levelCodec;b||(b=n[c]={buffer:void 0,listeners:[],codec:y,supplemental:w,container:T,levelCodec:v,metadata:S,id:m});const P=rl(k,O),$=P==null?void 0:P.replace(v0,"$1");let B=rl(y,v);const U=(f=B)==null?void 0:f.replace(v0,"$1");B&&P&&$!==U&&(c.slice(0,5)==="audio"&&(B=vl(B,this.appendSource)),this.log(`switching codec ${k} to ${B}`),B!==(b.pendingCodec||b.codec)&&(b.pendingCodec=B),b.container=T,this.appendChangeType(c,T,B))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const n=`${t};codecs=${r}`,i={label:`change-type=${n}`,execute:()=>{const o=this.tracks[e];if(o){const u=o.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),u.changeType(n),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,n=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,ge.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var u;const c=this.tracks.video;(this.lastVideoAppendEnd>n||c!=null&&c.buffer&&Re.isBuffered(c.buffer,n)||((u=this.fragmentTracker.getAppendedFrag(n,ge.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:n,type:i,parent:o,frag:u,part:c,chunkMeta:d,offset:f}=t,g=d.buffering[i],{sn:m,cc:y}=u,v=self.performance.now();g.start=v;const T=u.stats.buffering,S=c?c.stats.buffering:null;T.start===0&&(T.start=v),S&&S.start===0&&(S.start=v);const w=r.audio;let b=!1;i==="audio"&&(w==null?void 0:w.container)==="audio/mpeg"&&(b=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const A=r.video,L=A==null?void 0:A.buffer;if(L&&m!=="initSegment"){const P=c||u,$=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(A.ending||A.ended)){const U=P.start+P.duration*.05,q=L.buffered,re=this.currentOp("video");!q.length&&!re?this.blockAudio(P):!re&&!Re.isBuffered(L,U)&&this.lastVideoAppendEnd<U&&this.blockAudio(P)}else if(i==="video"){const B=P.end;if($){const U=$.frag.start;(B>U||B<this.lastVideoAppendEnd||Re.isBuffered(L,U))&&this.unblockAudio()}this.lastVideoAppendEnd=B}}const k=(c||u).start,O={label:`append-${i}`,execute:()=>{var P;g.executeStart=self.performance.now();const $=(P=this.tracks[i])==null?void 0:P.buffer;$&&(b?this.updateTimestampOffset($,k,.1,i,m,y):f!==void 0&&ue(f)&&this.updateTimestampOffset($,f,1e-6,i,m,y)),this.appendExecutor(n,i)},onStart:()=>{},onComplete:()=>{const P=self.performance.now();g.executeEnd=g.end=P,T.first===0&&(T.first=P),S&&S.first===0&&(S.first=P);const $={};this.sourceBuffers.forEach(([B,U])=>{B&&($[B]=Re.getBuffered(U))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(_.BUFFER_APPENDED,{type:i,frag:u,part:c,chunkMeta:d,parent:u.type,timeRanges:$})},onError:P=>{var $;const B={type:ve.MEDIA_ERROR,parent:u.type,details:V.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:u,part:c,chunkMeta:d,error:P,err:P,fatal:!1},U=($=this.media)==null?void 0:$.error;if(P.code===DOMException.QUOTA_EXCEEDED_ERR||P.name=="QuotaExceededError"||"quota"in P)B.details=V.BUFFER_FULL_ERROR;else if(P.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!U)B.errorAction=ei(!0);else if(P.name===pE&&this.sourceBufferCount===0)B.errorAction=ei(!0);else{const q=++this.appendErrors[i];this.warn(`Failed ${q}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${U||"no media error"})`),(q>=this.hls.config.appendErrorMaxRetry||U)&&(B.fatal=!0)}this.hls.trigger(_.ERROR,B)}};this.log(`queuing "${i}" append sn: ${m}${c?" p: "+c.index:""} of ${u.type===ge.MAIN?"level":"track"} ${u.level} cc: ${y}`),this.append(O,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(_.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:r,startOffset:n,endOffset:i}=t;r?this.append(this.getFlushOp(r,n,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,n,i),o)})}onFragParsed(e,t){const{frag:r,part:n}=t,i=[],o=n?n.elementaryStreams:r.elementaryStreams;o[je.AUDIOVIDEO]?i.push("audiovideo"):(o[je.AUDIO]&&i.push("audio"),o[je.VIDEO]&&i.push("video"));const u=()=>{const c=self.performance.now();r.stats.buffering.end=c,n&&(n.stats.buffering.end=c);const d=n?n.stats:r.stats;this.hls.trigger(_.FRAG_BUFFERED,{frag:r,part:n,stats:d,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(u,i).catch(c=>{this.warn(`Fragment buffered callback ${c}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const u=this.tracks[o];(!t.type||t.type===o)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${o} buffer reached EOS`)))}});const n=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var u;return o&&!((u=this.tracks[o])!=null&&u.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(_.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(_.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===V.BUFFER_APPEND_ERROR&&t.frag){var r;const n=(r=t.errorAction)==null?void 0:r.nextAutoLevel;ue(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const n=e.config,i=r.currentTime,o=t.levelTargetDuration,u=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(ue(u)&&u>=0){const d=Math.max(u,o),f=Math.floor(i/o)*o-d;this.flushBackBuffer(i,o,f)}const c=n.frontBufferFlushThreshold;if(ue(c)&&c>0){const d=Math.max(n.maxBufferLength,c),f=Math.max(d,o),g=Math.floor(i/o)*o+f;this.flushFrontBuffer(i,o,g)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([n,i])=>{if(i){const u=Re.getBuffered(i);if(u.length>0&&r>u.start(0)){var o;this.hls.trigger(_.BACK_BUFFER_REACHED,{bufferEnd:r});const c=this.tracks[n];if((o=this.details)!=null&&o.live)this.hls.trigger(_.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(c!=null&&c.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:n})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([n,i])=>{if(i){const o=Re.getBuffered(i),u=o.length;if(u<2)return;const c=o.start(u-1),d=o.end(u-1);if(r>c||e>=c&&e<=d)return;this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),f=Math.max(d,n);return{duration:1/0,start:d,end:f}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return ue(i)?{duration:i}:null;const o=this.media.duration,u=ue(r.duration)?r.duration:0;return n>u&&n>o||!ue(o)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:r}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(ue(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${r}.`),n.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ge(r)}`),this.tracksReady){var n;const i=(n=this.transferData)==null?void 0:n.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const n=this.tracks[t];e[t]={buffer:r,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(_.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,u=e[o];if(this.isPending(u)){const c=this.getTrackCodec(u,o),d=`${u.container};codecs=${c}`;u.codec=c,this.log(`creating sourceBuffer(${d})${this.currentOp(o)?" Queued":""} ${Ge(u)}`);try{const f=r.addSourceBuffer(d),g=sd(o),m=[o,f];t[g]=m,u.buffer=f}catch(f){var n;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[o],this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:d,parent:u.id});return}this.trackSourceBuffer(o,u)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let n=e.codec;r&&(t==="video"||t==="audiovideo")&&ha(r,"video")&&(n=wb(n,r));const i=rl(n,e.levelCodec);return i?t.slice(0,5)==="audio"?vl(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const u=o.removedRanges;u!=null&&u.length&&this.hls.trigger(_.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${n}`,t),this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const i=this.currentOp(e);i&&i.onError(n)}updateTimestampOffset(e,t,r,n,i,o){const u=t-e.timestampOffset;Math.abs(u)>=r&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:n,mediaSource:i}=this,o=this.tracks[e],u=o==null?void 0:o.buffer;if(!n||!i||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const c=ue(n.duration)?n.duration:1/0,d=ue(i.duration)?i.duration:1/0,f=Math.max(0,t),g=Math.min(r,c,d);g>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${g}] from the ${e} SourceBuffer`),u.remove(f,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],n=r==null?void 0:r.buffer;if(!n)throw new DR(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,n=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const n=(r=this.tracks[t])==null?void 0:r.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const n=this.tracks[e];if(!n)return;const i=n.buffer;if(!i)return;const o=r.bind(this,e);n.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(n=>{r.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function E0(s){const e=s.querySelectorAll("source");[].slice.call(e).forEach(t=>{s.removeChild(t)})}function NR(s,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,s.appendChild(t)}function sd(s){return s==="audio"?1:0}class Oh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ue(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((n,i)=>this.isLevelAllowed(n)&&i<=e);return this.clientRect=null,Oh.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const n=(u,c)=>c?u.width!==c.width||u.height!==c.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let u=0;u<e.length;u+=1){const c=e[u];if((c.width>=o||c.height>=o)&&n(c,e[u+1])){i=u;break}}return i}}const MR={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},$t=MR,FR={HLS:"h"},UR=FR;class Ur{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Ur?r:new Ur(r))),this.value=e,this.params=t}}const BR="Dict";function $R(s){return Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":typeof s=="object"?JSON.stringify(s):String(s)}function jR(s,e,t,r){return new Error(`failed to ${s} "${$R(e)}" as ${t}`,{cause:r})}function Br(s,e,t){return jR("serialize",s,e,t)}class mE{constructor(e){this.description=e}}const S0="Bare Item",GR="Boolean";function VR(s){if(typeof s!="boolean")throw Br(s,GR);return s?"?1":"?0"}function KR(s){return btoa(String.fromCharCode(...s))}const HR="Byte Sequence";function WR(s){if(ArrayBuffer.isView(s)===!1)throw Br(s,HR);return`:${KR(s)}:`}const zR="Integer";function qR(s){return s<-999999999999999||999999999999999<s}function yE(s){if(qR(s))throw Br(s,zR);return s.toString()}function YR(s){return`@${yE(s.getTime()/1e3)}`}function vE(s,e){if(s<0)return-vE(-s,e);const t=Math.pow(10,e);if(Math.abs(s*t%1-.5)<Number.EPSILON){const n=Math.floor(s*t);return(n%2===0?n:n+1)/t}else return Math.round(s*t)/t}const QR="Decimal";function XR(s){const e=vE(s,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Br(s,QR);const t=e.toString();return t.includes(".")?t:`${t}.0`}const JR="String",ZR=/[\x00-\x1f\x7f]+/;function eL(s){if(ZR.test(s))throw Br(s,JR);return`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function tL(s){return s.description||s.toString().slice(7,-1)}const rL="Token";function T0(s){const e=tL(s);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Br(e,rL);return e}function Qd(s){switch(typeof s){case"number":if(!ue(s))throw Br(s,S0);return Number.isInteger(s)?yE(s):XR(s);case"string":return eL(s);case"symbol":return T0(s);case"boolean":return VR(s);case"object":if(s instanceof Date)return YR(s);if(s instanceof Uint8Array)return WR(s);if(s instanceof mE)return T0(s);default:throw Br(s,S0)}}const nL="Key";function Xd(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw Br(s,nL);return s}function Nh(s){return s==null?"":Object.entries(s).map(([e,t])=>t===!0?`;${Xd(e)}`:`;${Xd(e)}=${Qd(t)}`).join("")}function EE(s){return s instanceof Ur?`${Qd(s.value)}${Nh(s.params)}`:Qd(s)}function sL(s){return`(${s.value.map(EE).join(" ")})${Nh(s.params)}`}function iL(s,e={whitespace:!0}){if(typeof s!="object"||s==null)throw Br(s,BR);const t=s instanceof Map?s.entries():Object.entries(s),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([n,i])=>{i instanceof Ur||(i=new Ur(i));let o=Xd(n);return i.value===!0?o+=Nh(i.params):(o+="=",Array.isArray(i.value)?o+=sL(i):o+=EE(i)),o}).join(`,${r}`)}function SE(s,e){return iL(s,e)}const Pr="CMCD-Object",tt="CMCD-Request",Zn="CMCD-Session",bn="CMCD-Status",aL={br:Pr,ab:Pr,d:Pr,ot:Pr,tb:Pr,tpb:Pr,lb:Pr,tab:Pr,lab:Pr,url:Pr,pb:tt,bl:tt,tbl:tt,dl:tt,ltc:tt,mtp:tt,nor:tt,nrr:tt,rc:tt,sn:tt,sta:tt,su:tt,ttfb:tt,ttfbb:tt,ttlb:tt,cmsdd:tt,cmsds:tt,smrt:tt,df:tt,cs:tt,ts:tt,cid:Zn,pr:Zn,sf:Zn,sid:Zn,st:Zn,v:Zn,msd:Zn,bs:bn,bsd:bn,cdn:bn,rtp:bn,bg:bn,pt:bn,ec:bn,e:bn},oL={REQUEST:tt};function lL(s){return Object.keys(s).reduce((e,t)=>{var r;return(r=s[t])===null||r===void 0||r.forEach(n=>e[n]=t),e},{})}function uL(s,e){const t={};if(!s)return t;const r=Object.keys(s),n=e?lL(e):{};return r.reduce((i,o)=>{var u;const c=aL[o]||n[o]||oL.REQUEST,d=(u=i[c])!==null&&u!==void 0?u:i[c]={};return d[o]=s[o],i},t)}function cL(s){return["ot","sf","st","e","sta"].includes(s)}function dL(s){return typeof s=="number"?ue(s):s!=null&&s!==""&&s!==!1}const TE="event";function hL(s,e){const t=new URL(s),r=new URL(e);if(t.origin!==r.origin)return s;const n=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;n[0]===i[0];)n.shift(),i.shift();for(;i.length;)i.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const ol=s=>Math.round(s),Jd=(s,e)=>Array.isArray(s)?s.map(t=>Jd(t,e)):s instanceof Ur&&typeof s.value=="string"?new Ur(Jd(s.value,e),s.params):(e.baseUrl&&(s=hL(s,e.baseUrl)),e.version===1?encodeURIComponent(s):s),qo=s=>ol(s/100)*100,fL=(s,e)=>{let t=s;return e.version>=2&&(s instanceof Ur&&typeof s.value=="string"?t=new Ur([s]):typeof s=="string"&&(t=[s])),Jd(t,e)},gL={br:ol,d:ol,bl:qo,dl:qo,mtp:qo,nor:fL,rtp:qo,tb:ol},xE="request",_E="response",Mh=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],pL=["e"],mL=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Fl(s){return mL.test(s)}function yL(s){return Mh.includes(s)||pL.includes(s)||Fl(s)}const wE=["d","dl","nor","ot","rtp","su"];function vL(s){return Mh.includes(s)||wE.includes(s)||Fl(s)}const EL=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function SL(s){return Mh.includes(s)||wE.includes(s)||EL.includes(s)||Fl(s)}const TL=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function xL(s){return TL.includes(s)||Fl(s)}const _L={[_E]:SL,[TE]:yL,[xE]:vL};function AE(s,e={}){const t={};if(s==null||typeof s!="object")return t;const r=e.version||s.v||1,n=e.reportingMode||xE,i=r===1?xL:_L[n];let o=Object.keys(s).filter(i);const u=e.filter;typeof u=="function"&&(o=o.filter(u));const c=n===_E||n===TE;c&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const d=$e({},gL,e.formatters),f={version:r,reportingMode:n,baseUrl:e.baseUrl};return o.sort().forEach(g=>{let m=s[g];const y=d[g];if(typeof y=="function"&&(m=y(m,f)),g==="v"){if(r===1)return;m=r}g=="pr"&&m===1||(c&&g==="ts"&&!ue(m)&&(m=Date.now()),dL(m)&&(cL(g)&&typeof m=="string"&&(m=new mE(m)),t[g]=m))}),t}function wL(s,e={}){const t={};if(!s)return t;const r=AE(s,e),n=uL(r,e==null?void 0:e.customHeaderMap);return Object.entries(n).reduce((i,[o,u])=>{const c=SE(u,{whitespace:!1});return c&&(i[o]=c),i},t)}function AL(s,e,t){return $e(s,wL(e,t))}const bL="CMCD";function IL(s,e={}){return s?SE(AE(s,e),{whitespace:!1}):""}function RL(s,e={}){if(!s)return"";const t=IL(s,e);return encodeURIComponent(t)}function LL(s,e={}){if(!s)return"";const t=RL(s,e);return`${bL}=${t}`}const x0=/CMCD=[^&#]+/;function kL(s,e,t){const r=LL(e,t);if(!r)return s;if(x0.test(s))return s.replace(x0,r);const n=s.includes("?")?"&":"?";return`${s}${n}${r}`}class CL{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:$t.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=n=>{try{const{frag:i,part:o}=n,u=this.hls.levels[i.level],c=this.getObjectType(i),d={d:(o||i).duration*1e3,ot:c};(c===$t.VIDEO||c===$t.AUDIO||c==$t.MUXED)&&(d.br=u.bitrate/1e3,d.tb=this.getTopBandwidth(c)/1e3,d.bl=this.getBufferLength(c));const f=o?this.getNextPart(o):this.getNextFrag(i);f!=null&&f.url&&f.url!==i.url&&(d.nor=f.url),this.apply(n,d)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHED,this.onMediaDetached,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHED,this.onMediaDetached,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,n;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:UR.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){$e(t,this.createData());const r=t.ot===$t.INIT||t.ot===$t.VIDEO||t.ot===$t.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((o,u)=>(n.includes(u)&&(o[u]=t[u]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),AL(e.headers,t,i)):e.url=kL(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const n=e.sn-r.startSN;return r.fragments[n+1]}}getNextPart(e){var t;const{index:r,fragment:n}=e,i=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=n;for(let u=i.length-1;u>=0;u--){const c=i[u];if(c.index===r&&c.fragment.sn===o)return i[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return $t.TIMED_TEXT;if(e.sn==="initSegment")return $t.INIT;if(t==="audio")return $t.AUDIO;if(t==="main")return this.hls.audioTracks.length?$t.VIDEO:$t.MUXED}getTopBandwidth(e){let t=0,r;const n=this.hls;if(e===$t.AUDIO)r=n.audioTracks;else{const i=n.maxAutoLevel,o=i>-1?i+1:n.levels.length;r=n.levels.slice(0,o)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===$t.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Re.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,u){t(i),this.loader.load(i,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,u){t(i),this.loader.load(i,o,u)}}}}const PL=3e5;class DL extends cr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===xt.SendAlternateToPenaltyBox&&r.flags===qt.MoveAllAlternatesMatchingHost){const n=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:u,pathwayId:c,type:d}=t.context;u&&n?o=this.getPathwayForGroupId(u,d,o):c&&(o=c)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&n&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),t.details===V.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${n&&n.length} priorities: ${Ge(i)} penalized: ${Ge(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach(i=>{n-r[i]>PL&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,c=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Hv(t),this.hls.trigger(_.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[u];c&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==c.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==c.bitrate&&this.log(`Unstable Pathways change from bitrate ${c.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<n.length;i++)if(t===Pe.AUDIO_TRACK&&n[i].hasAudioGroup(e)||t===Pe.SUBTITLE_TRACK&&n[i].hasSubtitleGroup(e))return n[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},n={};e.forEach(i=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":c}=i;if(t.some(f=>f.pathwayId===o))return;const d=this.getLevelsForPathway(u).map(f=>{const g=new Xe(f.attrs);g["PATHWAY-ID"]=o;const m=g.AUDIO&&`${g.AUDIO}_clone_${o}`,y=g.SUBTITLES&&`${g.SUBTITLES}_clone_${o}`;m&&(r[g.AUDIO]=m,g.AUDIO=m),y&&(n[g.SUBTITLES]=y,g.SUBTITLES=y);const v=bE(f.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c),T=new ga({attrs:g,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:v,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let S=1;S<f.audioGroups.length;S++)T.addGroupId("audio",`${f.audioGroups[S]}_clone_${o}`);if(f.subtitleGroups)for(let S=1;S<f.subtitleGroups.length;S++)T.addGroupId("text",`${f.subtitleGroups[S]}_clone_${o}`);return T});t.push(...d),_0(this.audioTracks,r,c,o),_0(this.subtitleTracks,n,c,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+f)}const i={responseType:"json",url:n.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},d={onSuccess:(f,g,m,y)=>{this.log(`Loaded steering manifest: "${n}"`);const v=f.data;if((v==null?void 0:v.VERSION)!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":w}=v;if(T)try{this.uri=new self.URL(T,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||m.url),S&&this.clonePathways(S);const b={steeringManifest:v,url:n.toString()};this.hls.trigger(_.STEERING_MANIFEST_LOADED,b),w&&this.updatePathwayPriority(w)},onError:(f,g,m,y)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${g.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let v=this.timeToLoad*1e3;if(f.code===429){const T=this.loader;if(typeof(T==null?void 0:T.getResponseHeader)=="function"){const S=T.getResponseHeader("Retry-After");S&&(v=parseFloat(S)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,v)},onTimeout:(f,g,m)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(i,c,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const n=(r=this.hls)==null?void 0:r.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function _0(s,e,t,r){s&&Object.keys(e).forEach(n=>{const i=s.filter(o=>o.groupId===n).map(o=>{const u=$e({},o);return u.details=void 0,u.attrs=new Xe(u.attrs),u.url=u.attrs.URI=bE(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[n],u.attrs["PATHWAY-ID"]=r,u});s.push(...i)})}function bE(s,e,t,r){const{HOST:n,PARAMS:i,[t]:o}=r;let u;e&&(u=o==null?void 0:o[e],u&&(s=u));const c=new self.URL(s);return n&&!u&&(c.host=n),i&&Object.keys(i).sort().forEach(d=>{d&&c.searchParams.set(d,i[d])}),c.href}class ri extends cr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ri.CDMCleanupPromise?[ri.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:n}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),n!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=ta(this.config));const u=o.map(Qc).filter(c=>!!c);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(o=>{const u=sl(o);if(r!=="sinf"||u!==Ze.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${u}`);return}let c;try{const y=ht(new Uint8Array(n)),v=wh(JSON.parse(y).sinf),T=Sv(v);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(T.subarray(8,24))}catch(y){this.warn(`${i} Failed to parse sinf: ${y}`);return}const d=Pt(c),{keyIdToKeySessionPromise:f,mediaKeySessions:g}=this;let m=f[d];for(let y=0;y<g.length;y++){const v=g[y],T=v.decryptdata;if(!T.keyId)continue;const S=Pt(T.keyId);if(_l(c,T.keyId)||T.uri.replace(/-/g,"").indexOf(d)!==-1){if(m=f[S],!m)continue;if(T.pssh)break;delete f[S],T.pssh=new Uint8Array(n),T.keyId=c,m=f[d]=m.then(()=>this.generateRequestWithPreferredKeySession(v,r,n,"encrypted-event-key-match")),m.catch(w=>this.handleError(w));break}}m||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(_.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(_.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,n=t==null?void 0:t[e];if(n)return n.licenseUrl;if(e===Ze.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,u,c)=>!!o&&c.indexOf(o)===u,n=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,u)=>{const c=d=>{const f=d.shift();this.getMediaKeysPromise(f,n,i).then(g=>o({keySystem:f,mediaKeys:g})).catch(g=>{d.length?c(d):g instanceof zt?u(g):u(new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};c(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${r}`;return Fv===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return r(e,t)}getMediaKeysPromise(e,t,r){var n;const i=fI(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],u=(n=o)==null?void 0:n.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ge(i)}`),u=this.requestMediaKeySystemAccess(e,i);const c=o=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),u.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=c.mediaKeys=d.createMediaKeys().then(m=>(this.log(`Media-keys created for "${e}"`),c.hasMediaKeys=!0,f.then(y=>y?this.setMediaKeysServerCertificate(m,e,y):m)));return g.catch(m=>{this.error(`Failed to create media-keys for "${e}"}: ${m}`)}),g})}return u.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Pt(e.keyId||[])} keyUri: ${e.uri}`);const n=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),n=Yo(t),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Pt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Qc(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const i=Qc(n);i?t(i):r(new Error(`Unable to find format for key-system "${n}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ta(this.config),r=e.map(sl).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const n=OL(e,t[r]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,r=Yo(t),n=this.bannedKeyIds[r];if(n||this.getKeyStatus(t)==="internal-error"){const u=w0(n||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:c,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(c,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:d,decryptdata:t}))))).then(c=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,d,f,"playlist-key")});return u.catch(c=>this.handleError(c,e.frag)),this.keyIdToKeySessionPromise[r]=u,u}return o.catch(u=>{if(u instanceof zt){const c=Ue({},u.data);this.getKeyStatus(t)==="internal-error"&&(c.decryptdata=t);const d=new zt(c,u.message);this.handleError(d,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof zt){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${Pt(r.keyId||[])})`:""}`),this.hls.trigger(_.ERROR,e.data)}else this.error(e.message),this.hls.trigger(_.ERROR,{type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Yo(e),r=this.keyIdToKeySessionPromise[t];if(!r){const n=sl(e.keyFormat),i=n?[n]:ta(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=ta(this.config)),e.length===0)throw new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ge({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,n){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const v=o.call(this.hls,t,r,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,r=v.initData?v.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(r===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const u=Yo(e.decryptdata),c=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${u} URI: ${c} (init data type: ${t} length: ${r.byteLength})`);const d=new bh,f=e._onmessage=v=>{const T=e.mediaKeysSession;if(!T){d.emit("error",new Error("invalid state"));return}const{messageType:S,message:w}=v;this.log(`"${S}" message event for session "${T.sessionId}" message size: ${w.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,w).catch(b=>{d.eventNames().length?d.emit("error",b):this.handleError(b)}):S==="license-release"?e.keySystem===Ze.FAIRPLAY&&this.updateKeySession(e,Kd("acknowledged")).then(()=>this.removeSession(e)).catch(b=>this.handleError(b)):this.warn(`unhandled media key message type "${S}"`)},g=(v,T)=>{T.keyStatus=v;let S;v.startsWith("usable")?d.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?S=w0(v,T.decryptdata):v==="expired"?S=new Error(`key expired (keyId: ${u})`):v==="released"?S=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${u})`),S&&(d.eventNames().length?d.emit("error",S):this.handleError(S))},m=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(L=>S[L]!=="status-pending"))return;if(S[u]==="expired"){this.log(`Expired key ${Ge(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let b=S[u];if(b)g(b,e);else{var A;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(A=e.keyStatusTimeouts)[u]||(A[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),g(k,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),b="internal-error",g(b,e)},1e3)),this.log(`No status for keyId ${u} (${Ge(S)}).`)}};Dt(e.mediaKeysSession,"message",f),Dt(e.mediaKeysSession,"keystatuseschange",m);const y=new Promise((v,T)=>{d.on("error",T),d.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${c}`)}).catch(v=>{throw new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>y).catch(v=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,n)=>{if(typeof n=="string"&&typeof r=="object"){const u=n;n=r,r=u}const i="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);e.keySystem===Ze.PLAYREADY&&i.length===16&&Nv(i);const o=Pt(i);r==="internal-error"&&(this.bannedKeyIds[o]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,n=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,u)=>{const c={responseType:"arraybuffer",url:i},d=t.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(m,y,v,T)=>{o(m.data)},onError:(m,y,v,T)=>{u(new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:Ue({url:c.url,data:void 0},m)},`"${e}" certificate request failed (${i}). Status: ${m.code} (${m.text})`))},onTimeout:(m,y,v)=>{u(new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:c.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(m,y,v)=>{u(new Error("aborted"))}};n.load(c,f,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((n,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),n(e)}).catch(o=>{i(new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(n=>{throw new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(r,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0){let f;for(let g=0,m=i.length;g<m;g++){var o,u;f=i[g];const y=(o=f.querySelector("name"))==null?void 0:o.textContent,v=(u=f.querySelector("value"))==null?void 0:u.textContent;y&&v&&e.setRequestHeader(y,v)}}const c=n.querySelector("Challenge"),d=c==null?void 0:c.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Kd(atob(d))}setupLicenseXHR(e,t,r,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,n)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,n)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((n,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let c=u.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const d=this.config.licenseResponseCallback;if(d)try{c=d.call(this.hls,u,o,e)}catch(f){this.error(f)}n(c)}else{const c=r.errorRetry,d=c?c.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||u.status>=400&&u.status<500)i(new zt({type:ve.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:o,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${o}). Status: ${u.status} (${u.statusText})`));else{const f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(n,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,o,e,t).then(({xhr:c,licenseChallenge:d})=>{e.keySystem==Ze.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(c,d)),c.send(d)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,Dt(r,"encrypted",this.onMediaEncrypted),Dt(r,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(jt(e,"encrypted",this.onMediaEncrypted),jt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,us.clearKeyUriToKeyIdMap();const i=n.length;ri.CDMCleanupPromise=Promise.all(n.map(o=>this.removeSession(o)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((n,i)=>(n.indexOf(i.keyFormat)===-1&&n.push(i.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Pt((n==null?void 0:n.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(d=>self.clearTimeout(o[d]));const{drmSystemOptions:u}=this.config;return(pI(u)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}ri.CDMCleanupPromise=void 0;function Yo(s){if(!s)throw new Error("Could not read keyId of undefined decryptdata");if(s.keyId===null)throw new Error("keyId is null");return Pt(s.keyId)}function OL(s,e){if(s.keyId&&e.mediaKeysSession.keyStatuses.has(s.keyId))return e.mediaKeysSession.keyStatuses.get(s.keyId);if(s.matches(e.decryptdata))return e.keyStatus}class zt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function w0(s,e){const t=s==="output-restricted",r=t?V.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:V.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new zt({type:ve.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${s}"`)}class NL{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const n=performance.now();if(t){if(this.lastTime){const i=n-this.lastTime,o=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,c=1e3*o/i,d=this.hls;if(d.trigger(_.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:r}),c>0&&o>d.config.fpsDroppedMonitoringThreshold*u){let f=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=f)&&(f=f-1,d.trigger(_.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function IE(s,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=s,e.dispatchEvent(t)}function RE(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(e.id))try{if(s.addCue(e),!s.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Be.debug(`[texttrack-utils]: ${r}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,s.addCue(n)}catch(n){Be.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(s.mode=t)}function Qs(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues)for(let r=s.cues.length;r--;)e&&s.cues[r].removeEventListener("enter",e),s.removeCue(s.cues[r]);t==="disabled"&&(s.mode=t)}function Zd(s,e,t,r){const n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0){const i=FL(s.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&s.removeCue(i[o])}n==="disabled"&&(s.mode=n)}function ML(s,e){if(e<=s[0].startTime)return 0;const t=s.length-1;if(e>s[t].endTime)return-1;let r=0,n=t,i;for(;r<=n;)if(i=Math.floor((n+r)/2),e<s[i].startTime)n=i-1;else if(e>s[i].startTime&&r<t)r=i+1;else return i;return s[r].startTime-e<e-s[n].startTime?r:n}function FL(s,e,t){const r=[],n=ML(s,e);if(n>-1)for(let i=n,o=s.length;i<o;i++){const u=s[i];if(u.startTime>=e&&u.endTime<=t)r.push(u);else if(u.startTime>t)return r}return r}function ll(s){const e=[];for(let t=0;t<s.length;t++){const r=s[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(s[t])}return e}class UL extends Dh{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=ll(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;ll(r.textTracks).forEach(o=>{Qs(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==n){this.warn(`Subtitle track with id:${r} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(n==null?void 0:n.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,g)=>{f.id=g});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.subtitlePreference;if(!i&&u){this.selectDefaultTrack=!1;const f=Mr(u,o);if(f>-1)i=o[f];else{const g=Mr(u,this.tracks);i=this.tracks[g]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const d={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(_.SUBTITLE_TRACKS_UPDATED,d),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const i=t[n];if(!(r&&!i.default||!r&&!e)&&(!e||ls(i,e)))return n}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(va(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(va(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(Yd(n,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Pe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&ls(e,r))return r;const n=Mr(e,this.tracksInGroup);if(n>-1){const i=this.tracksInGroup[n];return this.setSubtitleTrack(n),i}else{if(r)return null;{const i=Mr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(_.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ll(e.textTracks),r=this.currentTrack;let n;if(r&&(n=t.filter(i=>Yd(r,i))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==n&&(i.mode="disabled")}),n){const i=this.subtitleDisplay?"showing":"hidden";n.mode!==i&&(n.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ue(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!n.details&&!n.details.live;if(e===this.trackId&&n===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:o,groupId:u="",name:c,type:d,url:f}=n;this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:c,type:d,url:f});const g=this.switchParams(n.url,r==null?void 0:r.details,n.details);this.loadPlaylist(g)}}function BL(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?i:i&3|8).toString(16)})}}}function aa(s){let e=5381,t=s.length;for(;t;)e=e*33^s.charCodeAt(--t);return(e>>>0).toString()}const ni=.025;let Il=(function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s})({});function $L(s,e,t){return`${s.identifier}-${t+1}-${aa(e)}`}class jL{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return id(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=id(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ue(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return id(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ni))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Il.Range:Il.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return GL(this)}}function id(s,e){return s-e.start<e.duration/2&&!(Math.abs(s-(e.start+e.duration))<ni)?e.start:e.start+e.duration}function LE(s,e,t){const r=new self.URL(s,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function ad(s,e){for(;(t=s.assetList[++e])!=null&&t.error;)var t;return e}function GL(s){return`["${s.identifier}" ${s.cue.pre?"<pre>":s.cue.post?"<post>":""}${s.timelineStart.toFixed(2)}-${s.resumeTime.toFixed(2)}]`}function Ys(s){const e=s.timelineStart,t=s.duration||0;return`["${s.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class VL{constructor(e,t,r,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(_.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=n;const o=()=>{this.hasDetails=!0};i.once(_.LEVEL_LOADED,o),i.once(_.AUDIO_TRACK_LOADED,o),i.once(_.SUBTITLE_TRACK_LOADED,o),i.on(_.MEDIA_ATTACHING,(u,{media:c})=>{this.removeMediaListeners(),this.mediaAttached=c,this.interstitial.playoutLimit&&(c.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(_.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,i.trigger(_.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=LE(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,i=Re.bufferInfo(e,n,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Re.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,r){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,r){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ys(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const A0=.033;class KL extends cr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=n[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let n=0;n<r.length;n++){let i=r[n];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return n}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let n=e;n<=t&&r[n];n++){const i=r[n].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var r;if(((r=t[n].event)==null?void 0:r.identifier)===e)return n}return-1}findAssetIndex(e,t){const r=e.assetList,n=r.length;if(n>1)for(let i=0;i<n;i++){const o=r[i];if(!o.error){const u=o.timelineStart;if(t===u||t>u&&(t<u+(o.duration||0)||i===n-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,n=r[r.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:n}=r,i=this.events,o=this.parseDateRanges(n,{url:r.url},t),u=Object.keys(n),c=i?i.filter(d=>!u.includes(d.identifier)):[];o.length&&o.sort((d,f)=>{const g=d.cue.pre,m=d.cue.post,y=f.cue.pre,v=f.cue.post;if(g&&!y)return-1;if(y&&!g||m&&!v)return 1;if(v&&!m)return-1;if(!g&&!y&&!m&&!v){const T=d.startTime,S=f.startTime;if(T!==S)return T-S}return d.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,c.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,c)}updateSchedule(e,t=[],r=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(n,e);(r||t.length||(i==null?void 0:i.length)!==o.length||o.some((c,d)=>Math.abs(c.playout.start-i[d].playout.start)>.005||Math.abs(c.playout.end-i[d].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const n=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const u=i[o],c=e[u];if(c.isInterstitial){let d=this.eventMap[u];d?d.setDateRange(c):(d=new jL(c,t),this.eventMap[u]=d,r===!1&&(d.appendInPlace=r)),n.push(d)}}return n}parseSchedule(e,t){const r=[],n=t.main.details,i=n.live?1/0:n.edge;let o=0;if(e=e.filter(c=>!c.error&&!(c.cue.once&&c.hasPlayed)),e.length){this.resolveOffsets(e,t);let c=0,d=0;if(e.forEach((f,g)=>{const m=f.cue.pre,y=f.cue.post,v=e[g-1]||null,T=f.appendInPlace,S=y?i:f.startOffset,w=f.duration,b=f.timelineOccupancy===Il.Range?w:0,A=f.resumptionOffset,L=(v==null?void 0:v.startTime)===S,k=S+f.cumulativeDuration;let O=T?k+w:S+A;if(m||!y&&S<=0){const $=d;d+=b,f.timelineStart=k;const B=o;o+=w,r.push({event:f,start:k,end:O,playout:{start:B,end:o},integrated:{start:$,end:d}})}else if(S<=i){if(!L){const U=S-c;if(U>A0){const q=c,re=d;d+=U;const ae=o;o+=U;const le={previousEvent:e[g-1]||null,nextEvent:f,start:q,end:q+U,playout:{start:ae,end:o},integrated:{start:re,end:d}};r.push(le)}else U>0&&v&&(v.cumulativeDuration+=U,r[r.length-1].end=S)}y&&(O=k),f.timelineStart=k;const $=d;d+=b;const B=o;o+=w,r.push({event:f,start:k,end:O,playout:{start:B,end:o},integrated:{start:$,end:d}})}else return;const P=f.resumeTime;y||P>i?c=i:c=P}),c<i){var u;const f=c,g=d,m=i-c;d+=m;const y=o;o+=m,r.push({previousEvent:((u=r[r.length-1])==null?void 0:u.event)||null,nextEvent:null,start:c,end:f+m,playout:{start:y,end:o},integrated:{start:g,end:d}})}this.setDurations(i,o,d)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,n=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((u,c)=>{const d=u.cue.pre,f=u.cue.post,g=d?0:f?n:u.startTime;this.updateAssetDurations(u),o===g?u.cumulativeDuration=i:(i=0,o=g),!f&&u.snapOptions.in&&(u.resumeAnchor=cs(null,r.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&c+1<e.length&&e[c+1].startTime-e[c].resumeTime<A0&&(e[c+1].appendInPlace=!1,e[c+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const y=ue(u.resumeOffset)?u.resumeOffset:u.duration;i+=y})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(r-n)>ni?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(o=>{const u=t[o].details,c=u.edge;if(r>=c)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${c}`),!1;const d=cs(null,u.fragments,r);if(!d)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(d.start-r)<ni+f||Math.abs(d.end-r)<ni+f?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,n=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const u=e.assetList[o],c=t+r;u.startOffset=r,u.timelineStart=c,n||(n=u.duration===null),i||(i=!!u.error);const d=u.error?0:u.duration||0;r+=d}n&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Tr(s){return`[${s.event?'"'+s.event.identifier+'"':"primary"}: ${s.start.toFixed(2)}-${s.end.toFixed(2)}]`}class HL{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let n;try{n=LE(r,this.hls.sessionId,e.baseUrl)}catch(m){const y=this.assignAssetListError(e,V.ASSET_LIST_LOAD_ERROR,m,r);this.hls.trigger(_.ERROR,y);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,u=new o(i),c={responseType:"json",url:n.href},d=i.interstitialAssetListLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(m,y,v,T)=>{const S=m.data,w=S==null?void 0:S.ASSETS;if(!Array.isArray(w)){const b=this.assignAssetListError(e,V.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,T);this.hls.trigger(_.ERROR,b);return}e.assetListResponse=S,this.hls.trigger(_.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:T})},onError:(m,y,v,T)=>{const S=this.assignAssetListError(e,V.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${y.url})`),y.url,T,v);this.hls.trigger(_.ERROR,S)},onTimeout:(m,y,v)=>{const T=this.assignAssetListError(e,V.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,m,v);this.hls.trigger(_.ERROR,T)}};return u.load(c,f,g),this.hls.trigger(_.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,r,n,i,o){return e.error=r,{type:ve.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:r,networkDetails:o,stats:i}}}function b0(s){var e;s==null||(e=s.play())==null||e.catch(()=>{})}function Qo(s,e){return`[${s}] Advancing timeline position to ${e}`}class WL extends cr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const n=r-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const o=n<=-.01;this.timelinePos=r,this.bufferedPos=r;const u=this.playingItem;if(!u){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-n)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<u.start||r>=u.end){var c;const y=this.findItemIndex(u);let v=this.schedule.findItemIndexAtTime(r);if(v===-1&&(v=y+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${y} to ${v})`)),!this.isInterstitial(u)&&(c=this.media)!=null&&c.paused&&(this.shouldPlay=!1),!o&&v>y){const T=this.schedule.findJumpRestrictedIndex(y+1,v);if(T>y){this.setSchedulePosition(T);return}}this.setSchedulePosition(v);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(u)){const y=u.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,y))}return}const f=d.timelineStart,g=d.duration||0;if(o&&r<f||r>=f+g){var m;(m=u.event)!=null&&m.appendInPlace&&(this.clearInterstitial(u.event,u),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,d)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(r>=n.end){this.timelinePos=n.end;const u=this.findItemIndex(n);this.setSchedulePosition(u+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,n)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,u=i.events||[],c=i.items||[],d=i.durations,f=r.map(T=>T.identifier),g=!!(u.length||f.length);(g||n)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${c.map(T=>Tr(T))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let m=null,y=null;o&&(m=this.updateItem(o,this.timelinePos),this.itemsMatch(o,m)?this.playingItem=m:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),r.forEach(T=>{T.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(T=>{if(T.interstitial.appendInPlace){const S=T.assetItem.timelineStart,w=T.timelineOffset-S;if(w)try{T.timelineOffset=S}catch(b){Math.abs(w)>ni&&this.warn(`${b} ("${T.assetId}" ${T.timelineOffset}->${S})`)}}}),g||n){if(this.hls.trigger(_.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:c.slice(0),durations:d,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(m,o),v&&y!==m&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new HL(e),this.schedule=new KL(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(_.MEDIA_ENDED,this.onMediaEnded,this),e.on(_.ERROR,this.onError,this),e.on(_.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(_.MEDIA_ENDED,this.onMediaEnded,this),e.off(_.ERROR,this.onError,this),e.off(_.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){jt(e,"play",this.onPlay),jt(e,"pause",this.onPause),jt(e,"seeking",this.onSeeking),jt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Dt(r,"seeking",this.onSeeking),Dt(r,"timeupdate",this.onTimeupdate),Dt(r,"play",this.onPlay),Dt(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!n){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(this.media=null,!r&&(n&&this.removeMediaListeners(n),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=g=>g&&e.getAssetPlayer(g.identifier),n=(g,m,y,v,T)=>{if(g){let S=g[m].start;const w=g.event;if(w){if(m==="playout"||w.timelineOccupancy!==Il.Point){const b=r(y);(b==null?void 0:b.interstitial)===w&&(S+=b.assetItem.startOffset+b[T])}}else{const b=v==="bufferedPos"?o():e[v];S+=b-g.start}return S}return 0},i=(g,m)=>{var y;if(g!==0&&m!=="primary"&&(y=e.schedule)!=null&&y.length){var v;const T=e.schedule.findItemIndexAtTime(g),S=(v=e.schedule.items)==null?void 0:v[T];if(S){const w=S[m].start-S.start;return g+w}}return g},o=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?u("primary"):Math.max(g,0)},u=g=>{var m,y;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[g])||0},c=(g,m)=>{var y,v;const T=e.effectivePlayingItem;if(T!=null&&(y=T.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${m}"`);const S=e.effectivePlayingItem,w=e.schedule.findItemIndexAtTime(g,m),b=(v=e.schedule.items)==null?void 0:v[w],A=e.getBufferingPlayer(),L=A==null?void 0:A.interstitial,k=L==null?void 0:L.appendInPlace,O=S&&e.itemsMatch(S,b);if(S&&(k||O)){const P=r(e.playingAsset),$=(P==null?void 0:P.media)||e.primaryMedia;if($){const B=m==="primary"?$.currentTime:n(S,m,e.playingAsset,"timelinePos","currentTime"),U=g-B,q=(k?B:$.currentTime)+U;if(q>=0&&(!P||k||q<=P.duration)){$.currentTime=q;return}}}if(b){let P=g;if(m!=="primary"){const B=b[m].start,U=g-B;P=b.start+U}const $=!e.isInterstitial(b);if((!e.isInterstitial(S)||S.event.appendInPlace)&&($||b.event.appendInPlace)){const B=e.media||(k?A==null?void 0:A.media:null);B&&(B.currentTime=P)}else if(S){const B=e.findItemIndex(S);if(w>B){const q=e.schedule.findJumpRestrictedIndex(B+1,w);if(q>B){e.setSchedulePosition(q);return}}let U=0;if($)e.timelinePos=P,e.checkBuffer();else{const q=b.event.assetList,re=g-(b[m]||b).start;for(let ae=q.length;ae--;){const le=q[ae];if(le.duration&&re>=le.startOffset&&re<le.startOffset+le.duration){U=ae;break}}}e.setSchedulePosition(w,U)}}},d=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const m=t();return e.isInterstitial(m)?m:null},f={get bufferedEnd(){const g=t(),m=e.bufferingItem;if(m&&m===g){var y;return n(m,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-m.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const g=d(),m=e.effectivePlayingItem;return m&&m===g?n(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(g){const m=d(),y=e.effectivePlayingItem;y&&y===m&&c(g+y.playout.start,"playout")},get duration(){const g=d();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const m=(g=d())==null?void 0:g.event.assetList;return m?m.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var g;const m=(g=d())==null?void 0:g.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return d()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return o()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){c(g,"primary")},get duration(){return u("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){c(g,"integrated")},get duration(){return u("integrated")},get seekableStart(){var g;return i(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,m=g==null?void 0:g.event;if(m&&!m.restrictions.skip){const y=e.findItemIndex(g);if(m.appendInPlace){const v=g.playout.start+g.event.duration;c(v+.001,"playout")}else e.advanceAfterAssetEnded(m,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const i=(t=n)==null?void 0:t.currentTime;if(!(i===void 0||!ue(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,n=e.media;if(r&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ge(i)}`),this.detachedData=i}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var r,n;if(e.media===t)return;let i=null;const o=this.hls,u=e!==o,c=u&&e.interstitial.appendInPlace,d=(r=this.detachedData)==null?void 0:r.mediaSource;let f;if(o.media)c&&(i=o.transferMedia(),this.detachedData=i),f="Primary";else if(d){const v=this.getBufferingPlayer();v?(i=v.transferMedia(),f=`${v}`):f="detached MediaSource"}else f="detached media";if(!i){if(d)i=this.detachedData,this.log(`using detachedData: MediaSource ${Ge(i)}`);else if(!this.detachedData||o.media===t){const v=this.playerQueue;v.length>1&&v.forEach(T=>{if(u&&T.interstitial.appendInPlace!==c){const S=T.interstitial;this.clearInterstitial(T.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=i&&"mediaSource"in i&&((n=i.mediaSource)==null?void 0:n.readyState)!=="closed",m=g&&i?i:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(m===i&&y){const v=u&&e.assetId===y.assetIdAtEnd;m.overrides={duration:y.duration,endOfStream:!u||v,cueRemoval:!u}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,n=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(Qo("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,u=e.findItemIndexAtTime(o);this.setSchedulePosition(u)}}else if(n&&!this.playingItem){const i=e.findItemIndex(n);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,n=r.findAssetIndex(t),i=ad(r,n);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const u=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,r){const n=ad(e,r);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,u=i.length;if(o>=u){this.setSchedulePosition(-1);return}const c=e.resumeTime;this.timelinePos<c&&(this.log(Qo("advanceAfterAssetEnded",c)),this.timelinePos=c,e.appendInPlace&&this.advanceInPlace(c),this.checkBuffer(this.bufferedPos<c)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[n];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const n=t.parentIdentifier,i=r.getEvent(n);if(i){const o=r.findEventIndex(n),u=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,u-1)}}setSchedulePosition(e,t){var r;const n=(r=this.schedule)==null?void 0:r.items;if(!n||this.playbackDisabled)return;const i=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&Tr(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(o)){const f=o.event,g=this.playingAsset,m=g==null?void 0:g.identifier,y=m?this.getAssetPlayer(m):null;if(y&&m&&(!this.eventItemsMatch(o,i)||t!==void 0&&m!==f.assetList[t].identifier)){var c;const v=f.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${f.assetList.length} ${Ys(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(_.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:v,event:f,schedule:n.slice(0),scheduleIndex:e,player:y}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(m,i),y.media&&!((c=this.detachedData)!=null&&c.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Tr(o)}`),f.hasPlayed=!0,this.hls.trigger(_.INTERSTITIAL_ENDED,{event:f,schedule:n.slice(0),scheduleIndex:e}),f.cue.once)){var d;this.updateSchedule();const v=(d=this.schedule)==null?void 0:d.items;if(i&&v){const T=this.findItemIndex(i);this.advanceSchedule(T,v,t,o,u)}return}}this.advanceSchedule(e,n,t,o,u)}advanceSchedule(e,t,r,n,i){const o=this.schedule;if(!o)return;const u=t[e]||null,c=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const g=f.interstitial,m=o.findEventIndex(g.identifier);(m<e||m>e+1)&&this.clearInterstitial(g,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const f=u.event;if(r===void 0){r=o.findAssetIndex(f,this.timelinePos);const v=ad(f,r-1);if(f.isAssetPastPlayoutLimit(v)||f.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(f,e,r);return}r=v}const g=this.waitingItem;this.assetsBuffered(u,c)||this.setBufferingItem(u);let m=this.preloadAssets(f,r);if(this.eventItemsMatch(u,g||n)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${Tr(u)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(_.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const y=f.assetList[r];if(!y){this.advanceAfterAssetEnded(f,e,r||0);return}if(m||(m=this.getAssetPlayer(y.identifier)),m===null||m.destroyed){const v=f.assetList.length;this.warn(`asset ${r+1}/${v} player destroyed ${f}`),m=this.createAssetPlayer(f,y,r),m.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(m,r,t,e,c),this.shouldPlay&&b0(m.media)}else u?(this.resumePrimary(u,e,n),this.shouldPlay&&b0(this.hls.media)):i&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var n,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Tr(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(Qo("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!r)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Tr(e)}`),this.hls.trigger(_.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(r<n.fragmentStart||r>n.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Re.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,n),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Qo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((r=n.mainForwardBufferInfo)==null?void 0:r.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(_.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(_.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const n=Ue(Ue({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ue(Ue({},this.altSelection),{},{audio:r});return}const i=Ue(Ue({},n),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ue(Ue({},this.altSelection),{},{subtitles:r});return}const i=Ue(Ue({},n),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=Nm(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=Nm(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const i=t[n];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),u=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const n=(r=this.schedule)==null?void 0:r.items;if(e&&n){const i=this.findItemIndex(e,t);return n[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,n=Re.bufferInfo(this.primaryMedia,r,0);(n.end>r||(n.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${Tr(e)} (was ${Tr(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const n=Re.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,r,e)}updateBufferedPos(e,t,r){const n=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,u=this.findItemIndex(o);let c=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const f=this.findItemIndex(i),g=Math.min(f+1,t.length-1),m=t[g];if((c===-1&&i&&e>=i.end||(d=m.event)!=null&&d.appendInPlace&&e+.01>=m.start)&&(c=g),this.isInterstitial(i)){const y=i.event;if(g-u>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,c>f&&c>u)this.bufferedToItem(m);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&m.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(c===u?this.bufferedToItem(o):c===u+1&&this.bufferedToItem(t[c]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const i=this.getAssetPlayer(n.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:n,events:i}=r;if(!n||!i)return t;const o=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const c=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Tr(e)}`+(t?` (${c.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const d=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,g)=>{const m=this.getAssetPlayer(f.identifier);m&&(g===d&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(_.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,n=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(n||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(o,u)}}}preloadAssets(e,t){const r=e.assetUrl,n=e.assetList.length,i=n===0&&!e.assetListLoader,o=e.cue.once;if(i){const c=e.timelineStart;if(e.appendInPlace){var u;const m=this.playingItem;!this.isInterstitial(m)&&(m==null||(u=m.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(c+.25)}let d,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const m=f-c;m>0&&(d=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:n} ${e}${d?` live-start: ${f} start-offset: ${d}`:""}`),r)return this.createAsset(e,0,0,c,e.duration,r);const g=this.assetListLoader.loadAssetList(e,d);g&&(e.assetListLoader=g)}else if(!o&&n){for(let d=t;d<n;d++){const f=e.assetList[d],g=this.getAssetPlayerQueueIndex(f.identifier);(g===-1||this.playerQueue[g].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}const c=e.assetList[t];if(c){const d=this.getAssetPlayer(c.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,n,i,o){const u={parentIdentifier:e.identifier,identifier:$L(e,o,t),duration:i,startOffset:r,timelineStart:n,uri:o};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,r){const n=this.hls,i=n.userConfig;let o=i.videoPreference;const u=n.loadLevelObj||n.levels[n.currentLevel];(o||u)&&(o=$e({},o),u.videoCodec&&(o.videoCodec=u.videoCodec),u.videoRange&&(o.allowedVideoRanges=[u.videoRange]));const c=n.audioTracks[n.audioTrack],d=n.subtitleTracks[n.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-t.timelineStart;if(L>1){const k=t.duration;k&&L<k&&(f=L)}}const g=t.identifier,m=Ue(Ue({},i),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:c||i.audioPreference,subtitlePreference:d||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));const y=m.cmcd;y!=null&&y.sessionId&&y.contentId&&(m.cmcd=$e({},y,{contentId:aa(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const v=new VL(this.HlsPlayerClass,m,e,t);this.playerQueue.push(v),e.assetList[r]=t;let T=!0;const S=L=>{if(L.live){var k;const $=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:ve.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:$},U=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(B,e,U,r,$.message);return}const O=L.edge-L.fragmentStart,P=t.duration;(T||P===null||O>P)&&(T=!1,this.log(`Interstitial asset "${g}" duration change ${P} > ${O}`),t.duration=O,this.updateSchedule())};v.on(_.LEVEL_UPDATED,(L,{details:k})=>S(k)),v.on(_.LEVEL_PTS_UPDATED,(L,{details:k})=>S(k)),v.on(_.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const w=(L,k)=>{const O=this.getAssetPlayer(g);if(O&&k.tracks){O.off(_.BUFFER_CODECS,w),O.tracks=k.tracks;const P=this.primaryMedia;this.bufferingAsset===O.assetItem&&P&&!O.media&&this.bufferAssetPlayer(O,P)}};v.on(_.BUFFER_CODECS,w);const b=()=>{var L;const k=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const O=this.schedule.findEventIndex(e.identifier),P=(L=this.schedule.items)==null?void 0:L[O];this.isInterstitial(P)&&this.advanceAssetBuffering(P,t)};v.on(_.BUFFERED_TO_END,b);const A=L=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const O=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,O,L)};return v.once(_.MEDIA_ENDED,A(r)),v.once(_.PLAYOUT_LIMIT_REACHED,A(1/0)),v.on(_.ERROR,(L,k)=>{if(!this.schedule)return;const O=this.getAssetPlayer(g);if(k.details===V.BUFFER_STALLED_ERROR){if(O!=null&&O.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${k.error} ${e}`)}),v.on(_.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${g}`),O={fatal:!0,type:ve.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(O,e,this.schedule.findEventIndex(e.identifier),r,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ys(t)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:v}),v}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const n=this.playerQueue[r];this.log(`clear ${n} toSegment: ${t&&Tr(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(r,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,n,i){const{interstitial:o,assetItem:u,assetId:c}=e,d=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!f||f.identifier!==c)&&(f&&(this.clearAssetPlayer(f.identifier,r[n]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${Ys(u)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,n;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,u=this.schedule.findEventIndex(i.identifier),c=(r=this.schedule.items)==null?void 0:r[u];if(!c)return;e.loadSource(),this.setBufferingItem(c),this.bufferingAsset=o;const d=this.getBufferingPlayer();if(d===e)return;const f=i.appendInPlace;if(f&&(d==null?void 0:d.interstitial.appendInPlace)===!1)return;const g=(d==null?void 0:d.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(f&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!dv(g,e.tracks)){const m=new Error(`Asset ${Ys(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),y={fatal:!0,type:ve.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},v=i.findAssetIndex(o);this.handleAssetItemError(y,i,u,v,m.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const n=r.currentTime,i=t.findAssetIndex(e,n),o=e.assetList[i];if(o){const u=this.getAssetPlayer(o.identifier);if(u){const c=u.currentTime||n-o.timelineStart,d=u.duration-c;if(this.warn(`Stalled at ${c} of ${c+d} in ${u} ${e} (media.currentTime: ${n})`),c&&(d/r.playbackRate<.5||u.bufferedInPlaceToEnd(r))&&u.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,n,i){if(e.details===V.BUFFER_STALLED_ERROR)return;const o=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ys(o)} ${e.error}`),!this.schedule)return;const u=(o==null?void 0:o.identifier)||"",c=this.getAssetPlayerQueueIndex(u),d=this.playerQueue[c]||null,f=this.schedule.items,g=$e({},e,{fatal:!1,errorAction:ei(!0),asset:o,assetListIndex:n,event:t,schedule:f,scheduleIndex:r,player:d});if(this.hls.trigger(_.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const m=this.playingAsset,y=this.bufferingAsset,v=new Error(i);if(o&&(this.clearAssetPlayer(u,null),o.error=v),!t.assetList.some(T=>!T.error))t.error=v;else for(let T=n;T<t.assetList.length;T++)this.resetAssetPlayer(t.assetList[T].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):m&&m.identifier===u?this.advanceAfterAssetEnded(t,r,n):y&&y.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${Tr(r)} error: ${e.error}`);let n=this.timelinePos;n===-1&&(n=this.hls.startPosition);const i=this.updateItem(r,n);if(this.itemsMatch(r,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var r,n;const i=t.event,o=i.identifier,u=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const c=i.timelineStart,d=i.duration;let f=0;u.forEach((T,S)=>{const w=parseFloat(T.DURATION);this.createAsset(i,S,f,c+f,w,T.URI),f+=w}),i.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${i}`);const g=this.waitingItem,m=(g==null?void 0:g.event.identifier)===o;this.updateSchedule();const y=(n=this.bufferingItem)==null?void 0:n.event;if(m){var v;const T=this.schedule.findEventIndex(o),S=(v=this.schedule.items)==null?void 0:v[T];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==T){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(S)}this.setSchedulePosition(T)}else if((y==null?void 0:y.identifier)===o){const T=i.assetList[0];if(T){const S=this.getAssetPlayer(T.identifier);if(y.appendInPlace){const w=this.primaryMedia;S&&w&&this.bufferAssetPlayer(S,w)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case V.ASSET_LIST_PARSING_ERROR:case V.ASSET_LIST_LOAD_ERROR:case V.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case V.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const I0=500;class zL extends Ah{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",ge.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=X.IDLE,this.setInterval(I0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:n}=t;if(this.fragContextChanged(r)||(lt(r)&&(this.fragPrevious=r),this.state=X.IDLE),!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const u=r.start;for(let d=0;d<i.length;d++)if(u>=i[d].start&&u<=i[d].end){o=i[d];break}const c=r.start+r.duration;o?o.end=c:(o={start:u,end:c},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:n}=t;if(r===0&&n!==Number.POSITIVE_INFINITY){const i=n-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;){if(o[u].end<=i){o.shift();continue}else if(o[u].start<i)o[u].start=i;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(r,i,ge.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===ge.SUBTITLE&&(t.details===V.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==X.STOPPED&&(this.state=X.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&gE(this.levels,t)){this.levels=t.map(r=>new ga(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const n=new ga(r);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ge.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==X.STOPPED&&this.setInterval(I0)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:n,levels:i}=this,{details:o,id:u}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const c=i[u];if(u>=i.length||!c)return;this.log(`Subtitle track ${u} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(o.live||(r=c.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const m=g.fragments[0];if(!c.details)o.hasProgramDateTime&&g.hasProgramDateTime?(Al(o,g),d=o.fragmentStart):m&&(d=m.start,Wd(o,d));else{var f;d=this.alignPlaylists(o,c.details,(f=this.levelLastLoaded)==null?void 0:f.details),d===0&&m&&(d=m.start,Wd(o,d))}g&&!this.startFragRequested&&this.setStartPosition(g,d)}c.details=o,this.levelLastLoaded=c,u===n&&(this.hls.trigger(_.SUBTITLE_TRACK_UPDATED,{details:o,id:u,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===X.IDLE&&(cs(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,n=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&n!=null&&n.key&&n.iv&&ti(n.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer,_h(n.method)).catch(u=>{throw i.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const c=performance.now();i.trigger(_.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:c}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=X.IDLE})}}doTick(){if(!this.media){this.state=X.IDLE;return}if(this.state===X.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:n}=this,i=this.getLoadPosition(),o=Re.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:u,len:c}=o,d=r.details,f=this.hls.maxBufferLength+d.levelTargetDuration;if(c>f)return;const g=d.fragments,m=g.length,y=d.edge;let v=null;const T=this.fragPrevious;if(u<y){const b=n.maxFragLookUpTolerance,A=u>y-b?0:b;v=cs(T,g,Math.max(g[0].start,u),A),!v&&T&&T.start<g[0].start&&(v=g[0])}else v=g[m-1];if(v=this.filterReplacedPrimary(v,r.details),!v)return;const S=v.sn-d.startSN,w=g[S-1];if(w&&w.cc===v.cc&&this.fragmentTracker.getState(w)===ft.NOT_LOADED&&(v=w),this.fragmentTracker.getState(v)===ft.NOT_LOADED){const b=this.mapToInitFragWhenRequired(v);b&&this.loadFragment(b,r,u)}}}loadFragment(e,t,r){lt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new qL(this.tracksBuffered[this.currentTrackId]||[])}}class qL{constructor(e){this.buffered=void 0;const t=(r,n,i)=>{if(n=n>>>0,n>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${i})`);return e[n][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const YL={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},kE=s=>String.fromCharCode(YL[s]||s),wr=15,Qr=100,QL={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},XL={17:2,18:4,21:6,22:8,23:10,19:13,20:15},JL={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ZL={25:2,26:4,29:6,30:8,31:10,27:13,28:15},e1=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class t1{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Be.log(`${this.time} [${e}] ${r}`)}}}const es=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class CE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class r1{constructor(){this.uchar=" ",this.penState=new CE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class n1{constructor(e){this.chars=[],this.pos=0,this.currPenState=new CE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Qr;t++)this.chars.push(new r1);this.logger=e}equals(e){for(let t=0;t<Qr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Qr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Qr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Qr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Qr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=kE(e);if(this.pos>=Qr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Qr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Qr;r++){const n=this.chars[r].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class od{constructor(e){this.rows=[],this.currRow=wr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<wr;t++)this.rows.push(new n1(e));this.logger=e}reset(){for(let e=0;e<wr;e++)this.rows[e].clear();this.currRow=wr-1}equals(e){let t=!0;for(let r=0;r<wr;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<wr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<wr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ge(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<wr;u++)this.rows[u].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[i].cueStartTime,c=this.logger.time;if(u!==null&&c!==null&&u<c)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(o.rows[i+d])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ge(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",n=-1;for(let i=0;i<wr;i++){const o=this.rows[i].getTextString();o&&(n=i+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class R0{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new od(r),this.nonDisplayedMemory=new od(r),this.lastOutputScreen=new od(r),this.currRollUpRow=this.displayedMemory.rows[wr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[wr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(2,"MIDROW: "+Ge(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class L0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=i1(),this.logger=void 0;const n=this.logger=new t1;this.channels=[null,new R0(e,t,n),new R0(e+1,r,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const n=t[r]&127,i=t[r+1]&127;let o=!1,u=null;if(n===0&&i===0)continue;this.logger.log(3,()=>"["+es([t[r],t[r+1]])+"] -> ("+es([n,i])+")");const c=this.cmdHistory;if(n>=16&&n<=31){if(s1(n,i,c)){Xo(null,null,c),this.logger.log(3,()=>"Repeated command ("+es([n,i])+") is dropped");continue}Xo(n,i,this.cmdHistory),o=this.parseCmd(n,i),o||(o=this.parseMidrow(n,i)),o||(o=this.parsePAC(n,i)),o||(o=this.parseBackgroundAttributes(n,i))}else Xo(null,null,c);if(!o&&(u=this.parseChars(n,i),u)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+es([n,i])+" orig: "+es([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(r||n))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+es([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(n||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?QL[e]:JL[e]:r=o===1?XL[e]:ZL[e];const u=this.channels[o];return u?(u.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,n.underline=(r&1)===1,r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((r-16)/2)*4,n}parseChars(e,t){let r,n=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+kE(o)+"' in channel "+r),n=[o]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+es(n).join(",")),n}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(r||n))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=e1[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Xo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Xo(s,e,t){t.a=s,t.b=e}function s1(s,e,t){return t.a===s&&t.b===e}function i1(){return{a:null,b:null}}var Fh=(function(){if(wl!=null&&wl.VTTCue)return self.VTTCue;const s=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,c){if(typeof c!="string"||!Array.isArray(u))return!1;const d=c.toLowerCase();return~u.indexOf(d)?d:!1}function r(u){return t(s,u)}function n(u){return t(e,u)}function i(u,...c){let d=1;for(;d<arguments.length;d++){const f=arguments[d];for(const g in f)u[g]=f[g]}return u}function o(u,c,d){const f=this,g={enumerable:!0};f.hasBeenReset=!1;let m="",y=!1,v=u,T=c,S=d,w=null,b="",A=!0,L="auto",k="start",O=50,P="middle",$=50,B="middle";Object.defineProperty(f,"id",i({},g,{get:function(){return m},set:function(U){m=""+U}})),Object.defineProperty(f,"pauseOnExit",i({},g,{get:function(){return y},set:function(U){y=!!U}})),Object.defineProperty(f,"startTime",i({},g,{get:function(){return v},set:function(U){if(typeof U!="number")throw new TypeError("Start time must be set to a number.");v=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",i({},g,{get:function(){return T},set:function(U){if(typeof U!="number")throw new TypeError("End time must be set to a number.");T=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",i({},g,{get:function(){return S},set:function(U){S=""+U,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",i({},g,{get:function(){return w},set:function(U){w=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",i({},g,{get:function(){return b},set:function(U){const q=r(U);if(q===!1)throw new SyntaxError("An invalid or illegal string was specified.");b=q,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",i({},g,{get:function(){return A},set:function(U){A=!!U,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",i({},g,{get:function(){return L},set:function(U){if(typeof U!="number"&&U!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",i({},g,{get:function(){return k},set:function(U){const q=n(U);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");k=q,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",i({},g,{get:function(){return O},set:function(U){if(U<0||U>100)throw new Error("Position must be between 0 and 100.");O=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",i({},g,{get:function(){return P},set:function(U){const q=n(U);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");P=q,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",i({},g,{get:function(){return $},set:function(U){if(U<0||U>100)throw new Error("Size must be between 0 and 100.");$=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",i({},g,{get:function(){return B},set:function(U){const q=n(U);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");B=q,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class a1{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function PE(s){function e(r,n,i,o){return(r|0)*3600+(n|0)*60+(i|0)+parseFloat(o||0)}const t=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class o1{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function DE(s,e,t,r){const n=r?s.split(r):[s];for(const i in n){if(typeof n[i]!="string")continue;const o=n[i].split(t);if(o.length!==2)continue;const u=o[0],c=o[1];e(u,c)}}const eh=new Fh(0,0,""),Jo=eh.align==="middle"?"middle":"center";function l1(s,e,t){const r=s;function n(){const u=PE(s);if(u===null)throw new Error("Malformed timestamp: "+r);return s=s.replace(/^[^\sa-zA-Z-]+/,""),u}function i(u,c){const d=new o1;DE(u,function(m,y){let v;switch(m){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===y){d.set(m,t[T].region);break}break;case"vertical":d.alt(m,y,["rl","lr"]);break;case"line":v=y.split(","),d.integer(m,v[0]),d.percent(m,v[0])&&d.set("snapToLines",!1),d.alt(m,v[0],["auto"]),v.length===2&&d.alt("lineAlign",v[1],["start",Jo,"end"]);break;case"position":v=y.split(","),d.percent(m,v[0]),v.length===2&&d.alt("positionAlign",v[1],["start",Jo,"end","line-left","line-right","auto"]);break;case"size":d.percent(m,y);break;case"align":d.alt(m,y,["start",Jo,"end","left","right"]);break}},/:/,/\s/),c.region=d.get("region",null),c.vertical=d.get("vertical","");let f=d.get("line","auto");f==="auto"&&eh.line===-1&&(f=-1),c.line=f,c.lineAlign=d.get("lineAlign","start"),c.snapToLines=d.get("snapToLines",!0),c.size=d.get("size",100),c.align=d.get("align",Jo);let g=d.get("position","auto");g==="auto"&&eh.position===50&&(g=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=g}function o(){s=s.replace(/^\s+/,"")}if(o(),e.startTime=n(),o(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);s=s.slice(3),o(),e.endTime=n(),o(),i(s,e)}function OE(s){return s.replace(/<br(?: \/)?>/gi,`
`)}class u1{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new a1,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=OE(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const u=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),u}function n(i){DE(i,function(o,u){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const u=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?n(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Fh(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{l1(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=i.indexOf("-->")!==-1;if(!i||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const c1=/\r\n|\n\r|\n|\r/g,ld=function(e,t,r=0){return e.slice(r,r+t.length)===t},d1=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ue(t)||!ue(r)||!ue(n)||!ue(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*n,t+=3600*1e3*i,t};function Uh(s,e,t){return aa(s.toString())+aa(e.toString())+aa(t)}const h1=function(e,t,r){let n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=n.start-i.start,n.new=!1,n=i,i=e[n.prevCC]}e.presentationOffset=r};function f1(s,e,t,r,n,i,o){const u=new u1,c=er(new Uint8Array(s)).trim().replace(c1,`
`).split(`
`),d=[],f=e?ER(e.baseTime,e.timescale):0;let g="00:00.000",m=0,y=0,v,T=!0;u.oncue=function(S){const w=t[r];let b=t.ccOffset;const A=(m-f)/9e4;if(w!=null&&w.new&&(y!==void 0?b=t.ccOffset=w.start:h1(t,r,A)),A){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}b=A-t.presentationOffset}const L=S.endTime-S.startTime,k=Yt((S.startTime+b-y)*9e4,n*9e4)/9e4;S.startTime=Math.max(k,0),S.endTime=Math.max(k+L,0);const O=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(O)),S.id||(S.id=Uh(S.startTime,S.endTime,O)),S.endTime>0&&d.push(S)},u.onparsingerror=function(S){v=S},u.onflush=function(){if(v){o(v);return}i(d)},c.forEach(S=>{if(T)if(ld(S,"X-TIMESTAMP-MAP=")){T=!1,S.slice(16).split(",").forEach(w=>{ld(w,"LOCAL:")?g=w.slice(6):ld(w,"MPEGTS:")&&(m=parseInt(w.slice(7)))});try{y=d1(g)/1e3}catch(w){v=w}return}else S===""&&(T=!1);u.parse(S+`
`)}),u.flush()}const ud="stpp.ttml.im1t",NE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ME=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,g1={left:"start",center:"center",right:"end",start:"start",end:"end"};function k0(s,e,t,r){const n=ke(new Uint8Array(s),["mdat"]);if(n.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=n.map(u=>er(u)),o=vR(e.baseTime,1,e.timescale);try{i.forEach(u=>t(p1(u,o)))}catch(u){r(u)}}function p1(s,e){const n=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((g,m)=>(g[m]=n.getAttribute(`ttp:${m}`)||i[m],g),{}),u=n.getAttribute("xml:space")!=="preserve",c=C0(cd(n,"styling","style")),d=C0(cd(n,"layout","region")),f=cd(n,"body","[begin]");return[].map.call(f,g=>{const m=FE(g,u);if(!m||!g.hasAttribute("begin"))return null;const y=hd(g.getAttribute("begin"),o),v=hd(g.getAttribute("dur"),o);let T=hd(g.getAttribute("end"),o);if(y===null)throw P0(g);if(T===null){if(v===null)throw P0(g);T=y+v}const S=new Fh(y-e,T-e,m);S.id=Uh(S.startTime,S.endTime,S.text);const w=d[g.getAttribute("region")],b=c[g.getAttribute("style")],A=m1(w,b,c),{textAlign:L}=A;if(L){const k=g1[L];k&&(S.lineAlign=k),S.align=L}return $e(S,A),S}).filter(g=>g!==null)}function cd(s,e,t){const r=s.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function C0(s){return s.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function FE(s,e){return[].slice.call(s.childNodes).reduce((t,r,n)=>{var i;return r.nodeName==="br"&&n?t+`
`:(i=r.childNodes)!=null&&i.length?FE(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function m1(s,e,t){const r="http://www.w3.org/ns/ttml#styling";let n=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(n=t[o]),i.reduce((u,c)=>{const d=dd(e,r,c)||dd(s,r,c)||dd(n,r,c);return d&&(u[c]=d),u},{})}function dd(s,e,t){return s&&s.hasAttributeNS(e,t)?s.getAttributeNS(e,t):null}function P0(s){return new Error(`Could not parse ttml timestamp ${s}`)}function hd(s,e){if(!s)return null;let t=PE(s);return t===null&&(NE.test(s)?t=y1(s,e):ME.test(s)&&(t=v1(s,e))),t}function y1(s,e){const t=NE.exec(s),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function v1(s,e){const t=ME.exec(s),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Zo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class E1{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=O0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this),e.on(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(_.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this),e.off(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(_.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Zo(this,"textTrack1"),t=new Zo(this,"textTrack2"),r=new Zo(this,"textTrack3"),n=new Zo(this,"textTrack4");this.cea608Parser1=new L0(1,e,t),this.cea608Parser2=new L0(3,r,n)}addCues(e,t,r,n,i){let o=!1;for(let u=i.length;u--;){const c=i[u],d=S1(c[0],c[1],t,r);if(d>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],r),o=!0,d/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,r,n)}else{const u=this.Cues.newCue(null,t,r,n);this.hls.trigger(_.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i,trackId:o}){const{unparsedVttFrags:u}=this;r===ge.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:i,trackId:o}),u.length&&(this.unparsedVttFrags=[],u.forEach(c=>{this.initPTS[c.frag.cc]?this.onFragLoaded(_.FRAG_LOADED,c):this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const i=r.textTracks[n];if(D0(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:n}=this,{label:i,languageCode:o}=t[e],u=this.getExistingTrack(i,o);if(u)r[e]=u,Qs(r[e]),IE(r[e],n);else{const c=this.createTextTrack("captions",i,o);c&&(c[e]=!0,r[e]=c)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,n={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,r){const n=this.media;if(n)return n.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:n}=this;Object.keys(n).forEach(i=>{Qs(n[i]),delete n[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=O0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Qs(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],n=r.some(i=>i.textCodec===ud);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(gE(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,u=o?ll(o.textTracks):null;if(this.tracks.forEach((c,d)=>{let f;if(u){let g=null;for(let m=0;m<u.length;m++)if(u[m]&&D0(u[m],c)){g=u[m],u[m]=null;break}g&&(f=g)}if(f)Qs(f);else{const g=UE(c);f=this.createTextTrack(g,c.name,c.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),u!=null&&u.length){const c=u.filter(d=>d!==null).map(d=>d.label);c.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${c.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const n=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!n)return;const i=`textTrack${n[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ge.MAIN){var r,n;const{cea608Parser1:i,cea608Parser2:o,lastSn:u}=this,{cc:c,sn:d}=t.frag,f=(r=(n=t.part)==null?void 0:n.index)!=null?r:-1;i&&o&&(d!==u+1||d===u&&f!==this.lastPartIndex+1||c!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=c,this.lastSn=d,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:r,payload:n}=t;if(r.type===ge.SUBTITLE)if(n.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const u=this.tracks[r.level],c=this.vttCCs;c[r.cc]||(c[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),u&&u.textCodec===ud?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;k0(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),r.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{r.logger.log(`Failed to parse IMSC1: ${n}`),r.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:r,payload:n}=e,{initPTS:i,unparsedVttFrags:o}=this,u=i.length-1;if(!i[r.cc]&&u===-1){o.push(e);return}const c=this.hls,d=(t=r.initSegment)!=null&&t.data?ur(r.initSegment.data,new Uint8Array(n)).buffer:n;f1(d,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,f=>{this._appendCues(f,r.level),c.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},f=>{const g=f.message==="Missing initPTS for VTT MPEGTS";g?o.push(e):this._fallbackToIMSC1(r,n),c.logger.log(`Failed to parse VTT cue: ${f}`),!(g&&u>r.cc)&&c.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:f})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||k0(t,this.initPTS[e.cc],()=>{r.textCodec=ud,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(i=>RE(n,i))}else{const n=this.tracks[t];if(!n)return;const i=n.default?"default":"subtitles"+t;r.trigger(_.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===ge.SUBTITLE&&this.onFragLoaded(_.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:n}=t;if(!(r.type===ge.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<n.length;i++){const o=n[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(o);this.cea608Parser1.addData(n[i].pts,u[0]),this.cea608Parser2.addData(n[i].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:n,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(c=>Zd(u[c],t,r))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(c=>Zd(u[c],t,n))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let n=2;for(let i=0;i<r;i++){const o=e[n++],u=127&e[n++],c=127&e[n++];if(u===0&&c===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(t[f].push(u),t[f].push(c))}}return t}}function UE(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function D0(s,e){return!!s&&s.kind===UE(e)&&Yd(e,s)}function S1(s,e,t,r){return Math.min(e,r)-Math.max(s,t)}function O0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const T1=/\s/,x1={newCue(s,e,t,r){const n=[];let i,o,u,c,d;const f=self.VTTCue||self.TextTrackCue;for(let m=0;m<r.rows.length;m++)if(i=r.rows[m],u=!0,c=0,d="",!i.isEmpty()){var g;for(let T=0;T<i.chars.length;T++)T1.test(i.chars[T].uchar)&&u?c++:(d+=i.chars[T].uchar,u=!1);i.cueStartTime=e,e===t&&(t+=1e-4),c>=16?c--:c++;const y=OE(d.trim()),v=Uh(e,t,y);s!=null&&(g=s.cues)!=null&&g.getCueById(v)||(o=new f(e,t,y),o.id=v,o.line=m+1,o.align="left",o.position=10+Math.min(80,Math.floor(c*8/32)*10),n.push(o))}return s&&n.length&&(n.sort((m,y)=>m.line==="auto"||y.line==="auto"?0:m.line>8&&y.line>8?y.line-m.line:m.line-y.line),n.forEach(m=>RE(s,m))),n}};function _1(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const w1=/(\d+)-(\d+)\/(\d+)/;class N0{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||R1,this.controller=new self.AbortController,this.stats=new mh}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=A1(e,this.controller.signal),o=e.responseType==="arraybuffer",u=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=c&&ue(c)?c:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(ya(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var m;this.response=this.loader=g;const y=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},d-(y-n.loading.start)),!g.ok){const{status:T,statusText:S}=g;throw new L1(S||"fetch, bad network response",T,g)}n.loading.first=y,n.total=I1(g.headers)||n.total;const v=(m=this.callbacks)==null?void 0:m.onProgress;return v&&ue(t.highWaterMark)?this.loadProgressively(g,n,e,t.highWaterMark,v):o?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var m,y;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const T=g[u];T&&(n.loaded=n.total=T);const S={url:v.url,data:g,code:v.status},w=(m=this.callbacks)==null?void 0:m.onProgress;w&&!ue(t.highWaterMark)&&w(n,e,g,v),(y=this.callbacks)==null||y.onSuccess(S,n,e,v)}).catch(g=>{var m;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const y=g&&g.code||0,v=g?g.message:null;(m=this.callbacks)==null||m.onError({code:y,text:v},e,g?g.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,n=0,i){const o=new qv,u=e.body.getReader(),c=()=>u.read().then(d=>{if(d.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=d.value,g=f.length;return t.loaded+=g,g<n||o.dataLength?(o.push(f),o.dataLength>=n&&i(t,r,o.flush().buffer,e)):i(t,r,f.buffer,e),c()}).catch(()=>Promise.reject());return c()}}function A1(s,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers($e({},s.headers))};return s.rangeEnd&&t.headers.set("Range","bytes="+s.rangeStart+"-"+String(s.rangeEnd-1)),t}function b1(s){const e=w1.exec(s);if(e)return parseInt(e[2])-parseInt(e[1])+1}function I1(s){const e=s.get("Content-Range");if(e){const r=b1(e);if(ue(r))return r}const t=s.get("Content-Length");if(t)return parseInt(t)}function R1(s,e){return new self.Request(s.url,e)}class L1 extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const k1=/^age:\s*[\d.]+\s*$/im;class BE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new mh,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var u;(u=this.callbacks)==null||u.onError({code:r.status,text:o.message},t,r,n)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(n)for(const u in n)e.setRequestHeader(u,n[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&ue(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,f=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const v=f??t.response;if(v!=null){var o,u;r.loading.end=Math.max(self.performance.now(),r.loading.first);const T=t.responseType==="arraybuffer"?v.byteLength:v.length;r.loaded=r.total=T,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const S=(o=this.callbacks)==null?void 0:o.onProgress;S&&S(r,e,v,t);const w={url:t.responseURL,data:v,code:d};(u=this.callbacks)==null||u.onSuccess(w,r,e,t);return}}const g=i.loadPolicy.errorRetry,m=r.retry,y={url:e.url,data:void 0,code:d};if(xl(g,m,!1,y))this.retry(g);else{var c;Be.error(`${d} while loading ${e.url}`),(c=this.callbacks)==null||c.onError({code:d,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(xl(e,t,!0))this.retry(e);else{var r;Be.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Sh(e,r.retry),r.retry++,Be.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&k1.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const C1={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},P1=Ue(Ue({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:BE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Kb,bufferController:OR,capLevelController:Oh,errorController:Yb,fpsController:NL,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Fv,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:C1},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},D1()),{},{subtitleStreamController:zL,subtitleTrackController:UL,timelineController:E1,audioStreamController:kR,audioTrackController:CR,emeController:ri,cmcdController:CL,contentSteeringController:DL,interstitialsController:WL});function D1(){return{cueHandler:x1,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function O1(s,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=th(s),n=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(o=>{const u=`${o==="level"?"playlist":o}LoadPolicy`,c=e[u]===void 0,d=[];i.forEach(f=>{const g=`${o}Loading${f}`,m=e[g];if(m!==void 0&&c){d.push(g);const y=r[u].default;switch(e[u]={default:y},f){case"TimeOut":y.maxLoadTimeMs=m,y.maxTimeToFirstByteMs=m;break;case"MaxRetry":y.errorRetry.maxNumRetry=m,y.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":y.errorRetry.retryDelayMs=m,y.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=m,y.timeoutRetry.maxRetryDelayMs=m;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${u}": ${Ge(e[u])}`)}),Ue(Ue({},r),e)}function th(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(th):Object.keys(s).reduce((e,t)=>(e[t]=th(s[t]),e),{}):s}function N1(s,e){const t=s.loader;t!==N0&&t!==BE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):_1()&&(s.loader=N0,s.progressive=!0,s.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ul=2,M1=.1,F1=.05,U1=100;class B1 extends Pv{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(U1),this.mediaSource=t.mediaSource;const r=this.media=t.media;Dt(r,"playing",this.onMediaPlaying),Dt(r,"waiting",this.onMediaWaiting),Dt(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(jt(r,"playing",this.onMediaPlaying),jt(r,"waiting",this.onMediaWaiting),jt(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,n;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:u}=o,c=this.seeking&&!u,d=!this.seeking&&u,f=o.paused&&!u||o.ended||o.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||c){c&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1}));return}if(!Re.getBuffered(o).length){this.nudgeRetry=0;return}const g=Re.bufferInfo(o,e,0),m=g.nextStart||0,y=this.fragmentTracker;if(u&&y&&this.hls){const O=M0(this.hls.inFlightFragments,e),P=g.len>ul,$=!m||O||m-e>ul&&!y.getPartialFragment(e);if(P||$)return;this.moved=!1}const v=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(g.len>0)&&!m)return;const P=Math.max(m,g.start||0)-e,B=!!(v!=null&&v.live)?v.targetduration*2:ul,U=el(e,y);if(P>0&&(P<=B||U)){o.paused||this._trySkipBufferHole(U);return}}const T=i.detectStallWithCurrentTimeMs,S=self.performance.now(),w=this.waiting;let b=this.stalled;if(b===null)if(w>0&&S-w<T)b=this.stalled=w;else{this.stalled=S;return}const A=S-b;if(!u&&(A>=T||w)&&this.hls){var L;if(((L=this.mediaSource)==null?void 0:L.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-((v==null?void 0:v.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const k=Re.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(k,A,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(_.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&n&&n.length>1&&e>n.end(0)){const i=Re.bufferedInfo(Re.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=Re.timeRangesToArray(n),u=Re.bufferedInfo(o,t,0).bufferedIndex;if(u>-1&&u<o.length-1){const c=Re.bufferedInfo(o,e,0).bufferedIndex,d=o[u].end,f=o[u+1].start;if((c===-1||c>u)&&f-d<1&&e-d<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${f} buffered index: ${c}`);this.warn(g.message),this.media.currentTime+=1e-6;let m=el(e,this.fragmentTracker);m&&"fragment"in m?m=m.fragment:m||(m=void 0);const y=Re.bufferInfo(this.media,e,0);this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:m,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,r){var n,i;const{fragmentTracker:o,media:u}=this,c=(n=this.hls)==null?void 0:n.config;if(!u||!o||!c)return;const d=(i=this.hls)==null?void 0:i.latestLevelDetails,f=el(r,o);if((f||d!=null&&d.live&&r<d.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const g=e.buffered,m=this.adjacentTraversal(e,r);(g&&g.length>1&&e.len>c.maxBufferHole||e.nextStart&&(e.nextStart-r<c.maxBufferHole||m))&&(t>c.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,n=e.nextStart;if(r&&n){const i=r.getFragAtPos(t,ge.MAIN),o=r.getFragAtPos(n,ge.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:n,stalled:i}=this;if(!n&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${Ge(e)})`);this.warn(o.message),t.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:n}=this,i=(t=this.hls)==null?void 0:t.config;if(!n||!r||!i)return 0;const o=n.currentTime,u=Re.bufferInfo(n,o,0),c=o<u.start?u.start:u.nextStart;if(c&&this.hls){const f=u.len<=i.maxBufferHole,g=u.len>0&&u.len<1&&n.readyState<3,m=c-o;if(m>0&&(f||g)){if(m>i.maxBufferHole){let v=!1;if(o===0){const T=r.getAppendedFrag(0,ge.MAIN);T&&c<T.end&&(v=!0)}if(!v&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||M0(this.hls.inFlightFragments,c))return 0;let S=!1,w=e.end;for(;w<c;){const b=el(w,r);if(b)w+=b.duration;else{S=!0;break}}if(S)return 0}}const y=Math.max(c+F1,o+M1);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${y}`),this.moved=!0,n.currentTime=y,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${y}`),T={type:ve.MEDIA_ERROR,details:V.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?T.part=e:T.frag=e),this.hls.trigger(_.ERROR,T)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:n}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,n<i.nudgeMaxRetry){const u=o+(n+1)*i.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${o} to ${u}`);this.warn(c.message),r.currentTime=u,t.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function M0(s,e){const t=F0(s.main);if(t&&t.start<=e)return t;const r=F0(s.audio);return r&&r.start<=e?r:null}function F0(s){if(!s)return null;switch(s.state){case X.IDLE:case X.STOPPED:case X.ENDED:case X.ERROR:return null}return s.frag}function el(s,e){return e.getAppendedFrag(s,ge.MAIN)||e.getPartialFragment(s)}const $1=.25;function rh(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function fd(s,e,t,r,n){let i=new s(e,t,"");try{i.value=r,n&&(i.type=n)}catch{i=new s(e,t,Ge(n?Ue({type:n},r):r))}return i}const tl=(()=>{const s=rh();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class j1{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(_.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Qs(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return IE(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:n}=this.hls.config;if(!r&&!n)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=rh();if(o)for(let u=0;u<i.length;u++){const c=i[u].type;if(c===Qt.emsg&&!r||!n)continue;const d=tE(i[u].data),f=i[u].pts;let g=f+i[u].duration;g>tl&&(g=tl),g-f<=0&&(g=f+$1);for(let y=0;y<d.length;y++){const v=d[y];if(!rE(v)){this.updateId3CueEnds(f,c);const T=fd(o,f,g,v,c);T&&this.id3Track.addCue(T)}}}}updateId3CueEnds(e,t){var r;const n=(r=this.id3Track)==null?void 0:r.cues;if(n)for(let i=n.length;i--;){const o=n[i];o.type===t&&o.startTime<e&&o.endTime===tl&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:n}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:c}}=o;if(i&&(u||c)){let d;n==="audio"?d=f=>f.type===Qt.audioId3&&c:n==="video"?d=f=>f.type===Qt.emsg&&u:d=f=>f.type===Qt.audioId3&&c||f.type===Qt.emsg&&u,Zd(i,t,r,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:n,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const u=rh();if(r&&n&&!o){const{fragmentStart:T,fragmentEnd:S}=e;let w=this.assetCue;w?(w.startTime=T,w.endTime=S):u&&(w=this.assetCue=fd(u,T,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),w&&(w.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(w),w.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:c}=this,{dateRanges:d}=e,f=Object.keys(d);let g=this.dateRangeCuesAppended;if(c&&t){var m;if((m=c.cues)!=null&&m.length){const T=Object.keys(g).filter(S=>!f.includes(S));for(let S=T.length;S--;){var y;const w=T[S],b=(y=g[w])==null?void 0:y.cues;delete g[w],b&&Object.keys(b).forEach(A=>{const L=b[A];if(L){L.removeEventListener("enter",this.onEventCueEnter);try{c.removeCue(L)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(f.length===0||!ue(v==null?void 0:v.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let T=0;T<f.length;T++){const S=f[T],w=d[S],b=w.startTime,A=g[S],L=(A==null?void 0:A.cues)||{};let k=(A==null?void 0:A.durationKnown)||!1,O=tl;const{duration:P,endDate:$}=w;if($&&P!==null)O=b+P,k=!0;else if(w.endOnNext&&!k){const U=f.reduce((q,re)=>{if(re!==w.id){const ae=d[re];if(ae.class===w.class&&ae.startDate>w.startDate&&(!q||w.startDate<q.startDate))return ae}return q},null);U&&(O=U.startTime,k=!0)}const B=Object.keys(w.attr);for(let U=0;U<B.length;U++){const q=B[U];if(!lI(q))continue;const re=L[q];if(re)k&&!(A!=null&&A.durationKnown)?re.endTime=O:Math.abs(re.startTime-b)>.01&&(re.startTime=b,re.endTime=O);else if(u){let ae=w.attr[q];uI(q)&&(ae=hv(ae));const oe=fd(u,b,O,{key:q,data:ae},Qt.dateRange);oe&&(oe.id=S,this.id3Track.addCue(oe),L[q]=oe,o&&(q==="X-ASSET-LIST"||q==="X-ASSET-URL")&&oe.addEventListener("enter",this.onEventCueEnter))}}g[S]={cues:L,dateRange:w,durationKnown:k}}}}}class G1{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const u=this.targetLatency;if(u===null)return;const c=n-u,d=Math.min(this.maxLatency,u+r.targetduration);if(c<d&&c>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20,y=Math.min(g,Math.max(1,m));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,c=this.hls.userConfig;let d=u&&r||t;(this._targetLatencyUpdated||c.liveSyncDuration||c.liveSyncDurationCount||d===0)&&(d=i!==void 0?i:o*n);const f=n;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const n=r.edge,i=e-t-this.edgeStalled,o=n-r.totalduration,u=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===V.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,n;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class V1 extends Dh{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,n=[],i={},o={};let u=!1,c=!1,d=!1;t.levels.forEach(f=>{const g=f.attrs;let{audioCodec:m,videoCodec:y}=f;m&&(f.audioCodec=m=vl(m,r)||void 0),y&&(y=f.videoCodec=Ab(y));const{width:v,height:T,unknownCodecs:S}=f,w=(S==null?void 0:S.length)||0;if(u||(u=!!(v&&T)),c||(c=!!y),d||(d=!!m),w||m&&!this.isAudioSupported(m)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:b,"FRAME-RATE":A,"HDCP-LEVEL":L,"PATHWAY-ID":k,RESOLUTION:O,"VIDEO-RANGE":P}=g,B=`${`${k||"."}-`}${f.bitrate}-${O}-${A}-${b}-${P}-${L}`;if(i[B])if(i[B].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const U=o[B]+=1;f.attrs["PATHWAY-ID"]=new Array(U+1).join(".");const q=this.createLevel(f);i[B]=q,n.push(q)}else i[B].addGroupId("audio",g.AUDIO),i[B].addGroupId("text",g.SUBTITLES);else{const U=this.createLevel(f);i[B]=U,o[B]=1,n.push(U)}}),this.filterAndSortMediaOptions(n,t,u,c,d)}createLevel(e){const t=new ga(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(n.message),t.supportedResult=wv(n,[])}return t}isAudioSupported(e){return ha(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return ha(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,n,i){var o;let u=[],c=[],d=e;const f=((o=t.stats)==null?void 0:o.parsing)||{};if((r||n)&&i&&(d=d.filter(({videoCodec:b,videoRange:A,width:L,height:k})=>(!!b||!!(L&&k))&&Nb(A))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let b="no level with compatible codecs found in manifest",A=b;t.levels.length&&(A=`one or more CODECS in variant not supported: ${Ge(t.levels.map(k=>k.attrs.CODECS).filter((k,O,P)=>P.indexOf(k)===O))}`,this.warn(A),b+=` (${A})`);const L=new Error(b);this.hls.trigger(_.ERROR,{type:ve.MEDIA_ERROR,details:V.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:A})}}),f.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(b=>!b.audioCodec||this.isAudioSupported(b.audioCodec)),U0(u)),t.subtitles&&(c=t.subtitles,U0(c));const g=d.slice(0);d.sort((b,A)=>{if(b.attrs["HDCP-LEVEL"]!==A.attrs["HDCP-LEVEL"])return(b.attrs["HDCP-LEVEL"]||"")>(A.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&b.height!==A.height)return b.height-A.height;if(b.frameRate!==A.frameRate)return b.frameRate-A.frameRate;if(b.videoRange!==A.videoRange)return El.indexOf(b.videoRange)-El.indexOf(A.videoRange);if(b.videoCodec!==A.videoCodec){const L=Lm(b.videoCodec),k=Lm(A.videoCodec);if(L!==k)return k-L}if(b.uri===A.uri&&b.codecSet!==A.codecSet){const L=yl(b.codecSet),k=yl(A.codecSet);if(L!==k)return k-L}return b.averageBitrate!==A.averageBitrate?b.averageBitrate-A.averageBitrate:0});let m=g[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==g.length)){for(let b=0;b<g.length;b++)if(g[b].pathwayId===d[0].pathwayId){m=g[b];break}}this._levels=d;for(let b=0;b<d.length;b++)if(d[b]===m){var y;this._firstLevel=b;const A=m.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${A}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const k=Math.min(A,this.hls.config.abrEwmaDefaultEstimateMax);k>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const v=i&&!n,T=this.hls.config,S=!!(T.audioStreamController&&T.audioTrackController),w={levels:d,audioTracks:u,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:n,altAudio:S&&!v&&u.some(b=>!!b.url)};f.end=performance.now(),this.hls.trigger(_.MANIFEST_PARSED,w)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:f,reason:f.message}),g)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&n&&i===u)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${u?" with Pathway "+u:""} from level ${r}${i?" with Pathway "+i:""}`);const c={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(_.LEVEL_SWITCHING,c);const d=o.details;if(!d||d.live){const f=this.switchParams(o.uri,n==null?void 0:n.details,d);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Pe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ge.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var r;const{level:n,details:i}=t,o=t.levelInfo;if(!o){var u;this.warn(`Invalid level index ${n}`),(u=t.deliveryDirectives)!=null&&u.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let c=o.details;c===t.details&&c.advanced&&(c=void 0),this.playlistLoaded(n,t,c)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,u=o==null?void 0:o.age;this.log(`Loading level index ${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(_.LEVEL_LOADING,{url:r,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(u=>u.level=-1)),!1));Hv(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=r.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(_.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(_.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function U0(s){const e={};s.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function $E(){return self.SourceBuffer||self.WebKitSourceBuffer}function jE(){if(!Pn())return!1;const e=$E();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function K1(){if(!jE())return!1;const s=Pn();return typeof(s==null?void 0:s.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>s.isTypeSupported(fa(e,"video")))||["mp4a.40.2","fLaC"].some(e=>s.isTypeSupported(fa(e,"audio"))))}function H1(){var s;const e=$E();return typeof(e==null||(s=e.prototype)==null?void 0:s.changeType)=="function"}const W1=100;class z1 extends Ah{constructor(e,t,r){super(e,t,r,"stream-controller",ge.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,i=n?n.currentTime:null;if(i===null||!ue(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(n,i,ge.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:n}=this;if(this.stopLoad(),this.setInterval(W1),this.level=-1,!this.startFragRequested){let i=n.startLevel;i===-1&&(n.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=n.firstAutoLevel),n.nextLoadLevel=i,this.level=n.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=X.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=X.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case X.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],n=r==null?void 0:r.details;if(n&&(!n.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(n))break;this.state=X.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=X.IDLE;break}break}case X.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===X.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],u=this.getMainFwdBufferInfo();if(u===null)return;const c=this.getLevelDetails();if(c&&this._streamEnded(u,c)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(_.BUFFER_EOS,T),this.state=X.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const d=o.details;if(!d||this.state===X.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=X.WAITING_LEVEL,this.startFragRequested=!1;return}const f=u.len,g=this.getMaxBufferLength(o.maxBitrate);if(f>=g)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const m=this.backtrackFragment?this.backtrackFragment.start:u.end;let y=this.getNextFragment(m,d);if(this.couldBacktrack&&!this.fragPrevious&&y&&lt(y)&&this.fragmentTracker.getState(y)!==ft.OK){var v;const S=((v=this.backtrackFragment)!=null?v:y).sn-d.startSN,w=d.fragments[S-1];w&&y.cc===w.cc&&(y=w,this.fragmentTracker.removeFragment(w))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,m)){if(!y.gap){const S=this.audioOnly&&!this.altAudio?je.AUDIO:je.VIDEO,w=(S===je.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;w&&this.afterBufferFlushed(w,S,ge.MAIN)}y=this.getNextFragmentLoopLoading(y,d,u,ge.MAIN,g)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,o,m))}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);n===ft.NOT_LOADED||n===ft.PARTIAL?lt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ge.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<i.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,c=e[u],d=this.fragLastKbps;d&&this.fragCurrent?r=this.fragCurrent.duration*c.maxBitrate/(1e3*d)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const c=u.maxStartPTS?u.maxStartPTS:u.start,d=u.duration,f=Math.max(o.end,c+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case X.KEY_LOADING:case X.FRAG_LOADING:case X.FRAG_LOADING_WAITING_RETRY:case X.PARSING:case X.PARSED:this.state=X.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Dt(r,"playing",this.onMediaPlaying),Dt(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(jt(r,"playing",this.onMediaPlaying),jt(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,n=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,n=n||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&n&&!H1(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==X.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=X.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:n,startFragRequested:i}=this,o=t.level,u=t.details,c=u.totalduration;if(!n){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${c}`);const d=t.levelInfo,f=this.fragCurrent;f&&(this.state===X.FRAG_LOADING||this.state===X.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let g=0;if(u.live||(r=d.details)!=null&&r.live){var m;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;g=this.alignPlaylists(u,d.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(d.details=u,this.levelLastLoaded=d,i||this.setStartPosition(u,g),this.hls.trigger(_.LEVEL_UPDATED,{details:u,level:o}),this.state===X.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=X.IDLE}i&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,u=e.edge,c=i>=o-t.maxFragLookUpTolerance&&i<=u;if(n!==null&&r.duration>n&&(i<n||!c)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!c&&r.readyState<4||i<u-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const g=Re.bufferInfo(r,n,0);if(!((d=g.buffered)!=null&&d.length)){r.currentTime=n;return}if(g.start<=i){r.currentTime=n;return}const{nextStart:y}=Re.bufferedInfo(g.buffered,i,0);y&&(r.currentTime=y)}else r.currentTime=n}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=o[r.level];if(!u){this.warn(`Level ${r.level} not found on progress`);return}const c=u.details;if(!c){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const d=u.videoCodec,f=c.PTSKnown||!c.live,g=(t=r.initSegment)==null?void 0:t.data,m=this._getAudioCodec(u),y=this.transmuxer=this.transmuxer||new fE(this.hls,ge.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=n?n.index:-1,T=v!==-1,S=new xh(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,T),w=this.initPTS[r.cc];y.push(i,g,m,d,r,n,c.totalduration,f,S,w)}onAudioTrackSwitching(e,t){const r=this.hls,n=this.altAudio===2;if(Sl(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.fragmentTracker.removeAllFragments(),r.once(_.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(_.AUDIO_TRACK_SWITCHED,t)}),r.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(_.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Sl(t.url,this.hls);if(r){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let n,i,o=!1;for(const u in r){const c=r[u];if(c.id==="main"){if(i=u,n=c,u==="video"){const d=r[u];d&&(this.videoBuffer=d.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:n}=t,i=r.type===ge.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===X.PARSED&&(this.state=X.IDLE);return}const u=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),lt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}const o=this.media;o&&(!this._hasEnoughToStart&&Re.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=X.ERROR;return}switch(t.details){case V.FRAG_GAP:case V.FRAG_PARSING_ERROR:case V.FRAG_DECRYPT_ERROR:case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.MAIN,t);break;case V.LEVEL_LOAD_ERROR:case V.LEVEL_LOAD_TIMEOUT:case V.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===X.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Pe.LEVEL&&(this.state=X.IDLE);break;case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case V.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case V.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=X.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==je.AUDIO||!this.altAudio){const r=(t===je.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,ge.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&r&&(r+=n);const i=this.getLevelDetails(),o=Re.getBuffered(e),u=o.length?o.start(0):0,c=u-r,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||c>0&&(c<d||this.loadingParts&&c<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${c} to match buffer start`),r+=c,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${u}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:n}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=X.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),n.trigger(_.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===X.STOPPED||this.state===X.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:n,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:u,part:c,level:d}=o,{video:f,text:g,id3:m,initSegment:y}=n,{details:v}=d,T=this.altAudio?void 0:n.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=X.PARSING,y){const S=y.tracks;if(S){const L=u.initSegment||u;if(this.unhandledEncryptionError(y,u))return;this._bufferInitSegment(d,S,L,i),r.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:t,tracks:S})}const w=y.initPTS,b=y.timescale,A=this.initPTS[u.cc];if(ue(w)&&(!A||A.baseTime!==w||A.timescale!==b)){const L=y.trackId;this.initPTS[u.cc]={baseTime:w,timescale:b,trackId:L},r.trigger(_.INIT_PTS_FOUND,{frag:u,id:t,initPTS:w,timescale:b,trackId:L})}}if(f&&v){T&&f.type==="audiovideo"&&this.logMuxedErr(u);const S=v.fragments[u.sn-1-v.startSN],w=u.sn===v.startSN,b=!S||u.cc>S.cc;if(n.independent!==!1){const{startPTS:A,endPTS:L,startDTS:k,endDTS:O}=f;if(c)c.elementaryStreams[f.type]={startPTS:A,endPTS:L,startDTS:k,endDTS:O};else if(f.firstKeyFrame&&f.independent&&i.id===1&&!b&&(this.couldBacktrack=!0),f.dropped&&f.independent){const P=this.getMainFwdBufferInfo(),$=(P?P.end:this.getLoadPosition())+this.config.maxBufferHole,B=f.firstKeyFramePTS?f.firstKeyFramePTS:A;if(!w&&$<B-this.config.maxBufferHole&&!b){this.backtrack(u);return}else b&&(u.gap=!0);u.setElementaryStreamInfo(f.type,u.start,L,u.start,O,!0)}else w&&A-(v.appliedTimelineOffset||0)>ul&&(u.gap=!0);u.setElementaryStreamInfo(f.type,A,L,k,O),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(f,u,c,i,w||b)}else if(w||b)u.gap=!0;else{this.backtrack(u);return}}if(T){const{startPTS:S,endPTS:w,startDTS:b,endDTS:A}=T;c&&(c.elementaryStreams[je.AUDIO]={startPTS:S,endPTS:w,startDTS:b,endDTS:A}),u.setElementaryStreamInfo(je.AUDIO,S,w,b,A),this.bufferFragmentData(T,u,c,i)}if(v&&m!=null&&m.samples.length){const S={id:t,frag:u,details:v,samples:m.samples};r.trigger(_.FRAG_PARSING_METADATA,S)}if(v&&g){const S={id:t,frag:u,details:v,samples:g.samples};r.trigger(_.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${lt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,n){if(this.state!==X.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:u}=t;if(i){const d=e.audioCodec;let f=rl(i.codec,d);f==="mp4a"&&(f="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const m=i.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),d&&d!==f&&this.log(`Swapping manifest audio codec "${d}" for "${f}"`),i.levelCodec=f,i.id=ge.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${f||""}/${d||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=ge.MAIN;const d=o.codec;if((d==null?void 0:d.length)===4)switch(d){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${o.codec!==d?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const c=Object.keys(t);if(c.length){if(this.hls.trigger(_.BUFFER_CODECS,t),!this.hls)return;c.forEach(d=>{const g=t[d].initSegment;g!=null&&g.byteLength&&this.hls.trigger(_.BUFFER_APPENDING,{type:d,data:g,frag:r,part:null,chunkMeta:n,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ge.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=X.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Re.isBuffered(e,r)?t=this.getAppendedFrag(r):Re.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,i=t.level;(!n||t.sn!==n.sn||n.level!==i)&&(this.fragPlaying=t,this.hls.trigger(_.FRAG_CHANGED,{frag:t}),(!n||n.level!==i)&&this.hls.trigger(_.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ue(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ue(t)){const r=this.getLevelDetails(),n=this.currentFrag||(r?cs(null,r.fragments,t):null);if(n){const i=n.programDateTime;if(i!==null){const o=i+(t-n.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class q1 extends cr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[r].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=V.KEY_LOAD_ERROR,r,n,i){return new Zr({type:ve.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,i=t.length;n<i;n++){const o=t[n];if(e.cc<=o.cc&&(!lt(e)||!lt(o)||e.sn<o.sn)||!r&&n==i-1)return this.emeController.selectKeySystemFormat(o).then(u=>{if(!this.emeController)return;o.setKeyFormat(u);const c=sl(u);if(c)return this.emeController.getKeySystemAccess([c])})}if(this.config.requireKeySystemAccessOnStart){const n=ta(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,n;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,d))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const u=gd(i);let c=this.keyIdToKeyInfo[u];if((r=c)!=null&&r.decryptdata.key)return i.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if(this.emeController&&(n=c)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(c.decryptdata)){case"usable":case"usable-in-future":return c.keyLoadPromise.then(f=>{const{keyInfo:g}=f;return i.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${i.keyId?" keyId: "+Pt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),c=this.keyIdToKeyInfo[u]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const o=fb(t.initSegment.data);if(o.length){const u=o[0];u.some(c=>c!==0)&&(this.log(`Using keyId found in init segment ${Pt(u)}`),e.decryptdata.keyId=u,us.setKeyIdForUri(e.decryptdata.uri,u))}}const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,n=r.loader,i=new n(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,u)=>{const c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=r.keyLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(m,y,v,T)=>{const{frag:S,keyInfo:w}=v,b=gd(w.decryptdata);if(!S.decryptdata||w!==this.keyIdToKeyInfo[b])return u(this.createKeyLoadError(S,V.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));w.decryptdata.key=S.decryptdata.key=new Uint8Array(m.data),S.keyLoader=null,w.loader=null,o({frag:S,keyInfo:w})},onError:(m,y,v,T)=>{this.resetLoader(y),u(this.createKeyLoadError(t,V.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),v,Ue({url:c.url,data:void 0},m)))},onTimeout:(m,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,V.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(m,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,V.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};i.load(c,f,g)})}resetLoader(e){const{frag:t,keyInfo:r,url:n}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const o=gd(r.decryptdata)||n;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function gd(s){if(s.keyFormat!==_t.FAIRPLAY){const e=s.keyId;if(e)return Pt(e)}return s.uri}function B0(s){const{type:e}=s;switch(e){case Pe.AUDIO_TRACK:return ge.AUDIO;case Pe.SUBTITLE_TRACK:return ge.SUBTITLE;default:return ge.MAIN}}function pd(s,e){let t=s.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Y1{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,n=t.loader,i=r||n,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Pe.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:n,pathwayId:i,url:o,deliveryDirectives:u,levelInfo:c}=t;this.load({id:r,level:n,pathwayId:i,responseType:"text",type:Pe.LEVEL,url:o,deliveryDirectives:u,levelOrTrack:c})}onAudioTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:o,track:u}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:Pe.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:o,track:u}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:Pe.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:u})}onLevelsUpdated(e,t){const r=this.loaders[Pe.LEVEL];if(r){const n=r.context;n&&!t.levels.some(i=>i===n.levelOrTrack)&&(r.abort(),delete this.loaders[Pe.LEVEL])}}load(e){var t;const r=this.hls.config;let n=this.getInternalLoader(e);if(n){const d=this.hls.logger,f=n.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let i;if(e.type===Pe.MANIFEST?i=r.manifestLoadPolicy.default:i=$e({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),ue((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===Pe.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===Pe.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===Pe.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const f=d.partTarget,g=d.targetduration;if(f&&g){const m=Math.max(f*3,g*.8)*1e3;i=$e({},i,{maxTimeToFirstByteMs:Math.min(m,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},u={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(d,f,g,m)=>{const y=this.getInternalLoader(g);this.resetInternalLoader(g.type);const v=d.data;f.parsing.start=performance.now(),Fr.isMediaPlaylist(v)||g.type!==Pe.MANIFEST?this.handleTrackOrLevelPlaylist(d,f,g,m||null,y):this.handleMasterPlaylist(d,f,g,m)},onError:(d,f,g,m)=>{this.handleNetworkError(f,g,!1,d,m)},onTimeout:(d,f,g)=>{this.handleNetworkError(f,g,!0,void 0,d)}};n.load(e,u,c)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,n){const i=this.hls,o=e.data,u=pd(e,r),c=Fr.parseMasterPlaylist(o,u);if(c.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,c.playlistParsingError,n,t);return}const{contentSteering:d,levels:f,sessionData:g,sessionKeys:m,startTimeOffset:y,variableList:v}=c;this.variableList=v,f.forEach(b=>{const{unknownCodecs:A}=b;if(A){const{preferManagedMediaSource:L}=this.hls.config;let{audioCodec:k,videoCodec:O}=b;for(let P=A.length;P--;){const $=A[P];ha($,"audio",L)?(b.audioCodec=k=k?`${k},${$}`:$,ai.audio[k.substring(0,4)]=2,A.splice(P,1)):ha($,"video",L)&&(b.videoCodec=O=O?`${O},${$}`:$,ai.video[O.substring(0,4)]=2,A.splice(P,1))}}});const{AUDIO:T=[],SUBTITLES:S,"CLOSED-CAPTIONS":w}=Fr.parseMasterPlaylistMedia(o,u,c);T.length&&!T.some(A=>!A.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Xe({}),bitrate:0,url:""})),i.trigger(_.MANIFEST_LOADED,{levels:f,audioTracks:T,subtitles:S,captions:w,contentSteering:d,url:u,stats:t,networkDetails:n,sessionData:g,sessionKeys:m,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,r,n,i){const o=this.hls,{id:u,level:c,type:d}=r,f=pd(e,r),g=ue(c)?c:ue(u)?u:0,m=B0(r),y=Fr.parseLevelPlaylist(e.data,f,g,m,0,this.variableList);if(d===Pe.MANIFEST){const v={attrs:new Xe({}),bitrate:0,details:y,name:"",url:f};y.requestScheduled=t.loading.start+Gv(y,0),o.trigger(_.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:f,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=y,this.handlePlaylistLoaded(y,e,t,r,n,i)}handleManifestParsingError(e,t,r,n,i){this.hls.trigger(_.ERROR,{type:ve.NETWORK_ERROR,details:V.MANIFEST_PARSING_ERROR,fatal:t.type===Pe.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}handleNetworkError(e,t,r=!1,n,i){let o=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===Pe.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Pe.AUDIO_TRACK||e.type===Pe.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let c=V.UNKNOWN,d=!1;const f=this.getInternalLoader(e);switch(e.type){case Pe.MANIFEST:c=r?V.MANIFEST_LOAD_TIMEOUT:V.MANIFEST_LOAD_ERROR,d=!0;break;case Pe.LEVEL:c=r?V.LEVEL_LOAD_TIMEOUT:V.LEVEL_LOAD_ERROR,d=!1;break;case Pe.AUDIO_TRACK:c=r?V.AUDIO_TRACK_LOAD_TIMEOUT:V.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Pe.SUBTITLE_TRACK:c=r?V.SUBTITLE_TRACK_LOAD_TIMEOUT:V.SUBTITLE_LOAD_ERROR,d=!1;break}f&&this.resetInternalLoader(e.type);const g={type:ve.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:f,context:e,error:u,networkDetails:t,stats:i};if(n){const m=(t==null?void 0:t.url)||e.url;g.response=Ue({url:m,data:void 0},n)}this.hls.trigger(_.ERROR,g)}handlePlaylistLoaded(e,t,r,n,i,o){const u=this.hls,{type:c,level:d,levelOrTrack:f,id:g,groupId:m,deliveryDirectives:y}=n,v=pd(t,n),T=B0(n);let S=typeof n.level=="number"&&T===ge.MAIN?d:void 0;const w=e.playlistParsingError;if(w){if(this.hls.logger.warn(`${w} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(_.ERROR,{type:ve.NETWORK_ERROR,details:V.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:w,reason:w.message,response:t,context:n,level:S,parent:T,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const b=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(_.ERROR,{type:ve.NETWORK_ERROR,details:V.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:b,reason:b.message,response:t,context:n,level:S,parent:T,networkDetails:i,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),c){case Pe.MANIFEST:case Pe.LEVEL:if(S){if(!f)S=0;else if(f!==u.levels[S]){const b=u.levels.indexOf(f);b>-1&&(S=b)}}u.trigger(_.LEVEL_LOADED,{details:e,levelInfo:f||u.levels[0],level:S||0,id:g||0,stats:r,networkDetails:i,deliveryDirectives:y,withoutMultiVariant:c===Pe.MANIFEST});break;case Pe.AUDIO_TRACK:u.trigger(_.AUDIO_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:m||"",stats:r,networkDetails:i,deliveryDirectives:y});break;case Pe.SUBTITLE_TRACK:u.trigger(_.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:m||"",stats:r,networkDetails:i,deliveryDirectives:y});break}}}class Nr{static get version(){return pa}static isMSESupported(){return jE()}static isSupported(){return K1()}static getMediaSource(){return Pn()}static get Events(){return _}static get MetadataSchema(){return Qt}static get ErrorTypes(){return ve}static get ErrorDetails(){return V}static get DefaultConfig(){return Nr.defaultConfig?Nr.defaultConfig:P1}static set DefaultConfig(e){Nr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new bh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=tb(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=O1(Nr.DefaultConfig,e,t);this.userConfig=e,r.progressive&&N1(r,t);const{abrController:n,bufferController:i,capLevelController:o,errorController:u,fpsController:c}=r,d=new u(this),f=this.abrController=new n(this),g=new Qb(this),m=r.interstitialsController,y=m?this.interstitialsController=new m(this,Nr):null,v=this.bufferController=new i(this,g),T=this.capLevelController=new o(this),S=new c(this),w=new Y1(this),b=r.contentSteeringController,A=b?new b(this):null,L=this.levelController=new V1(this,A),k=new j1(this),O=new q1(this.config,this.logger),P=this.streamController=new z1(this,g,O),$=this.gapController=new B1(this,g);T.setStreamController(P),S.setStreamController(P);const B=[w,L,P];y&&B.splice(1,0,y),A&&B.splice(1,0,A),this.networkControllers=B;const U=[f,v,$,T,S,k,g];this.audioTrackController=this.createController(r.audioTrackController,B);const q=r.audioStreamController;q&&B.push(this.audioStreamController=new q(this,g,O)),this.subtitleTrackController=this.createController(r.subtitleTrackController,B);const re=r.subtitleStreamController;re&&B.push(this.subtititleStreamController=new re(this,g,O)),this.createController(r.timelineController,U),O.emeController=this.emeController=this.createController(r.emeController,U),this.cmcdController=this.createController(r.cmcdController,U),this.latencyController=this.createController(G1,U),this.coreComponents=U,B.push(d);const ae=d.onErrorOut;typeof ae=="function"&&this.on(_.ERROR,ae,d),this.on(_.MANIFEST_LOADED,w.onManifestLoaded,w)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,n){this._emitter.off(e,t,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const n=e===_.ERROR;this.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,fatal:n,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(_.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(_.ERROR,{type:ve.OTHER_ERROR,details:V.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,n=t?e:{media:r};this._media=r,this.trigger(_.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(_.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(_.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,n=this._url=ph.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(_.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ge.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ge.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ge.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=BL()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ob(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,r)for(let i=n;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=Iv(t);return Av(e,r,navigator.mediaCapabilities)}}Nr.defaultConfig=void 0;const Q1=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:R.jsx("path",{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z",clipRule:"evenodd"})}),X1=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),J1=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25"})}),Z1=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 9.75L19.5 12m0 0l2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6l4.72-4.72a.75.75 0 011.28 .53v15.88a.75.75 0 01-1.28 .53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"})}),ek=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28 .53v15.88a.75.75 0 01-1.28 .53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"})}),tk=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})}),rk=()=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-green-400",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),nk=()=>R.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[R.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),R.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),GE=({channel:s,onClose:e})=>{const t=W.useRef(null),r=W.useRef(null),[n,i]=W.useState(!1),[o,u]=W.useState(!1),[c,d]=W.useState(!1),[f,g]=W.useState(!1),[m,y]=W.useState(!0),[v,T]=W.useState(!1);if(!s)return null;W.useEffect(()=>{const k=()=>{T(window.innerWidth<640)};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]),W.useEffect(()=>{const k=P=>{P.key==="Escape"&&!o&&e()};document.body.style.overflow="hidden",window.addEventListener("keydown",k);const O=()=>{const P=document;u(!!(P.fullscreenElement||P.mozFullScreenElement||P.webkitFullscreenElement||P.msFullscreenElement))};return document.addEventListener("fullscreenchange",O),document.addEventListener("webkitfullscreenchange",O),document.addEventListener("mozfullscreenchange",O),document.addEventListener("MSFullscreenChange",O),()=>{document.body.style.overflow="auto",window.removeEventListener("keydown",k),document.removeEventListener("fullscreenchange",O),document.removeEventListener("webkitfullscreenchange",O),document.removeEventListener("mozfullscreenchange",O),document.removeEventListener("MSFullscreenChange",O)}},[e,o]),W.useEffect(()=>{if(!t.current)return;const k=t.current,O=s.streamUrl;let P;y(!0);const $=()=>y(!0),B=()=>y(!1);if(k.addEventListener("waiting",$),k.addEventListener("playing",B),Nr.isSupported()){const U={lowLatencyMode:!0,liveSyncDurationCount:2,maxBufferLength:10,startLevel:0,abrEwmaDefaultEstimate:5e5};P=new Nr(U),P.loadSource(O),P.attachMedia(k),P.on(Nr.Events.MANIFEST_PARSED,()=>{k.play().catch(()=>{console.log("Autoplay was prevented by the browser."),y(!1)})})}else k.canPlayType("application/vnd.apple.mpegurl")&&(k.src=O,k.addEventListener("loadedmetadata",()=>{k.play().catch(()=>{console.log("Autoplay was prevented by the browser."),y(!1)})}));return()=>{P&&P.destroy(),k.removeEventListener("waiting",$),k.removeEventListener("playing",B)}},[s.streamUrl]);const S=()=>{t.current&&(t.current.muted=!t.current.muted,i(t.current.muted))},w=()=>{const k=document,O=r.current,P=t.current;!!(k.fullscreenElement||k.webkitFullscreenElement||k.mozFullScreenElement||k.msFullscreenElement)?k.exitFullscreen?k.exitFullscreen():k.webkitExitFullscreen?k.webkitExitFullscreen():k.mozCancelFullScreen?k.mozCancelFullScreen():k.msExitFullscreen&&k.msExitFullscreen():P&&P.webkitEnterFullscreen?P.webkitEnterFullscreen():O.requestFullscreen?O.requestFullscreen().catch(B=>console.error(`Error attempting to enable full-screen mode: ${B.message} (${B.name})`)):O.webkitRequestFullscreen?O.webkitRequestFullscreen().catch(B=>console.error(`Error attempting to enable full-screen mode: ${B.message} (${B.name})`)):O.mozRequestFullScreen?O.mozRequestFullScreen().catch(B=>console.error(`Error attempting to enable full-screen mode: ${B.message} (${B.name})`)):O.msRequestFullscreen&&O.msRequestFullscreen().catch(B=>console.error(`Error attempting to enable full-screen mode: ${B.message} (${B.name})`))},b=async()=>{if(!(c||f)){d(!0);try{await xA(s),g(!0),setTimeout(()=>g(!1),3e3)}catch(k){console.error(k),alert("Failed to submit report. Please try again later.")}finally{d(!1)}}},A=()=>c?v?"REPORTING":"REPORTING...":f?"REPORTED":v?"REPORT":"REPORT NOT WORKING",L=Array.isArray(s.subCategory)?s.subCategory.join(", "):s.subCategory;return R.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in","aria-modal":"true",role:"dialog",children:R.jsxs("div",{className:"relative w-full max-w-4xl mx-4",children:[R.jsxs("div",{ref:r,className:"bg-black rounded-lg shadow-2xl overflow-hidden flex flex-col",children:[R.jsxs("div",{className:"w-full aspect-video relative bg-black",children:[m&&R.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:R.jsx(di,{})}),R.jsx("video",{ref:t,autoPlay:!0,playsInline:!0,className:"w-full h-full",muted:n,children:"Your browser does not support the video tag."})]}),R.jsxs("div",{className:"relative bg-gray-900/70 backdrop-blur-sm p-2 flex justify-between items-center",children:[R.jsxs("button",{onClick:b,disabled:c||f,className:"bg-transparent hover:bg-white/20 text-white rounded-md px-3 py-2.5 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 z-10","aria-label":"Report broken link",children:[c?R.jsx(nk,{}):f?R.jsx(rk,{}):R.jsx(tk,{}),R.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:A()})]}),R.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center text-white pointer-events-none",children:[R.jsx("p",{className:"font-bold text-sm truncate",children:s.name}),R.jsx("p",{className:"text-xs text-gray-400 truncate",children:L})]}),R.jsxs("div",{className:"flex items-center space-x-2 z-10",children:[R.jsx("button",{onClick:S,className:"bg-transparent hover:bg-white/20 text-white rounded-full p-2.5 transition-all duration-200","aria-label":n?"Unmute":"Mute",children:n?R.jsx(Z1,{}):R.jsx(ek,{})}),R.jsx("button",{onClick:w,className:"bg-transparent hover:bg-white/20 text-white rounded-full p-2.5 transition-all duration-200","aria-label":o?"Exit Fullscreen":"Enter Fullscreen",children:o?R.jsx(J1,{}):R.jsx(X1,{})})]})]})]}),R.jsx("button",{onClick:e,className:"absolute -top-4 -right-4 bg-gradient-to-br from-gray-700 to-gray-900 text-white rounded-full p-3 hover:from-red-500 hover:to-red-600 transition-all duration-200 z-10 shadow-lg border-2 border-black/20","aria-label":"Close video player",children:R.jsx(Q1,{})})]})})},sk=({channel:s,onSelect:e})=>R.jsx("div",{onClick:e,className:"group cursor-pointer aspect-square rounded-lg bg-white shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden",children:R.jsx("img",{src:s.logoUrl,alt:`${s.name} Logo`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"})}),ik=({onVideoSelect:s})=>{const[e,t]=W.useState(null),[r,n]=W.useState(!0),[i,o]=W.useState(null),[u,c]=W.useState({}),d=()=>{n(!0),o(null);try{const v=uv.filter(w=>w.category==="NATIONAL").reduce((w,b)=>{const{subCategory:A}=b;return w[A]||(w[A]=[]),w[A].push(b),w},{}),T=["HINDI","ENGLISH","BUSINESS"],S={};for(const w of T)v[w]&&(S[w]=v[w]);c(S)}catch{o("Failed to load live channels.")}finally{n(!1)}};W.useEffect(()=>{d()},[]);const f=y=>{t(y)},g=()=>{t(null)},m=()=>r?R.jsx(di,{}):i?R.jsxs("div",{className:"text-center py-20",children:[R.jsx("p",{className:"text-red-600 mb-4",children:i}),R.jsx("button",{onClick:d,className:"bg-[#8a1315] hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"Retry"})]}):R.jsx("div",{children:Object.entries(u).map(([y,v])=>R.jsxs("section",{className:"mb-8",children:[R.jsx("h2",{className:"text-xl font-bold text-gray-800 border-b-2 border-red-600 pb-2 mb-4",children:y}),R.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4 lg:gap-6",children:v.map(T=>R.jsx(sk,{channel:T,onSelect:()=>f(T)},T.id))})]},y))});return R.jsxs(R.Fragment,{children:[R.jsxs("div",{children:[R.jsx("h1",{className:"text-3xl font-bold text-black mb-2",children:"Live News"}),R.jsx("p",{className:"text-gray-600 mb-6",children:"Watch national news channels live."}),m()]}),e&&R.jsx(GE,{channel:e,onClose:g})]})},ak=()=>{const[s,e]=W.useState([]),[t,r]=W.useState(0);W.useEffect(()=>{(async()=>{try{e([])}catch(c){console.error("Error fetching top news:",c),e([])}})()},[]);const n=()=>{r(u=>u>=s.length-1?0:u+1)},i=()=>{r(u=>u<=0?s.length-1:u-1)};if(s.length===0)return R.jsx("div",{className:"w-full max-w-4xl rounded-lg overflow-hidden shadow-lg bg-white flex items-center justify-center",style:{height:"256px"},children:R.jsx("p",{className:"text-gray-500",children:"No featured news right now. Check back later!"})});const o=s[t];return R.jsxs("div",{className:"relative w-full max-w-4xl rounded-lg overflow-hidden shadow-lg",children:[o.imageUrl?R.jsx("img",{src:o.imageUrl,alt:o.title,className:"w-full h-64 object-cover"}):R.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center",children:R.jsx("p",{className:"text-gray-500",children:"Image not available"})}),R.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 p-4",children:[R.jsx("h3",{className:"text-white text-xl font-bold",children:o.title}),o.summary&&R.jsx("p",{className:"text-white text-sm mt-1",children:o.summary})]}),R.jsx("button",{onClick:i,className:"absolute top-1/2 left-4 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-200 opacity-75 hover:opacity-100","aria-label":"Previous slide",children:""}),R.jsx("button",{onClick:n,className:"absolute top-1/2 right-4 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-200 opacity-75 hover:opacity-100","aria-label":"Next slide",children:""})]})},$0=()=>{const[s,e]=W.useState([]),[t,r]=W.useState(!0);return W.useEffect(()=>{(async()=>{try{e([])}catch(i){console.error("Error fetching regional news:",i),e([])}finally{r(!1)}})()},[]),t?R.jsx("div",{className:"flex justify-center items-center py-8",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})}):R.jsxs("div",{className:"space-y-8",children:[R.jsx(ak,{}),R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Regional News"}),s.length>0?R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(n=>R.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[n.title&&R.jsx("h3",{className:"font-semibold mb-2",children:n.title}),n.summary&&R.jsx("p",{className:"text-gray-600 text-sm",children:n.summary})]},n.id))}):R.jsx("div",{className:"text-center py-8",children:R.jsx("p",{className:"text-gray-500",children:"No regional news available right now."})})]})]})},ok=({article:s})=>{const e=s.content?s.content.replace(/\\"/g,'"'):"Content not available";return R.jsx(oy,{to:`/article/${s.id}`,className:"block",children:R.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-4 transition-transform duration-300 ease-in-out hover:scale-105",children:[R.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-48 object-cover"}),R.jsxs("div",{className:"p-4",children:[R.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-800",children:s.title}),R.jsx("p",{className:"text-gray-600 text-sm mb-4",children:e})]})]})})},lk=()=>{const[s,e]=W.useState([]),[t,r]=W.useState(!0);return W.useEffect(()=>{(async()=>{try{e([])}catch(i){console.error("Error fetching national news:",i),e([])}finally{r(!1)}})()},[]),t?R.jsx("div",{className:"flex justify-center items-center py-8",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})}):R.jsx("div",{className:"space-y-8",children:R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"National News"}),s.length>0?R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(n=>R.jsx(ok,{article:n},n.id))}):R.jsx("div",{className:"text-center py-8",children:R.jsx("p",{className:"text-gray-500",children:"No national news available right now."})})]})})},uk=({channel:s,onSelect:e})=>R.jsx("div",{onClick:e,className:"group cursor-pointer aspect-square rounded-lg bg-white shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden",children:R.jsx("img",{src:s.logoUrl,alt:`${s.name} Logo`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"})}),ck=()=>{const[s,e]=W.useState(null),[t,r]=W.useState(!0),[n,i]=W.useState(null),[o,u]=W.useState({}),c=()=>{r(!0),i(null);try{const m=uv.filter(v=>v.category==="REGIONAL"),y={};m.forEach(v=>{v.category==="REGIONAL"&&v.subCategory.forEach(T=>{y[T]||(y[T]=[]),y[T].push(v)})}),u(y)}catch{i("Failed to load regional live channels.")}finally{r(!1)}};W.useEffect(()=>{c()},[]);const d=m=>{e(m)},f=()=>{e(null)},g=()=>t?R.jsx(di,{}):n?R.jsxs("div",{className:"text-center py-20",children:[R.jsx("p",{className:"text-red-600 mb-4",children:n}),R.jsx("button",{onClick:c,className:"bg-[#8a1315] hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"Retry"})]}):R.jsx("div",{children:Object.entries(o).map(([m,y])=>R.jsxs("section",{className:"mb-8",children:[R.jsx("h2",{className:"text-xl font-bold text-gray-800 border-b-2 border-red-600 pb-2 mb-4",children:m}),R.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4 lg:gap-6",children:y.map(v=>R.jsx(uk,{channel:v,onSelect:()=>d(v)},v.id))})]},m))});return R.jsxs(R.Fragment,{children:[R.jsxs("div",{children:[R.jsx("h1",{className:"text-3xl font-bold text-black mb-2",children:"Regional Live"}),R.jsx("p",{className:"text-gray-600 mb-6",children:"Live news from your state."}),g()]}),s&&R.jsx(GE,{channel:s,onClose:f})]})},dk=s=>typeof s!="string"||s.length===0?"":s.charAt(0).toUpperCase()+s.slice(1),hk=s=>{const e=typeof s=="string"?new Date(s):s,r=Math.floor((new Date().getTime()-e.getTime())/1e3);if(r<5)return"just now";let n=r/31536e3;return n>1?Math.floor(n)+" years ago":(n=r/2592e3,n>1?Math.floor(n)+" months ago":(n=r/86400,n>1?Math.floor(n)+" days ago":(n=r/3600,n>1?Math.floor(n)+" hours ago":(n=r/60,n>1?Math.floor(n)+" minutes ago":Math.floor(r)+" seconds ago"))))},fk=({className:s})=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:s||"w-5 h-5",children:R.jsx("path",{fillRule:"evenodd",d:"M7.5 3.75A1.5 1.5 0 006 5.25v13.5a1.5 1.5 0 001.5 1.5h6a1.5 1.5 0 001.5-1.5V15a.75.75 0 011.5 0v3.75a3 3 0 01-3 3h-6a3 3 0 01-3-3V5.25a3 3 0 013-3h6a3 3 0 013 3V9A.75.75 0 0115 9V5.25a1.5 1.5 0 00-1.5-1.5h-6zm10.72 4.72a.75.75 0 011.06 0l3 3a.75.75 0 010 1.06l-3 3a.75.75 0 11-1.06-1.06l1.72-1.72H9a.75.75 0 010-1.5h10.94l-1.72-1.72a.75.75 0 010-1.06z",clipRule:"evenodd"})}),gk=({className:s})=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:s,children:R.jsx("path",{fillRule:"evenodd",d:"M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z",clipRule:"evenodd"})}),pk=({className:s})=>R.jsx("svg",{className:s,viewBox:"0 0 24 24",fill:"currentColor",children:R.jsx("path",{d:"M12,2A3,3,0,0,1,15,5A3,3,0,0,1,12,8A3,3,0,0,1,9,5A3,3,0,0,1,12,2M10,9H14A2,2,0,0,1,16,11V17H13.5V22H10.5V17H8V11A2,2,0,0,1,10,9Z"})}),mk=({className:s})=>R.jsx("svg",{className:s,viewBox:"0 0 24 24",fill:"currentColor",children:R.jsx("path",{d:"M12,2A3,3,0,0,1,15,5A3,3,0,0,1,12,8A3,3,0,0,1,9,5A3,3,0,0,1,12,2M10,9H14A2,2,0,0,1,16,11V16L13,22H11L8,16V11A2,2,0,0,1,10,9Z"})}),yk=({className:s})=>R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:s,children:[R.jsx("path",{d:"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"}),R.jsx("path",{d:"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25-1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"})]}),j0={categories:[],state:"",district:""},vk=({onLogout:s})=>{var Y,Q,C;const{user:e,profile:t,loading:r,reloadProfile:n}=KE(),[i,o]=W.useState(t),[u,c]=W.useState(!0),[d,f]=W.useState(!1),[g,m]=W.useState((i==null?void 0:i.name)||""),[y,v]=W.useState((i==null?void 0:i.gender)||"other"),[T,S]=W.useState((i==null?void 0:i.preferences)||j0),[w,b]=W.useState({INDIAN_STATES:[],INDIAN_STATES_AND_DISTRICTS:{}}),[A,L]=W.useState([]),[k,O]=W.useState(!1),[P,$]=W.useState(""),[B,U]=W.useState("");W.useEffect(()=>{!r&&u&&c(!1)},[r,u]),W.useEffect(()=>{t&&o(t)},[t]),W.useEffect(()=>{lv().then(b)},[]),W.useEffect(()=>{L(T.state?w.INDIAN_STATES_AND_DISTRICTS[T.state]||[]:[])},[T.state,w]);const q=()=>{$(""),U("")},re=()=>{q(),i&&(m(i.name),v(i.gender),S(i.preferences||j0)),f(!0)},ae=()=>{f(!1),q()},le=async()=>{if(q(),!g.trim()){U("Name cannot be empty.");return}if(!e){U("You must be logged in to save.");return}O(!0);const N={name:g,gender:y,preferences:T};o(te=>({...te,...N})),f(!1);try{await tv(e.uid,{name:g,gender:y,preferences:T}),$("Profile and preferences updated!"),n()}catch(te){U(te.message||"Failed to update profile."),o(t)}finally{O(!1),setTimeout(()=>q(),4e3)}},oe=N=>S(te=>({...te,categories:te.categories.includes(N)?te.categories.filter(ce=>ce!==N):[...te.categories,N]})),J=N=>S(te=>({...te,state:N.target.value,district:""})),se=N=>S(te=>({...te,district:N.target.value})),F=(N,te)=>{const ce=N==null?void 0:N.toLowerCase();return ce==="male"?R.jsx(pk,{className:te}):ce==="female"?R.jsx(mk,{className:te}):R.jsx(gk,{className:te})};return r&&u?R.jsx("div",{className:"w-full flex justify-center items-center py-20",children:R.jsx(di,{})}):!e||!i?R.jsx("div",{className:"p-8 text-center",children:"Please log in to see your profile."}):R.jsx("div",{className:"animate-fade-in bg-gray-50 min-h-full",children:R.jsxs("div",{className:"max-w-2xl mx-auto p-4 sm:p-6 lg:p-8",children:[P&&R.jsx("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-r-lg shadow-md",role:"alert",children:R.jsx("p",{children:P})}),B&&R.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r-lg shadow-md",role:"alert",children:R.jsx("p",{children:B})}),R.jsx("div",{className:"space-y-8",children:R.jsx("div",{children:d?R.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md border",children:[R.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Edit Profile"}),R.jsxs("div",{className:"space-y-4 mb-6",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-600 text-sm font-bold mb-2",children:"Full Name"}),R.jsx("input",{type:"text",value:g,onChange:N=>m(N.target.value),className:"w-full px-4 py-2 rounded-lg bg-gray-100 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#b30002] text-black"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-600 text-sm font-bold mb-2",children:"Gender"}),R.jsx("div",{className:"flex justify-start space-x-4 bg-gray-100 p-2 rounded-lg",children:["male","female","other"].map(N=>R.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-1 rounded-md",children:[R.jsx("input",{type:"radio",name:"gender",value:N,checked:y===N,onChange:te=>v(te.target.value),className:"form-radio h-4 w-4 text-[#b30002]"}),R.jsx("span",{className:"text-gray-700",children:dk(N)})]},N))})]})]}),R.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4 border-t pt-6",children:"Manage Preferences"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Favorite Categories"}),R.jsx("div",{className:"flex flex-wrap gap-2",children:cv.map(N=>R.jsx("button",{onClick:()=>oe(N),className:`px-3 py-1 text-sm rounded-full transition-colors ${T.categories.includes(N)?"bg-[#8a1315] text-white":"bg-gray-200 text-gray-700"}`,children:N},N))})]}),R.jsxs("div",{children:[R.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Location"}),R.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm text-gray-600",children:"State"}),R.jsxs("select",{value:T.state,onChange:J,className:"w-full p-2 rounded bg-gray-100 border-gray-300",children:[R.jsx("option",{value:"",children:"Select State"}),w.INDIAN_STATES.map(N=>R.jsx("option",{value:N,children:N},N))]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm text-gray-600",children:"District"}),R.jsxs("select",{value:T.district,onChange:se,className:"w-full p-2 rounded bg-gray-100 border-gray-300",disabled:!A.length,children:[R.jsx("option",{value:"",children:"Select District"}),A.map(N=>R.jsx("option",{value:N,children:N},N))]})]})]})]})]}),R.jsxs("div",{className:"flex gap-4 pt-8 border-t mt-8",children:[R.jsx("button",{onClick:le,disabled:k,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg disabled:bg-gray-400",children:k?"Saving...":"Save Changes"}),R.jsx("button",{onClick:ae,className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg",children:"Cancel"})]})]}):R.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md border",children:[R.jsxs("div",{className:"flex items-start",children:[R.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mr-5 border-2 border-gray-200",children:F(i.gender||"","w-10 h-10 text-gray-500")}),R.jsxs("div",{className:"flex-grow",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:i.name}),R.jsx("p",{className:"text-sm text-gray-500 mt-1",children:i.phone}),((Y=i.preferences)==null?void 0:Y.state)&&R.jsxs("p",{className:"text-sm text-gray-500",children:[i.preferences.district,", ",i.preferences.state]})]}),R.jsxs("div",{className:"flex flex-col space-y-2",children:[R.jsx("button",{onClick:re,className:"p-2 rounded-full text-gray-500 hover:text-blue-600 hover:bg-gray-100 transition-colors",children:R.jsx(yk,{className:"w-5 h-5"})}),R.jsx("button",{onClick:s,className:"p-2 rounded-full text-gray-500 hover:text-red-600 hover:bg-gray-100 transition-colors",children:R.jsx(fk,{className:"w-5 h-5"})})]})]}),R.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200/80",children:[R.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Favorite Categories"}),R.jsx("div",{className:"flex flex-wrap gap-2",children:(C=(Q=i.preferences)==null?void 0:Q.categories)!=null&&C.length?i.preferences.categories.map(N=>R.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-red-700 text-white shadow-sm",children:N},N)):R.jsx("p",{className:"text-sm text-gray-500",children:"No categories selected."})})]})]})})})]})})},Ek=({className:s})=>R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:s,children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),Sk=()=>{const{user:s}=KE(),[e,t]=W.useState([]),[r,n]=W.useState(!0),[i,o]=W.useState(""),[u,c]=W.useState("");W.useEffect(()=>{if(!(s!=null&&s.uid))return;n(!0);const g=rv(s.uid,m=>{t(m),n(!1)});return()=>g()},[s==null?void 0:s.uid]);const d=()=>{o(""),c("")},f=async()=>{if(s!=null&&s.uid){d();try{await AA(s.uid),t(g=>g.map(m=>({...m,isRead:!0}))),o("All notifications marked as read."),setTimeout(()=>d(),3e3)}catch{c("Failed to mark all as read. Please try again."),setTimeout(()=>d(),3e3)}}};return s?R.jsx("div",{className:"animate-fade-in bg-gray-50 min-h-full",children:R.jsxs("div",{className:"max-w-2xl mx-auto",children:[i&&R.jsx("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-r-lg shadow-md",role:"alert",children:R.jsx("p",{children:i})}),u&&R.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r-lg shadow-md",role:"alert",children:R.jsx("p",{children:u})}),R.jsxs("div",{className:"bg-white rounded-lg shadow-md border",children:[R.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200/80",children:[R.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Notifications"}),e.some(g=>!g.isRead)&&R.jsxs("button",{onClick:f,className:"flex items-center text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors",children:[R.jsx(Ek,{className:"w-5 h-5 mr-1"}),"Mark all as read"]})]}),R.jsx("div",{className:"max-h-[85vh] overflow-y-auto",children:r?R.jsx("div",{className:"flex justify-center items-center h-40",children:R.jsx(di,{})}):e.length===0?R.jsxs("div",{className:"text-center py-16 text-gray-500",children:[R.jsx("p",{className:"font-semibold",children:"You're all caught up!"}),R.jsx("p",{className:"text-sm",children:"You have no new notifications."})]}):R.jsx("ul",{className:"divide-y divide-gray-200/80",children:e.map(g=>R.jsx("li",{className:`transition-colors cursor-pointer ${g.isRead?"bg-gray-50/50 text-gray-500":"bg-white hover:bg-blue-50/50"}`,children:R.jsxs("div",{className:"flex items-center p-4",children:[!g.isRead&&R.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-4 flex-shrink-0"}),R.jsxs("div",{className:"flex-grow",children:[R.jsx("p",{className:`font-semibold ${g.isRead?"text-gray-600":"text-gray-900"}`,children:g.title}),R.jsx("p",{className:`text-sm ${g.isRead?"text-gray-500":"text-gray-700"}`,children:g.message}),R.jsx("p",{className:"text-xs text-gray-400 mt-1",children:hk(g.timestamp)})]})]})},g.id))})})]})]})}):R.jsx("div",{className:"p-8 text-center",children:"Please log in to see your notifications."})},Tk=()=>{const s=$r(),e=kl();return s.pathname.split("/").pop(),R.jsxs("div",{className:"p-4",children:[R.jsx("button",{onClick:()=>e(-1),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4",children:"Go Back"}),R.jsx("div",{children:"Article not found"})]})},xk="Left",_k="Right",wk="Up",Ak="Down",Xs={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},nh={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},G0="mousemove",V0="mouseup",bk="touchend",Ik="touchmove",Rk="touchstart";function Lk(s,e,t,r){return s>e?t>0?_k:xk:r>0?Ak:wk}function K0(s,e){if(e===0)return s;const t=Math.PI/180*e,r=s[0]*Math.cos(t)+s[1]*Math.sin(t),n=s[1]*Math.cos(t)-s[0]*Math.sin(t);return[r,n]}function kk(s,e){const t=f=>{const g="touches"in f;g&&f.touches.length>1||s((m,y)=>{y.trackMouse&&!g&&(document.addEventListener(G0,r),document.addEventListener(V0,o));const{clientX:v,clientY:T}=g?f.touches[0]:f,S=K0([v,T],y.rotationAngle);return y.onTouchStartOrOnMouseDown&&y.onTouchStartOrOnMouseDown({event:f}),Object.assign(Object.assign(Object.assign({},m),nh),{initial:S.slice(),xy:S,start:f.timeStamp||0})})},r=f=>{s((g,m)=>{const y="touches"in f;if(y&&f.touches.length>1)return g;if(f.timeStamp-g.start>m.swipeDuration)return g.swiping?Object.assign(Object.assign({},g),{swiping:!1}):g;const{clientX:v,clientY:T}=y?f.touches[0]:f,[S,w]=K0([v,T],m.rotationAngle),b=S-g.xy[0],A=w-g.xy[1],L=Math.abs(b),k=Math.abs(A),O=(f.timeStamp||0)-g.start,P=Math.sqrt(L*L+k*k)/(O||1),$=[b/(O||1),A/(O||1)],B=Lk(L,k,b,A),U=typeof m.delta=="number"?m.delta:m.delta[B.toLowerCase()]||Xs.delta;if(L<U&&k<U&&!g.swiping)return g;const q={absX:L,absY:k,deltaX:b,deltaY:A,dir:B,event:f,first:g.first,initial:g.initial,velocity:P,vxvy:$};q.first&&m.onSwipeStart&&m.onSwipeStart(q),m.onSwiping&&m.onSwiping(q);let re=!1;return(m.onSwiping||m.onSwiped||m[`onSwiped${B}`])&&(re=!0),re&&m.preventScrollOnSwipe&&m.trackTouch&&f.cancelable&&f.preventDefault(),Object.assign(Object.assign({},g),{first:!1,eventData:q,swiping:!0})})},n=f=>{s((g,m)=>{let y;if(g.swiping&&g.eventData){if(f.timeStamp-g.start<m.swipeDuration){y=Object.assign(Object.assign({},g.eventData),{event:f}),m.onSwiped&&m.onSwiped(y);const v=m[`onSwiped${y.dir}`];v&&v(y)}}else m.onTap&&m.onTap({event:f});return m.onTouchEndOrOnMouseUp&&m.onTouchEndOrOnMouseUp({event:f}),Object.assign(Object.assign(Object.assign({},g),nh),{eventData:y})})},i=()=>{document.removeEventListener(G0,r),document.removeEventListener(V0,o)},o=f=>{i(),n(f)},u=(f,g)=>{let m=()=>{};if(f&&f.addEventListener){const y=Object.assign(Object.assign({},Xs.touchEventOptions),g.touchEventOptions),v=[[Rk,t,y],[Ik,r,Object.assign(Object.assign({},y),g.preventScrollOnSwipe?{passive:!1}:{})],[bk,n,y]];v.forEach(([T,S,w])=>f.addEventListener(T,S,w)),m=()=>v.forEach(([T,S])=>f.removeEventListener(T,S))}return m},d={ref:f=>{f!==null&&s((g,m)=>{if(g.el===f)return g;const y={};return g.el&&g.el!==f&&g.cleanUpTouch&&(g.cleanUpTouch(),y.cleanUpTouch=void 0),m.trackTouch&&f&&(y.cleanUpTouch=u(f,m)),Object.assign(Object.assign(Object.assign({},g),{el:f}),y)})}};return e.trackMouse&&(d.onMouseDown=t),[d,u]}function Ck(s,e,t,r){return!e.trackTouch||!s.el?(s.cleanUpTouch&&s.cleanUpTouch(),Object.assign(Object.assign({},s),{cleanUpTouch:void 0})):s.cleanUpTouch?e.preventScrollOnSwipe!==t.preventScrollOnSwipe||e.touchEventOptions.passive!==t.touchEventOptions.passive?(s.cleanUpTouch(),Object.assign(Object.assign({},s),{cleanUpTouch:r(s.el,e)})):s:Object.assign(Object.assign({},s),{cleanUpTouch:r(s.el,e)})}function Pk(s){const{trackMouse:e}=s,t=W.useRef(Object.assign({},nh)),r=W.useRef(Object.assign({},Xs)),n=W.useRef(Object.assign({},r.current));n.current=Object.assign({},r.current),r.current=Object.assign(Object.assign({},Xs),s);let i;for(i in Xs)r.current[i]===void 0&&(r.current[i]=Xs[i]);const[o,u]=W.useMemo(()=>kk(c=>t.current=c(t.current,r.current),{trackMouse:e}),[e]);return t.current=Ck(t.current,r.current,n.current,u),o}const Dk=({children:s})=>{const e=kl(),t=$r(),r=Pk({onSwipedLeft:()=>{if(t.pathname.includes("live")){const n=t.pathname.replace("live","news");e(n)}},onSwipedRight:()=>{if(t.pathname.includes("news")){const n=t.pathname.replace("news","live");e(n)}},preventScrollOnSwipe:!0,trackMouse:!0});return R.jsx("div",{...r,style:{touchAction:"pan-y"},children:s})},VE=W.createContext(void 0),KE=()=>{const s=W.useContext(VE);if(!s)throw new Error("useSession must be used within an AppProvider");return s},Ok=()=>{const[s,e]=W.useState(null),[t,r]=W.useState(null),[n,i]=W.useState(!0),[o,u]=W.useState(0),[c,d]=W.useState(!1),f=kl(),g=$r(),m=W.useCallback(()=>{},[]);W.useEffect(()=>{const b=async()=>{const{data:{session:L}}=await Zt.auth.getSession();i(!0),L!=null&&L.user?(await Tm(L.user.id),e(L.user),pm(L.user.id,k=>{r(k),i(!1)})):(await xm(),e(null),r(null),i(!1))},{data:{subscription:A}}=Zt.auth.onAuthStateChange(async(L,k)=>{i(!0),k!=null&&k.user?(await Tm(k.user.id),e(k.user),pm(k.user.id,O=>{r(O),i(!1)})):(await xm(),e(null),r(null),i(!1))});return b(),()=>{A.unsubscribe()}},[]),W.useEffect(()=>{if(s!=null&&s.id){const b=rv(s.id,A=>{const L=A.filter(k=>!k.isRead).length;u(L>0?L:0)});return()=>b()}},[s==null?void 0:s.id]);const y=W.useCallback(async()=>{await Zt.auth.signOut(),f("/")},[f]),v=()=>{s?f("/profile"):d(!0)},T=()=>f("/news");if(n)return R.jsx("div",{className:"w-screen h-screen flex justify-center items-center",children:R.jsx(di,{})});const S={user:s,profile:t,loading:n,reloadProfile:m,showAuthModal:c,setShowAuthModal:d};return R.jsx(VE.Provider,{value:S,children:R.jsxs("div",{className:"bg-gray-100 min-h-screen font-sans pb-20 landscape:pb-0 landscape:pr-20",children:[R.jsx(UA,{onLogoClick:T}),R.jsx("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:R.jsx(Dk,{children:R.jsxs($x,{location:g,children:[R.jsx(Xr,{path:"/news",element:R.jsx($0,{})}),R.jsx(Xr,{path:"/national",element:R.jsx(lk,{})}),R.jsx(Xr,{path:"/live",element:R.jsx(ik,{})}),R.jsx(Xr,{path:"/regional-live",element:R.jsx(ck,{})}),R.jsx(Xr,{path:"/profile",element:R.jsx(vk,{onLogout:y})}),R.jsx(Xr,{path:"/notifications",element:R.jsx(Sk,{})}),R.jsx(Xr,{path:"/article/:id",element:R.jsx(Tk,{})}),R.jsx(Xr,{path:"*",element:R.jsx($0,{})})]})})}),R.jsx(KA,{onProfileClick:v,unreadCount:o}),c&&R.jsx(WA,{onClose:()=>d(!1)})]})})},Nk=()=>R.jsx(qx,{basename:"/app",children:R.jsx(Ok,{})});XT.createRoot(document.getElementById("root")).render(R.jsx(W0.StrictMode,{children:R.jsx(Nk,{})}));
